{"file_contents":{"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/layout/footer.tsx":{"content":"import { Link } from \"wouter\";\nimport { MapPin, Phone, Mail, Instagram } from \"lucide-react\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { NewsletterForm } from \"@/components/newsletter-form\";\nimport leflowLogo from \"@/assets/leflow-logo.png\";\n\nexport function Footer() {\n  const currentYear = new Date().getFullYear();\n\n  const quickLinks = [\n    { name: \"Poƒçetna\", href: \"/\" },\n    { name: \"Pravila i Uslovi\", href: \"/pravila\" },\n    { name: \"Kontakt\", href: \"/kontakt\" }\n  ];\n\n  const scrollToServices = () => {\n    const element = document.getElementById(\"usluge\");\n    if (element) {\n      element.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n    } else {\n      window.location.href = \"/#usluge\";\n    }\n  };\n\n  const services = [\n    \"Snimanje vokala\",\n    \"Mix i Master\",\n    \"Instrumentali\",\n    \"Video produkcija\"\n  ];\n\n  return (\n    <footer className=\"bg-muted/30 border-t\">\n      <div className=\"max-w-7xl mx-auto px-6 py-12 lg:py-16\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12\">\n          <FadeInWhenVisible delay={0.1}>\n            <div>\n              <div className=\"flex items-center gap-2 mb-4\">\n                <img \n                  src={leflowLogo} \n                  alt=\"Studio LeFlow Logo\" \n                  draggable={false}\n                  onContextMenu={(e) => e.preventDefault()}\n                  className=\"h-8 w-auto dark:invert transition-all select-none\"\n                />\n                <span className=\"text-xl font-bold font-[Montserrat]\">Studio LeFlow</span>\n              </div>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Profesionalni muziƒçki studio u Beogradu za sve va≈°e kreativne potrebe.\n            </p>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                <MapPin className=\"w-4 h-4\" />\n                <span>Beograd, Srbija</span>\n              </div>\n              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                <Phone className=\"w-4 h-4\" />\n                <a href=\"tel:+381637347023\" className=\"hover:text-primary transition-colors\">\n                  +381 63 734 7023\n                </a>\n              </div>\n              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                <Mail className=\"w-4 h-4\" />\n                <a href=\"mailto:info@studioleflow.com\" className=\"hover:text-primary transition-colors\">\n                  info@studioleflow.com\n                </a>\n              </div>\n              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                <Instagram className=\"w-4 h-4\" />\n                <a href=\"https://instagram.com/studioleflow\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:text-primary transition-colors\">\n                  @studioleflow\n                </a>\n              </div>\n            </div>\n            </div>\n          </FadeInWhenVisible>\n\n          <FadeInWhenVisible delay={0.2}>\n            <div>\n              <h3 className=\"font-bold mb-4\" data-testid=\"text-footer-links-title\">Brzi Linkovi</h3>\n            <ul className=\"space-y-2\">\n              {quickLinks.map((link) => (\n                <li key={link.name}>\n                  <Link \n                    href={link.href}\n                    className=\"text-sm text-muted-foreground hover:text-primary transition-colors\" \n                    data-testid={`link-footer-${link.name.toLowerCase()}`}\n                  >\n                    {link.name}\n                  </Link>\n                </li>\n              ))}\n              <li>\n                <button\n                  onClick={scrollToServices}\n                  className=\"text-sm text-muted-foreground hover:text-primary transition-colors text-left\"\n                  data-testid=\"link-footer-usluge\"\n                >\n                  Usluge\n                </button>\n              </li>\n            </ul>\n            </div>\n          </FadeInWhenVisible>\n\n          <FadeInWhenVisible delay={0.3}>\n            <div>\n              <h3 className=\"font-bold mb-4\" data-testid=\"text-footer-services-title\">Usluge</h3>\n            <ul className=\"space-y-2\">\n              {services.map((service) => (\n                <li key={service}>\n                  <span className=\"text-sm text-muted-foreground\">{service}</span>\n                </li>\n              ))}\n            </ul>\n            </div>\n          </FadeInWhenVisible>\n\n          <FadeInWhenVisible delay={0.4}>\n            <div>\n              <h3 className=\"font-bold mb-4\">Newsletter</h3>\n              <p className=\"text-sm text-muted-foreground mb-4\">\n                Budite u toku sa najnovijim novostima i promocijama\n              </p>\n              <NewsletterForm variant=\"footer\" />\n            </div>\n          </FadeInWhenVisible>\n        </div>\n\n        <div className=\"border-t mt-12 pt-8 flex flex-col md:flex-row justify-between items-center gap-4\">\n          <p className=\"text-sm text-muted-foreground text-center md:text-left\">\n            ¬© {currentYear} Studio LeFlow. Sva prava zadr≈æana.\n          </p>\n          <div className=\"flex gap-6 text-sm text-muted-foreground\">\n            <Link \n              href=\"/pravila\"\n              className=\"hover:text-primary transition-colors\" \n              data-testid=\"link-footer-privacy\"\n            >\n              Politika Privatnosti\n            </Link>\n            <Link \n              href=\"/pravila\"\n              className=\"hover:text-primary transition-colors\" \n              data-testid=\"link-footer-terms\"\n            >\n              Uslovi Kori≈°ƒáenja\n            </Link>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5796},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { cmsContent } from \"../shared/schema\";\nimport { sql } from \"drizzle-orm\";\n\nconst defaultCmsContent = [\n  // Hero section\n  { page: 'home', section: 'hero', contentKey: 'title', contentValue: 'Studio LeFlow' },\n  { page: 'home', section: 'hero', contentKey: 'subtitle', contentValue: 'Profesionalna Muziƒçka Produkcija' },\n  { page: 'home', section: 'hero', contentKey: 'description', contentValue: 'Mix ‚Ä¢ Master ‚Ä¢ Instrumentali ‚Ä¢ Video Produkcija' },\n\n  // Services\n  { page: 'home', section: 'services', contentKey: 'service_1_title', contentValue: 'Snimanje & Mix/Master' },\n  { page: 'home', section: 'services', contentKey: 'service_1_description', contentValue: 'Profesionalno snimanje vokala i instrumenata u akustiƒçki tretiranom studiju' },\n  { page: 'home', section: 'services', contentKey: 'service_1_image', contentValue: '/client/src/assets/generated_images/Apollo_Twin_X_audio_interface_8905cd94.png' },\n  { page: 'home', section: 'services', contentKey: 'service_2_title', contentValue: 'Instrumentali & Gotove Pesme' },\n  { page: 'home', section: 'services', contentKey: 'service_2_description', contentValue: 'Kreiranje originalnih bitova i kompletna produkcija va≈°ih pesama' },\n  { page: 'home', section: 'services', contentKey: 'service_2_image', contentValue: '/client/src/assets/generated_images/Synthesizer_keyboard_with_controls_c7b4f573.png' },\n  { page: 'home', section: 'services', contentKey: 'service_3_title', contentValue: 'Video Produkcija' },\n  { page: 'home', section: 'services', contentKey: 'service_3_description', contentValue: 'Snimanje i editing profesionalnih muziƒçkih spotova' },\n  { page: 'home', section: 'services', contentKey: 'service_3_image', contentValue: '/client/src/assets/generated_images/Video_camera_production_setup_199f7c64.png' },\n  \n  // Equipment section\n  { page: 'home', section: 'equipment', contentKey: 'equipment_image', contentValue: '/client/src/assets/generated_images/Yamaha_HS8_studio_monitors_d1470a56.png' },\n\n  // CTA section\n  { page: 'home', section: 'cta', contentKey: 'title', contentValue: 'Spremni za Va≈°u Sledeƒáu Produkciju?' },\n  { page: 'home', section: 'cta', contentKey: 'description', contentValue: 'Zaka≈æite besplatnu konsultaciju i razgovarajmo o va≈°oj muziƒçkoj viziji' },\n];\n\n// Ensure messaging database triggers exist\nasync function ensureMessagingTriggers() {\n  try {\n    console.log('üîß Ensuring messaging triggers...');\n    \n    // Create function that enforces canonical ordering (user1_id < user2_id)\n    await db.execute(sql`\n      CREATE OR REPLACE FUNCTION enforce_canonical_conversation_users()\n      RETURNS TRIGGER AS $$\n      DECLARE\n        temp INT;\n      BEGIN\n        -- If user1_id > user2_id, swap them to enforce canonical ordering\n        IF NEW.user1_id > NEW.user2_id THEN\n          temp := NEW.user1_id;\n          NEW.user1_id := NEW.user2_id;\n          NEW.user2_id := temp;\n        END IF;\n        RETURN NEW;\n      END;\n      $$ LANGUAGE plpgsql;\n    `);\n    \n    // Create trigger that runs before INSERT or UPDATE on conversations\n    await db.execute(sql`\n      DROP TRIGGER IF EXISTS trigger_canonical_conversation_users ON conversations;\n    `);\n    \n    await db.execute(sql`\n      CREATE TRIGGER trigger_canonical_conversation_users\n      BEFORE INSERT OR UPDATE ON conversations\n      FOR EACH ROW\n      EXECUTE FUNCTION enforce_canonical_conversation_users();\n    `);\n    \n    console.log('‚úÖ Messaging triggers ensured');\n  } catch (error) {\n    console.error('‚ùå Error ensuring messaging triggers:', error);\n    throw error;\n  }\n}\n\nexport async function seedCmsContent() {\n  try {\n    console.log('üå± Checking CMS content...');\n    \n    // Ensure messaging triggers exist (database-level canonical ordering enforcement)\n    await ensureMessagingTriggers();\n    \n    // Check if CMS content already exists\n    const existingContent = await db.select().from(cmsContent).limit(1);\n    \n    if (existingContent.length > 0) {\n      console.log('‚úÖ CMS content already exists, skipping seed');\n      return;\n    }\n\n    console.log('üìù Seeding CMS content...');\n    \n    // Insert default content\n    await db.insert(cmsContent).values(defaultCmsContent);\n    \n    console.log(`‚úÖ Successfully seeded ${defaultCmsContent.length} CMS content entries`);\n  } catch (error) {\n    console.error('‚ùå Error seeding CMS content:', error);\n    throw error;\n  }\n}\n","size_bytes":4432},"client/src/components/ScrollIndicator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { ChevronDown } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\ninterface ScrollIndicatorProps {\n  targetId?: string;\n  className?: string;\n}\n\nexport function ScrollIndicator({ targetId = \"usluge\", className = \"\" }: ScrollIndicatorProps) {\n  const [isVisible, setIsVisible] = useState(true);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const scrollPosition = window.scrollY;\n      setIsVisible(scrollPosition < 100);\n    };\n\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, []);\n\n  const scrollToTarget = () => {\n    const element = document.getElementById(targetId);\n    if (element) {\n      element.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.button\n          onClick={scrollToTarget}\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.5 }}\n          className={`fixed bottom-8 left-1/2 -translate-x-1/2 z-20 cursor-pointer ${className}`}\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          aria-label=\"Scroll to services\"\n        >\n          <motion.div\n            animate={{\n              y: [0, 10, 0],\n            }}\n            transition={{\n              duration: 1.5,\n              repeat: Infinity,\n              ease: \"easeInOut\",\n            }}\n          >\n            <ChevronDown className=\"w-8 h-8 text-white/60 hover:text-primary transition-colors\" />\n          </motion.div>\n        </motion.button>\n      )}\n    </AnimatePresence>\n  );\n}\n","size_bytes":1749},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, serial, integer, boolean, unique, json, index, pgEnum, numeric } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums for type-safe status fields\nexport const projectStatusEnum = pgEnum(\"project_status\", [\"waiting\", \"in_progress\", \"completed\", \"cancelled\"]);\nexport const invoiceStatusEnum = pgEnum(\"invoice_status\", [\"pending\", \"paid\", \"overdue\", \"cancelled\"]);\nexport const userRankEnum = pgEnum(\"user_rank\", [\"user\", \"vip\", \"legend\", \"admin\"]);\n\n// Session table - managed by connect-pg-simple for express-session\nexport const session = pgTable(\"session\", {\n  sid: varchar(\"sid\").primaryKey(),\n  sess: json(\"sess\").notNull(),\n  expire: timestamp(\"expire\").notNull(),\n});\n\nexport const contactSubmissions = pgTable(\"contact_submissions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull(),\n  phone: text(\"phone\").notNull(),\n  service: text(\"service\").notNull(),\n  preferredDate: text(\"preferred_date\"),\n  message: text(\"message\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertContactSubmissionSchema = createInsertSchema(contactSubmissions).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  email: z.string().email(\"Unesite validnu email adresu\"),\n  phone: z.string().min(6, \"Unesite validan broj telefona\"),\n  name: z.string().min(2, \"Ime mora imati najmanje 2 karaktera\"),\n  message: z.string().min(10, \"Poruka mora imati najmanje 10 karaktera\"),\n  service: z.string().min(1, \"Izaberite uslugu\"),\n});\n\nexport type InsertContactSubmission = z.infer<typeof insertContactSubmissionSchema>;\nexport type ContactSubmission = typeof contactSubmissions.$inferSelect;\n\n// Users table - for authentication and user management\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  username: text(\"username\").notNull().unique(),\n  role: text(\"role\").notNull().default(\"user\"), // \"user\" or \"admin\"\n  rank: userRankEnum(\"rank\").notNull().default(\"user\"), // \"user\", \"vip\", \"legend\", \"admin\"\n  banned: boolean(\"banned\").notNull().default(false),\n  termsAccepted: boolean(\"terms_accepted\").notNull().default(false),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  verificationCode: text(\"verification_code\"),\n  passwordResetToken: text(\"password_reset_token\"),\n  passwordResetExpiry: timestamp(\"password_reset_expiry\"),\n  adminLoginToken: text(\"admin_login_token\"),\n  adminLoginExpiry: timestamp(\"admin_login_expiry\"),\n  usernameLastChanged: timestamp(\"username_last_changed\"),\n  avatarUrl: text(\"avatar_url\"),\n  lastSeen: timestamp(\"last_seen\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Pending Users table - for unverified registrations\n// Users stay here until they verify their email, then they are moved to users table\n// NOTE: password is already hashed before insertion\nexport const pendingUsers = pgTable(\"pending_users\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(), // Pre-hashed password\n  username: text(\"username\").notNull().unique(),\n  verificationCode: text(\"verification_code\").notNull(),\n  ipAddress: text(\"ip_address\").notNull(),\n  userAgent: text(\"user_agent\"), // For fraud detection heuristics\n  termsAccepted: boolean(\"terms_accepted\").notNull(), // No default - must be explicitly submitted\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(), // Auto-delete after 24 hours\n}, (table) => ({\n  // Composite index for faster cleanup queries\n  emailExpiresIdx: index(\"pending_users_email_expires_idx\").on(table.email, table.expiresAt),\n}));\n\n// Registration Attempts table - for IP-based rate limiting and flood protection\nexport const registrationAttempts = pgTable(\"registration_attempts\", {\n  id: serial(\"id\").primaryKey(),\n  ipAddress: text(\"ip_address\").notNull(),\n  attemptedAt: timestamp(\"attempted_at\").defaultNow().notNull(),\n  email: text(\"email\"), // Track which email was attempted for fraud detection\n  userAgent: text(\"user_agent\"), // For bot detection\n}, (table) => ({\n  // Composite index for sliding-window rate limit queries\n  ipAttemptedIdx: index(\"registration_attempts_ip_attempted_idx\").on(table.ipAddress, table.attemptedAt),\n  // Email index for fraud detection (same IP trying multiple emails)\n  emailIdx: index(\"registration_attempts_email_idx\").on(table.email),\n}));\n\n// Projects table - for uploaded MP3s\nexport const projects = pgTable(\"projects\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  genre: text(\"genre\").notNull(),\n  mp3Url: text(\"mp3_url\").notNull(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  uploadDate: timestamp(\"upload_date\").defaultNow().notNull(),\n  votesCount: integer(\"votes_count\").notNull().default(0),\n  currentMonth: text(\"current_month\").notNull(), // e.g., \"2025-01\" to track monthly limit\n  approved: boolean(\"approved\").notNull().default(false), // Admin must approve before project is visible\n  status: projectStatusEnum(\"status\").notNull().default(\"waiting\"),\n});\n\n// Votes table - for upvoting projects\nexport const votes = pgTable(\"votes\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  ipAddress: text(\"ip_address\").notNull(),\n  votedAt: timestamp(\"voted_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Prevent duplicate votes: user can only vote once per project\n  uniqueUserProject: unique().on(table.userId, table.projectId),\n  // Also prevent same IP from voting multiple times on same project\n  uniqueIpProject: unique().on(table.ipAddress, table.projectId),\n}));\n\n// Comments table - for project comments\nexport const comments = pgTable(\"comments\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  text: text(\"text\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Settings table - for giveaway toggle and other settings\nexport const settings = pgTable(\"settings\", {\n  id: serial(\"id\").primaryKey(),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\").notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// CMS Page and Section enums\nexport const cmsPages = [\"home\", \"team\"] as const;\nexport const cmsSections = [\"hero\", \"services\", \"equipment\", \"cta\", \"members\"] as const;\nexport const cmsContentTypes = [\"text\", \"image\", \"html\"] as const;\n\nexport type CmsPage = typeof cmsPages[number];\nexport type CmsSection = typeof cmsSections[number];\nexport type CmsContentType = typeof cmsContentTypes[number];\n\n// CMS Content table - for editable text/html content on the site\nexport const cmsContent = pgTable(\"cms_content\", {\n  id: serial(\"id\").primaryKey(),\n  page: text(\"page\").notNull(), // \"home\", \"team\"\n  section: text(\"section\").notNull(), // \"hero\", \"services\", \"equipment\", \"cta\", \"members\"\n  contentKey: text(\"content_key\").notNull(), // unique identifier e.g. \"hero_title\", \"service_1_title\"\n  contentValue: text(\"content_value\").notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Unique constraint: one value per page+section+key combination\n  uniquePageSectionKey: unique().on(table.page, table.section, table.contentKey),\n}));\n\n// CMS Media table - for uploaded images\nexport const cmsMedia = pgTable(\"cms_media\", {\n  id: serial(\"id\").primaryKey(),\n  page: text(\"page\").notNull(), // \"home\", \"team\"\n  section: text(\"section\").notNull(), // \"hero\", \"services\", \"equipment\", \"members\"\n  assetKey: text(\"asset_key\").notNull(), // e.g., \"hero_background\", \"team_member_1\"\n  filePath: text(\"file_path\").notNull(), // relative path: \"attached_assets/cms/home/hero_bg.png\"\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Unique constraint: one image per page+section+assetKey combination\n  uniquePageSectionAsset: unique().on(table.page, table.section, table.assetKey),\n}));\n\n// Video Spots table - for studio music video portfolio\nexport const videoSpots = pgTable(\"video_spots\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  artist: text(\"artist\").notNull(),\n  youtubeUrl: text(\"youtube_url\").notNull(),\n  order: integer(\"order\").notNull().default(0), // for custom ordering\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// User Songs table - for user-submitted YouTube songs (protected section)\nexport const userSongs = pgTable(\"user_songs\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  songTitle: text(\"song_title\").notNull(),\n  artistName: text(\"artist_name\").notNull(),\n  youtubeUrl: text(\"youtube_url\").notNull().unique(), // Duplicate protection\n  submittedAt: timestamp(\"submitted_at\").defaultNow().notNull(),\n  approved: boolean(\"approved\").notNull().default(false), // Admin must approve\n  votesCount: integer(\"votes_count\").notNull().default(0), // Cached vote count for sorting\n}, (table) => ({\n  // Index for efficient rate limiting queries (find user's last submission)\n  userSubmittedIdx: index(\"user_songs_user_submitted_idx\").on(table.userId, table.submittedAt),\n  // Index for fetching approved songs\n  approvedIdx: index(\"user_songs_approved_idx\").on(table.approved),\n  // Index for sorting by votes\n  votesCountIdx: index(\"user_songs_votes_count_idx\").on(table.votesCount),\n}));\n\n// User Song Votes table - for voting on user-submitted songs\nexport const userSongVotes = pgTable(\"user_song_votes\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  songId: integer(\"song_id\").notNull().references(() => userSongs.id, { onDelete: \"cascade\" }),\n  votedAt: timestamp(\"voted_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Prevent duplicate votes: user can only vote once per song\n  uniqueUserSong: unique().on(table.userId, table.songId),\n  // Performance index for counting votes per song\n  songIdx: index(\"user_song_votes_song_idx\").on(table.songId),\n}));\n\n// Community Messages table - for global community chat in /zajednica\nexport const communityMessages = pgTable(\"community_messages\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  message: text(\"message\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Index for fetching recent messages efficiently\n  createdAtIdx: index(\"community_messages_created_at_idx\").on(table.createdAt),\n  // Index for rate limiting checks (user's last message)\n  userCreatedIdx: index(\"community_messages_user_created_idx\").on(table.userId, table.createdAt),\n}));\n\n// Newsletter Subscribers table - for email subscriptions\nexport const newsletterSubscribers = pgTable(\"newsletter_subscribers\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"confirmed\", \"unsubscribed\"\n  confirmationToken: text(\"confirmation_token\"),\n  confirmedAt: timestamp(\"confirmed_at\"),\n  subscribedAt: timestamp(\"subscribed_at\").defaultNow().notNull(),\n  unsubscribedAt: timestamp(\"unsubscribed_at\"),\n});\n\n// Conversations table - tracks message threads between users\n// Database-level canonical ordering enforcement:\n// - PostgreSQL TRIGGER automatically swaps user1_id/user2_id so user1_id < user2_id (BEFORE INSERT/UPDATE)\n// - This guarantees unique constraint (user1_id, user2_id) prevents duplicates (A,B) and (B,A)\n// - Application can optionally use normalizeConversationUsers() helper for consistency\nexport const conversations = pgTable(\"conversations\", {\n  id: serial(\"id\").primaryKey(),\n  user1Id: integer(\"user1_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  user2Id: integer(\"user2_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  lastMessageAt: timestamp(\"last_message_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Ensure unique conversation between two users (works ONLY if application normalizes IDs)\n  uniqueUsers: unique().on(table.user1Id, table.user2Id),\n  // Performance index for sorting conversations by last message\n  lastMessageIdx: index(\"conversations_last_message_idx\").on(table.lastMessageAt),\n}));\n\n// Messages table - individual messages in conversations\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  conversationId: integer(\"conversation_id\").notNull().references(() => conversations.id, { onDelete: \"cascade\" }),\n  senderId: integer(\"sender_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  receiverId: integer(\"receiver_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  content: text(\"content\").notNull(),\n  imageUrl: text(\"image_url\"), // Optional image attachment\n  deleted: boolean(\"deleted\").notNull().default(false), // Soft delete\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Performance indexes for fetching messages\n  conversationIdx: index(\"messages_conversation_idx\").on(table.conversationId),\n  createdAtIdx: index(\"messages_created_at_idx\").on(table.createdAt),\n  // Composite index for conversation + timestamp (most common query)\n  conversationCreatedIdx: index(\"messages_conversation_created_idx\").on(table.conversationId, table.createdAt),\n}));\n\n// Message Reads table - tracks when messages are read (for seen checkmarks)\nexport const messageReads = pgTable(\"message_reads\", {\n  id: serial(\"id\").primaryKey(),\n  messageId: integer(\"message_id\").notNull().references(() => messages.id, { onDelete: \"cascade\" }),\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  readAt: timestamp(\"read_at\").defaultNow().notNull(),\n}, (table) => ({\n  // One read record per user per message\n  uniqueUserMessage: unique().on(table.userId, table.messageId),\n  // Performance index for checking read status\n  messageIdx: index(\"message_reads_message_idx\").on(table.messageId),\n}));\n\n// Admin Message Audit table - logs when admins view conversations\nexport const adminMessageAudit = pgTable(\"admin_message_audit\", {\n  id: serial(\"id\").primaryKey(),\n  adminId: integer(\"admin_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  viewedUser1Id: integer(\"viewed_user1_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  viewedUser2Id: integer(\"viewed_user2_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  viewedAt: timestamp(\"viewed_at\").defaultNow().notNull(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  projects: many(projects),\n  votes: many(votes),\n  comments: many(comments),\n  sentMessages: many(messages, { relationName: \"sentMessages\" }),\n  receivedMessages: many(messages, { relationName: \"receivedMessages\" }),\n  messageReads: many(messageReads),\n}));\n\nexport const projectsRelations = relations(projects, ({ one, many }) => ({\n  user: one(users, {\n    fields: [projects.userId],\n    references: [users.id],\n  }),\n  votes: many(votes),\n  comments: many(comments),\n}));\n\nexport const votesRelations = relations(votes, ({ one }) => ({\n  user: one(users, {\n    fields: [votes.userId],\n    references: [users.id],\n  }),\n  project: one(projects, {\n    fields: [votes.projectId],\n    references: [projects.id],\n  }),\n}));\n\nexport const commentsRelations = relations(comments, ({ one }) => ({\n  project: one(projects, {\n    fields: [comments.projectId],\n    references: [projects.id],\n  }),\n  user: one(users, {\n    fields: [comments.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const conversationsRelations = relations(conversations, ({ one, many }) => ({\n  user1: one(users, {\n    fields: [conversations.user1Id],\n    references: [users.id],\n  }),\n  user2: one(users, {\n    fields: [conversations.user2Id],\n    references: [users.id],\n  }),\n  messages: many(messages),\n}));\n\nexport const messagesRelations = relations(messages, ({ one, many }) => ({\n  conversation: one(conversations, {\n    fields: [messages.conversationId],\n    references: [conversations.id],\n  }),\n  sender: one(users, {\n    fields: [messages.senderId],\n    references: [users.id],\n    relationName: \"sentMessages\",\n  }),\n  receiver: one(users, {\n    fields: [messages.receiverId],\n    references: [users.id],\n    relationName: \"receivedMessages\",\n  }),\n  reads: many(messageReads),\n}));\n\nexport const messageReadsRelations = relations(messageReads, ({ one }) => ({\n  message: one(messages, {\n    fields: [messageReads.messageId],\n    references: [messages.id],\n  }),\n  user: one(users, {\n    fields: [messageReads.userId],\n    references: [users.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  role: true,\n  banned: true,\n}).extend({\n  email: z.string().email(\"Unesite validnu email adresu\"),\n  password: z.string().min(8, \"Lozinka mora imati najmanje 8 karaktera\"),\n  username: z.string().min(3, \"Korisniƒçko ime mora imati najmanje 3 karaktera\"),\n  termsAccepted: z.boolean({\n    required_error: \"Morate prihvatiti uslove kori≈°ƒáenja\",\n  }).refine((val) => val === true, {\n    message: \"Morate prihvatiti uslove kori≈°ƒáenja\",\n  }),\n});\n\nexport const insertPendingUserSchema = createInsertSchema(pendingUsers).omit({\n  id: true,\n  createdAt: true,\n  expiresAt: true,\n  verificationCode: true,\n}).extend({\n  email: z.string().email(\"Unesite validnu email adresu\"),\n  password: z.string().min(8, \"Lozinka mora imati najmanje 8 karaktera\"),\n  username: z.string().min(3, \"Korisniƒçko ime mora imati najmanje 3 karaktera\"),\n  termsAccepted: z.boolean({\n    required_error: \"Morate prihvatiti uslove kori≈°ƒáenja\",\n  }).refine((val) => val === true, {\n    message: \"Morate prihvatiti uslove kori≈°ƒáenja\",\n  }),\n  ipAddress: z.string().min(1, \"IP adresa je obavezna\"),\n  userAgent: z.string().optional(),\n});\n\nexport const insertRegistrationAttemptSchema = createInsertSchema(registrationAttempts).omit({\n  id: true,\n  attemptedAt: true,\n}).extend({\n  ipAddress: z.string().min(1, \"IP adresa je obavezna\"),\n  email: z.string().email(\"Unesite validnu email adresu\").optional(),\n  userAgent: z.string().optional(),\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).omit({\n  id: true,\n  uploadDate: true,\n  votesCount: true,\n  userId: true,\n  currentMonth: true,\n}).extend({\n  title: z.string().min(3, \"Naslov mora imati najmanje 3 karaktera\"),\n  description: z.string(),\n  genre: z.string().min(1, \"Izaberite ≈æanr\"),\n  mp3Url: z.string().url(\"Neva≈æeƒái URL\"),\n});\n\nexport const insertCommentSchema = createInsertSchema(comments).omit({\n  id: true,\n  createdAt: true,\n  userId: true,\n}).extend({\n  text: z.string().min(1, \"Komentar ne mo≈æe biti prazan\"),\n});\n\n// Types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertPendingUser = z.infer<typeof insertPendingUserSchema>;\nexport type PendingUser = typeof pendingUsers.$inferSelect;\n\nexport type InsertRegistrationAttempt = z.infer<typeof insertRegistrationAttemptSchema>;\nexport type RegistrationAttempt = typeof registrationAttempts.$inferSelect;\n\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\nexport type Project = typeof projects.$inferSelect;\n\nexport type InsertComment = z.infer<typeof insertCommentSchema>;\nexport type Comment = typeof comments.$inferSelect;\n\nexport type Vote = typeof votes.$inferSelect;\nexport type Setting = typeof settings.$inferSelect;\nexport type CmsContent = typeof cmsContent.$inferSelect;\nexport type CmsMedia = typeof cmsMedia.$inferSelect;\n\n// CMS Insert schemas\nexport const insertCmsContentSchema = createInsertSchema(cmsContent).omit({\n  id: true,\n  updatedAt: true,\n}).extend({\n  page: z.enum(cmsPages),\n  section: z.enum(cmsSections),\n  contentKey: z.string().min(1, \"Content key ne mo≈æe biti prazan\"),\n  contentValue: z.string(),\n});\n\nexport const insertCmsMediaSchema = createInsertSchema(cmsMedia).omit({\n  id: true,\n  updatedAt: true,\n}).extend({\n  page: z.enum(cmsPages),\n  section: z.enum(cmsSections),\n  assetKey: z.string().min(1, \"Asset key ne mo≈æe biti prazan\"),\n  filePath: z.string().min(1, \"File path ne mo≈æe biti prazan\"),\n});\n\nexport type InsertCmsContent = z.infer<typeof insertCmsContentSchema>;\nexport type InsertCmsMedia = z.infer<typeof insertCmsMediaSchema>;\n\n// Video Spots schemas\nexport const insertVideoSpotSchema = createInsertSchema(videoSpots).omit({\n  id: true,\n  createdAt: true,\n  order: true,\n}).extend({\n  title: z.string().min(3, \"Naslov mora imati najmanje 3 karaktera\"),\n  description: z.string().min(10, \"Opis mora imati najmanje 10 karaktera\"),\n  artist: z.string().min(2, \"Ime izvoƒëaƒça mora imati najmanje 2 karaktera\"),\n  youtubeUrl: z.string().url(\"Unesite validan YouTube URL\").regex(/^https?:\\/\\/(www\\.)?(youtube\\.com|youtu\\.be)\\//, \"URL mora biti sa YouTube-a\"),\n});\n\nexport type InsertVideoSpot = z.infer<typeof insertVideoSpotSchema>;\nexport type VideoSpot = typeof videoSpots.$inferSelect;\n\nexport const insertUserSongSchema = createInsertSchema(userSongs).omit({\n  id: true,\n  userId: true,\n  submittedAt: true,\n  approved: true,\n  votesCount: true,\n}).extend({\n  songTitle: z.string().min(3, \"Naslov pesme mora imati najmanje 3 karaktera\").max(100, \"Naslov pesme mo≈æe imati najvi≈°e 100 karaktera\"),\n  artistName: z.string().min(2, \"Ime izvoƒëaƒça mora imati najmanje 2 karaktera\").max(100, \"Ime izvoƒëaƒça mo≈æe imati najvi≈°e 100 karaktera\"),\n  youtubeUrl: z.string().url(\"Unesite validan YouTube URL\").regex(/^https?:\\/\\/(www\\.)?(youtube\\.com|youtu\\.be)\\//, \"URL mora biti sa YouTube-a\"),\n});\n\nexport type InsertUserSong = z.infer<typeof insertUserSongSchema>;\nexport type UserSong = typeof userSongs.$inferSelect;\n\n// Newsletter Subscribers schemas\nexport const insertNewsletterSubscriberSchema = createInsertSchema(newsletterSubscribers).omit({\n  id: true,\n  status: true,\n  confirmationToken: true,\n  confirmedAt: true,\n  subscribedAt: true,\n  unsubscribedAt: true,\n}).extend({\n  email: z.string().email(\"Unesite validnu email adresu\"),\n});\n\nexport type InsertNewsletterSubscriber = z.infer<typeof insertNewsletterSubscriberSchema>;\nexport type NewsletterSubscriber = typeof newsletterSubscribers.$inferSelect;\n\n// Messaging types\nexport type Conversation = typeof conversations.$inferSelect;\nexport type Message = typeof messages.$inferSelect;\nexport type MessageRead = typeof messageReads.$inferSelect;\nexport type AdminMessageAudit = typeof adminMessageAudit.$inferSelect;\n\n// Messaging insert schemas\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n  deleted: true,\n}).extend({\n  content: z.string().min(1, \"Poruka ne mo≈æe biti prazna\").max(5000, \"Poruka mo≈æe imati najvi≈°e 5000 karaktera\"),\n  imageUrl: z.string().url(\"Neva≈æeƒái URL\").optional().or(z.literal(\"\")),\n});\n\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\n// Helper function to normalize conversation user IDs (canonical ordering)\n// MUST be used before INSERT/SELECT to prevent duplicate conversations\nexport function normalizeConversationUsers(userId1: number, userId2: number): [number, number] {\n  return userId1 < userId2 ? [userId1, userId2] : [userId2, userId1];\n}\n\n// Contracts table - for legal contract generation and management\nexport const contracts = pgTable(\"contracts\", {\n  id: serial(\"id\").primaryKey(),\n  contractNumber: varchar(\"contract_number\", { length: 20 }).notNull().unique(),\n  contractType: varchar(\"contract_type\", { length: 50 }).notNull(), // \"mix_master\" | \"copyright_transfer\" | \"instrumental_sale\"\n  contractData: json(\"contract_data\").notNull(), // All contract-specific fields stored as JSON\n  pdfPath: text(\"pdf_path\"), // Path to generated PDF file\n  clientEmail: text(\"client_email\"), // Client's email for sending contract\n  userId: integer(\"user_id\").references(() => users.id, { onDelete: \"set null\" }), // Optional: Direct link to user account\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  createdBy: integer(\"created_by\").notNull().references(() => users.id), // Admin who created the contract\n});\n\nexport const insertContractSchema = createInsertSchema(contracts).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  contractNumber: z.string().min(1, \"Broj ugovora je obavezan\"),\n  contractType: z.enum([\"mix_master\", \"copyright_transfer\", \"instrumental_sale\"]),\n  contractData: z.object({}).passthrough(), // Accept any valid JSON object\n  clientEmail: z.string().email(\"Neva≈æeƒáa email adresa\").optional().or(z.literal(\"\")),\n  userId: z.number().int().positive().optional().nullable(),\n});\n\nexport type InsertContract = z.infer<typeof insertContractSchema>;\nexport type Contract = typeof contracts.$inferSelect;\n\n// Contract Data Validation Schemas\nexport const mixMasterContractDataSchema = z.object({\n  contractDate: z.string().min(1, \"Datum ugovora je obavezan\"),\n  contractPlace: z.string().min(1, \"Mesto je obavezno\"),\n  studioName: z.string().min(1, \"Naziv studija je obavezan\"),\n  studioAddress: z.string().min(1, \"Adresa studija je obavezna\"),\n  studioMaticniBroj: z.string().optional(),\n  clientName: z.string().min(1, \"Ime klijenta je obavezno\"),\n  clientAddress: z.string().min(1, \"Adresa klijenta je obavezna\"),\n  clientMaticniBroj: z.string().optional(),\n  projectName: z.string().min(1, \"Naziv projekta je obavezan\"),\n  channelCount: z.string().min(1, \"Broj kanala je obavezan\"),\n  deliveryFormat: z.string().min(1, \"Format isporuke je obavezan\"),\n  deliveryDate: z.string().min(1, \"Rok isporuke je obavezan\"),\n  totalAmount: z.string().min(1, \"Ukupna naknada je obavezna\"),\n  advancePayment: z.string().min(1, \"Avans je obavezan\"),\n  remainingPayment: z.string().min(1, \"Preostali iznos je obavezan\"),\n  paymentMethod: z.string().min(1, \"Naƒçin plaƒáanja je obavezan\"),\n  vocalRecording: z.enum([\"yes\", \"no\"]),\n  vocalRights: z.enum([\"client\", \"studio\", \"other\"]).optional(),\n  vocalRightsOther: z.string().optional(),\n  jurisdiction: z.string().min(1, \"Nadle≈æni sud je obavezan\"),\n  copies: z.string().min(1, \"Broj primeraka je obavezan\"),\n  finalDate: z.string().min(1, \"Zavr≈°ni datum je obavezan\"),\n});\n\nexport const copyrightTransferContractDataSchema = z.object({\n  contractDate: z.string().min(1, \"Datum ugovora je obavezan\"),\n  contractPlace: z.string().min(1, \"Mesto je obavezno\"),\n  authorName: z.string().min(1, \"Ime autora je obavezno\"),\n  authorAddress: z.string().min(1, \"Adresa autora je obavezna\"),\n  authorMaticniBroj: z.string().optional(),\n  buyerName: z.string().min(1, \"Ime kupca je obavezno\"),\n  buyerAddress: z.string().min(1, \"Adresa kupca je obavezna\"),\n  buyerMaticniBroj: z.string().optional(),\n  songTitle: z.string().min(1, \"Naziv pesme je obavezan\"),\n  components: z.object({\n    text: z.boolean(),\n    music: z.boolean(),\n    vocals: z.boolean(),\n    mixMaster: z.boolean(),\n    other: z.boolean(),\n    otherText: z.string().optional(),\n  }),\n  rightsType: z.enum([\"exclusive\", \"nonexclusive\"]),\n  rightsScope: z.object({\n    reproduction: z.boolean(),\n    distribution: z.boolean(),\n    performance: z.boolean(),\n    adaptation: z.boolean(),\n    other: z.boolean(),\n    otherText: z.string().optional(),\n  }),\n  territory: z.string().min(1, \"Teritorija je obavezna\"),\n  duration: z.string().min(1, \"Trajanje je obavezno\"),\n  totalAmount: z.string().min(1, \"Ukupna naknada je obavezna\"),\n  firstPayment: z.string().optional(),\n  firstPaymentDate: z.string().optional(),\n  secondPayment: z.string().optional(),\n  secondPaymentDate: z.string().optional(),\n  paymentMethod: z.string().min(1, \"Naƒçin plaƒáanja je obavezan\"),\n  authorPercentage: z.string().optional(),\n  buyerPercentage: z.string().optional(),\n  jurisdiction: z.string().min(1, \"Nadle≈æni sud je obavezan\"),\n  copies: z.string().min(1, \"Broj primeraka je obavezan\"),\n  finalDate: z.string().min(1, \"Zavr≈°ni datum je obavezan\"),\n});\n\nexport const instrumentalSaleContractDataSchema = z.object({\n  contractDate: z.string().min(1, \"Datum ugovora je obavezan\"),\n  contractPlace: z.string().min(1, \"Mesto je obavezno\"),\n  authorName: z.string().min(1, \"Ime autora je obavezno\"),\n  authorAddress: z.string().min(1, \"Adresa autora je obavezna\"),\n  authorMaticniBroj: z.string().optional(),\n  buyerName: z.string().min(1, \"Ime kupca je obavezno\"),\n  buyerAddress: z.string().min(1, \"Adresa kupca je obavezna\"),\n  buyerMaticniBroj: z.string().optional(),\n  instrumentalName: z.string().min(1, \"Naziv instrumentala je obavezan\"),\n  duration: z.string().optional(),\n  rightsType: z.enum([\"exclusive\", \"nonexclusive\"]),\n  rightsScope: z.object({\n    reproduction: z.boolean(),\n    distribution: z.boolean(),\n    performance: z.boolean(),\n    adaptation: z.boolean(),\n    other: z.boolean(),\n    otherText: z.string().optional(),\n  }),\n  territory: z.string().min(1, \"Teritorija je obavezna\"),\n  durationPeriod: z.string().min(1, \"Trajanje je obavezno\"),\n  totalAmount: z.string().min(1, \"Ukupna naknada je obavezna\"),\n  advancePayment: z.string().min(1, \"Avans je obavezan\"),\n  remainingPayment: z.string().min(1, \"Preostali iznos je obavezan\"),\n  paymentMethod: z.string().min(1, \"Naƒçin plaƒáanja je obavezan\"),\n  authorPercentage: z.string().optional(),\n  buyerPercentage: z.string().optional(),\n  jurisdiction: z.string().min(1, \"Nadle≈æni sud je obavezan\"),\n  copies: z.string().min(1, \"Broj primeraka je obavezan\"),\n  finalDate: z.string().min(1, \"Zavr≈°ni datum je obavezan\"),\n});\n\n// Invoices table - for managing client invoices and payments\nexport const invoices = pgTable(\"invoices\", {\n  id: serial(\"id\").primaryKey(),\n  invoiceNumber: varchar(\"invoice_number\", { length: 20 }).notNull().unique(),\n  contractId: integer(\"contract_id\").references(() => contracts.id), // Optional: link to contract\n  userId: integer(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Client who receives the invoice\n  amount: numeric(\"amount\", { precision: 12, scale: 2 }).notNull(), // Numeric for aggregations\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"RSD\"), // ISO currency code (RSD, EUR)\n  status: invoiceStatusEnum(\"status\").notNull().default(\"pending\"),\n  description: text(\"description\").notNull(), // What the invoice is for\n  notes: text(\"notes\"), // Optional additional notes\n  issuedDate: timestamp(\"issued_date\").defaultNow().notNull(),\n  dueDate: timestamp(\"due_date\").notNull(), // Payment deadline\n  paidDate: timestamp(\"paid_date\"), // When payment was received\n  createdBy: integer(\"created_by\").notNull().references(() => users.id), // Admin who created the invoice\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Index for finding invoices by user\n  userIdx: index(\"invoices_user_idx\").on(table.userId),\n  // Index for finding invoices by status\n  statusIdx: index(\"invoices_status_idx\").on(table.status),\n  // Index for finding overdue invoices\n  dueDateIdx: index(\"invoices_due_date_idx\").on(table.dueDate),\n}));\n\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({\n  id: true,\n  createdAt: true,\n  issuedDate: true,\n}).extend({\n  invoiceNumber: z.string().min(1, \"Broj fakture je obavezan\"),\n  amount: z.coerce.number().nonnegative(\"Iznos mora biti pozitivan broj\"),\n  currency: z.enum([\"RSD\", \"EUR\"]).default(\"RSD\"),\n  status: z.enum([\"pending\", \"paid\", \"overdue\", \"cancelled\"]).default(\"pending\"),\n  description: z.string().min(1, \"Opis je obavezan\"),\n  notes: z.string().optional().nullable(),\n  dueDate: z.date().or(z.string()),\n  paidDate: z.date().or(z.string()).optional().nullable(),\n});\n\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\nexport type Invoice = typeof invoices.$inferSelect;\n\n// Community Messages - insert schema and types\nexport const insertCommunityMessageSchema = createInsertSchema(communityMessages).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  message: z.string().min(1, \"Poruka ne mo≈æe biti prazna\").max(85, \"Poruka mo≈æe imati maksimalno 85 karaktera\"),\n});\n\nexport type InsertCommunityMessage = z.infer<typeof insertCommunityMessageSchema>;\nexport type CommunityMessage = typeof communityMessages.$inferSelect;\n","size_bytes":32943},"client/src/pages/giveaway.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { Link } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { Heart, Upload, MessageCircle, Send, Music, Trophy } from \"lucide-react\";\nimport { useUploadThing } from \"@/lib/uploadthing\";\nimport { SEO } from \"@/components/SEO\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ntype ProjectWithUser = {\n  id: number;\n  title: string;\n  description: string;\n  genre: string;\n  mp3Url: string;\n  userId: number;\n  uploadDate: string;\n  votesCount: number;\n  currentMonth: string;\n  username: string;\n};\n\ntype CommentWithUser = {\n  id: number;\n  projectId: number;\n  userId: number;\n  text: string;\n  createdAt: string;\n  username: string;\n};\n\nexport default function Giveaway() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [termsAccepted, setTermsAccepted] = useState(false);\n  const [showTermsDialog, setShowTermsDialog] = useState(false);\n  const [commentTexts, setCommentTexts] = useState<Record<number, string>>({});\n  \n  const [uploadDialogOpen, setUploadDialogOpen] = useState(false);\n  const [uploadForm, setUploadForm] = useState({\n    title: \"\",\n    description: \"\",\n    genre: \"\",\n    file: null as File | null,\n  });\n  const [isUploading, setIsUploading] = useState(false);\n\n  const { startUpload } = useUploadThing(\"audioUploader\", {\n    onClientUploadComplete: async (files) => {\n      if (files && files.length > 0) {\n        const file = files[0];\n        if (!file) return;\n        \n        // Save project metadata to database\n        const response = await apiRequest(\"POST\", \"/api/giveaway/projects\", {\n          title: uploadForm.title.trim(),\n          description: uploadForm.description.trim(),\n          genre: uploadForm.genre,\n          mp3Url: file.url,\n        });\n\n        queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/projects\"] });\n        setUploadDialogOpen(false);\n        setUploadForm({\n          title: \"\",\n          description: \"\",\n          genre: \"\",\n          file: null,\n        });\n        setIsUploading(false);\n        \n        toast({\n          title: \"Projekat uploadovan\",\n          description: \"Va≈° projekat je uspe≈°no dodat u konkurs!\",\n        });\n      }\n    },\n    onUploadError: (error: Error) => {\n      setIsUploading(false);\n      toast({\n        title: \"Gre≈°ka pri upload-u\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const { data: settings } = useQuery<{ isActive: boolean }>({\n    queryKey: [\"/api/giveaway/settings\"],\n  });\n\n  const { data: projects = [], isLoading: projectsLoading } = useQuery<ProjectWithUser[]>({\n    queryKey: [\"/api/giveaway/projects\"],\n  });\n\n  useEffect(() => {\n    if (user && !user.termsAccepted) {\n      setShowTermsDialog(true);\n    }\n  }, [user]);\n\n  const acceptTermsMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/user/accept-terms\");\n    },\n    onSuccess: async () => {\n      // Refetch user data to get updated termsAccepted status\n      await queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/user\"] });\n      setShowTermsDialog(false);\n      toast({\n        title: \"Pravila prihvaƒáena\",\n        description: \"Sada mo≈æete uƒçestvovati u giveaway-u!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const voteMutation = useMutation({\n    mutationFn: async (projectId: number) => {\n      const response = await apiRequest(\"POST\", \"/api/giveaway/vote\", { projectId });\n      return await response.json() as { action: 'added' | 'removed' };\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/projects\"] });\n      if (data.action === 'added') {\n        toast({\n          title: \"Glas dodat\",\n          description: \"Uspe≈°no ste glasali za projekat!\",\n        });\n      } else {\n        toast({\n          title: \"Glas uklonjen\",\n          description: \"Uspe≈°no ste uklonili glas\",\n        });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const commentMutation = useMutation({\n    mutationFn: async ({ projectId, text }: { projectId: number; text: string }) => {\n      await apiRequest(\"POST\", \"/api/giveaway/comments\", { projectId, text });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/projects\", variables.projectId, \"comments\"] });\n      setCommentTexts({ ...commentTexts, [variables.projectId]: \"\" });\n      toast({\n        title: \"Komentar dodat\",\n        description: \"Va≈° komentar je uspe≈°no dodat!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleUploadSubmit = async () => {\n    if (!user?.termsAccepted) {\n      toast({\n        title: \"Morate prihvatiti pravila\",\n        description: \"Pre upload-a morate prihvatiti pravila kori≈°ƒáenja\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!uploadForm.file || !uploadForm.title.trim() || !uploadForm.genre) {\n      toast({\n        title: \"Popunite sva polja\",\n        description: \"Sva polja su obavezna\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (uploadForm.title.trim().length < 3) {\n      toast({\n        title: \"Naslov je prekratak\",\n        description: \"Naslov mora imati najmanje 3 karaktera\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!uploadForm.file.type.startsWith('audio/')) {\n      toast({\n        title: \"Neva≈æeƒái fajl\",\n        description: \"Fajl mora biti audio format (MP3, WAV, itd.)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const maxSize = 50 * 1024 * 1024;\n    if (uploadForm.file.size > maxSize) {\n      toast({\n        title: \"Fajl je prevelik\",\n        description: \"Maksimalna veliƒçina je 50MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n    \n    try {\n      await startUpload([uploadForm.file]);\n    } catch (error) {\n      setIsUploading(false);\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri upload-u\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleAcceptTerms = () => {\n    if (termsAccepted) {\n      acceptTermsMutation.mutate();\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0] || null;\n    setUploadForm({ ...uploadForm, file });\n  };\n\n  const handleVote = (projectId: number) => {\n    if (!user?.termsAccepted) {\n      toast({\n        title: \"Morate prihvatiti pravila\",\n        description: \"Pre glasanja morate prihvatiti pravila kori≈°ƒáenja\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    voteMutation.mutate(projectId);\n  };\n\n  const handleComment = (projectId: number) => {\n    const text = commentTexts[projectId]?.trim();\n    if (!text) return;\n\n    if (!user?.termsAccepted) {\n      toast({\n        title: \"Morate prihvatiti pravila\",\n        description: \"Pre komentarisanja morate prihvatiti pravila kori≈°ƒáenja\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    commentMutation.mutate({ projectId, text });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Giveaway - Studio LeFlow | Glasaj za Najbolje Pesme\"\n        description=\"Uƒçestvuj u meseƒçnom giveaway-u Studio LeFlow-a! Podeli svoju pesmu, glasaj za omiljene pesme, osvoji nagrade. Besplatno snimanje, miks i mastering za najbolje projekte.\"\n        keywords={[\n          \"studio leflow giveaway\",\n          \"leflow studio giveaway\",\n          \"leflow giveaway\",\n          \"muziƒçki giveaway beograd\",\n          \"besplatno snimanje pesme\",\n          \"glasanje za pesme\",\n          \"muziƒçki konkurs beograd\",\n          \"pobedi snimanje pesme\",\n          \"meseƒçni muziƒçki konkurs\"\n        ]}\n      />\n      <AlertDialog open={showTermsDialog}>\n        <AlertDialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-terms\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"text-2xl font-bold\" data-testid=\"text-terms-title\">\n              Pravila Kori≈°ƒáenja Giveaway Platforme\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-base\">\n              Pre nego ≈°to nastavite, morate prihvatiti pravila:\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n\n          <div className=\"space-y-4 py-4\">\n            <ul className=\"space-y-3 text-sm\">\n              <li className=\"flex items-start gap-3\" data-testid=\"text-rule-1\">\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0\" />\n                <span>Zabranjeno je downloadovanje MP3 fajlova drugih korisnika</span>\n              </li>\n              <li className=\"flex items-start gap-3\" data-testid=\"text-rule-2\">\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0\" />\n                <span>Zabranjeno je deljenje projekata izvan platforme</span>\n              </li>\n              <li className=\"flex items-start gap-3\" data-testid=\"text-rule-3\">\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0\" />\n                <span>Kr≈°enje pravila dovodi do permanentnog bana</span>\n              </li>\n              <li className=\"flex items-start gap-3\" data-testid=\"text-rule-4\">\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0\" />\n                <span>Va≈°i upload-ovani projekti ƒáe biti dostupni 30 dana</span>\n              </li>\n            </ul>\n\n            <Separator />\n\n            <div className=\"bg-muted/50 p-4 rounded-lg border\">\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                Za detaljne informacije proƒçitajte:{\" \"}\n                <Link href=\"/uslovi-koriscenja\" data-testid=\"link-full-terms\">\n                  <span className=\"text-primary hover:underline font-medium cursor-pointer\">\n                    Kompletne Uslove Kori≈°ƒáenja\n                  </span>\n                </Link>\n              </p>\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox\n                id=\"terms\"\n                checked={termsAccepted}\n                onCheckedChange={(checked) => setTermsAccepted(checked as boolean)}\n                data-testid=\"checkbox-accept-terms\"\n              />\n              <label\n                htmlFor=\"terms\"\n                className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n              >\n                Prihvatam pravila i uslove\n              </label>\n            </div>\n          </div>\n\n          <AlertDialogFooter>\n            <Button\n              onClick={handleAcceptTerms}\n              disabled={!termsAccepted || acceptTermsMutation.isPending}\n              data-testid=\"button-accept-terms\"\n            >\n              {acceptTermsMutation.isPending ? \"Prihvatanje...\" : \"Prihvati\"}\n            </Button>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <section className=\"relative py-20 lg:py-32 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 text-center\">\n          <div className=\"mb-6 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20\">\n            <Trophy className=\"w-4 h-4 text-primary\" />\n            <span className=\"text-sm font-medium\" data-testid=\"text-contest-badge\">Meseƒçni Konkurs</span>\n          </div>\n\n          <h1 className=\"text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight font-[Montserrat]\" data-testid=\"text-hero-title\">\n            Meseƒçni Giveaway\n          </h1>\n\n          <p className=\"text-xl md:text-2xl mb-4 text-muted-foreground max-w-3xl mx-auto\">\n            Pobedi Besplatnu Produkciju!\n          </p>\n\n          <p className=\"text-lg mb-12 text-muted-foreground max-w-2xl mx-auto\">\n            Uploaduj svoj projekat, glasaj za najbolje, i osvoji profesionalnu produkciju u Studio LeFlow\n          </p>\n\n          <Dialog open={uploadDialogOpen} onOpenChange={setUploadDialogOpen}>\n            <DialogTrigger asChild>\n              <Button\n                size=\"lg\"\n                disabled={!settings?.isActive || !user}\n                className=\"text-lg px-8\"\n                data-testid=\"button-upload-project\"\n              >\n                <Upload className=\"mr-2 w-5 h-5\" />\n                {!user \n                  ? \"Prijavite se da upload-ujete\"\n                  : settings?.isActive \n                    ? \"Uploaduj Projekat\" \n                    : \"Giveaway Trenutno Neaktivan\"\n                }\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-lg\" data-testid=\"dialog-upload\">\n              <DialogHeader>\n                <DialogTitle className=\"text-2xl font-bold\" data-testid=\"text-upload-title\">\n                  Uploaduj Projekat\n                </DialogTitle>\n                <DialogDescription>\n                  Popunite formu da dodate va≈° projekat u meseƒçni konkurs.\n                </DialogDescription>\n              </DialogHeader>\n\n              <div className=\"space-y-6 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"file\" className=\"text-sm font-medium\">\n                    MP3 Fajl <span className=\"text-destructive\">*</span>\n                  </Label>\n                  <Input\n                    id=\"file\"\n                    type=\"file\"\n                    accept=\"audio/*\"\n                    onChange={handleFileChange}\n                    disabled={isUploading}\n                    data-testid=\"input-upload-file\"\n                  />\n                  {uploadForm.file && (\n                    <p className=\"text-xs text-muted-foreground\" data-testid=\"text-file-name\">\n                      {uploadForm.file.name} ({(uploadForm.file.size / 1024 / 1024).toFixed(2)} MB)\n                    </p>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\" className=\"text-sm font-medium\">\n                    Naslov Projekta <span className=\"text-destructive\">*</span>\n                  </Label>\n                  <Input\n                    id=\"title\"\n                    type=\"text\"\n                    placeholder=\"Unesite naslov...\"\n                    value={uploadForm.title}\n                    onChange={(e) => setUploadForm({ ...uploadForm, title: e.target.value })}\n                    disabled={isUploading}\n                    data-testid=\"input-upload-title\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\" className=\"text-sm font-medium\">\n                    Opis (opciono)\n                  </Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder=\"Kratko opi≈°ite svoj projekat...\"\n                    value={uploadForm.description}\n                    onChange={(e) => setUploadForm({ ...uploadForm, description: e.target.value })}\n                    disabled={isUploading}\n                    className=\"resize-none min-h-[100px]\"\n                    data-testid=\"input-upload-description\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"genre\" className=\"text-sm font-medium\">\n                    ≈Ωanr <span className=\"text-destructive\">*</span>\n                  </Label>\n                  <Select\n                    value={uploadForm.genre}\n                    onValueChange={(value) => setUploadForm({ ...uploadForm, genre: value })}\n                    disabled={isUploading}\n                  >\n                    <SelectTrigger id=\"genre\" data-testid=\"select-upload-genre\">\n                      <SelectValue placeholder=\"Izaberite ≈æanr...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Hip Hop\" data-testid=\"genre-option-hiphop\">Hip Hop</SelectItem>\n                      <SelectItem value=\"Trap\" data-testid=\"genre-option-trap\">Trap</SelectItem>\n                      <SelectItem value=\"R&B\" data-testid=\"genre-option-rnb\">R&B</SelectItem>\n                      <SelectItem value=\"Pop\" data-testid=\"genre-option-pop\">Pop</SelectItem>\n                      <SelectItem value=\"Rock\" data-testid=\"genre-option-rock\">Rock</SelectItem>\n                      <SelectItem value=\"Electronic\" data-testid=\"genre-option-electronic\">Electronic</SelectItem>\n                      <SelectItem value=\"Ostalo\" data-testid=\"genre-option-other\">Ostalo</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              <DialogFooter>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setUploadDialogOpen(false)}\n                  disabled={isUploading}\n                  data-testid=\"button-upload-cancel\"\n                >\n                  Otka≈æi\n                </Button>\n                <Button\n                  onClick={handleUploadSubmit}\n                  disabled={isUploading || !uploadForm.file || !uploadForm.title.trim() || !uploadForm.genre}\n                  data-testid=\"button-upload-submit\"\n                >\n                  {isUploading ? \"Upload...\" : \"Upload Projekat\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n\n          {!settings?.isActive && (\n            <p className=\"text-sm text-muted-foreground mt-4\" data-testid=\"text-inactive-notice\">\n              Upload projekata je trenutno onemoguƒáen. Pratite nas za najave sledeƒáeg konkursa!\n            </p>\n          )}\n          \n          {!user && (\n            <p className=\"text-sm text-muted-foreground mt-4\" data-testid=\"text-login-notice\">\n              Prijavite se ili registrujte da uƒçestvujete u giveaway-u.\n            </p>\n          )}\n        </div>\n      </section>\n\n      <section className=\"py-20 lg:py-32 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n          <div className=\"mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold mb-4 tracking-tight\" data-testid=\"text-projects-title\">\n              Konkursni Projekti\n            </h2>\n            <p className=\"text-muted-foreground\">\n              Slu≈°ajte i glasajte za va≈°e omiljene projekte. Projekat sa najvi≈°e glasova osvaja!\n            </p>\n          </div>\n\n          {projectsLoading ? (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n              {[1, 2, 3, 4].map((i) => (\n                <FadeInWhenVisible key={i} delay={i * 0.1}>\n                  <Card className=\"animate-pulse\">\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                      <Skeleton className=\"h-4 w-1/2\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-32 w-full\" />\n                    </CardContent>\n                  </Card>\n                </FadeInWhenVisible>\n              ))}\n            </div>\n          ) : projects.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Music className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground\" />\n                <p className=\"text-lg text-muted-foreground\" data-testid=\"text-no-projects\">\n                  Jo≈° nema projekata. Budite prvi koji ƒáe uploadovati!\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n              {projects.map((project, index) => (\n                <FadeInWhenVisible key={project.id} delay={index * 0.1}>\n                  <ProjectCard\n                    project={project}\n                    onVote={handleVote}\n                    onComment={handleComment}\n                    commentText={commentTexts[project.id] || \"\"}\n                    onCommentChange={(text) => setCommentTexts({ ...commentTexts, [project.id]: text })}\n                    currentUserId={user?.id}\n                  />\n                </FadeInWhenVisible>\n              ))}\n            </div>\n          )}\n        </div>\n      </section>\n    </div>\n  );\n}\n\nfunction ProjectCard({\n  project,\n  onVote,\n  onComment,\n  commentText,\n  onCommentChange,\n  currentUserId,\n}: {\n  project: ProjectWithUser;\n  onVote: (id: number) => void;\n  onComment: (id: number) => void;\n  commentText: string;\n  onCommentChange: (text: string) => void;\n  currentUserId?: number;\n}) {\n  const [showComments, setShowComments] = useState(false);\n\n  const { data: comments = [], isLoading: commentsLoading } = useQuery<CommentWithUser[]>({\n    queryKey: [\"/api/giveaway/projects\", project.id, \"comments\"],\n    enabled: showComments,\n  });\n\n  return (\n    <Card className=\"overflow-visible hover-elevate active-elevate-2\" data-testid={`card-project-${project.id}`}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-2xl mb-2\" data-testid={`text-project-title-${project.id}`}>\n              {project.title}\n            </CardTitle>\n            <CardDescription className=\"flex flex-wrap items-center gap-2\">\n              <span data-testid={`text-project-author-${project.id}`}>\n                od <span className=\"font-semibold\">{project.username}</span>\n              </span>\n              <span className=\"text-muted-foreground\">‚Ä¢</span>\n              <span data-testid={`text-project-date-${project.id}`}>\n                {format(new Date(project.uploadDate), \"dd.MM.yyyy\")}\n              </span>\n            </CardDescription>\n          </div>\n          <Badge variant=\"secondary\" data-testid={`badge-genre-${project.id}`}>\n            {project.genre}\n          </Badge>\n        </div>\n        {project.description && (\n          <p className=\"text-sm text-muted-foreground mt-2\" data-testid={`text-project-description-${project.id}`}>\n            {project.description}\n          </p>\n        )}\n      </CardHeader>\n\n      <CardContent className=\"space-y-6\">\n        {/* \n          NOTE: controlsList=\"nodownload\" provides basic download prevention,\n          but technical users can still inspect network requests to access MP3 URLs.\n          Real enforcement relies on:\n          1. Legal terms that users must accept before accessing giveaway\n          2. Social accountability (usernames are public)\n          3. Ban consequences for violations\n          Future: Implement proxy streaming with signed URLs for stronger protection\n        */}\n        <div className=\"bg-muted/30 rounded-lg p-4\">\n          <audio\n            controls\n            controlsList=\"nodownload\"\n            preload=\"metadata\"\n            className=\"w-full h-12\"\n            style={{ outline: 'none' }}\n            src={project.mp3Url}\n            data-testid={`audio-player-${project.id}`}\n          />\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <motion.div\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            transition={{ type: \"spring\", stiffness: 400, damping: 17 }}\n          >\n            <Button\n              variant=\"outline\"\n              size=\"default\"\n              onClick={() => onVote(project.id)}\n              className=\"gap-2\"\n              data-testid={`button-vote-${project.id}`}\n            >\n              <Heart className=\"w-4 h-4\" />\n              <span data-testid={`text-votes-count-${project.id}`}>{project.votesCount}</span>\n            </Button>\n          </motion.div>\n\n          <Button\n            variant=\"ghost\"\n            size=\"default\"\n            onClick={() => setShowComments(!showComments)}\n            className=\"gap-2\"\n            data-testid={`button-toggle-comments-${project.id}`}\n          >\n            <MessageCircle className=\"w-4 h-4\" />\n            <span>Komentari ({comments.length})</span>\n          </Button>\n        </div>\n\n        {showComments && (\n          <div className=\"space-y-4\">\n            <Separator />\n\n            {commentsLoading ? (\n              <div className=\"space-y-3\">\n                <Skeleton className=\"h-16 w-full\" />\n                <Skeleton className=\"h-16 w-full\" />\n              </div>\n            ) : comments.length > 0 ? (\n              <div className=\"space-y-3 max-h-64 overflow-y-auto\">\n                {comments.map((comment) => (\n                  <div\n                    key={comment.id}\n                    className=\"p-3 rounded-lg bg-muted/30\"\n                    data-testid={`comment-${comment.id}`}\n                  >\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"font-semibold text-sm\" data-testid={`text-comment-author-${comment.id}`}>\n                        {comment.username}\n                      </span>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {format(new Date(comment.createdAt), \"dd.MM.yyyy HH:mm\")}\n                      </span>\n                    </div>\n                    <p className=\"text-sm\" data-testid={`text-comment-text-${comment.id}`}>\n                      {comment.text}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground text-center py-4\" data-testid={`text-no-comments-${project.id}`}>\n                Jo≈° nema komentara. Budite prvi!\n              </p>\n            )}\n\n            <div className=\"flex gap-2\">\n              <Textarea\n                placeholder=\"Dodajte komentar...\"\n                value={commentText}\n                onChange={(e) => onCommentChange(e.target.value)}\n                className=\"resize-none min-h-[80px]\"\n                data-testid={`input-comment-${project.id}`}\n              />\n              <Button\n                size=\"icon\"\n                onClick={() => onComment(project.id)}\n                disabled={!commentText.trim()}\n                data-testid={`button-submit-comment-${project.id}`}\n              >\n                <Send className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":28159},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/OptimizedImage.tsx":{"content":"import { ImgHTMLAttributes, useState, type MouseEvent } from 'react';\n\ninterface OptimizedImageProps extends Omit<ImgHTMLAttributes<HTMLImageElement>, 'loading'> {\n  src: string;\n  alt: string;\n  priority?: boolean;\n  className?: string;\n  sizes?: string;\n}\n\nexport function OptimizedImage({ \n  src, \n  alt, \n  priority = false,\n  className = \"\",\n  sizes,\n  ...props \n}: OptimizedImageProps) {\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  const imgAttributes: any = {\n    src,\n    alt,\n    loading: priority ? \"eager\" : \"lazy\",\n    decoding: priority ? \"sync\" : \"async\",\n    onLoad: () => setIsLoaded(true),\n    onContextMenu: (e: MouseEvent) => e.preventDefault(),\n    draggable: false,\n    className: `transition-opacity duration-300 select-none ${isLoaded ? 'opacity-100' : 'opacity-0'} ${className}`,\n    ...props\n  };\n\n  // Add sizes attribute for responsive images (LCP optimization)\n  if (sizes) {\n    imgAttributes.sizes = sizes;\n  } else if (priority) {\n    // Default sizes for priority images (hero images typically full width)\n    imgAttributes.sizes = '100vw';\n  }\n\n  // fetchpriority is a valid HTML attribute but not yet in React's types (LCP optimization)\n  if (priority) {\n    imgAttributes.fetchpriority = \"high\";\n  }\n\n  return <img {...imgAttributes} />;\n}\n","size_bytes":1285},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/motion/StaggerContainer.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { ReactNode } from \"react\";\n\ninterface StaggerContainerProps {\n  children: ReactNode;\n  staggerDelay?: number;\n  className?: string;\n}\n\nexport function StaggerContainer({ children, staggerDelay = 0.1, className }: StaggerContainerProps) {\n  return (\n    <motion.div\n      initial=\"hidden\"\n      animate=\"visible\"\n      variants={{\n        hidden: { opacity: 0 },\n        visible: {\n          opacity: 1,\n          transition: {\n            staggerChildren: staggerDelay,\n          },\n        },\n      }}\n      className={className}\n    >\n      {children}\n    </motion.div>\n  );\n}\n\nexport function StaggerItem({ children, className }: { children: ReactNode; className?: string }) {\n  return (\n    <motion.div\n      variants={{\n        hidden: { opacity: 0, y: 20 },\n        visible: { opacity: 1, y: 0 },\n      }}\n      className={className}\n    >\n      {children}\n    </motion.div>\n  );\n}\n","size_bytes":936},"server/uploadthing.ts":{"content":"import { createUploadthing, type FileRouter } from \"uploadthing/express\";\nimport type { Request, Response } from \"express\";\n\nconst f = createUploadthing();\n\n// Auth middleware for UploadThing - check if user is authenticated\nconst auth = (req: Request, res: Response) => {\n  // Passport attaches user to req.user\n  if (!req.isAuthenticated || !req.isAuthenticated() || !req.user) {\n    throw new Error(\"Neautorizovan pristup\");\n  }\n  \n  // Check if email is verified\n  const user = req.user as any;\n  if (!user.emailVerified) {\n    throw new Error(\"Morate verifikovati email adresu\");\n  }\n  \n  return { userId: user.id, username: user.username };\n};\n\n// Our file upload router\nexport const uploadRouter = {\n  // Audio file uploader for giveaway submissions - Only MP3 files allowed\n  audioUploader: f({ \n    \"audio/mpeg\": { \n      maxFileSize: \"16MB\",\n      maxFileCount: 1,\n    } \n  })\n    .middleware(async ({ req, res }) => {\n      // Authenticate user\n      const userMetadata = auth(req, res);\n      \n      // Additional validation will happen in onUploadComplete\n      return userMetadata;\n    })\n    .onUploadComplete(async ({ metadata, file }) => {\n      console.log(\"MP3 upload complete!\");\n      console.log(\"User ID:\", metadata.userId);\n      console.log(\"File URL:\", file.url);\n      console.log(\"File name:\", file.name);\n      console.log(\"File type:\", file.type);\n      \n      // Extra validation: ensure it's actually an MP3 file\n      if (file.type !== \"audio/mpeg\" && !file.name.toLowerCase().endsWith('.mp3')) {\n        throw new Error(\"Dozvoljeni su samo MP3 fajlovi\");\n      }\n      \n      return { \n        uploadedBy: metadata.userId,\n        fileUrl: file.url,\n        fileName: file.name\n      };\n    }),\n  \n  // Avatar image uploader - Only image files allowed\n  avatarUploader: f({ \n    \"image/png\": { maxFileSize: \"4MB\", maxFileCount: 1 },\n    \"image/jpeg\": { maxFileSize: \"4MB\", maxFileCount: 1 },\n    \"image/webp\": { maxFileSize: \"4MB\", maxFileCount: 1 },\n  })\n    .middleware(async ({ req, res }) => {\n      // Authenticate user (email verification not required for avatar upload)\n      if (!req.isAuthenticated || !req.isAuthenticated() || !req.user) {\n        throw new Error(\"Neautorizovan pristup\");\n      }\n      \n      const user = req.user as any;\n      return { userId: user.id, username: user.username };\n    })\n    .onUploadComplete(async ({ metadata, file }) => {\n      console.log(\"Avatar upload complete!\");\n      console.log(\"User ID:\", metadata.userId);\n      console.log(\"File URL:\", file.url);\n      \n      return { \n        uploadedBy: metadata.userId,\n        fileUrl: file.url,\n      };\n    }),\n} satisfies FileRouter;\n\nexport type OurFileRouter = typeof uploadRouter;\n","size_bytes":2719},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { \n      server,\n      port: 5000,\n    },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  log(`Looking for static files in: ${distPath}`, \"express\");\n  \n  if (!fs.existsSync(distPath)) {\n    log(`ERROR: Build directory not found at ${distPath}`, \"express\");\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  const indexPath = path.resolve(distPath, \"index.html\");\n  if (!fs.existsSync(indexPath)) {\n    log(`ERROR: index.html not found at ${indexPath}`, \"express\");\n    throw new Error(\n      `Could not find index.html in the build directory: ${indexPath}`,\n    );\n  }\n\n  log(`Serving static files from: ${distPath}`, \"express\");\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(indexPath);\n  });\n}\n","size_bytes":2727},"client/src/pages/verify-email.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Music, Mail, RefreshCw } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function VerifyEmailPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [verificationCode, setVerificationCode] = useState(\"\");\n  const [isVerifying, setIsVerifying] = useState(false);\n  const [isResending, setIsResending] = useState(false);\n  const [userId, setUserId] = useState<string | null>(null);\n  const [email, setEmail] = useState<string | null>(null);\n\n  // Get userId and email from URL params (passed after registration)\n  // Use useEffect to safely access window.location after component mounts\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const params = new URLSearchParams(window.location.search);\n      setUserId(params.get(\"userId\"));\n      setEmail(params.get(\"email\"));\n    }\n  }, []);\n\n  const handleVerify = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!userId) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"UserId nije pronaƒëen. Molimo registrujte se ponovo.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (verificationCode.length !== 6) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Verifikacioni kod mora imati 6 cifara\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsVerifying(true);\n    try {\n      await apiRequest(\"POST\", \"/api/verify-email\", { \n        userId: parseInt(userId), \n        code: verificationCode \n      });\n      \n      toast({\n        title: \"Uspe≈°no!\",\n        description: \"Va≈° email je verifikovan. Dobrodo≈°li u Studio LeFlow!\",\n      });\n      \n      // Redirect to home or dashboard after successful verification\n      setTimeout(() => setLocation(\"/\"), 1500);\n    } catch (error: any) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Neva≈æeƒái verifikacioni kod\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsVerifying(false);\n    }\n  };\n\n  const handleResend = async () => {\n    if (!email) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Email nije pronaƒëen\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsResending(true);\n    try {\n      await apiRequest(\"POST\", \"/api/resend-verification\", { email });\n      toast({\n        title: \"Uspe≈°no!\",\n        description: \"Novi verifikacioni kod je poslat na Va≈° email\",\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri slanju koda\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsResending(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-2 text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"bg-primary/10 p-3 rounded-full\">\n              <Mail className=\"w-8 h-8 text-primary\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-2xl font-bold flex items-center justify-center gap-2\">\n            <Music className=\"w-6 h-6 text-primary\" />\n            Studio LeFlow\n          </CardTitle>\n          <CardDescription className=\"text-base\">\n            Verifikujte Va≈°u Email Adresu\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"text-center space-y-2 mb-6\">\n            <p className=\"text-sm text-muted-foreground\">\n              Poslali smo 6-cifreni verifikacioni kod na:\n            </p>\n            <p className=\"font-semibold text-base\">{email}</p>\n            <p className=\"text-xs text-muted-foreground\">\n              Proverite inbox i spam folder\n            </p>\n          </div>\n\n          <form onSubmit={handleVerify} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Verifikacioni Kod</label>\n              <Input\n                type=\"text\"\n                placeholder=\"123456\"\n                value={verificationCode}\n                onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, \"\").slice(0, 6))}\n                maxLength={6}\n                className=\"text-center text-2xl tracking-widest font-bold\"\n                autoFocus\n              />\n            </div>\n\n            <Button \n              type=\"submit\" \n              className=\"w-full\" \n              disabled={isVerifying || verificationCode.length !== 6}\n            >\n              {isVerifying ? \"Verifikujem...\" : \"Potvrdi Email\"}\n            </Button>\n          </form>\n\n          <div className=\"pt-4 border-t\">\n            <div className=\"text-center space-y-2\">\n              <p className=\"text-sm text-muted-foreground\">\n                Niste dobili kod?\n              </p>\n              <Button\n                variant=\"outline\"\n                onClick={handleResend}\n                disabled={isResending}\n                className=\"w-full\"\n              >\n                <RefreshCw className={`w-4 h-4 mr-2 ${isResending ? \"animate-spin\" : \"\"}`} />\n                {isResending ? \"≈†aljem...\" : \"Po≈°alji Novi Kod\"}\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"pt-4 text-center\">\n            <button\n              onClick={() => setLocation(\"/auth\")}\n              className=\"text-sm text-muted-foreground hover:text-primary transition-colors\"\n            >\n              Nazad na prijavu\n            </button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6013},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Smooth Scroll */\nhtml {\n  scroll-behavior: smooth;\n}\n\n/* Respect user's motion preference */\n@media (prefers-reduced-motion: reduce) {\n  *,\n  *::before,\n  *::after {\n    animation-duration: 0.01ms !important;\n    animation-iteration-count: 1 !important;\n    transition-duration: 0.01ms !important;\n    scroll-behavior: auto !important;\n  }\n}\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 98%;\n\n  --foreground: 0 0% 12%;\n\n  --border: 0 0% 88%;\n\n  --card: 0 0% 96%;\n\n  --card-foreground: 0 0% 12%;\n\n  --card-border: 0 0% 90%;\n\n  --sidebar: 0 0% 94%;\n\n  --sidebar-foreground: 0 0% 12%;\n\n  --sidebar-border: 0 0% 88%;\n\n  --sidebar-primary: 210 85% 28%;\n\n  --sidebar-primary-foreground: 210 85% 98%;\n\n  --sidebar-accent: 210 12% 88%;\n\n  --sidebar-accent-foreground: 210 12% 18%;\n\n  --sidebar-ring: 210 85% 28%;\n\n  --popover: 0 0% 92%;\n\n  --popover-foreground: 0 0% 12%;\n\n  --popover-border: 0 0% 86%;\n\n  --primary: 241 90% 61%;\n\n  --primary-foreground: 241 90% 98%;\n\n  --secondary: 210 8% 86%;\n\n  --secondary-foreground: 210 8% 16%;\n\n  --muted: 210 10% 90%;\n\n  --muted-foreground: 210 10% 35%;\n\n  --accent: 210 15% 88%;\n\n  --accent-foreground: 210 15% 18%;\n\n  --destructive: 0 78% 32%;\n\n  --destructive-foreground: 0 78% 98%;\n\n  --input: 0 0% 75%;\n  --ring: 210 85% 28%;\n  --chart-1: 210 85% 28%;\n  --chart-2: 280 70% 32%;\n  --chart-3: 335 75% 35%;\n  --chart-4: 40 88% 30%;\n  --chart-5: 160 70% 28%;\n\n  --font-sans: Inter, Work Sans, Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.08);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.10);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.12);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.15);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 0 0% 8%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 0 0% 18%;\n\n  --card: 0 0% 10%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 0 0% 16%;\n\n  --sidebar: 0 0% 12%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 0 0% 18%;\n\n  --sidebar-primary: 210 85% 28%;\n\n  --sidebar-primary-foreground: 210 85% 98%;\n\n  --sidebar-accent: 210 15% 18%;\n\n  --sidebar-accent-foreground: 210 15% 88%;\n\n  --sidebar-ring: 210 85% 45%;\n\n  --popover: 0 0% 14%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 0 0% 20%;\n\n  --primary: 241 90% 61%;\n\n  --primary-foreground: 241 90% 98%;\n\n  --secondary: 210 10% 20%;\n\n  --secondary-foreground: 210 10% 90%;\n\n  --muted: 210 12% 16%;\n\n  --muted-foreground: 210 12% 70%;\n\n  --accent: 210 18% 18%;\n\n  --accent-foreground: 210 18% 88%;\n\n  --destructive: 0 78% 32%;\n\n  --destructive-foreground: 0 78% 98%;\n\n  --input: 0 0% 30%;\n  --ring: 210 85% 45%;\n  --chart-1: 210 85% 65%;\n  --chart-2: 280 70% 68%;\n  --chart-3: 335 75% 65%;\n  --chart-4: 40 88% 70%;\n  --chart-5: 160 70% 68%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.30);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.40);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.50);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.60);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.70);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n/* Page transition animations - Lightweight CSS replacement for Framer Motion */\n.page-transition {\n  animation: pageEnter 0.4s cubic-bezier(0.22, 1, 0.36, 1);\n}\n\n@keyframes pageEnter {\n  from {\n    opacity: 0;\n    transform: scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n/* Respect reduced motion preference */\n@media (prefers-reduced-motion: reduce) {\n  .page-transition {\n    animation: pageEnterReduced 0.01ms;\n  }\n  \n  @keyframes pageEnterReduced {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n}\n\n/* Typography Scale - Consistent heading hierarchy */\n@layer components {\n  .heading-xl {\n    @apply text-5xl md:text-6xl lg:text-7xl font-black tracking-tight;\n  }\n  \n  .heading-lg {\n    @apply text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight;\n  }\n  \n  .heading-md {\n    @apply text-3xl md:text-4xl lg:text-5xl font-bold tracking-tight;\n  }\n  \n  .heading-sm {\n    @apply text-2xl md:text-3xl font-semibold;\n  }\n  \n  .heading-xs {\n    @apply text-xl md:text-2xl font-semibold;\n  }\n}\n","size_bytes":12474},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/lib/uploadthing.ts":{"content":"import { generateReactHelpers } from \"@uploadthing/react\";\nimport type { OurFileRouter } from \"../../../server/uploadthing\";\n\nexport const { useUploadThing, uploadFiles } =\n  generateReactHelpers<OurFileRouter>();\n","size_bytes":214},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { useTheme } from \"next-themes\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  if (!mounted) {\n    return (\n      <Button variant=\"ghost\" size=\"icon\" className=\"relative\">\n        <Sun className=\"h-5 w-5\" />\n      </Button>\n    );\n  }\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\n      className=\"relative\"\n    >\n      <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">Toggle tema</span>\n    </Button>\n  );\n}\n","size_bytes":952},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"server/run-seed.ts":{"content":"import { seedCmsContent } from './seed';\n\nseedCmsContent()\n  .then(() => {\n    console.log('‚úÖ Seed completed successfully');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('‚ùå Seed failed:', error);\n    process.exit(1);\n  });\n","size_bytes":248},"client/src/hooks/use-auth.tsx":{"content":"// Blueprint reference: blueprint:javascript_auth_all_persistance\nimport { createContext, ReactNode, useContext } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport { insertUserSchema, User as SelectUser, InsertUser } from \"@shared/schema\";\nimport { getQueryFn, apiRequest, queryClient } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype AuthContextType = {\n  user: SelectUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<SelectUser, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<SelectUser, Error, InsertUser>;\n};\n\ntype LoginData = Pick<InsertUser, \"username\" | \"password\"> & { rememberMe?: boolean };\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  const {\n    data: user,\n    error,\n    isLoading,\n  } = useQuery<SelectUser | undefined, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      const res = await apiRequest(\"POST\", \"/api/login\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n      toast({\n        title: \"Uspe≈°no logovanje\",\n        description: `Dobrodo≈°li, ${user.username}!`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Neuspe≈°no logovanje\",\n        description: error.message || \"Pogre≈°no korisniƒçko ime ili lozinka\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (credentials: InsertUser) => {\n      const res = await apiRequest(\"POST\", \"/api/register\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      toast({\n        title: \"Uspe≈°na registracija\",\n        description: `Proverite email za verifikacioni kod`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Neuspe≈°na registracija\",\n        description: error.message || \"Gre≈°ka pri registraciji\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/logout\");\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/user\"], null);\n      toast({\n        title: \"Uspe≈°no odjavljivanje\",\n        description: \"Doviƒëenja!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":3294},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/contact.tsx":{"content":"import { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { MapPin, Phone, Mail, Instagram, ArrowLeft, Send } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertContactSubmissionSchema, type InsertContactSubmission } from \"@shared/schema\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { SEO } from \"@/components/SEO\";\n\nexport default function Contact() {\n  const { toast } = useToast();\n  const [submitted, setSubmitted] = useState(false);\n\n  const form = useForm<InsertContactSubmission>({\n    resolver: zodResolver(insertContactSubmissionSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      service: \"\",\n      preferredDate: \"\",\n      message: \"\"\n    }\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: InsertContactSubmission) => {\n      return await apiRequest(\"POST\", \"/api/contact\", data);\n    },\n    onSuccess: () => {\n      setSubmitted(true);\n      form.reset();\n      toast({\n        title: \"Uspe≈°no poslato!\",\n        description: \"Kontaktiraƒáemo vas u najkraƒáem moguƒáem roku.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: error.message || \"Do≈°lo je do gre≈°ke. Molimo poku≈°ajte ponovo.\",\n      });\n    }\n  });\n\n  const onSubmit = (data: InsertContactSubmission) => {\n    mutation.mutate(data);\n  };\n\n  const contactInfo = [\n    {\n      icon: MapPin,\n      title: \"Adresa\",\n      content: \"Beograd, Srbija\",\n      link: null\n    },\n    {\n      icon: Phone,\n      title: \"Telefon\",\n      content: \"+381 63 734 7023\",\n      link: \"tel:+381637347023\"\n    },\n    {\n      icon: Mail,\n      title: \"Email\",\n      content: \"info@studioleflow.com\",\n      link: \"mailto:info@studioleflow.com\"\n    },\n    {\n      icon: Instagram,\n      title: \"Instagram\",\n      content: \"@studioleflow\",\n      link: \"https://instagram.com/studioleflow\"\n    }\n  ];\n\n  const services = [\n    \"Snimanje\",\n    \"Mix/Master (Produkcija)\",\n    \"Instrumental\",\n    \"Gotova pesma\"\n  ];\n\n  return (\n    <div className=\"min-h-screen py-12 lg:py-20\">\n      <SEO\n        title=\"Kontakt - Studio LeFlow | Rezervi≈°ite Termin za Snimanje\"\n        description=\"Kontaktirajte Studio LeFlow za rezervaciju termina. Snimanje pesama, miks i mastering, voice over, podcast produkcija. Beograd, Srbija. Email: info@studioleflow.com, Tel: +381 63 734 7023\"\n        keywords={[\n          \"kontakt studio leflow\",\n          \"leflow studio kontakt\",\n          \"leflow kontakt\",\n          \"rezervacija studio beograd\",\n          \"studio termin beograd\",\n          \"muziƒçki studio kontakt\",\n          \"snimanje pesme rezervacija\",\n          \"studio beograd adresa\",\n          \"studio leflow kontakt\",\n          \"leflow studio beograd kontakt\",\n          \"leflow cena\",\n          \"studio rezervacija online\"\n        ]}\n      />\n      <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n        <div className=\"mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" data-testid=\"button-back-home\">\n              <ArrowLeft className=\"mr-2 w-4 h-4\" />\n              Nazad na Poƒçetnu\n            </Button>\n          </Link>\n        </div>\n\n        <div className=\"mb-12 text-center\">\n          <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold mb-6 tracking-tight\" data-testid=\"text-contact-title\">\n            Kontaktirajte Nas\n          </h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Zaka≈æite besplatnu konsultaciju ili nas kontaktirajte za bilo kakva pitanja o na≈°im uslugama\n          </p>\n        </div>\n\n        <div className=\"grid lg:grid-cols-3 gap-8\">\n          <FadeInWhenVisible delay={0.1} className=\"lg:col-span-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-2xl\" data-testid=\"text-form-title\">Po≈°aljite Upit</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {submitted ? (\n                  <div className=\"py-12 text-center\">\n                    <div className=\"mb-4 inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n                      <Send className=\"w-8 h-8 text-primary\" />\n                    </div>\n                    <h3 className=\"text-2xl font-bold mb-3\" data-testid=\"text-success-title\">Hvala na upitu!</h3>\n                    <p className=\"text-muted-foreground mb-6\">\n                      Primili smo va≈°u poruku i kontaktiraƒáemo vas u najkraƒáem moguƒáem roku.\n                    </p>\n                    <Button onClick={() => setSubmitted(false)} data-testid=\"button-send-another\">\n                      Po≈°alji Jo≈° Jedan Upit\n                    </Button>\n                  </div>\n                ) : (\n                  <Form {...form}>\n                    <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                      <div className=\"grid md:grid-cols-2 gap-6\">\n                        <FormField\n                          control={form.control}\n                          name=\"name\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Ime i Prezime *</FormLabel>\n                              <FormControl>\n                                <Input \n                                  placeholder=\"Va≈°e ime\" \n                                  {...field}\n                                  data-testid=\"input-name\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={form.control}\n                          name=\"email\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Email *</FormLabel>\n                              <FormControl>\n                                <Input \n                                  type=\"email\"\n                                  placeholder=\"vas@email.com\" \n                                  {...field}\n                                  data-testid=\"input-email\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <div className=\"grid md:grid-cols-2 gap-6\">\n                        <FormField\n                          control={form.control}\n                          name=\"phone\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Telefon *</FormLabel>\n                              <FormControl>\n                                <Input \n                                  placeholder=\"+381 XX XXX XXXX\" \n                                  {...field}\n                                  data-testid=\"input-phone\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={form.control}\n                          name=\"service\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Usluga *</FormLabel>\n                              <Select onValueChange={field.onChange} value={field.value}>\n                                <FormControl>\n                                  <SelectTrigger data-testid=\"select-service\">\n                                    <SelectValue placeholder=\"Izaberite uslugu\" />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent>\n                                  {services.map((service) => (\n                                    <SelectItem key={service} value={service}>\n                                      {service}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <FormField\n                        control={form.control}\n                        name=\"preferredDate\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>≈Ωeljeni Termin (Opciono)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"date\"\n                                {...field}\n                                value={field.value || \"\"}\n                                data-testid=\"input-date\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"message\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Poruka *</FormLabel>\n                            <FormControl>\n                              <Textarea \n                                placeholder=\"Opi≈°ite va≈° projekat ili postavite pitanje...\"\n                                className=\"min-h-32 resize-none\"\n                                {...field}\n                                data-testid=\"input-message\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <Button \n                        type=\"submit\" \n                        size=\"lg\" \n                        className=\"w-full md:w-auto text-lg\"\n                        disabled={mutation.isPending}\n                        data-testid=\"button-submit\"\n                      >\n                        {mutation.isPending ? \"≈†alje se...\" : \"Po≈°alji Upit\"}\n                        <Send className=\"ml-2 w-5 h-5\" />\n                      </Button>\n                    </form>\n                  </Form>\n                )}\n              </CardContent>\n            </Card>\n          </FadeInWhenVisible>\n\n          <FadeInWhenVisible delay={0.2} className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle data-testid=\"text-info-title\">Kontakt Informacije</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {contactInfo.map((info, index) => (\n                  <motion.div \n                    key={index} \n                    className=\"flex items-start gap-4\" \n                    data-testid={`info-item-${index}`}\n                    initial={{ opacity: 0, x: -20 }}\n                    whileInView={{ opacity: 1, x: 0 }}\n                    viewport={{ once: true }}\n                    transition={{ duration: 0.5, delay: index * 0.1 }}\n                  >\n                    <div className=\"flex items-center justify-center w-10 h-10 rounded-lg bg-primary/10 flex-shrink-0\">\n                      <info.icon className=\"w-5 h-5 text-primary\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold mb-1\">{info.title}</h3>\n                      {info.link ? (\n                        <a \n                          href={info.link}\n                          className=\"text-muted-foreground hover:text-primary transition-colors\"\n                        >\n                          {info.content}\n                        </a>\n                      ) : (\n                        <p className=\"text-muted-foreground\">{info.content}</p>\n                      )}\n                    </div>\n                  </motion.div>\n                ))}\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-primary/5 border-primary/20\">\n              <CardContent className=\"p-6\">\n                <h3 className=\"font-bold mb-3 text-lg\" data-testid=\"text-direct-call-title\">\n                  Pozovite nas direktno\n                </h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Za hitne zakazivanje ili dodatna pitanja, slobodno nas pozovite.\n                </p>\n                <Button variant=\"outline\" className=\"w-full\" asChild data-testid=\"button-call\">\n                  <a href=\"tel:+381637347023\">\n                    <Phone className=\"mr-2 w-4 h-4\" />\n                    Pozovi Sada\n                  </a>\n                </Button>\n              </CardContent>\n            </Card>\n          </FadeInWhenVisible>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":14061},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/cms/EditableImage.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Upload, Loader2 } from \"lucide-react\";\nimport { useEditMode } from \"@/contexts/EditModeContext\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { cn } from \"@/lib/utils\";\n\ninterface EditableImageProps {\n  page: string;\n  section: string;\n  contentKey: string;\n  currentImageUrl?: string;\n  alt: string;\n  className?: string;\n  containerClassName?: string;\n  fallbackSrc?: string;\n}\n\nexport function EditableImage({\n  page,\n  section,\n  contentKey,\n  currentImageUrl,\n  alt,\n  className,\n  containerClassName,\n  fallbackSrc = \"/placeholder.png\"\n}: EditableImageProps) {\n  const { isEditMode } = useEditMode();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState(currentImageUrl);\n\n  const updateImageMutation = useMutation({\n    mutationFn: async (imageUrl: string) => {\n      const response = await fetch(\"/api/cms/content/single\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({\n          page,\n          section,\n          contentKey,\n          contentValue: imageUrl,\n        }),\n      });\n\n      if (!response.ok) throw new Error(\"Failed to update image\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/cms/content\"] });\n      toast({\n        title: \"Slika a≈æurirana\",\n        description: \"Slika je uspe≈°no promenjena\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri a≈æuriranju slike\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Izabrani fajl nije slika\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate file size (max 4MB)\n    if (file.size > 4 * 1024 * 1024) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Slika je prevelika (max 4MB)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n\n    try {\n      // Upload to UploadThing\n      const formData = new FormData();\n      formData.append(\"file\", file);\n\n      const uploadResponse = await fetch(\"/api/upload-image\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n\n      if (!uploadResponse.ok) throw new Error(\"Upload failed\");\n\n      const { url } = await uploadResponse.json();\n      setPreviewUrl(url);\n      await updateImageMutation.mutateAsync(url);\n    } catch (error) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri upload-u slike\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleClick = () => {\n    if (isEditMode && fileInputRef.current) {\n      fileInputRef.current.click();\n    }\n  };\n\n  return (\n    <div className={cn(\"relative group\", containerClassName)}>\n      <img\n        src={previewUrl || fallbackSrc}\n        alt={alt}\n        draggable={false}\n        onContextMenu={(e) => e.preventDefault()}\n        className={cn(\n          \"select-none\",\n          className,\n          isEditMode && \"cursor-pointer hover:opacity-80 transition-opacity\"\n        )}\n        onClick={handleClick}\n      />\n\n      {isEditMode && (\n        <>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            className=\"hidden\"\n            onChange={handleFileSelect}\n            disabled={isUploading}\n          />\n          <div\n            className={cn(\n              \"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer rounded\",\n              isUploading && \"opacity-100\"\n            )}\n            onClick={handleClick}\n          >\n            {isUploading ? (\n              <Loader2 className=\"w-8 h-8 text-white animate-spin\" />\n            ) : (\n              <div className=\"flex flex-col items-center gap-2 text-white\">\n                <Upload className=\"w-8 h-8\" />\n                <span className=\"text-sm font-medium\">Promeni Sliku</span>\n              </div>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":4711},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/layout/header.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Menu, X, LogOut, User, Edit3, Save, MessageCircle, LayoutDashboard, Settings } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useEditMode } from \"@/contexts/EditModeContext\";\nimport { useWebSocket } from \"@/hooks/use-websocket\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport leflowLogo from \"@/assets/leflow-logo.png\";\n\nexport function Header() {\n  const [location, setLocation] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const { user, logoutMutation } = useAuth();\n  const { isEditMode, toggleEditMode } = useEditMode();\n  const queryClient = useQueryClient();\n  const { subscribe } = useWebSocket();\n\n  // Fetch unread message count (only for verified users)\n  const { data: unreadData } = useQuery<{ count: number }>({\n    queryKey: [\"/api/messages/unread-count\"],\n    enabled: !!user && user.emailVerified === true,\n    refetchInterval: 30000, // Refetch every 30 seconds\n  });\n\n  const unreadCount = unreadData?.count ?? 0;\n\n  // Subscribe to WebSocket events to update unread count in real-time\n  useEffect(() => {\n    if (!user || !user.emailVerified) return;\n\n    const unsubscribe = subscribe((message) => {\n      if (message.type === 'new_message' || message.type === 'message_read') {\n        // Invalidate unread count query to refetch\n        queryClient.invalidateQueries({ queryKey: [\"/api/messages/unread-count\"] });\n      }\n    });\n\n    return unsubscribe;\n  }, [user, subscribe, queryClient]);\n\n  const handleLogout = () => {\n    logoutMutation.mutate(undefined, {\n      onSuccess: () => {\n        window.location.href = \"/\";\n      }\n    });\n  };\n\n  const navigation = [\n    { name: \"Giveaway\", href: \"/giveaway\" },\n    { name: \"Zajednica\", href: \"/zajednica\" },\n    { name: \"Projekti\", href: \"/projekti\" },\n    { name: \"Tim\", href: \"/tim\" },\n    { name: \"Pravila\", href: \"/pravila\" }\n  ];\n\n  const isActive = (href: string) => {\n    if (href === \"/\") return location === \"/\";\n    return location === href;\n  };\n\n  const scrollToServices = () => {\n    if (location !== \"/\") {\n      setLocation(\"/#usluge\");\n    } else {\n      const element = document.getElementById(\"usluge\");\n      if (element) {\n        element.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n      }\n    }\n    setMobileMenuOpen(false);\n  };\n\n  return (\n    <header className=\"sticky top-0 z-50 bg-background/80 backdrop-blur-md border-b\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n        <div className=\"flex items-center justify-between h-16\">\n          <Link \n            href=\"/\"\n            className=\"flex items-center gap-1.5 md:gap-2 rounded-lg px-2 md:px-3 py-2 -ml-2 md:-ml-3 transition-opacity hover:opacity-80\" \n            data-testid=\"link-logo\"\n          >\n            <img \n              src={leflowLogo} \n              alt=\"Studio LeFlow Logo\" \n              draggable={false}\n              onContextMenu={(e) => e.preventDefault()}\n              className=\"h-8 md:h-10 w-auto dark:invert transition-all select-none\"\n            />\n            <span className=\"text-sm sm:text-base md:text-xl font-bold font-[Montserrat] uppercase\">STUDIO LEFLOW</span>\n          </Link>\n\n          <nav className=\"hidden xl:flex items-center gap-0.5 ml-8\">\n            {navigation.map((item) => (\n              <motion.div key={item.name} whileHover={{ y: -2 }} transition={{ duration: 0.2 }} className=\"flex items-center\">\n                <Link \n                  href={item.href}\n                  className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors hover-elevate flex items-center min-h-9 ${\n                    isActive(item.href)\n                      ? \"text-primary\"\n                      : \"text-foreground\"\n                  }`}\n                  data-testid={`link-nav-${item.name.toLowerCase()}`}\n                >\n                  {item.name}\n                </Link>\n              </motion.div>\n            ))}\n            {user?.role === 'admin' && (\n              <>\n                <motion.div whileHover={{ y: -2 }} transition={{ duration: 0.2 }} className=\"flex items-center\">\n                  <Link \n                    href=\"/admin\"\n                    className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors hover-elevate flex items-center min-h-9 ${\n                      isActive(\"/admin\")\n                        ? \"text-primary\"\n                        : \"text-foreground\"\n                    }`}\n                    data-testid=\"link-nav-admin\"\n                  >\n                    Admin\n                  </Link>\n                </motion.div>\n                {!isActive(\"/admin\") && (\n                  <Button\n                    variant={isEditMode ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={toggleEditMode}\n                    className=\"gap-2 min-h-9\"\n                    data-testid=\"button-edit-site\"\n                  >\n                    {isEditMode ? (\n                      <>\n                        <Save className=\"w-4 h-4\" />\n                        Zavr≈°i Izmene\n                      </>\n                    ) : (\n                      <>\n                        <Edit3 className=\"w-4 h-4\" />\n                        Izmeni Sajt\n                      </>\n                    )}\n                  </Button>\n                )}\n              </>\n            )}\n            <motion.div whileHover={{ y: -2 }} transition={{ duration: 0.2 }} className=\"flex items-center\">\n              <button\n                onClick={scrollToServices}\n                className=\"px-3 py-2 rounded-lg text-sm font-medium transition-colors hover-elevate text-foreground flex items-center min-h-9\"\n                data-testid=\"link-nav-usluge\"\n              >\n                Usluge\n              </button>\n            </motion.div>\n          </nav>\n\n          <div className=\"hidden xl:flex items-center gap-3\">\n            <ThemeToggle />\n            {user ? (\n              <>\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" className=\"relative h-9 gap-2 px-3\" data-testid=\"button-user-menu\">\n                      <Avatar className=\"h-7 w-7\">\n                        {user.avatarUrl ? (\n                          <AvatarImage src={user.avatarUrl} alt={user.username} />\n                        ) : (\n                          <AvatarFallback className=\"bg-primary/10 text-xs\">\n                            <User className=\"h-4 w-4 text-primary\" />\n                          </AvatarFallback>\n                        )}\n                      </Avatar>\n                      <span className=\"text-sm font-medium\">{user.username}</span>\n                      {user.emailVerified && unreadCount > 0 && (\n                        <Badge \n                          variant=\"destructive\" \n                          className=\"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs\"\n                        >\n                          {unreadCount > 9 ? '9+' : unreadCount}\n                        </Badge>\n                      )}\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\" className=\"w-56\">\n                    <DropdownMenuLabel>\n                      <div className=\"flex flex-col gap-1\">\n                        <span className=\"font-medium\">{user.username}</span>\n                        <span className=\"text-xs text-muted-foreground\">{user.email}</span>\n                      </div>\n                    </DropdownMenuLabel>\n                    <DropdownMenuSeparator />\n                    {user.emailVerified && (\n                      <>\n                        <DropdownMenuItem asChild>\n                          <Link href=\"/dashboard\" className=\"flex items-center gap-2 cursor-pointer\" data-testid=\"link-dropdown-dashboard\">\n                            <LayoutDashboard className=\"h-4 w-4\" />\n                            Dashboard\n                          </Link>\n                        </DropdownMenuItem>\n                        <DropdownMenuItem asChild>\n                          <Link href=\"/inbox\" className=\"flex items-center gap-2 cursor-pointer\" data-testid=\"link-dropdown-inbox\">\n                            <MessageCircle className=\"h-4 w-4\" />\n                            Poruke\n                            {unreadCount > 0 && (\n                              <Badge variant=\"destructive\" className=\"ml-auto h-5 px-1.5 text-xs\">\n                                {unreadCount > 9 ? '9+' : unreadCount}\n                              </Badge>\n                            )}\n                          </Link>\n                        </DropdownMenuItem>\n                        <DropdownMenuSeparator />\n                      </>\n                    )}\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/settings\" className=\"flex items-center gap-2 cursor-pointer\" data-testid=\"link-dropdown-settings\">\n                        <Settings className=\"h-4 w-4\" />\n                        Pode≈°avanja\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem\n                      onClick={handleLogout}\n                      disabled={logoutMutation.isPending}\n                      className=\"text-destructive focus:text-destructive cursor-pointer\"\n                      data-testid=\"button-dropdown-logout\"\n                    >\n                      <LogOut className=\"h-4 w-4 mr-2\" />\n                      Odjavi se\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </>\n            ) : (\n              <Link href=\"/prijava\">\n                <Button variant=\"outline\" className=\"h-9\">\n                  Prijava\n                </Button>\n              </Link>\n            )}\n            <Link href=\"/kontakt\">\n              <Button data-testid=\"button-header-contact\" className=\"h-9\">\n                Zaka≈æite Termin\n              </Button>\n            </Link>\n          </div>\n\n          <button\n            className=\"xl:hidden p-2 hover-elevate rounded-lg\"\n            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n            data-testid=\"button-mobile-menu\"\n          >\n            {mobileMenuOpen ? (\n              <X className=\"w-6 h-6\" />\n            ) : (\n              <Menu className=\"w-6 h-6\" />\n            )}\n          </button>\n        </div>\n\n        {mobileMenuOpen && (\n          <div className=\"xl:hidden py-4 border-t\" data-testid=\"mobile-menu\">\n            <nav className=\"flex flex-col gap-2\">\n              {navigation.map((item) => (\n                <Link \n                  key={item.name} \n                  href={item.href}\n                  className={`px-4 py-3 rounded-lg text-sm font-medium transition-colors hover-elevate ${\n                    isActive(item.href)\n                      ? \"bg-primary/10 text-primary\"\n                      : \"text-foreground\"\n                  }`}\n                  onClick={() => setMobileMenuOpen(false)}\n                  data-testid={`link-mobile-${item.name.toLowerCase()}`}\n                >\n                  {item.name}\n                </Link>\n              ))}\n              {user?.role === 'admin' && (\n                <>\n                  <Link \n                    href=\"/admin\"\n                    className={`px-4 py-3 rounded-lg text-sm font-medium transition-colors hover-elevate ${\n                      isActive(\"/admin\")\n                        ? \"bg-primary/10 text-primary\"\n                        : \"text-foreground\"\n                    }`}\n                    onClick={() => setMobileMenuOpen(false)}\n                    data-testid=\"link-mobile-admin\"\n                  >\n                    Admin\n                  </Link>\n                  {!isActive(\"/admin\") && (\n                    <Button\n                      variant={isEditMode ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => {\n                        toggleEditMode();\n                        setMobileMenuOpen(false);\n                      }}\n                      className=\"gap-2 mx-4\"\n                      data-testid=\"button-mobile-edit-site\"\n                    >\n                      {isEditMode ? (\n                        <>\n                          <Save className=\"w-4 h-4\" />\n                          Zavr≈°i Izmene\n                        </>\n                      ) : (\n                        <>\n                          <Edit3 className=\"w-4 h-4\" />\n                          Izmeni Sajt\n                        </>\n                      )}\n                    </Button>\n                  )}\n                </>\n              )}\n              <button\n                onClick={scrollToServices}\n                className=\"px-4 py-3 rounded-lg text-sm font-medium transition-colors hover-elevate text-foreground text-left\"\n                data-testid=\"link-mobile-usluge\"\n              >\n                Usluge\n              </button>\n              <div className=\"border-t pt-4 mt-2 flex flex-col gap-2\">\n                <div className=\"flex items-center justify-between px-4\">\n                  <span className=\"text-sm font-medium\">Tema</span>\n                  <ThemeToggle />\n                </div>\n                {user ? (\n                  <>\n                    {user.emailVerified && (\n                      <>\n                        <Link href=\"/dashboard\">\n                          <Button \n                            variant=\"outline\" \n                            className=\"w-full justify-start\"\n                            onClick={() => setMobileMenuOpen(false)}\n                            data-testid=\"link-mobile-dashboard\"\n                          >\n                            <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                            Dashboard\n                          </Button>\n                        </Link>\n                        <Link href=\"/inbox\">\n                          <Button \n                            variant=\"outline\" \n                            className=\"w-full justify-start relative\"\n                            onClick={() => setMobileMenuOpen(false)}\n                            data-testid=\"link-mobile-inbox\"\n                          >\n                            <MessageCircle className=\"h-4 w-4 mr-2\" />\n                            Poruke\n                            {unreadCount > 0 && (\n                              <Badge \n                                variant=\"destructive\" \n                                className=\"ml-auto h-5 w-5 flex items-center justify-center p-0 text-xs\"\n                              >\n                                {unreadCount > 9 ? '9+' : unreadCount}\n                              </Badge>\n                            )}\n                          </Button>\n                        </Link>\n                      </>\n                    )}\n                    <Link href=\"/settings\">\n                      <Button \n                        variant=\"outline\" \n                        className=\"w-full justify-start\"\n                        onClick={() => setMobileMenuOpen(false)}\n                      >\n                        <Avatar className=\"h-6 w-6 mr-2\">\n                          {user.avatarUrl ? (\n                            <AvatarImage src={user.avatarUrl} alt={user.username} />\n                          ) : (\n                            <AvatarFallback className=\"bg-primary/10 text-xs\">\n                              <User className=\"h-4 w-4 text-primary\" />\n                            </AvatarFallback>\n                          )}\n                        </Avatar>\n                        Pode≈°avanja\n                      </Button>\n                    </Link>\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full\"\n                      onClick={() => {\n                        handleLogout();\n                        setMobileMenuOpen(false);\n                      }}\n                      disabled={logoutMutation.isPending}\n                    >\n                      <LogOut className=\"h-4 w-4 mr-2\" />\n                      Odjavi se\n                    </Button>\n                  </>\n                ) : (\n                  <Link href=\"/prijava\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"w-full\"\n                      onClick={() => setMobileMenuOpen(false)}\n                    >\n                      Prijava\n                    </Button>\n                  </Link>\n                )}\n                <Link href=\"/kontakt\">\n                  <Button \n                    className=\"w-full\"\n                    onClick={() => setMobileMenuOpen(false)}\n                    data-testid=\"button-mobile-contact\"\n                  >\n                    Zaka≈æite Termin\n                  </Button>\n                </Link>\n              </div>\n            </nav>\n          </div>\n        )}\n      </div>\n    </header>\n  );\n}\n","size_bytes":17745},"client/src/pages/terms.tsx":{"content":"import { Link } from \"wouter\";\nimport { AlertCircle, CheckCircle2, Clock, CreditCard, FileText, Shield, ArrowLeft, MessageSquare } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\n\nexport default function Terms() {\n  const termsSection = [\n    {\n      icon: CreditCard,\n      title: \"Politika Avansa\",\n      content: [\n        \"Za sve usluge Studio LeFlow zahteva se obavezan avans u iznosu od 30% ukupne cene projekta.\",\n        \"Avans se plaƒáa pri rezervaciji termina i potvrƒëivanju dogovora o projektu.\",\n        \"Avans je nepovratan u svim sluƒçajevima, osim u situacijama kada Studio LeFlow ne mo≈æe ispuniti dogovorene usluge iz objektivnih razloga.\"\n      ]\n    },\n    {\n      icon: AlertCircle,\n      title: \"Razlozi Nepovrativosti Avansa\",\n      content: [\n        \"<strong>Rezervacija studio vremena:</strong> Va≈° termin se rezervi≈°e ekskluzivno za vas, ≈°to znaƒçi da studio odbija druge klijente u tom periodu. Otkazivanje termina u kratkom roku rezultira gubicima koje studio ne mo≈æe nadoknaditi.\",\n        \"<strong>Tehniƒçka i kreativna priprema:</strong> Pre svakog termina, na≈° tim priprema opremu, pode≈°ava akustiku prostora i planira kreativni pristup na osnovu va≈°ih potreba. Ova priprema zahteva vreme i struƒçnost.\",\n        \"<strong>Anga≈æovanje kreativnog tima:</strong> Za va≈° projekat anga≈æujemo profesionalce (producente, mix in≈æenjere, video operatere) koji se pripremaju i rezervi≈°u vreme specifiƒçno za va≈° projekat.\",\n        \"<strong>Organizacioni tro≈°kovi:</strong> Koordinacija rasporeda, komunikacija sa klijentom, priprema materijala i administracija projekta predstavljaju znaƒçajan ulo≈æeni trud pre same realizacije.\"\n      ]\n    },\n    {\n      icon: Clock,\n      title: \"Otkazivanje i Izmene Termina\",\n      content: [\n        \"Izmene termina moguƒáe su uz obavezu da nas obavestite <strong>najmanje 48 sati unapred</strong>.\",\n        \"Promena termina uz po≈°tovanje ovog roka ne utiƒçe na avans - jednostavno prenosimo rezervaciju.\",\n        \"Otkazivanje ili pomeranje termina sa manje od 48 sati najave rezultira gubitkom avansa.\",\n        \"Nepojavljivan je na zakazanom terminu bez prethodne najave smatra se otkazivanjem i avans se ne vraƒáa.\",\n        \"Studio LeFlow zadr≈æava pravo da ponudi alternativni termin u sluƒçaju tehniƒçkih problema ili vi≈°e sile.\"\n      ]\n    },\n    {\n      icon: CreditCard,\n      title: \"Uslovi Plaƒáanja\",\n      content: [\n        \"<strong>Prihvaƒáeni naƒçini plaƒáanja:</strong> Gotovina, bankovna transakcija, PayPal.\",\n        \"<strong>Avans (30%):</strong> Plaƒáa se prilikom potvrde rezervacije.\",\n        \"<strong>Preostali iznos (70%):</strong> Plaƒáa se po zavr≈°etku projekta, pre isporuke finalnih fajlova.\",\n        \"Za veƒáe projekte moguƒá je dogovor o ratama - kontaktirajte nas za poseban aran≈æman.\",\n        \"Raƒçun/Faktura se izdaje na zahtev klijenta.\"\n      ]\n    },\n    {\n      icon: FileText,\n      title: \"Autorska Prava i Vlasni≈°tvo\",\n      content: [\n        \"<strong>Snimanje i Mix/Master:</strong> Vi zadr≈æavate sva prava na snimljeni materijal i finalni miks. Studio LeFlow ne koristi va≈° materijal bez va≈°e dozvole.\",\n        \"<strong>Instrumentali (Beatovi):</strong> U zavisnosti od dogovora, mo≈æete kupiti ekskluzivna prava (samo vi mo≈æete koristiti beat) ili neekskluzivnu licencu (beat mo≈æe biti prodat i drugima). Uslovi se preciziraju u ugovoru.\",\n        \"<strong>Video produkcija:</strong> Finalni video je va≈°e vlasni≈°tvo. Studio LeFlow zadr≈æava pravo da koristi iseƒçke videa u promotivne svrhe (portfolio, dru≈°tvene mre≈æe) uz va≈°u saglasnost.\",\n        \"Za komercijalne projekte velikih razmera, autorska prava se detaljno defini≈°u pisanim ugovorom.\"\n      ]\n    },\n    {\n      icon: Shield,\n      title: \"Revizije i Garancija Kvaliteta\",\n      content: [\n        \"<strong>Snimanje i Mix/Master:</strong> Ukljuƒçeno je do <strong>3 besplatne revizije</strong> finalne verzije. Dodatne revizije se naplaƒáuju po cenovniku.\",\n        \"<strong>Instrumentali:</strong> Ukljuƒçena je <strong>1 revizija</strong> beat-a (izmene u aran≈æmanu, zvucima). Potpuno novi beat se smatra novim projektom.\",\n        \"<strong>Video produkcija:</strong> Ukljuƒçene su <strong>2 revizije</strong> monta≈æe (izmene u editingu, boji, efektima). Potpuno nova snimanja naplaƒáuju se posebno.\",\n        \"Garancija kvaliteta: Ako niste zadovoljni finalnim produktom zbog tehniƒçkih gre≈°aka sa na≈°e strane, radiƒáemo bez dodatne naplate dok ne budete zadovoljni.\",\n        \"Revizije moraju biti konkretne i jasno definisane. Redefinisanje celokupnog kreativnog pravca smatra se novim projektom.\"\n      ]\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen py-12 lg:py-20\">\n      <div className=\"max-w-5xl mx-auto px-4 md:px-6\">\n        <FadeInWhenVisible delay={0.1}>\n          <div className=\"mb-8\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" data-testid=\"button-back-home\">\n                <ArrowLeft className=\"mr-2 w-4 h-4\" />\n                Nazad na Poƒçetnu\n              </Button>\n            </Link>\n          </div>\n        </FadeInWhenVisible>\n\n        <FadeInWhenVisible delay={0}>\n          <div className=\"mb-16 text-center\">\n            <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold mb-6 tracking-tight\" data-testid=\"text-terms-title\">\n              Pravila i Uslovi\n            </h1>\n            <p className=\"text-lg md:text-xl text-muted-foreground max-w-3xl mx-auto leading-relaxed\">\n              Studio LeFlow je posveƒáen transparentnosti i profesionalnosti. Molimo vas da pa≈æljivo proƒçitate na≈°a pravila \n              kako bismo zajedno obezbedili uspe≈°nu saradnju.\n            </p>\n          </div>\n        </FadeInWhenVisible>\n\n        <div className=\"space-y-8\">\n          {termsSection.map((section, index) => (\n            <FadeInWhenVisible key={index} delay={index * 0.05}>\n                <Card data-testid={`card-terms-${index}`} className=\"overflow-hidden hover:shadow-lg transition-shadow duration-300\">\n                  <CardHeader className=\"bg-gradient-to-r from-primary/5 to-transparent\">\n                    <CardTitle className=\"flex items-center gap-4 text-2xl\">\n                      <div className=\"flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 ring-2 ring-primary/20\">\n                        <section.icon className=\"w-6 h-6 text-primary\" />\n                      </div>\n                      <span data-testid={`text-section-title-${index}`}>{section.title}</span>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-6\">\n                    <ul className=\"space-y-4\">\n                      {section.content.map((item, itemIndex) => (\n                        <li key={itemIndex} className=\"flex items-start gap-4\" data-testid={`text-section-content-${index}-${itemIndex}`}>\n                          <CheckCircle2 className=\"w-5 h-5 text-primary mt-1 flex-shrink-0\" />\n                          <span \n                            className=\"text-base md:text-lg leading-relaxed text-muted-foreground\"\n                            dangerouslySetInnerHTML={{ __html: item }}\n                          />\n                        </li>\n                      ))}\n                    </ul>\n                  </CardContent>\n                </Card>\n              </FadeInWhenVisible>\n            ))}\n          </div>\n\n        <FadeInWhenVisible delay={0}>\n          <Card className=\"mt-16 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-primary/30 shadow-lg\">\n            <CardContent className=\"p-8 md:p-10\">\n              <div className=\"flex flex-col md:flex-row items-start gap-6\">\n                <div className=\"flex items-center justify-center w-14 h-14 rounded-xl bg-primary/20 ring-4 ring-primary/10 flex-shrink-0\">\n                  <Shield className=\"w-7 h-7 text-primary\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-4\" data-testid=\"text-important-note-title\">\n                    Va≈æna Napomena\n                  </h3>\n                  <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed mb-4\">\n                    Ova pravila su kreirana da za≈°tite i vas i nas, osiguravajuƒái profesionalan i po≈°ten odnos. \n                    Razumemo da svaki projekat ima svoje specifiƒçnosti - za bilo kakva pitanja, dodatne dogovore \n                    ili posebne okolnosti, slobodno nas kontaktirajte.\n                  </p>\n                  <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n                    <strong className=\"text-foreground\">Kontakt:</strong> Dostupni smo za razgovor i spremni da prilagodimo na≈°e usluge va≈°im potrebama, \n                    uz po≈°tovanje ovih osnovnih principa rada.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </FadeInWhenVisible>\n\n        <FadeInWhenVisible delay={0}>\n          <Card className=\"mt-8 border-muted-foreground/20\">\n            <CardContent className=\"p-8 md:p-10\">\n              <div className=\"flex flex-col md:flex-row items-start gap-6\">\n                <div className=\"flex items-center justify-center w-14 h-14 rounded-xl bg-muted ring-4 ring-muted/10 flex-shrink-0\">\n                  <MessageSquare className=\"w-7 h-7 text-muted-foreground\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-2xl font-bold mb-4\" data-testid=\"text-messaging-privacy\">\n                    Privatnost Poruka\n                  </h3>\n                  <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n                    Administrator mo≈æe da reguli≈°e poruke na platformi radi bezbednosti, moderacije i po≈°tovanja pravila. \n                    Ova mera osigurava profesionalno i sigurno okru≈æenje za sve korisnike, spreƒçava zloupotrebe sistema \n                    i omoguƒáava adekvatnu podr≈°ku u sluƒçaju sporova ili tehniƒçkih problema.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </FadeInWhenVisible>\n\n        <FadeInWhenVisible delay={0}>\n          <div className=\"mt-16 text-center\">\n            <Link href=\"/kontakt\">\n              <Button size=\"lg\" className=\"text-lg px-8 py-6 shadow-lg hover:shadow-xl transition-all duration-300\" data-testid=\"button-contact-terms\">\n                Imate Pitanja? Kontaktirajte Nas\n              </Button>\n            </Link>\n          </div>\n        </FadeInWhenVisible>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10839},"server/db.ts":{"content":"// Blueprint reference: blueprint:javascript_database\nimport { Pool } from 'pg';\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nconst connectionString = process.env.DATABASE_URL;\n\n// Create PostgreSQL connection pool\n// Works with both Replit's internal database and external databases (like Neon)\nexport const pool = new Pool({ \n  connectionString,\n  // Enable SSL for external databases, disable for Replit internal database\n  ssl: connectionString.includes('helium') || connectionString.includes('db.internal') \n    ? false \n    : { rejectUnauthorized: false }\n});\n\nexport const db = drizzle(pool, { schema });\n","size_bytes":796},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full object-cover\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1605},"client/src/hooks/use-scroll-to-top.ts":{"content":"import { useEffect } from 'react';\nimport { useLocation } from 'wouter';\n\nexport function useScrollToTop() {\n  const [location] = useLocation();\n\n  useEffect(() => {\n    window.scrollTo({\n      top: 0,\n      left: 0,\n      behavior: 'instant',\n    });\n  }, [location]);\n}\n","size_bytes":272},"client/src/lib/protected-route.tsx":{"content":"// Blueprint reference: blueprint:javascript_auth_all_persistance\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Loader2 } from \"lucide-react\";\nimport { Redirect, Route } from \"wouter\";\n\nexport function ProtectedRoute({\n  path,\n  component: Component,\n}: {\n  path: string;\n  component: () => React.JSX.Element | null;\n}) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <Route path={path}>\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-border\" />\n        </div>\n      </Route>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/auth\" />\n      </Route>\n    );\n  }\n\n  return <Route path={path} component={Component} />;\n}\n","size_bytes":779},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/VerificationModal.tsx":{"content":"import { useState } from \"react\";\nimport { Mail, RefreshCw } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface VerificationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  userId: number;\n  email: string;\n  onSuccess: () => void;\n}\n\nexport function VerificationModal({ \n  isOpen, \n  onClose, \n  userId, \n  email,\n  onSuccess \n}: VerificationModalProps) {\n  const { toast } = useToast();\n  const [verificationCode, setVerificationCode] = useState(\"\");\n  const [isVerifying, setIsVerifying] = useState(false);\n  const [isResending, setIsResending] = useState(false);\n\n  const handleVerify = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (verificationCode.length !== 6) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Verifikacioni kod mora imati 6 cifara\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsVerifying(true);\n    try {\n      const res = await apiRequest(\"POST\", \"/api/verify-email\", { \n        userId, \n        code: verificationCode \n      });\n      const data = await res.json();\n      \n      queryClient.setQueryData([\"/api/user\"], data.user);\n      \n      toast({\n        title: \"Uspe≈°no!\",\n        description: \"Va≈° email je verifikovan. Dobrodo≈°li u Studio LeFlow!\",\n      });\n      \n      onSuccess();\n    } catch (error: any) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Neva≈æeƒái verifikacioni kod\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsVerifying(false);\n    }\n  };\n\n  const handleResend = async () => {\n    setIsResending(true);\n    try {\n      await apiRequest(\"POST\", \"/api/resend-verification\", { email });\n      toast({\n        title: \"Uspe≈°no!\",\n        description: \"Novi verifikacioni kod je poslat na Va≈° email\",\n      });\n      setVerificationCode(\"\");\n    } catch (error: any) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri slanju koda\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsResending(false);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader className=\"space-y-3\">\n          <div className=\"flex justify-center\">\n            <div className=\"bg-primary/10 p-3 rounded-full\">\n              <Mail className=\"w-8 h-8 text-primary\" />\n            </div>\n          </div>\n          <DialogTitle className=\"text-center text-2xl\">\n            Verifikujte Email\n          </DialogTitle>\n          <DialogDescription className=\"text-center\">\n            Poslali smo 6-cifreni kod na:<br />\n            <span className=\"font-semibold text-foreground\">{email}</span>\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleVerify} className=\"space-y-4 pt-2\">\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Verifikacioni Kod</label>\n            <Input\n              type=\"text\"\n              placeholder=\"123456\"\n              value={verificationCode}\n              onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, \"\").slice(0, 6))}\n              maxLength={6}\n              className=\"text-center text-2xl tracking-widest font-bold\"\n              autoFocus\n            />\n            <p className=\"text-xs text-muted-foreground text-center\">\n              Proverite inbox i spam folder\n            </p>\n          </div>\n\n          <Button \n            type=\"submit\" \n            className=\"w-full\" \n            disabled={isVerifying || verificationCode.length !== 6}\n          >\n            {isVerifying ? \"Verifikujem...\" : \"Potvrdi Email\"}\n          </Button>\n        </form>\n\n        <div className=\"pt-4 border-t space-y-2\">\n          <p className=\"text-sm text-muted-foreground text-center\">\n            Niste dobili kod?\n          </p>\n          <Button\n            variant=\"outline\"\n            onClick={handleResend}\n            disabled={isResending}\n            className=\"w-full\"\n          >\n            <RefreshCw className={`w-4 h-4 mr-2 ${isResending ? \"animate-spin\" : \"\"}`} />\n            {isResending ? \"≈†aljem...\" : \"Po≈°alji Novi Kod\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":4564},"vite.config.ts":{"content":"import { defineConfig, createLogger, splitVendorChunkPlugin } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport runtimeErrorModal from \"@replit/vite-plugin-runtime-error-modal\";\nimport tailwindcss from \"tailwindcss\";\nimport autoprefixer from \"autoprefixer\";\nimport { visualizer } from 'rollup-plugin-visualizer';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst logger = createLogger();\nconst originalWarning = logger.warn;\nlogger.warn = (msg, options) => {\n  if (msg.includes('did not pass the `from` option')) return;\n  originalWarning(msg, options);\n};\n\nexport default defineConfig({\n  customLogger: logger,\n  plugins: [\n    react(),\n    runtimeErrorModal(),\n    splitVendorChunkPlugin(),\n    visualizer({\n      filename: 'dist/stats.html',\n      gzipSize: true,\n      brotliSize: true,\n    }) as any,\n  ],\n  optimizeDeps: {\n    include: ['react', 'react-dom'],\n  },\n  css: {\n    postcss: {\n      plugins: [\n        tailwindcss(),\n        autoprefixer(),\n      ],\n    },\n  },\n  resolve: {\n    alias: {\n      \"@\": path.resolve(__dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(__dirname, \"shared\"),\n      \"@assets\": path.resolve(__dirname, \"attached_assets\"),\n    },\n    dedupe: ['react', 'react-dom'],\n  },\n  root: path.resolve(__dirname, \"client\"),\n  build: {\n    outDir: path.resolve(__dirname, \"dist\", \"public\"),\n    emptyOutDir: true,\n    // ENABLE modulePreload - this guarantees correct chunk loading order!\n    modulePreload: {\n      polyfill: true,\n    },\n    rollupOptions: {\n      output: {\n        // Let splitVendorChunkPlugin handle vendor splitting intelligently\n        chunkFileNames: 'assets/[name]-[hash].js',\n        entryFileNames: 'assets/[name]-[hash].js',\n        assetFileNames: 'assets/[name]-[hash].[ext]',\n      },\n    },\n    cssMinify: 'esbuild',\n    minify: 'terser',\n    terserOptions: {\n      compress: {\n        drop_console: true,\n        drop_debugger: true,\n        pure_funcs: ['console.log', 'console.info', 'console.debug'],\n        passes: 2,\n      },\n      mangle: {\n        safari10: true,\n      },\n      format: {\n        comments: false,\n      },\n    },\n    chunkSizeWarningLimit: 600,\n    reportCompressedSize: false,\n    sourcemap: false,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    port: 5000,\n    strictPort: true,\n    hmr: {\n      clientPort: 443,\n    },\n    allowedHosts: [\n      '.replit.app',\n      '.repl.co',\n      'localhost',\n    ],\n  },\n});\n","size_bytes":2535},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport compression from \"compression\";\nimport path from \"path\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { seedCmsContent } from \"./seed\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { storage } from \"./storage\";\nimport { setBroadcastFunction, setNotificationFunction, setOnlineUsersAccessor } from \"./websocket-helpers\";\n\nconst app = express();\n\n// Enable gzip/brotli compression for all responses (LCP optimization)\napp.use(compression({\n  level: 9, // Maximum compression for production\n  threshold: 512, // Compress responses larger than 512 bytes\n  filter: (req: Request, res: Response) => {\n    if (req.headers['x-no-compression']) {\n      return false;\n    }\n    return compression.filter(req, res);\n  }\n}));\n\n// Serve static files from attached_assets directory with aggressive cache headers (LCP optimization)\napp.use('/attached_assets', express.static(path.join(process.cwd(), 'attached_assets'), {\n  maxAge: '1y',\n  immutable: true,\n  setHeaders: (res, filePath) => {\n    // Add Cache-Control headers for optimal caching\n    if (filePath.endsWith('.webp') || filePath.endsWith('.jpg') || filePath.endsWith('.png')) {\n      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');\n    }\n    if (filePath.endsWith('.js') || filePath.endsWith('.css')) {\n      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');\n    }\n  }\n}));\n\n// Serve static files from public directory (Open Graph images, etc.) with optimized caching\napp.use('/public', express.static(path.join(process.cwd(), 'public'), {\n  maxAge: '7d',\n  setHeaders: (res, filePath) => {\n    if (filePath.endsWith('.jpg') || filePath.endsWith('.png') || filePath.endsWith('.webp')) {\n      res.setHeader('Cache-Control', 'public, max-age=604800'); // 7 days\n    }\n  }\n}));\n\n// Trust proxy - omoguƒáava dobijanje prave IP adrese klijenta\n// Postavljamo na 1 jer je Replit iza jednog proxy hop-a\napp.set('trust proxy', 1);\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\n// Add security headers with relaxed CSP for Vite in production\napp.use((req, res, next) => {\n  // Allow eval for Vite build chunks (needed for dynamic imports)\n  res.setHeader(\n    'Content-Security-Policy',\n    \"default-src 'self'; \" +\n    \"script-src 'self' 'unsafe-eval' 'unsafe-inline'; \" +\n    \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; \" +\n    \"font-src 'self' https://fonts.gstatic.com; \" +\n    \"img-src 'self' data: https:; \" +\n    \"media-src 'self' https://utfs.io https://*.uploadthing.com; \" +\n    \"connect-src 'self' https://*.uploadthing.com https://uploadthing-prod.s3.us-west-2.amazonaws.com; \" +\n    \"frame-src 'self' https://www.youtube.com https://www.youtube-nocookie.com; \" +\n    \"frame-ancestors 'none';\"\n  );\n  next();\n});\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  try {\n    // Log environment info\n    const env = app.get(\"env\");\n    log(`Starting server in ${env} mode`);\n    log(`PORT: ${process.env.PORT || '5000'}`);\n    \n    // Check critical environment variables - FAIL FAST if missing\n    const missingEnvVars: string[] = [];\n    \n    // Critical environment variables required for the app to function\n    if (!process.env.DATABASE_URL) {\n      missingEnvVars.push('DATABASE_URL');\n    }\n    if (!process.env.SESSION_SECRET) {\n      missingEnvVars.push('SESSION_SECRET');\n    }\n    \n    if (missingEnvVars.length > 0) {\n      const errorMsg = `FATAL: Missing required environment variables: ${missingEnvVars.join(', ')}`;\n      log(errorMsg, 'express');\n      console.error('\\n' + '='.repeat(80));\n      console.error('DEPLOYMENT CONFIGURATION ERROR');\n      console.error('='.repeat(80));\n      console.error('\\nThe following environment variables are required but not set:');\n      missingEnvVars.forEach(v => console.error(`  - ${v}`));\n      console.error('\\nRequired for all environments:');\n      console.error('  - DATABASE_URL: PostgreSQL connection string');\n      console.error('  - SESSION_SECRET: Secret key for session encryption');\n      console.error('\\nOptional (for specific features):');\n      console.error('  - UPLOADTHING_TOKEN: For file uploads (avatars, MP3 files)');\n      console.error('  - RESEND_API_KEY: For email functionality');\n      console.error('  - RESEND_FROM_EMAIL: Sender email address');\n      console.error('\\nPlease add these in Replit Deployment ‚Üí Secrets');\n      console.error('='.repeat(80) + '\\n');\n      process.exit(1);\n    }\n    \n    log('All required environment variables present', 'express');\n    \n    // Warn about optional environment variables in production\n    const optionalWarnings: string[] = [];\n    \n    // UploadThing: Check for both TOKEN and SECRET (both needed for file uploads)\n    const hasUploadThingToken = !!process.env.UPLOADTHING_TOKEN;\n    const hasUploadThingSecret = !!process.env.UPLOADTHING_SECRET;\n    \n    if (!hasUploadThingToken && !hasUploadThingSecret) {\n      optionalWarnings.push('UPLOADTHING_TOKEN and UPLOADTHING_SECRET not set - file upload features (avatars, MP3 files) will be completely disabled');\n    } else if (!hasUploadThingToken) {\n      optionalWarnings.push('UPLOADTHING_TOKEN not set - file upload features will NOT work (UPLOADTHING_SECRET alone is insufficient)');\n    } else if (!hasUploadThingSecret) {\n      optionalWarnings.push('UPLOADTHING_SECRET not set - file upload features will NOT work (UPLOADTHING_TOKEN alone is insufficient)');\n    }\n    \n    // Resend: Check API key and from email separately\n    if (!process.env.RESEND_API_KEY) {\n      optionalWarnings.push('RESEND_API_KEY not set - email features (verification, password reset, contact form) will be disabled');\n    }\n    if (!process.env.RESEND_FROM_EMAIL) {\n      optionalWarnings.push('RESEND_FROM_EMAIL not set - emails cannot be sent even if RESEND_API_KEY is configured');\n    }\n    \n    if (optionalWarnings.length > 0 && env === 'production') {\n      console.warn('\\n' + '-'.repeat(80));\n      console.warn('WARNING: Optional environment variables not configured:');\n      console.warn('-'.repeat(80));\n      optionalWarnings.forEach(warning => console.warn('  - ' + warning));\n      console.warn('\\nThe application will start, but some features will be unavailable.');\n      console.warn('Add these secrets in Replit Deployment ‚Üí Secrets to enable all features.');\n      console.warn('-'.repeat(80) + '\\n');\n    }\n    \n    // Seed CMS content if needed\n    await seedCmsContent();\n    \n    const server = await registerRoutes(app);\n    \n    // ===== WEBSOCKET SETUP (before routes need it) =====\n    // Track online users: Map<userId, Set<WebSocket>>\n    const onlineUsers = new Map<number, Set<WebSocket>>();\n    \n    // Track typing status: Map<conversationKey, Set<userId>>\n    const typingUsers = new Map<string, Set<number>>();\n    \n    // Helper function to broadcast message to specific user (all their active connections)\n    function broadcastToUser(userId: number, message: any) {\n      const userSockets = onlineUsers.get(userId);\n      if (userSockets) {\n        const messageStr = JSON.stringify(message);\n        userSockets.forEach(socket => {\n          if (socket.readyState === WebSocket.OPEN) {\n            socket.send(messageStr);\n          }\n        });\n      }\n    }\n    \n    // Helper function to send notification to a specific user\n    function sendNotification(userId: number, title: string, description?: string, variant: 'default' | 'destructive' = 'default') {\n      broadcastToUser(userId, {\n        type: 'notification',\n        title,\n        description,\n        variant,\n      });\n    }\n    \n    // Helper function to get conversation key (canonical ordering)\n    function getConversationKey(user1Id: number, user2Id: number): string {\n      const [id1, id2] = user1Id < user2Id ? [user1Id, user2Id] : [user2Id, user1Id];\n      return `${id1}-${id2}`;\n    }\n    \n    // Make broadcastToUser, sendNotification, and onlineUsers available to routes IMMEDIATELY\n    setBroadcastFunction(broadcastToUser);\n    setNotificationFunction(sendNotification);\n    setOnlineUsersAccessor(() => Array.from(onlineUsers.keys()));\n\n    app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n      const status = err.status || err.statusCode || 500;\n      const message = err.message || \"Internal Server Error\";\n\n      log(`Error: ${message}`, 'express');\n      console.error('Full error details:', err);\n      \n      if (!res.headersSent) {\n        res.status(status).json({ message });\n      }\n    });\n\n    // importantly only setup vite in development and after\n    // setting up all the other routes so the catch-all route\n    // doesn't interfere with the other routes\n    if (env === \"development\") {\n      log('Setting up Vite dev server', 'express');\n      await setupVite(app, server);\n    } else {\n      log('Setting up production static file serving', 'express');\n      serveStatic(app);\n    }\n\n    // ALWAYS serve the app on the port specified in the environment variable PORT\n    // Other ports are firewalled. Default to 5000 if not specified.\n    // this serves both the API and the client.\n    // It is the only port that is not firewalled.\n    const port = parseInt(process.env.PORT || '5000', 10);\n    server.listen({\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    }, () => {\n      log(`Server successfully started on port ${port}`);\n      log(`Environment: ${env}`);\n    });\n\n    // Handle server errors\n    server.on('error', (error: any) => {\n      log(`Server error: ${error.message}`, 'express');\n      console.error('Full error:', error);\n      process.exit(1);\n    });\n\n    // ===== CLEANUP JOBS FOR REGISTRATION ABUSE PROTECTION =====\n    // Run cleanup every hour to remove expired pending users and old registration attempts\n    const CLEANUP_INTERVAL = 60 * 60 * 1000; // 1 hour in milliseconds\n    \n    const runCleanup = async () => {\n      try {\n        // Cleanup expired pending users (older than 24 hours)\n        const expiredPending = await storage.cleanupExpiredPendingUsers();\n        if (expiredPending > 0) {\n          log(`[CLEANUP] Deleted ${expiredPending} expired pending users`);\n        }\n\n        // Cleanup old registration attempts (older than 1 hour)\n        const oldAttempts = await storage.cleanupOldRegistrationAttempts(1);\n        if (oldAttempts > 0) {\n          log(`[CLEANUP] Deleted ${oldAttempts} old registration attempts`);\n        }\n      } catch (error) {\n        console.error('[CLEANUP] Error during cleanup job:', error);\n      }\n    };\n\n    // Run cleanup immediately on startup\n    runCleanup();\n\n    // Schedule cleanup to run every hour\n    setInterval(runCleanup, CLEANUP_INTERVAL);\n    log(`[CLEANUP] Scheduled cleanup job to run every ${CLEANUP_INTERVAL / 1000 / 60} minutes`);\n\n    // ===== WEBSOCKET SERVER FOR REAL-TIME MESSAGING =====\n    const wss = new WebSocketServer({ server, path: '/api/ws' });\n\n    wss.on('connection', async (ws: WebSocket, req) => {\n      try {\n        // Parse session cookie to authenticate user\n        const cookieHeader = req.headers.cookie;\n        if (!cookieHeader) {\n          ws.close(1008, 'No session cookie');\n          return;\n        }\n\n        // Extract session ID from cookie (this is a simplified approach)\n        // In production, you'd properly parse the session cookie\n        const sessionCookie = cookieHeader.split(';').find(c => c.trim().startsWith('connect.sid='));\n        if (!sessionCookie) {\n          ws.close(1008, 'Invalid session');\n          return;\n        }\n\n        // For now, we'll use a simpler approach: authenticate via initial message\n        let userId: number | null = null;\n\n        ws.on('message', async (data) => {\n          try {\n            const message = JSON.parse(data.toString());\n\n            // Authentication handshake\n            if (message.type === 'auth' && !userId) {\n              // Verify user is authenticated (you'd check session here)\n              // For simplicity, we trust the client sends correct userId after auth\n              // In production, validate against session store\n              userId = message.userId;\n              \n              if (!userId) {\n                ws.close(1008, 'Authentication failed');\n                return;\n              }\n\n              // Add user to online users\n              if (!onlineUsers.has(userId)) {\n                onlineUsers.set(userId, new Set());\n              }\n              onlineUsers.get(userId)!.add(ws);\n\n              // Update last seen timestamp\n              await storage.updateUserLastSeen(userId);\n\n              // Notify user is online\n              broadcastToUser(userId, {\n                type: 'online_status',\n                userId,\n                online: true,\n              });\n\n              log(`[WebSocket] User ${userId} connected`);\n              return;\n            }\n\n            if (!userId) {\n              ws.close(1008, 'Not authenticated');\n              return;\n            }\n\n            // Handle typing indicators\n            if (message.type === 'typing_start') {\n              const { receiverId } = message;\n              const conversationKey = getConversationKey(userId, receiverId);\n              const currentUserId = userId; // Capture for closure\n              \n              if (!typingUsers.has(conversationKey)) {\n                typingUsers.set(conversationKey, new Set());\n              }\n              typingUsers.get(conversationKey)!.add(userId);\n\n              // Notify receiver\n              broadcastToUser(receiverId, {\n                type: 'typing_start',\n                userId,\n              });\n\n              // Auto-clear typing after 5 seconds\n              setTimeout(() => {\n                typingUsers.get(conversationKey)?.delete(currentUserId);\n                broadcastToUser(receiverId, {\n                  type: 'typing_stop',\n                  userId: currentUserId,\n                });\n              }, 5000);\n            }\n\n            if (message.type === 'typing_stop') {\n              const { receiverId } = message;\n              const conversationKey = getConversationKey(userId, receiverId);\n              typingUsers.get(conversationKey)?.delete(userId);\n\n              broadcastToUser(receiverId, {\n                type: 'typing_stop',\n                userId,\n              });\n            }\n\n            // Handle new message notification\n            if (message.type === 'new_message') {\n              const { receiverId, messageData } = message;\n              \n              // Broadcast to receiver\n              broadcastToUser(receiverId, {\n                type: 'new_message',\n                message: messageData,\n              });\n            }\n\n            // Handle message read notification\n            if (message.type === 'message_read') {\n              const { senderId, conversationId } = message;\n              \n              // Notify sender that receiver read the message\n              broadcastToUser(senderId, {\n                type: 'message_read',\n                conversationId,\n                readBy: userId,\n              });\n            }\n\n          } catch (error: any) {\n            log(`[WebSocket] Message parse error: ${error.message}`);\n          }\n        });\n\n        ws.on('close', async () => {\n          if (userId) {\n            const userSockets = onlineUsers.get(userId);\n            if (userSockets) {\n              userSockets.delete(ws);\n              if (userSockets.size === 0) {\n                onlineUsers.delete(userId);\n                \n                // Update last seen timestamp when user goes offline\n                await storage.updateUserLastSeen(userId);\n                \n                // Broadcast offline status\n                broadcastToUser(userId, {\n                  type: 'online_status',\n                  userId,\n                  online: false,\n                });\n              }\n            }\n            log(`[WebSocket] User ${userId} disconnected`);\n          }\n        });\n\n        ws.on('error', (error) => {\n          log(`[WebSocket] Socket error: ${error.message}`);\n        });\n\n      } catch (error: any) {\n        log(`[WebSocket] Connection error: ${error.message}`);\n        ws.close(1011, 'Internal server error');\n      }\n    });\n\n    log('[WebSocket] WebSocket server initialized on /api/ws');\n\n  } catch (error: any) {\n    log(`Failed to start server: ${error.message}`, 'express');\n    console.error('Full error:', error);\n    process.exit(1);\n  }\n})();\n","size_bytes":17493},"client/src/pages/terms-of-use.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, Shield, AlertTriangle, FileText, Scale, Megaphone } from \"lucide-react\";\n\nexport default function TermsOfUsePage() {\n  return (\n    <div className=\"min-h-screen bg-background py-12\">\n      <div className=\"max-w-4xl mx-auto px-4 md:px-6\">\n        <Link href=\"/giveaway\" data-testid=\"link-back-giveaway\">\n          <Button variant=\"ghost\" className=\"mb-8\" data-testid=\"button-back\">\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Nazad na Giveaway\n          </Button>\n        </Link>\n\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold mb-3\" data-testid=\"heading-terms\">\n            Uslovi Kori≈°ƒáenja - Studio LeFlow Giveaway\n          </h1>\n          <p className=\"text-muted-foreground text-lg\" data-testid=\"text-subtitle\">\n            Molimo vas da pa≈æljivo proƒçitate sledeƒáe uslove pre uƒçe≈°ƒáa u meseƒçnom konkursu\n          </p>\n        </div>\n\n        <div className=\"space-y-6\">\n          {/* Prihvatanje Uslova */}\n          <Card data-testid=\"card-acceptance\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <FileText className=\"w-5 h-5 text-primary\" />\n                1. Prihvatanje Uslova\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-muted-foreground\">\n              <p>\n                Pristupanjem i kori≈°ƒáenjem Studio LeFlow Giveaway platforme (u daljem tekstu \"Platforma\"), \n                potvrƒëujete da ste proƒçitali, razumeli i prihvatili sve uslove kori≈°ƒáenja navedene u ovom \n                dokumentu.\n              </p>\n              <p>\n                Uƒçe≈°ƒáe u meseƒçnom konkursu podrazumeva potpuno i bezuslovno prihvatanje svih pravila i \n                obaveza navedenih u ovim Uslovima kori≈°ƒáenja.\n              </p>\n              <p className=\"font-medium text-foreground\">\n                Ako ne prihvatate ove uslove, molimo vas da ne uƒçestvujete u konkursu niti koristite Platformu.\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Pravila Uƒçe≈°ƒáa */}\n          <Card data-testid=\"card-participation\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <Shield className=\"w-5 h-5 text-primary\" />\n                2. Pravila Uƒçe≈°ƒáa u Konkursu\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">2.1 Upload Projekata</h3>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Svaki registrovani korisnik mo≈æe uploadovati <strong>maksimalno jedan (1) projekat meseƒçno</strong></li>\n                  <li>Projekti moraju biti u MP3 formatu, maksimalne veliƒçine <strong>100MB</strong></li>\n                  <li>Uƒçesnik garantuje da je <strong>vlasnik svih autorskih prava</strong> na uploadovani projekat</li>\n                  <li>Zabranjeno je uploadovanje sadr≈æaja koji kr≈°i autorska prava treƒáih lica</li>\n                  <li>Zabranjeno je uploadovanje sadr≈æaja koji sadr≈æi uvredljiv, diskriminatorni ili nezakonit materijal</li>\n                </ul>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">2.2 Glasanje</h3>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Svaki korisnik mo≈æe glasati za <strong>vi≈°e razliƒçitih projekata</strong></li>\n                  <li>Zabranjeno je glasati vi≈°e puta za isti projekat</li>\n                  <li>Sistem automatski prati IP adrese kako bi spreƒçio zloupotrebe</li>\n                  <li>Poku≈°aji manipulacije glasovima (kori≈°ƒáenje vi≈°e naloga, VPN, proxy servisi) rezultovaƒáe <strong>trajnim banom</strong></li>\n                </ul>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">2.3 Komentarisanje</h3>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Komentari moraju biti konstruktivni i po≈°tovati druge uƒçesnike</li>\n                  <li>Zabranjeni su uvredljivi, diskriminatorni ili neprimereni komentari</li>\n                  <li>Studio LeFlow zadr≈æava pravo brisanja neprimerenih komentara bez prethodne najave</li>\n                  <li>Korisnici koji ponavljaju kr≈°enje pravila pona≈°anja mogu biti trajno banovani</li>\n                </ul>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* KRITIƒåNO: Zabrana Downloadovanja */}\n          <Card data-testid=\"card-download-prohibition\" className=\"border-destructive/50\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3 text-destructive\">\n                <AlertTriangle className=\"w-5 h-5\" />\n                3. ZABRANA DOWNLOADOVANJA I DELJENJA SADR≈ΩAJA\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"bg-destructive/10 p-4 rounded-lg border border-destructive/30\">\n                <p className=\"font-bold text-destructive mb-3 text-lg flex items-center gap-2\">\n                  <AlertTriangle className=\"w-5 h-5\" />\n                  STROGO ZABRANJENO\n                </p>\n                <ul className=\"list-disc list-inside space-y-2 text-foreground ml-4\">\n                  <li><strong>Downloadovanje</strong> bilo kog projekta uploadovanog na Platformu</li>\n                  <li><strong>Snimanje, kopiranje ili ƒçuvanje</strong> audio fajlova sa Platforme</li>\n                  <li><strong>Deljenje projekata</strong> izvan Studio LeFlow Giveaway platforme (social media, streaming servisi, file sharing platforme)</li>\n                  <li><strong>Komercijalna upotreba</strong> bilo kog sadr≈æaja sa Platforme bez eksplicitne dozvole autora</li>\n                  <li><strong>Re-upload</strong> tuƒëih projekata kao sopstvenih</li>\n                </ul>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">3.1 Tehniƒçka Za≈°tita</h3>\n                <p className=\"text-muted-foreground\">\n                  Audio playerima je <strong>onemoguƒáena download opcija</strong> putem HTML5 atributa. \n                  Meƒëutim, svesni smo da tehniƒçka za≈°tita nije apsolutna i da korisnici sa tehniƒçkim znanjem \n                  mogu pronaƒái naƒçine da preuzmu fajlove.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">3.2 Pravno Odricanje</h3>\n                <p className=\"text-muted-foreground mb-3\">\n                  <strong>KORISTEƒÜI OVU PLATFORMU, POTVRƒêUJETE DA NEƒÜETE:</strong>\n                </p>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Poku≈°avati da zaobiƒëete tehniƒçke mere za≈°tite</li>\n                  <li>Koristiti alate ili skripte za automatsko preuzimanje sadr≈æaja</li>\n                  <li>Snimati audio preko screen/audio recording softvera</li>\n                  <li>Deliti linkove ka audio fajlovima van Platforme</li>\n                </ul>\n              </div>\n\n              <div className=\"bg-amber-500/10 p-4 rounded-lg border border-amber-500/30 mt-4\">\n                <p className=\"font-semibold text-amber-600 dark:text-amber-400 mb-2 flex items-center gap-2\">\n                  <Megaphone className=\"w-5 h-5\" />\n                  Socijalna Odgovornost\n                </p>\n                <p className=\"text-muted-foreground\">\n                  Svi uƒçesnici su vidljivi sa svojim korisniƒçkim imenima. Po≈°tovanje autorskih prava \n                  i pravila zajednice je pitanje <strong>liƒçne etike i odgovornosti</strong>. \n                  Studio LeFlow zajednica se zasniva na poverenju i meƒëusobnom po≈°tovanju umetnika.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Autorska Prava */}\n          <Card data-testid=\"card-copyright\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <Scale className=\"w-5 h-5 text-primary\" />\n                4. Autorska Prava i Intelektualna Svojina\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">4.1 Vlasni≈°tvo Nad Projektima</h3>\n                <p className=\"text-muted-foreground\">\n                  Uploadovanjem projekta na Platformu, uƒçesnik zadr≈æava <strong>sva autorska prava</strong> \n                  na svoj rad. Studio LeFlow NE preuzima vlasni≈°tvo nad projektima niti stiƒçe ekskluzivna \n                  prava na distribuciju.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">4.2 Licenca za Platformu</h3>\n                <p className=\"text-muted-foreground mb-3\">\n                  Uploadovanjem projekta, uƒçesnik daje Studio LeFlow-u <strong>neekskluzivnu, ograniƒçenu licencu</strong> za:\n                </p>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Hosting i prikazivanje projekta na Platformi tokom trajanja konkursa</li>\n                  <li>Streaming audio sadr≈æaja registrovanim korisnicima</li>\n                  <li>Promociju pobedniƒçkog projekta na zvaniƒçnim Studio LeFlow kanalima (Instagram, website)</li>\n                </ul>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">4.3 Automatsko Brisanje</h3>\n                <p className=\"text-muted-foreground\">\n                  Svi uploadovani projekti se ƒçuvaju na Ufile.io servisu koji <strong>automatski bri≈°e \n                  fajlove nakon 30 dana</strong>. Uƒçesnici su odgovorni za ƒçuvanje originalnih kopija \n                  svojih projekata.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">4.4 Prijava Kr≈°enja Autorskih Prava</h3>\n                <p className=\"text-muted-foreground\">\n                  Ako smatrate da va≈°a autorska prava bivaju povreƒëena sadr≈æajem na Platformi, \n                  kontaktirajte nas na: <strong>info@studioleflow.com</strong>\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Nagrade i Pobednici */}\n          <Card data-testid=\"card-prizes\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <Shield className=\"w-5 h-5 text-primary\" />\n                5. Nagrade i Pobednici\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">5.1 Nagrada</h3>\n                <p className=\"text-muted-foreground mb-3\">\n                  Pobednik meseƒçnog konkursa osvaja <strong>BESPLATNU produkciju</strong> svog projekta \n                  u Studio LeFlow-u, koja ukljuƒçuje:\n                </p>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Profesionalni recording vokal(a)</li>\n                  <li>Mixing & Mastering finalnog projekta</li>\n                  <li>Konsultacije sa producentima i in≈æenjerima</li>\n                </ul>\n                <p className=\"text-muted-foreground mt-3\">\n                  Vrednost nagrade: <strong>~15.000 - 25.000 RSD</strong> (u zavisnosti od kompleksnosti projekta)\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">5.2 Odreƒëivanje Pobednika</h3>\n                <p className=\"text-muted-foreground\">\n                  Pobednik se odreƒëuje na osnovu <strong>najveƒáeg broja glasova</strong> do kraja meseƒçnog konkursa. \n                  U sluƒçaju izjednaƒçenog broja glasova, pobednik ƒáe biti odreƒëen na osnovu datuma uploada \n                  (raniji upload ima prednost).\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">5.3 Zakazivanje Produkcije</h3>\n                <p className=\"text-muted-foreground\">\n                  Pobednik mora zakazati termin produkcije <strong>u roku od 60 dana</strong> od objave rezultata. \n                  Nakon isteka roka, nagrada se poni≈°tava bez moguƒánosti obnove.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">5.4 Preno≈°enje Nagrade</h3>\n                <p className=\"text-muted-foreground\">\n                  Nagrada se <strong>ne mo≈æe preneti na drugu osobu</strong> niti zameniti za novƒçani ekvivalent.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Odgovornost i Garancije */}\n          <Card data-testid=\"card-liability\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <AlertTriangle className=\"w-5 h-5 text-primary\" />\n                6. Odgovornost i Odricanje Garancija\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">6.1 Platforma \"Takva Kakva Jeste\"</h3>\n                <p className=\"text-muted-foreground\">\n                  Platforma se pru≈æa <strong>\"as is\"</strong> bez garancija bilo koje vrste. Studio LeFlow \n                  ne garantuje neprekinut ili bezgreshan rad Platforme.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">6.2 Gubitak Podataka</h3>\n                <p className=\"text-muted-foreground\">\n                  Studio LeFlow <strong>nije odgovoran</strong> za gubitak uploadovanih projekata usled \n                  tehniƒçkih problema, brisanja naloga, ili automatskog brisanja nakon 30 dana.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">6.3 Pona≈°anje Korisnika</h3>\n                <p className=\"text-muted-foreground\">\n                  Studio LeFlow <strong>nije odgovoran</strong> za pona≈°anje korisnika, sadr≈æaj komentara, \n                  ili eventualne sporove izmeƒëu uƒçesnika.\n                </p>\n              </div>\n\n              <div>\n                <h3 className=\"font-semibold text-foreground mb-2\">6.4 Kr≈°enje Pravila</h3>\n                <p className=\"text-muted-foreground\">\n                  Studio LeFlow zadr≈æava pravo da <strong>diskvalifikuje uƒçesnike</strong> koji kr≈°e ove Uslove \n                  kori≈°ƒáenja, bez prethodne najave ili obja≈°njenja.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Izmene Uslova */}\n          <Card data-testid=\"card-changes\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <FileText className=\"w-5 h-5 text-primary\" />\n                7. Izmene Uslova Kori≈°ƒáenja\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-muted-foreground\">\n              <p>\n                Studio LeFlow zadr≈æava pravo da <strong>izmeni ili dopuni</strong> ove Uslove kori≈°ƒáenja \n                u bilo kom trenutku. Izmene stupaju na snagu odmah nakon objavljivanja na Platformi.\n              </p>\n              <p>\n                Nastavak kori≈°ƒáenja Platforme nakon izmena podrazumeva prihvatanje novih uslova.\n              </p>\n              <p className=\"font-medium text-foreground\">\n                Datum poslednje izmene: <strong>Novembar 2025</strong>\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Privatnost Poruka */}\n          <Card data-testid=\"card-messaging-privacy\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <Shield className=\"w-5 h-5 text-primary\" />\n                8. Privatnost i Bezbednost Poruka\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-muted-foreground\">\n              <p>\n                Studio LeFlow platforma omoguƒáava korisnicima razmenu privatnih poruka u svrhu komunikacije \n                o projektima, saradnji i pitanjima vezanim za produkciju.\n              </p>\n              <p>\n                <strong className=\"text-foreground\">Administrator platforme ima pristup privatnim porukama u svrhu:</strong>\n              </p>\n              <ul className=\"list-disc list-inside space-y-2 ml-4\">\n                <li>Bezbednosti platforme i za≈°tite korisnika od zloupotrebe</li>\n                <li>Moderacije sadr≈æaja i spreƒçavanja uvredljivog ili neprimerenog pona≈°anja</li>\n                <li>Tehniƒçke podr≈°ke i re≈°avanja sporova izmeƒëu korisnika</li>\n                <li>Inspekcije u sluƒçaju prijava kr≈°enja pravila ili nezakonitog sadr≈æaja</li>\n              </ul>\n              <p className=\"font-medium text-foreground mt-3\">\n                Kori≈°ƒáenjem sistema za razmenu poruka, korisnik potvrƒëuje da je svestan da administrator \n                mo≈æe pristupiti sadr≈æaju poruka u napred navedene svrhe.\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Kontakt */}\n          <Card data-testid=\"card-contact\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-3\">\n                <Shield className=\"w-5 h-5 text-primary\" />\n                9. Kontakt Informacije\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-muted-foreground\">\n              <p>\n                Za pitanja u vezi sa Uslovima kori≈°ƒáenja, prijavama kr≈°enja pravila, ili tehniƒçkim problemima, \n                kontaktirajte nas:\n              </p>\n              <div className=\"bg-muted/50 p-4 rounded-lg\">\n                <p className=\"font-semibold text-foreground mb-2\">Studio LeFlow</p>\n                <p>Email: <strong>info@studioleflow.com</strong></p>\n                <p>Telefon: <strong>+381 63 734 7023</strong></p>\n                <p>Instagram: <strong>@studioleflow</strong></p>\n                <p>Lokacija: Beograd, Srbija</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Footer Actions */}\n        <div className=\"mt-12 text-center\">\n          <Link href=\"/giveaway\" data-testid=\"link-back-footer\">\n            <Button size=\"lg\" data-testid=\"button-back-footer\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Nazad na Giveaway\n            </Button>\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":19320},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/motion/FadeIn.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { ReactNode } from \"react\";\n\ninterface FadeInProps {\n  children: ReactNode;\n  delay?: number;\n  duration?: number;\n  className?: string;\n}\n\nexport function FadeIn({ children, delay = 0, duration = 0.5, className }: FadeInProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration, delay, ease: \"easeOut\" }}\n      className={className}\n    >\n      {children}\n    </motion.div>\n  );\n}\n\nexport function FadeInWhenVisible({ children, delay = 0, className }: Omit<FadeInProps, 'duration'>) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 30 }}\n      whileInView={{ opacity: 1, y: 0 }}\n      viewport={{ once: true, margin: \"-100px\" }}\n      transition={{ duration: 0.6, delay, ease: \"easeOut\" }}\n      className={className}\n    >\n      {children}\n    </motion.div>\n  );\n}\n","size_bytes":908},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/auth-page.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Music, ArrowLeft, Mail, Lock, CheckCircle2, AlertTriangle } from \"lucide-react\";\nimport { insertUserSchema } from \"@shared/schema\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n  FormDescription,\n} from \"@/components/ui/form\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { VerificationModal } from \"@/components/VerificationModal\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst loginSchema = z.object({\n  username: z.string().min(3, \"Korisniƒçko ime mora imati najmanje 3 karaktera\"),\n  password: z.string().min(8, \"Lozinka mora imati najmanje 8 karaktera\"),\n  rememberMe: z.boolean().optional().default(false),\n});\n\nconst registerSchema = insertUserSchema.extend({\n  passwordConfirm: z.string(),\n  termsAccepted: z.boolean().refine((val) => val === true, {\n    message: \"Morate prihvatiti uslove kori≈°ƒáenja\",\n  }),\n}).refine((data) => data.password === data.passwordConfirm, {\n  message: \"Lozinke se ne poklapaju\",\n  path: [\"passwordConfirm\"],\n});\n\nconst forgotPasswordSchema = z.object({\n  email: z.string().email(\"Unesite validnu email adresu\"),\n});\n\nconst resetPasswordSchema = z.object({\n  email: z.string().email(\"Unesite validnu email adresu\"),\n  token: z.string().length(6, \"Kod mora imati taƒçno 6 cifara\"),\n  newPassword: z.string().min(8, \"Lozinka mora imati najmanje 8 karaktera\"),\n  confirmPassword: z.string(),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: \"Lozinke se ne poklapaju\",\n  path: [\"confirmPassword\"],\n});\n\ntype LoginFormData = z.infer<typeof loginSchema>;\ntype RegisterFormData = z.infer<typeof registerSchema>;\ntype ForgotPasswordFormData = z.infer<typeof forgotPasswordSchema>;\ntype ResetPasswordFormData = z.infer<typeof resetPasswordSchema>;\n\ntype ViewMode = \"auth\" | \"forgot-password\" | \"reset-password\" | \"reset-success\";\n\nexport default function AuthPage() {\n  const [location, setLocation] = useLocation();\n  const { user, loginMutation, registerMutation } = useAuth();\n  const { toast } = useToast();\n  \n  const initialTab = location === \"/registracija\" ? \"register\" : \"login\";\n  const [activeTab, setActiveTab] = useState(initialTab);\n  const [viewMode, setViewMode] = useState<ViewMode>(\"auth\");\n  const [showVerificationModal, setShowVerificationModal] = useState(false);\n  const [registeredUser, setRegisteredUser] = useState<{ id: number; email: string } | null>(null);\n  const [resetUserEmail, setResetUserEmail] = useState(\"\");\n\n  const loginForm = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n      rememberMe: false,\n    },\n  });\n\n  const registerForm = useForm<RegisterFormData>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: {\n      email: \"\",\n      username: \"\",\n      password: \"\",\n      passwordConfirm: \"\",\n      termsAccepted: false,\n    },\n  });\n\n  const forgotPasswordForm = useForm<ForgotPasswordFormData>({\n    resolver: zodResolver(forgotPasswordSchema),\n    defaultValues: {\n      email: \"\",\n    },\n  });\n\n  const resetPasswordForm = useForm<ResetPasswordFormData>({\n    resolver: zodResolver(resetPasswordSchema),\n    defaultValues: {\n      email: \"\",\n      token: \"\",\n      newPassword: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (user !== null) {\n      setLocation(\"/\");\n    }\n  }, [user, setLocation]);\n\n  const onLoginSubmit = async (data: LoginFormData) => {\n    await loginMutation.mutateAsync(data);\n  };\n\n  const onRegisterSubmit = async (data: RegisterFormData) => {\n    const { passwordConfirm, ...registerData } = data;\n    try {\n      const result = await registerMutation.mutateAsync(registerData);\n      setRegisteredUser({ id: result.id, email: result.email });\n      setShowVerificationModal(true);\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n    }\n  };\n\n  const handleVerificationSuccess = () => {\n    setShowVerificationModal(false);\n    setRegisteredUser(null);\n    setLocation(\"/\");\n  };\n\n  const forgotPasswordMutation = useMutation({\n    mutationFn: async (data: ForgotPasswordFormData) => {\n      return await apiRequest(\"POST\", \"/api/forgot-password\", data);\n    },\n    onSuccess: () => {\n      const email = forgotPasswordForm.getValues(\"email\");\n      setResetUserEmail(email);\n      // Pre-fill email in reset password form\n      resetPasswordForm.setValue(\"email\", email);\n      setViewMode(\"reset-password\");\n      toast({\n        title: \"Email poslat\",\n        description: \"Kod za resetovanje lozinke je poslat na va≈°u email adresu.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: error.message || \"Do≈°lo je do gre≈°ke. Molimo poku≈°ajte ponovo.\",\n      });\n    },\n  });\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: async (data: ResetPasswordFormData) => {\n      return await apiRequest(\"POST\", \"/api/reset-password\", {\n        email: data.email,\n        token: data.token,\n        newPassword: data.newPassword,\n      });\n    },\n    onSuccess: () => {\n      setViewMode(\"reset-success\");\n      toast({\n        title: \"Uspe≈°no!\",\n        description: \"Lozinka je uspe≈°no promenjena. Sada se mo≈æete prijaviti.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: error.message || \"Do≈°lo je do gre≈°ke. Molimo poku≈°ajte ponovo.\",\n      });\n    },\n  });\n\n  const onForgotPasswordSubmit = async (data: ForgotPasswordFormData) => {\n    await forgotPasswordMutation.mutateAsync(data);\n  };\n\n  const onResetPasswordSubmit = async (data: ResetPasswordFormData) => {\n    await resetPasswordMutation.mutateAsync(data);\n  };\n\n  const handleBackToLogin = () => {\n    setViewMode(\"auth\");\n    setActiveTab(\"login\");\n    forgotPasswordForm.reset();\n    resetPasswordForm.reset();\n  };\n\n  // Forgot Password View\n  if (viewMode === \"forgot-password\") {\n    return (\n      <div className=\"min-h-screen flex\">\n        <div className=\"w-full lg:w-1/2 flex items-center justify-center p-6 lg:p-12\">\n          <div className=\"w-full max-w-md space-y-8\">\n            <div className=\"text-center\">\n              <div className=\"inline-flex items-center gap-2 mb-4\">\n                <Music className=\"w-8 h-8 text-primary\" />\n                <h1 className=\"text-3xl font-bold font-[Montserrat]\">Studio LeFlow</h1>\n              </div>\n              <p className=\"text-muted-foreground\">\n                Zaboravili ste lozinku?\n              </p>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Mail className=\"w-5 h-5 text-primary\" />\n                  Resetovanje Lozinke\n                </CardTitle>\n                <CardDescription>\n                  Unesite va≈°u email adresu i poslaƒáemo vam kod za resetovanje lozinke.\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...forgotPasswordForm}>\n                  <form onSubmit={forgotPasswordForm.handleSubmit(onForgotPasswordSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={forgotPasswordForm.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Email adresa</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"email\"\n                              placeholder=\"vas@email.com\"\n                              autoComplete=\"email\"\n                              data-testid=\"input-forgot-email\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full\"\n                      disabled={forgotPasswordMutation.isPending}\n                      data-testid=\"button-send-code\"\n                    >\n                      {forgotPasswordMutation.isPending ? \"Slanje...\" : \"Po≈°alji Kod\"}\n                    </Button>\n\n                    <div className=\"text-center\">\n                      <Button \n                        variant=\"ghost\" \n                        className=\"gap-2\" \n                        onClick={handleBackToLogin}\n                        data-testid=\"button-back-login\"\n                      >\n                        <ArrowLeft className=\"w-4 h-4\" />\n                        Nazad na Prijavu\n                      </Button>\n                    </div>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        <div className=\"hidden lg:flex lg:w-1/2 relative overflow-hidden text-white\">\n          <div \n            className=\"absolute inset-0 bg-cover bg-center opacity-50 grayscale\"\n            style={{ backgroundImage: \"url('/equipment/midi-workstation.jpg')\" }}\n          />\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-primary/90 to-primary/80\" />\n          \n          <div className=\"relative z-10 flex flex-col items-center justify-center text-center p-12 w-full gap-6\">\n            <div>\n              <Mail className=\"w-24 h-24 mx-auto\" />\n            </div>\n            \n            <h2 className=\"text-4xl lg:text-5xl font-bold tracking-tight font-[Montserrat] max-w-2xl mx-auto\">\n              Resetovanje Lozinke\n            </h2>\n            \n            <p className=\"text-xl lg:text-2xl max-w-lg mx-auto leading-relaxed text-white/90\">\n              Brzo i sigurno vratite pristup svom nalogu pomoƒáu verifikacionog koda.\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Reset Password View\n  if (viewMode === \"reset-password\") {\n    return (\n      <div className=\"min-h-screen flex\">\n        <div className=\"w-full lg:w-1/2 flex items-center justify-center p-6 lg:p-12\">\n          <div className=\"w-full max-w-md space-y-8\">\n            <div className=\"text-center\">\n              <div className=\"inline-flex items-center gap-2 mb-4\">\n                <Music className=\"w-8 h-8 text-primary\" />\n                <h1 className=\"text-3xl font-bold font-[Montserrat]\">Studio LeFlow</h1>\n              </div>\n              <p className=\"text-muted-foreground\">\n                Kreirajte novu lozinku\n              </p>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Lock className=\"w-5 h-5 text-primary\" />\n                  Nova Lozinka\n                </CardTitle>\n                <CardDescription>\n                  {resetUserEmail && (\n                    <span>\n                      Proverite email <strong>{resetUserEmail}</strong> za 6-cifreni kod.\n                    </span>\n                  )}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...resetPasswordForm}>\n                  <form onSubmit={resetPasswordForm.handleSubmit(onResetPasswordSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={resetPasswordForm.control}\n                      name=\"email\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Email adresa</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"email\"\n                              placeholder=\"vas@email.com\"\n                              autoComplete=\"email\"\n                              readOnly\n                              disabled\n                              className=\"bg-muted\"\n                              data-testid=\"input-reset-email\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={resetPasswordForm.control}\n                      name=\"token\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Verifikacioni Kod</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"123456\"\n                              maxLength={6}\n                              data-testid=\"input-reset-token\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={resetPasswordForm.control}\n                      name=\"newPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Nova Lozinka</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"password\"\n                              placeholder=\"Unesite novu lozinku\"\n                              autoComplete=\"new-password\"\n                              data-testid=\"input-new-password\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={resetPasswordForm.control}\n                      name=\"confirmPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Potvrda Lozinke</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"password\"\n                              placeholder=\"Ponovite novu lozinku\"\n                              autoComplete=\"new-password\"\n                              data-testid=\"input-confirm-password\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full\"\n                      disabled={resetPasswordMutation.isPending}\n                      data-testid=\"button-reset-password\"\n                    >\n                      {resetPasswordMutation.isPending ? \"ƒåuvanje...\" : \"Resetuj Lozinku\"}\n                    </Button>\n\n                    <div className=\"text-center\">\n                      <Button \n                        variant=\"ghost\" \n                        className=\"gap-2\" \n                        onClick={() => setViewMode(\"forgot-password\")}\n                        data-testid=\"button-resend-code\"\n                      >\n                        <ArrowLeft className=\"w-4 h-4\" />\n                        Po≈°alji Ponovo Kod\n                      </Button>\n                    </div>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        <div className=\"hidden lg:flex lg:w-1/2 relative overflow-hidden text-white\">\n          <div \n            className=\"absolute inset-0 bg-cover bg-center opacity-50 grayscale\"\n            style={{ backgroundImage: \"url('/equipment/midi-workstation.jpg')\" }}\n          />\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-primary/90 to-primary/80\" />\n          \n          <div className=\"relative z-10 flex flex-col items-center justify-center text-center p-12 w-full gap-6\">\n            <div>\n              <Lock className=\"w-24 h-24 mx-auto\" />\n            </div>\n            \n            <h2 className=\"text-4xl lg:text-5xl font-bold tracking-tight font-[Montserrat] max-w-2xl mx-auto\">\n              Sigurno Resetovanje\n            </h2>\n            \n            <p className=\"text-xl lg:text-2xl max-w-lg mx-auto leading-relaxed text-white/90\">\n              Va≈°a nova lozinka ƒáe biti sigurno ≈°ifrovana i za≈°tiƒáena.\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Reset Success View\n  if (viewMode === \"reset-success\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\n        <Card className=\"w-full max-w-md border-primary/20\">\n          <CardHeader>\n            <div className=\"mb-4 inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mx-auto\">\n              <CheckCircle2 className=\"w-8 h-8 text-primary\" />\n            </div>\n            <CardTitle className=\"text-center\" data-testid=\"text-reset-success\">\n              Lozinka Promenjena!\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              Va≈°a lozinka je uspe≈°no resetovana.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-sm text-muted-foreground text-center\">\n              Sada se mo≈æete prijaviti koristeƒái novu lozinku.\n            </p>\n\n            <Button \n              className=\"w-full\" \n              onClick={handleBackToLogin}\n              data-testid=\"button-go-to-login\"\n            >\n              Prijavite se\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Main Auth View (Login & Register)\n  return (\n    <div className=\"min-h-screen flex\">\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-6 lg:p-12\">\n        <div className=\"w-full max-w-md space-y-8\">\n          <div className=\"text-center\">\n            <div className=\"inline-flex items-center gap-2 mb-4\">\n              <Music className=\"w-8 h-8 text-primary\" />\n              <h1 className=\"text-3xl font-bold font-[Montserrat]\">Studio LeFlow</h1>\n            </div>\n            <p className=\"text-muted-foreground\">\n              Prijavite se ili kreirajte nalog\n            </p>\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"login\" data-testid=\"tab-login\">\n                Prijava\n              </TabsTrigger>\n              <TabsTrigger value=\"register\" data-testid=\"tab-register\">\n                Registracija\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"login\" className=\"space-y-4\">\n              <Form {...loginForm}>\n                <form onSubmit={loginForm.handleSubmit(onLoginSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={loginForm.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Korisniƒçko ime</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Unesite korisniƒçko ime\"\n                            autoComplete=\"username\"\n                            data-testid=\"input-username\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={loginForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Lozinka</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder=\"Unesite lozinku\"\n                            autoComplete=\"current-password\"\n                            data-testid=\"input-password\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"flex items-center justify-between\">\n                    <FormField\n                      control={loginForm.control}\n                      name=\"rememberMe\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-center space-x-2 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              data-testid=\"checkbox-remember-me\"\n                            />\n                          </FormControl>\n                          <FormLabel className=\"text-sm font-normal cursor-pointer\">\n                            Zapamti me\n                          </FormLabel>\n                        </FormItem>\n                      )}\n                    />\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      className=\"px-0 text-sm text-primary hover:text-primary/80\"\n                      onClick={() => setViewMode(\"forgot-password\")}\n                      data-testid=\"link-forgot-password\"\n                    >\n                      Zaboravili ste lozinku?\n                    </Button>\n                  </div>\n\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={loginMutation.isPending}\n                    data-testid=\"button-login\"\n                  >\n                    {loginMutation.isPending ? \"Prijavljivanje...\" : \"Prijavite se\"}\n                  </Button>\n                </form>\n              </Form>\n            </TabsContent>\n\n            <TabsContent value=\"register\" className=\"space-y-4\">\n              <Form {...registerForm}>\n                <form onSubmit={registerForm.handleSubmit(onRegisterSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={registerForm.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"email\"\n                            placeholder=\"Unesite email adresu\"\n                            autoComplete=\"email\"\n                            data-testid=\"input-email\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={registerForm.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Korisniƒçko ime</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Unesite korisniƒçko ime\"\n                            autoComplete=\"username\"\n                            data-testid=\"input-username\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={registerForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Lozinka</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder=\"Unesite lozinku\"\n                            autoComplete=\"new-password\"\n                            data-testid=\"input-password\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={registerForm.control}\n                    name=\"passwordConfirm\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Potvrda lozinke</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"password\"\n                            placeholder=\"Ponovite lozinku\"\n                            autoComplete=\"new-password\"\n                            data-testid=\"input-password-confirm\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={registerForm.control}\n                    name=\"termsAccepted\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"checkbox-terms\"\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel className=\"text-sm font-normal cursor-pointer\">\n                            Potvrƒëujem da sam proƒçitao i prihvatam na≈°e{\" \"}\n                            <Link href=\"/terms\" className=\"text-primary underline hover:text-primary/80\" data-testid=\"link-terms\">\n                              Uslove kori≈°ƒáenja\n                            </Link>\n                          </FormLabel>\n                          <FormMessage />\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={registerMutation.isPending}\n                    data-testid=\"button-register\"\n                  >\n                    {registerMutation.isPending ? \"Registracija...\" : \"Registrujte se\"}\n                  </Button>\n                </form>\n              </Form>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n\n      <div className=\"hidden lg:flex lg:w-1/2 relative overflow-hidden text-white\">\n        <div \n          className=\"absolute inset-0 bg-cover bg-center opacity-50 grayscale\"\n          style={{ backgroundImage: \"url('/equipment/midi-workstation.jpg')\" }}\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-primary/90 to-primary/80\" />\n        \n        <div className=\"relative z-10 flex flex-col items-center justify-center text-center p-12 w-full gap-6\">\n          <div>\n            <Music className=\"w-24 h-24 mx-auto\" />\n          </div>\n          \n          <h2 className=\"text-4xl lg:text-5xl font-bold tracking-tight font-[Montserrat] max-w-2xl mx-auto\">\n            Studio LeFlow Platforma\n          </h2>\n          \n          <p className=\"text-xl lg:text-2xl max-w-lg mx-auto leading-relaxed text-white/90\">\n            Centralno mesto za produkciju, kolaboraciju i isporuku muzike ‚Äì rezervi≈°ite studio, delite projekte, uƒçestvujte u giveaway konkursima i pratite revizije u jednom profesionalnom okru≈æenju.\n          </p>\n        </div>\n      </div>\n\n      {registeredUser && (\n        <VerificationModal\n          isOpen={showVerificationModal}\n          onClose={() => setShowVerificationModal(false)}\n          userId={registeredUser.id}\n          email={registeredUser.email}\n          onSuccess={handleVerificationSuccess}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":29436},"client/src/components/theme-provider.tsx":{"content":"import { ThemeProvider as NextThemesProvider } from \"next-themes\";\nimport { type ReactNode } from \"react\";\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  return (\n    <NextThemesProvider\n      attribute=\"class\"\n      defaultTheme=\"dark\"\n      enableSystem\n      disableTransitionOnChange\n    >\n      {children}\n    </NextThemesProvider>\n  );\n}\n","size_bytes":371},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport { registerServiceWorker } from \"./lib/registerServiceWorker\";\n\n// Register PWA Service Worker\nregisterServiceWorker();\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":283},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"server/resend-client.ts":{"content":"import { Resend } from 'resend';\n\n// Cache credentials to avoid repeated API calls\nlet cachedCredentials: { apiKey: string; fromEmail: string } | null = null;\n\n// Development mode storage for verification codes\ninterface VerificationCodeStorage {\n  email: string;\n  code: string;\n  subject: string;\n  timestamp: number;\n}\n\nlet lastVerificationCode: VerificationCodeStorage | null = null;\n\n// Export function to get last verification code (for debug endpoint)\nexport function getLastVerificationCode(): VerificationCodeStorage | null {\n  return lastVerificationCode;\n}\n\nasync function getCredentials() {\n  // Return cached credentials if available\n  if (cachedCredentials) {\n    console.log('[RESEND] Using cached credentials');\n    return cachedCredentials;\n  }\n\n  // Check for direct API key in environment variables first\n  const directApiKey = process.env.RESEND_API_KEY;\n  \n  if (directApiKey) {\n    console.log('[RESEND] Using RESEND_API_KEY from environment variables');\n    \n    // In production, RESEND_FROM_EMAIL is required to avoid silent failures\n    const fromEmail = process.env.RESEND_FROM_EMAIL;\n    \n    if (!fromEmail) {\n      // Allow fallback to test domain only in development\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('[RESEND] RESEND_FROM_EMAIL not set, using test domain (development only)');\n        cachedCredentials = {\n          apiKey: directApiKey,\n          fromEmail: 'onboarding@resend.dev'\n        };\n        return cachedCredentials;\n      }\n      \n      // Fail fast in production\n      console.error('[RESEND] RESEND_FROM_EMAIL environment variable is required in production');\n      throw new Error('RESEND_FROM_EMAIL is not configured. Add it to secrets with your verified domain email (e.g., no-reply@mail.studioleflow.com)');\n    }\n    \n    cachedCredentials = {\n      apiKey: directApiKey,\n      fromEmail: fromEmail\n    };\n    \n    return cachedCredentials;\n  }\n\n  // Fallback to Replit connector\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    console.error('[RESEND] X_REPLIT_TOKEN not found and no direct API key');\n    throw new Error('Resend API key not configured');\n  }\n\n  console.log('[RESEND] Fetching connection settings from:', hostname);\n  \n  const response = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=resend',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  );\n  \n  const data = await response.json();\n  const connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings?.api_key)) {\n    console.error('[RESEND] Connection settings invalid:', connectionSettings);\n    throw new Error('Resend not connected');\n  }\n\n  if (!connectionSettings.settings.from_email) {\n    console.error('[RESEND] Missing from_email in connection settings');\n    throw new Error('Resend from_email not configured');\n  }\n  \n  console.log('[RESEND] Successfully retrieved API key from connector');\n  \n  // Cache credentials for future use\n  cachedCredentials = {\n    apiKey: connectionSettings.settings.api_key, \n    fromEmail: connectionSettings.settings.from_email\n  };\n  \n  return cachedCredentials;\n}\n\nexport async function getResendClient() {\n  try {\n    const credentials = await getCredentials();\n    console.log('[RESEND] Creating Resend client with fromEmail:', credentials.fromEmail);\n    return {\n      client: new Resend(credentials.apiKey),\n      fromEmail: credentials.fromEmail\n    };\n  } catch (error) {\n    console.error('[RESEND] Error getting Resend client:', error);\n    throw error;\n  }\n}\n\n// Helper function to extract verification code from HTML\nfunction extractVerificationCode(html: string): string | null {\n  // Try to extract 6-digit code from HTML\n  const codeMatch = html.match(/\\b(\\d{6})\\b/);\n  return codeMatch?.[1] ?? null;\n}\n\n// Helper function for sending emails\nexport async function sendEmail({\n  to,\n  subject,\n  html,\n  attachments,\n}: {\n  to: string;\n  subject: string;\n  html: string;\n  attachments?: Array<{\n    filename: string;\n    content: string;\n    encoding?: string;\n    contentType?: string;\n  }>;\n}) {\n  const isDevelopment = process.env.NODE_ENV === 'development';\n  \n  console.log('[RESEND] Sending email to:', to);\n  console.log('[RESEND] Subject:', subject);\n\n  const { client, fromEmail } = await getResendClient();\n\n  console.log('[RESEND] From email:', fromEmail);\n\n  try {\n    const { data, error } = await client.emails.send({\n      from: fromEmail,\n      to,\n      subject,\n      html,\n      ...(attachments && { attachments }),\n    });\n\n    if (error) {\n      // Check if this is a test mode restriction error\n      const isTestModeError = error.message?.includes('only send testing emails') || \n                              error.message?.includes('verify a domain');\n      \n      if (isDevelopment && isTestModeError) {\n        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n        console.log('üîß [RESEND] TEST MODE DETECTED - Using Development Fallback');\n        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n        console.log('üìß Recipient:', to);\n        console.log('üì® Subject:', subject);\n        \n        // Try to extract verification code\n        const code = extractVerificationCode(html);\n        if (code) {\n          console.log('üîë VERIFICATION CODE:', code);\n          \n          // Store for debug endpoint\n          lastVerificationCode = {\n            email: to,\n            code: code,\n            subject: subject,\n            timestamp: Date.now()\n          };\n          \n          console.log('üí° Use GET /api/debug/verification-code to retrieve this code');\n        } else {\n          console.log('üìÑ Email content (first 200 chars):', html.substring(0, 200));\n        }\n        \n        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n        console.log('‚ÑπÔ∏è  To enable real emails, verify your domain at resend.com/domains');\n        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n        \n        // Return mock success in development\n        return {\n          success: true,\n          messageId: 'dev-mode-' + Date.now(),\n          data: { id: 'dev-mode-' + Date.now() }\n        };\n      }\n      \n      // Re-throw if not a test mode error or not in development\n      console.error('[RESEND] Failed to send email:', error);\n      throw new Error(error.message);\n    }\n\n    console.log('[RESEND] Email sent successfully. ID:', data?.id);\n    \n    return { \n      success: true, \n      messageId: data?.id,\n      data \n    };\n  } catch (error: any) {\n    // Catch network or unexpected errors\n    console.error('[RESEND] Unexpected error sending email:', error);\n    throw error;\n  }\n}\n","size_bytes":7438},"client/src/pages/video-spots.tsx":{"content":"import { Video, Plus, Trash2, Edit } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { useEditMode } from \"@/contexts/EditModeContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { SEO } from \"@/components/SEO\";\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport type { VideoSpot } from \"@shared/schema\";\n\nfunction extractYouTubeVideoId(url: string): string | null {\n  const patterns = [\n    /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&\\s]+)/,\n    /youtube\\.com\\/embed\\/([^&\\s]+)/,\n  ];\n  \n  for (const pattern of patterns) {\n    const match = url.match(pattern);\n    if (match && match[1]) return match[1];\n  }\n  \n  return null;\n}\n\ninterface VideoSpotFormData {\n  title: string;\n  description: string;\n  artist: string;\n  youtubeUrl: string;\n}\n\nexport default function VideoSpots() {\n  const { isEditMode } = useEditMode();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingSpot, setEditingSpot] = useState<VideoSpot | null>(null);\n  const [formData, setFormData] = useState<VideoSpotFormData>({\n    title: \"\",\n    description: \"\",\n    artist: \"\",\n    youtubeUrl: \"\",\n  });\n\n  const { data: spots = [] } = useQuery<VideoSpot[]>({\n    queryKey: [\"/api/video-spots\"],\n    queryFn: () => fetch(\"/api/video-spots\").then(r => r.json()),\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: VideoSpotFormData) => {\n      const response = await fetch(\"/api/video-spots\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Gre≈°ka pri dodavanju spota\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/video-spots\"] });\n      toast({\n        title: \"Uspe≈°no dodato\",\n        description: \"Novi projekat je dodat\",\n      });\n      setIsDialogOpen(false);\n      setFormData({ title: \"\", description: \"\", artist: \"\", youtubeUrl: \"\" });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: VideoSpotFormData }) => {\n      const response = await fetch(`/api/video-spots/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Gre≈°ka pri a≈æuriranju spota\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/video-spots\"] });\n      toast({\n        title: \"Uspe≈°no a≈æurirano\",\n        description: \"Projekat je a≈æuriran\",\n      });\n      setIsDialogOpen(false);\n      setEditingSpot(null);\n      setFormData({ title: \"\", description: \"\", artist: \"\", youtubeUrl: \"\" });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/video-spots/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Gre≈°ka pri brisanju spota\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/video-spots\"] });\n      toast({\n        title: \"Uspe≈°no obrisano\",\n        description: \"Projekat je obrisan\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri brisanju spota\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleOpenDialog = (spot?: VideoSpot) => {\n    if (spot) {\n      setEditingSpot(spot);\n      setFormData({\n        title: spot.title,\n        description: spot.description,\n        artist: spot.artist,\n        youtubeUrl: spot.youtubeUrl,\n      });\n    } else {\n      setEditingSpot(null);\n      setFormData({ title: \"\", description: \"\", artist: \"\", youtubeUrl: \"\" });\n    }\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = () => {\n    if (editingSpot) {\n      updateMutation.mutate({ id: editingSpot.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-muted/20\">\n      <SEO\n        title=\"Projekti - Studio LeFlow\"\n        description=\"Projekti u kojima je na≈° tim uƒçestvovao - video spotovi, pesme i muziƒçka produkcija. Profesionalni muziƒçki studio u Beogradu.\"\n        keywords={[\"studio leflow\", \"leflow studio\", \"leflow\", \"muziƒçka produkcija\", \"beograd\", \"video spotovi\", \"produkcija pesama\", \"snimanje muzike\", \"muziƒçki projekti\", \"leflow studio projekti\"]}\n      />\n\n      <section className=\"py-20\">\n        <div className=\"container px-4 mx-auto\">\n          <FadeInWhenVisible>\n            <div className=\"flex flex-col items-center text-center mb-12\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4\">\n                <Video className=\"w-8 h-8 text-primary\" />\n              </div>\n              <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">\n                Na≈°i <span className=\"text-primary\">Projekti</span>\n              </h1>\n              <p className=\"text-lg text-muted-foreground max-w-2xl\">\n                Projekti u kojima je na≈° tim uƒçestvovao - pogledajte ≈°ta smo kreirali\n              </p>\n            </div>\n          </FadeInWhenVisible>\n\n          {isEditMode && (\n            <div className=\"flex justify-center mb-8\">\n              <Button\n                onClick={() => handleOpenDialog()}\n                className=\"gap-2\"\n                size=\"lg\"\n              >\n                <Plus className=\"w-5 h-5\" />\n                Dodaj Novi Projekat\n              </Button>\n            </div>\n          )}\n\n          {spots.length === 0 ? (\n            <FadeInWhenVisible>\n              <div className=\"text-center py-12\">\n                <p className=\"text-muted-foreground\">\n                  {isEditMode\n                    ? \"Kliknite na dugme iznad da dodate prvi projekat\"\n                    : \"Trenutno nema dostupnih projekata\"}\n                </p>\n              </div>\n            </FadeInWhenVisible>\n          ) : (\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-2 gap-8\">\n              {spots.map((spot, index) => {\n                const videoId = extractYouTubeVideoId(spot.youtubeUrl);\n                \n                return (\n                  <FadeInWhenVisible key={spot.id} delay={index * 0.1}>\n                    <Card className=\"overflow-visible hover-elevate active-elevate-2\">\n                      <CardHeader>\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <CardTitle className=\"text-2xl mb-2\">{spot.title}</CardTitle>\n                            <CardDescription className=\"text-base\">\n                              <span className=\"font-semibold text-primary\">{spot.artist}</span>\n                            </CardDescription>\n                          </div>\n                          {isEditMode && (\n                            <div className=\"flex gap-2\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"icon\"\n                                onClick={() => handleOpenDialog(spot)}\n                              >\n                                <Edit className=\"w-4 h-4\" />\n                              </Button>\n                              <Button\n                                variant=\"destructive\"\n                                size=\"icon\"\n                                onClick={() => deleteMutation.mutate(spot.id)}\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </Button>\n                            </div>\n                          )}\n                        </div>\n                      </CardHeader>\n                      <CardContent className=\"space-y-4\">\n                        {videoId ? (\n                          <div className=\"overflow-hidden rounded-lg\">\n                            <div className=\"relative w-full\" style={{ paddingBottom: \"56.25%\" }}>\n                              <iframe\n                                className=\"absolute top-0 left-0 w-full h-full\"\n                                src={`https://www.youtube-nocookie.com/embed/${videoId}`}\n                                title={spot.title}\n                                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\n                                allowFullScreen\n                                loading=\"lazy\"\n                              />\n                            </div>\n                          </div>\n                        ) : (\n                          <div className=\"bg-muted rounded-lg p-8 text-center\">\n                            <p className=\"text-muted-foreground\">Neva≈æeƒái YouTube URL</p>\n                          </div>\n                        )}\n                        \n                        {spot.description && (\n                          <p className=\"text-muted-foreground\">{spot.description}</p>\n                        )}\n                      </CardContent>\n                    </Card>\n                  </FadeInWhenVisible>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </section>\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[525px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingSpot ? \"Izmeni Projekat\" : \"Dodaj Novi Projekat\"}\n            </DialogTitle>\n            <DialogDescription>\n              Popunite informacije o projektu. Unesite YouTube URL videa.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"title\">Naslov</Label>\n              <Input\n                id=\"title\"\n                value={formData.title}\n                onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                placeholder=\"Unesite naslov projekta\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"artist\">Izvoƒëaƒç</Label>\n              <Input\n                id=\"artist\"\n                value={formData.artist}\n                onChange={(e) => setFormData({ ...formData, artist: e.target.value })}\n                placeholder=\"Unesite ime izvoƒëaƒça\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"youtubeUrl\">YouTube URL</Label>\n              <Input\n                id=\"youtubeUrl\"\n                value={formData.youtubeUrl}\n                onChange={(e) => setFormData({ ...formData, youtubeUrl: e.target.value })}\n                placeholder=\"https://www.youtube.com/watch?v=...\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                ‚ö†Ô∏è Napomena: Age-restricted YouTube videi (18+) ne mogu da se prikazuju preko iframe-a. Koristite samo javne videe bez starosnih ograniƒçenja.\n              </p>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"description\">Opis</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                placeholder=\"Unesite opis projekta (opciono)\"\n                rows={3}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n              Otka≈æi\n            </Button>\n            <Button onClick={handleSubmit}>\n              {editingSpot ? \"Saƒçuvaj Izmene\" : \"Dodaj Projekat\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":13250},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"server/auth.ts":{"content":"// Blueprint reference: blueprint:javascript_auth_all_persistance\nimport passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport { Express } from \"express\";\nimport session from \"express-session\";\nimport { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { z } from \"zod\";\nimport { storage } from \"./storage\";\nimport { User as SelectUser } from \"@shared/schema\";\nimport { sendEmail } from \"./resend-client\";\n\ndeclare global {\n  namespace Express {\n    interface User extends SelectUser {}\n  }\n}\n\nconst scryptAsync = promisify(scrypt);\n\nexport async function hashPassword(password: string) {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nexport async function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split(\".\");\n  if (!hashed || !salt) {\n    throw new Error(\"Invalid password format\");\n  }\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\nfunction generateVerificationCode(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\nexport function setupAuth(app: Express) {\n  const sessionSettings: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET!,\n    resave: false,\n    saveUninitialized: false,\n    store: storage.sessionStore,\n  };\n\n  app.set(\"trust proxy\", 1);\n  app.use(session(sessionSettings));\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(async (username, password, done) => {\n      try {\n        console.log('[AUTH] Login attempt for username/email:', username);\n        \n        // Try to find user by username first, then by email\n        let user = await storage.getUserByUsername(username);\n        \n        if (!user) {\n          // Try by email if username not found\n          user = await storage.getUserByEmail(username);\n        }\n        \n        if (!user) {\n          console.log('[AUTH] User not found:', username);\n          return done(null, false, { message: \"Pogre≈°no korisniƒçko ime ili lozinka\" });\n        }\n        \n        const passwordMatch = await comparePasswords(password, user.password);\n        console.log('[AUTH] Password match:', passwordMatch);\n        \n        if (!passwordMatch) {\n          console.log('[AUTH] Password mismatch for user:', username);\n          return done(null, false, { message: \"Pogre≈°no korisniƒçko ime ili lozinka\" });\n        }\n        \n        // Check if user is banned\n        if (user.banned) {\n          console.log('[AUTH] User is banned:', username);\n          return done(null, false, { message: \"Va≈° nalog je banovan\" });\n        }\n        \n        console.log('[AUTH] Login successful for user:', user.username);\n        return done(null, user);\n      } catch (error) {\n        console.error('[AUTH] Login error:', error);\n        return done(error);\n      }\n    }),\n  );\n\n  passport.serializeUser((user, done) => done(null, user.id));\n  passport.deserializeUser(async (id: number, done) => {\n    const user = await storage.getUser(id);\n    done(null, user);\n  });\n\n  app.post(\"/api/register\", async (req, res, next) => {\n    try {\n      // Get IP address and user agent for rate limiting and fraud detection\n      const ipAddress = req.ip || req.socket.remoteAddress || \"unknown\";\n      const userAgent = req.headers[\"user-agent\"] || undefined;\n\n      // IP RATE LIMITING: Check if this IP has made too many registration attempts recently\n      const recentAttempts = await storage.getRecentRegistrationAttempts(ipAddress, 15); // Last 15 minutes\n      if (recentAttempts.length >= 3) {\n        console.log(`[AUTH] IP rate limit exceeded for ${ipAddress}: ${recentAttempts.length} attempts in last 15 minutes`);\n        return res.status(429).json({ \n          error: \"Previ≈°e poku≈°aja registracije. Molimo saƒçekajte 15 minuta i poku≈°ajte ponovo.\" \n        });\n      }\n\n      // Validate with Zod schema from shared/schema.ts\n      const { insertUserSchema } = await import(\"@shared/schema\");\n      const validatedData = insertUserSchema.parse(req.body);\n      \n      // Normalize email and username to lowercase for consistency\n      const normalizedEmail = validatedData.email.toLowerCase();\n      const normalizedUsername = validatedData.username.toLowerCase();\n\n      // Log registration attempt for rate limiting\n      await storage.createRegistrationAttempt({\n        ipAddress,\n        email: normalizedEmail,\n        userAgent,\n      });\n      \n      // Check if email or username already exists in USERS table (verified users)\n      const existingUser = await storage.getUserByUsername(normalizedUsername);\n      if (existingUser) {\n        return res.status(400).send(\"Korisniƒçko ime veƒá postoji\");\n      }\n\n      const existingEmail = await storage.getUserByEmail(normalizedEmail);\n      if (existingEmail) {\n        return res.status(400).send(\"Email adresa veƒá postoji\");\n      }\n\n      // Check if email or username already exists in PENDING_USERS table (awaiting verification)\n      const pendingUserByEmail = await storage.getPendingUserByEmail(normalizedEmail);\n      if (pendingUserByEmail) {\n        return res.status(400).json({ \n          error: \"Email adresa veƒá postoji. Molimo proverite va≈° inbox za verifikacioni kod ili saƒçekajte da prethodni zahtev istekne.\" \n        });\n      }\n\n      const pendingUserByUsername = await storage.getPendingUserByUsername(normalizedUsername);\n      if (pendingUserByUsername) {\n        return res.status(400).json({ \n          error: \"Korisniƒçko ime veƒá postoji. Molimo odaberite drugo korisniƒçko ime ili saƒçekajte da prethodni zahtev istekne.\" \n        });\n      }\n\n      // Generate verification code\n      const verificationCode = generateVerificationCode();\n\n      // Hash password BEFORE storing in pending_users\n      const hashedPassword = await hashPassword(validatedData.password);\n\n      // Create PENDING user (NOT in users table yet!)\n      // User will be moved to users table only after email verification\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // Expires in 24 hours\n      const pendingUser = await storage.createPendingUser({\n        email: normalizedEmail,\n        username: normalizedUsername,\n        password: hashedPassword, // Already hashed\n        verificationCode,\n        ipAddress,\n        userAgent,\n        termsAccepted: validatedData.termsAccepted,\n        expiresAt,\n      });\n\n      console.log(`[AUTH] Created pending user (id: ${pendingUser.id}) for ${normalizedEmail}`);\n      console.log(`[AUTH] Attempting to send verification email to: ${validatedData.email}`);\n      console.log(`[AUTH] Verification code generated: ${verificationCode}`);\n\n      try {\n        const result = await sendEmail({\n          to: validatedData.email,\n          subject: 'Potvrdite Va≈°u Email Adresu - Studio LeFlow',\n          html: `\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <h2 style=\"color: #7c3aed;\">Studio LeFlow</h2>\n              <h3>Dobrodo≈°li u Studio LeFlow zajednicu!</h3>\n              <p>Hvala ≈°to ste se registrovali. Da biste zavr≈°ili registraciju, unesite sledeƒái verifikacioni kod:</p>\n              <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; margin: 30px 0; border-radius: 8px;\">\n                <h1 style=\"color: #7c3aed; font-size: 36px; letter-spacing: 8px; margin: 0;\">${verificationCode}</h1>\n              </div>\n              <p>Ovaj kod istiƒçe za 24 sata.</p>\n              <p>Ako niste kreirali nalog, ignori≈°ite ovaj email.</p>\n              <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n              <p style=\"color: #666; font-size: 12px;\">Studio LeFlow - Profesionalna Muziƒçka Produkcija</p>\n            </div>\n          `\n        });\n        console.log(`[AUTH] Verification email sent successfully to ${validatedData.email}. Message ID: ${result.messageId}`);\n      } catch (emailError: any) {\n        console.error(\"[AUTH] Failed to send verification email:\", emailError);\n        console.error(\"[AUTH] Email error details:\", emailError.message);\n        \n        // Delete the pending user since we couldn't send the verification email\n        await storage.deletePendingUser(pendingUser.id);\n        \n        return res.status(500).json({ \n          error: \"Gre≈°ka pri slanju verifikacionog email-a. Molimo proverite da li je email adresa ispravna i poku≈°ajte ponovo.\" \n        });\n      }\n\n      // Return success response WITHOUT sensitive data\n      // User is NOT logged in yet - they must verify email first\n      res.status(201).json({ \n        message: \"Registracija uspe≈°na! Proverite va≈° email za verifikacioni kod.\",\n        email: normalizedEmail,\n        username: normalizedUsername,\n      });\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      }\n      console.error(\"[AUTH] Registration error:\", error);\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Login with Remember Me support\n  const loginSchema = z.object({\n    username: z.string(),\n    password: z.string(),\n    rememberMe: z.boolean().optional().default(false),\n  });\n\n  app.post(\"/api/login\", async (req, res, next) => {\n    try {\n      // Validate request body\n      const validatedData = loginSchema.parse(req.body);\n      const { username, password, rememberMe } = validatedData;\n\n      // Use custom passport callback to access user after authentication\n      passport.authenticate(\"local\", (err: Error | null, user: SelectUser | false, info: any) => {\n        if (err) {\n          console.error(\"[AUTH] Login error:\", err);\n          return next(err);\n        }\n\n        if (!user) {\n          console.log(\"[AUTH] Authentication failed:\", info?.message);\n          return res.status(401).json({ \n            error: info?.message || \"Pogre≈°no korisniƒçko ime ili lozinka\" \n          });\n        }\n\n        // Log user in\n        req.logIn(user, (loginErr) => {\n          if (loginErr) {\n            console.error(\"[AUTH] req.logIn error:\", loginErr);\n            return next(loginErr);\n          }\n\n          // Set session cookie maxAge based on rememberMe\n          if (rememberMe) {\n            // Remember for 30 days\n            req.session.cookie.maxAge = 30 * 24 * 60 * 60 * 1000;\n            console.log(\"[AUTH] Remember Me enabled - session expires in 30 days\");\n          } else {\n            // Session cookie (expires when browser closes)\n            req.session.cookie.maxAge = undefined;\n            delete req.session.cookie.expires;\n            console.log(\"[AUTH] Remember Me disabled - session cookie\");\n          }\n\n          // SECURITY: Don't expose password hash\n          const { password, ...userWithoutPassword } = user;\n          res.status(200).json(userWithoutPassword);\n        });\n      })(req, res, next);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Neva≈æeƒái format podataka\" });\n      }\n      console.error(\"[AUTH] Login validation error:\", error);\n      next(error);\n    }\n  });\n\n  app.post(\"/api/logout\", (req, res, next) => {\n    req.logout((err) => {\n      if (err) return next(err);\n      res.sendStatus(200);\n    });\n  });\n\n  app.get(\"/api/user\", (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n    \n    // SECURITY: Don't expose password hash\n    const { password, ...userWithoutPassword } = req.user!;\n    res.json(userWithoutPassword);\n  });\n\n  app.post(\"/api/forgot-password\", async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ error: \"Email je obavezan\" });\n      }\n\n      const user = await storage.getUserByEmail(email);\n      \n      // Always return success to prevent user enumeration\n      if (!user) {\n        console.log(`[AUTH] Password reset requested for non-existent email: ${email}`);\n        return res.json({ success: true, message: \"Ako email postoji, kod za reset lozinke je poslat\" });\n      }\n\n      // Generate 6-digit reset code\n      const resetToken = generateVerificationCode();\n      await storage.setPasswordResetToken(user.id, resetToken);\n\n      console.log(`[AUTH] Password reset requested for: ${email}`);\n      console.log(`[AUTH] Reset code generated: ${resetToken}`);\n\n      try {\n        await sendEmail({\n          to: email,\n          subject: 'Resetovanje Lozinke - Studio LeFlow',\n          html: `\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <h2 style=\"color: #7c3aed;\">Studio LeFlow</h2>\n              <h3>Zahtev za Resetovanje Lozinke</h3>\n              <p>Primili smo zahtev za resetovanje va≈°e lozinke. Unesite sledeƒái kod da biste kreirali novu lozinku:</p>\n              <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; margin: 30px 0; border-radius: 8px;\">\n                <h1 style=\"color: #7c3aed; font-size: 36px; letter-spacing: 8px; margin: 0;\">${resetToken}</h1>\n              </div>\n              <p>Ovaj kod istiƒçe za 15 minuta.</p>\n              <p>Ako niste zatra≈æili resetovanje lozinke, ignori≈°ite ovaj email. Va≈°a lozinka neƒáe biti promenjena.</p>\n              <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n              <p style=\"color: #666; font-size: 12px;\">Studio LeFlow - Profesionalna Muziƒçka Produkcija</p>\n            </div>\n          `\n        });\n        console.log(`[AUTH] Password reset email sent successfully to ${email}`);\n      } catch (emailError: any) {\n        console.error(\"[AUTH] Failed to send password reset email:\", emailError);\n        // Don't reveal if email exists - return generic error\n        return res.status(500).json({ \n          error: \"Gre≈°ka pri slanju email-a. Molimo poku≈°ajte ponovo.\" \n        });\n      }\n\n      // Don't reveal user ID or any identifying information\n      res.json({ success: true, message: \"Ako email postoji, kod za reset lozinke je poslat\" });\n    } catch (error: any) {\n      console.error(\"[AUTH] Forgot password error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  app.post(\"/api/reset-password\", async (req, res) => {\n    try {\n      const { email, token, newPassword } = req.body;\n\n      if (!email || !token || !newPassword) {\n        return res.status(400).json({ error: \"Svi parametri su obavezni\" });\n      }\n\n      // Validate new password\n      if (newPassword.length < 8) {\n        return res.status(400).json({ error: \"Lozinka mora imati najmanje 8 karaktera\" });\n      }\n\n      // Find user by email\n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ili istekao kod za reset lozinke\" });\n      }\n\n      // Verify reset token\n      const isValid = await storage.verifyPasswordResetToken(user.id, token);\n      if (!isValid) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ili istekao kod za reset lozinke\" });\n      }\n\n      // Hash new password and update\n      const hashedPassword = await hashPassword(newPassword);\n      await storage.updatePassword(user.id, hashedPassword);\n      await storage.clearPasswordResetToken(user.id);\n\n      console.log(`[AUTH] Password successfully reset for user: ${email}`);\n\n      res.json({ success: true, message: \"Lozinka je uspe≈°no promenjena\" });\n    } catch (error: any) {\n      console.error(\"[AUTH] Reset password error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n}\n","size_bytes":15940},"README.md":{"content":"# Studio LeFlow\n\nProfesionalni muziƒçki produkcijski studio u Beogradu, Srbija.\n\nWebsite za Studio LeFlow - home music studio koji nudi usluge snimanja, mix/master produkcije, izrade instrumentala i gotovih pesama.\n\n## üéµ Funkcionalnosti\n\n- **Prikaz usluga**: Snimanje, Mix/Master, Instrumentali, Gotove pesme\n- **Kontakt forma**: Zakazivanje termina sa automatskim email notifikacijama\n- **Premium dizajn**: Tamna tema inspirisana muziƒçkom industrijom\n- **Responsive**: Potpuno prilagoƒëen za mobilne ureƒëaje\n- **Srpski jezik**: Kompletan sadr≈æaj na srpskom (ƒáirilica i latinica)\n\n## üõ†Ô∏è Tehnologije\n\n### Frontend\n- **React 18** sa TypeScript\n- **Vite** - build tool\n- **Tailwind CSS** - styling\n- **shadcn/ui** - UI komponente\n- **Wouter** - routing\n- **TanStack Query** - server state management\n- **React Hook Form + Zod** - form validation\n\n### Backend\n- **Express.js** sa TypeScript\n- **Resend** - email notifikacije\n- **Drizzle ORM** - database schema (konfigurisano za PostgreSQL)\n- **In-memory storage** - trenutno skladi≈°tenje (mo≈æe lako da se prebaci na bazu)\n\n## üìã Preduslovi\n\n- **Node.js** 18.x ili noviji\n- **npm** ili **yarn**\n\n## üöÄ Lokalno pokretanje\n\n### 1. Kloniranje projekta\n\n```bash\ngit clone https://github.com/your-username/studio-leflow.git\ncd studio-leflow\n```\n\n### 2. Instalacija zavisnosti\n\n```bash\nnpm install\n```\n\n### 3. Konfiguracija environment varijabli\n\nKopiraj `.env.example` u `.env`:\n\n```bash\ncp .env.example .env\n```\n\nOtvori `.env` i podesi:\n\n```env\nRESEND_API_KEY=your_resend_api_key_here\nSESSION_SECRET=your_random_secret_here\n```\n\n**Kako dobiti Resend API kljuƒç:**\n1. Registruj se na [resend.com](https://resend.com)\n2. Idi na [API Keys](https://resend.com/api-keys)\n3. Kreiraj novi API kljuƒç\n4. Kopiraj i zalepi u `.env`\n\n### 4. Pokretanje development servera\n\n```bash\nnpm run dev\n```\n\nSajt ƒáe biti dostupan na: **http://localhost:5000**\n\n## üì¶ Build za produkciju\n\n```bash\nnpm run build\n```\n\nOvo kreira `dist/` folder sa kompajliranim kodom.\n\n## üåê Deployment\n\nZa deployment opcije i detaljne instrukcije, pogledaj **[DEPLOY.md](./DEPLOY.md)**.\n\n### Brze opcije za deploy:\n\n- **Render** ($7/mesec) - preporuƒçeno ‚≠ê\n- **Railway** (~$5-8/mesec)\n- **DigitalOcean App Platform** ($5/mesec)\n- **Vercel** (besplatno za hobby projekte)\n\n## üìÅ Struktura projekta\n\n```\nstudio-leflow/\n‚îú‚îÄ‚îÄ client/                 # Frontend React aplikacija\n‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/    # UI komponente\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/         # Stranice (Home, Contact, Terms)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/           # Utility funkcije\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx        # Main app\n‚îÇ   ‚îî‚îÄ‚îÄ index.html\n‚îú‚îÄ‚îÄ server/                # Backend Express server\n‚îÇ   ‚îú‚îÄ‚îÄ routes.ts          # API routes\n‚îÇ   ‚îú‚îÄ‚îÄ storage.ts         # Storage interface\n‚îÇ   ‚îî‚îÄ‚îÄ index.ts           # Server entry point\n‚îú‚îÄ‚îÄ shared/                # Zajedniƒçki kod\n‚îÇ   ‚îî‚îÄ‚îÄ schema.ts          # Zod schemas & types\n‚îú‚îÄ‚îÄ attached_assets/       # Slike i mediji\n‚îî‚îÄ‚îÄ package.json\n```\n\n## üìß Email notifikacije\n\nSvaki put kada neko popuni kontakt formu, automatski se ≈°alje email na `leflowbusiness@gmail.com` sa:\n- Izabranom uslugom\n- Imenom klijenta\n- Email adresom\n- Telefonom\n- ≈Ωeljenim terminom (opciono)\n- Porukom\n\nEmail sistem koristi **Resend** servis i zahteva `RESEND_API_KEY` environment varijablu.\n\n## üóÑÔ∏è Baza podataka\n\nTrenutno aplikacija koristi **in-memory storage** (Map).\n\nZa prebacivanje na PostgreSQL bazu:\n1. Kreiraj PostgreSQL bazu\n2. Dodaj `DATABASE_URL` u `.env`\n3. Pokreni migracije: `npm run db:push`\n4. Zameni `MemStorage` sa Drizzle ORM implementacijom u `server/storage.ts`\n\n## üîê Sigurnost\n\n- Svi korisniƒçki inputi su HTML-escaped pre slanja u emailu\n- Environment varijable nisu commited u Git\n- Session secret za production sigurnost\n- HTTPS automatski na deployment platformama\n\n## üìù Licenca\n\nPrivatni projekat - Sva prava zadr≈æana ¬© Studio LeFlow\n\n## üìû Kontakt\n\n- Email: leflowbusiness@gmail.com\n- Lokacija: Beograd, Srbija\n\n---\n\nNapravljeno sa ‚ù§Ô∏è za Studio LeFlow\n","size_bytes":4123},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\n    \"./client/index.html\",\n    \"./client/src/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n        \"fade-in\": {\n          from: { opacity: \"0\", transform: \"translateY(10px)\" },\n          to: { opacity: \"1\", transform: \"translateY(0)\" },\n        },\n        \"fade-up\": {\n          from: { opacity: \"0\", transform: \"translateY(20px)\" },\n          to: { opacity: \"1\", transform: \"translateY(0)\" },\n        },\n        \"scale-in\": {\n          from: { opacity: \"0\", transform: \"scale(0.95)\" },\n          to: { opacity: \"1\", transform: \"scale(1)\" },\n        },\n        \"slide-in-right\": {\n          from: { transform: \"translateX(100%)\" },\n          to: { transform: \"translateX(0)\" },\n        },\n        \"pulse-slow\": {\n          \"0%, 100%\": { opacity: \"1\" },\n          \"50%\": { opacity: \"0.8\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"fade-in\": \"fade-in 0.5s ease-out\",\n        \"fade-up\": \"fade-up 0.6s ease-out\",\n        \"scale-in\": \"scale-in 0.3s ease-out\",\n        \"slide-in-right\": \"slide-in-right 0.3s ease-out\",\n        \"pulse-slow\": \"pulse-slow 3s ease-in-out infinite\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":3659},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/contexts/EditModeContext.tsx":{"content":"import { createContext, useContext, useState, ReactNode } from \"react\";\n\ninterface EditModeContextType {\n  isEditMode: boolean;\n  setEditMode: (enabled: boolean) => void;\n  toggleEditMode: () => void;\n}\n\nconst EditModeContext = createContext<EditModeContextType | undefined>(undefined);\n\nexport function EditModeProvider({ children }: { children: ReactNode }) {\n  const [isEditMode, setIsEditMode] = useState(false);\n\n  const setEditMode = (enabled: boolean) => {\n    setIsEditMode(enabled);\n  };\n\n  const toggleEditMode = () => {\n    setIsEditMode((prev) => !prev);\n  };\n\n  return (\n    <EditModeContext.Provider value={{ isEditMode, setEditMode, toggleEditMode }}>\n      {children}\n    </EditModeContext.Provider>\n  );\n}\n\nexport function useEditMode() {\n  const context = useContext(EditModeContext);\n  if (context === undefined) {\n    throw new Error(\"useEditMode must be used within EditModeProvider\");\n  }\n  return context;\n}\n","size_bytes":931},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/pages/admin.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { Users, Music, Heart, MessageCircle, Trash2, Shield, ShieldOff, Settings, Construction, Send, Mail, Eye, Search, Download, UserPlus, FileText, Crown, Trophy } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { User, CmsContent, InsertCmsContent } from \"@shared/schema\";\nimport { lazy, Suspense } from \"react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\n// Lazy load TipTap editor - only needed in Newsletter tab\nconst RichTextEditor = lazy(() => \n  import(\"@/components/RichTextEditor\").then(module => ({ default: module.RichTextEditor }))\n);\nimport { Separator } from \"@/components/ui/separator\";\nimport { AvatarWithInitials } from \"@/components/ui/avatar-with-initials\";\nimport { ContractsTab } from \"@/components/admin/ContractsTab\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface AdminStats {\n  totalUsers: number;\n  totalProjects: number;\n  totalVotes: number;\n  totalComments: number;\n}\n\ninterface AnalyticsSummary {\n  newUsers: {\n    today: number;\n    week: number;\n    month: number;\n  };\n  approvedSongs: {\n    today: number;\n    week: number;\n    month: number;\n  };\n  topProjects: Array<{\n    id: number;\n    title: string;\n    username: string;\n    votesCount: number;\n  }>;\n  contracts: {\n    total: number;\n    byType: Record<string, number>;\n  };\n  unreadConversations: number;\n  activeUsers: number;\n}\n\ninterface ProjectWithUser {\n  id: number;\n  title: string;\n  description: string;\n  genre: string;\n  mp3Url: string;\n  userId: number;\n  uploadDate: string;\n  votesCount: number;\n  currentMonth: string;\n  approved: boolean;\n  username: string;\n}\n\ninterface CommentWithDetails {\n  id: number;\n  projectId: number;\n  projectTitle: string;\n  userId: number;\n  username: string;\n  text: string;\n  createdAt: string;\n}\n\ninterface ConversationWithUsers {\n  id: number;\n  user1Id: number;\n  user2Id: number;\n  user1Username: string;\n  user2Username: string;\n  user1AvatarUrl: string | null;\n  user2AvatarUrl: string | null;\n  messageCount: number;\n  lastMessageAt: string;\n  lastMessageContent: string | null;\n  lastMessageSenderUsername: string | null;\n  lastMessageDeleted: boolean;\n}\n\ninterface MessageWithSender {\n  id: number;\n  conversationId: number;\n  senderId: number;\n  senderUsername: string;\n  receiverId: number;\n  receiverUsername: string;\n  content: string;\n  imageUrl: string | null;\n  deleted: boolean;\n  createdAt: string;\n}\n\ninterface AuditLogEntry {\n  id: number;\n  adminId: number;\n  adminUsername: string;\n  viewedUser1Id: number;\n  viewedUser2Id: number;\n  user1Username: string;\n  user2Username: string;\n  viewedAt: string;\n}\n\ninterface MessagingStats {\n  totalMessages: number;\n  totalConversations: number;\n  deletedMessages: number;\n  activeConversations: number;\n}\n\nexport default function AdminPage() {\n  const { user, isLoading } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  // Redirect non-admin users\n  useEffect(() => {\n    if (user && user.role !== 'admin') {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Nemate admin privilegije\",\n        variant: \"destructive\",\n      });\n      setLocation(\"/\");\n    }\n  }, [user, setLocation, toast]);\n\n  // Show loading state while checking authentication\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background py-8 md:py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n          <Skeleton className=\"h-12 w-64 mb-2\" />\n          <Skeleton className=\"h-6 w-full max-w-96 mb-8\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  // If not admin, don't render anything (will redirect)\n  if (!user || user.role !== 'admin') {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-8 md:py-12\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n        <div className=\"mb-6 md:mb-8\">\n          <h1 className=\"text-2xl md:text-4xl font-bold mb-2\" data-testid=\"heading-admin-panel\">Admin Panel</h1>\n          <p className=\"text-sm md:text-base text-muted-foreground\" data-testid=\"text-admin-description\">\n            Upravljanje korisnicima, projektima i komentarima\n          </p>\n        </div>\n\n        <Tabs defaultValue=\"dashboard\" className=\"w-full\" data-testid=\"tabs-admin\">\n          <div className=\"mb-6 md:mb-8 overflow-x-auto -mx-4 md:mx-0 px-4 md:px-0\">\n            <TabsList className=\"inline-flex lg:grid lg:grid-cols-11 min-w-max lg:w-full\" data-testid=\"tabs-list-admin\">\n              <TabsTrigger value=\"dashboard\" data-testid=\"tab-dashboard\" className=\"whitespace-nowrap\">Dashboard</TabsTrigger>\n              <TabsTrigger value=\"users\" data-testid=\"tab-users\" className=\"whitespace-nowrap\">Korisnici</TabsTrigger>\n              <TabsTrigger value=\"projects\" data-testid=\"tab-projects\" className=\"whitespace-nowrap\">Projekti</TabsTrigger>\n              <TabsTrigger value=\"comments\" data-testid=\"tab-comments\" className=\"whitespace-nowrap\">Komentari</TabsTrigger>\n              <TabsTrigger value=\"user-songs\" data-testid=\"tab-user-songs\" className=\"whitespace-nowrap\">Zajednica</TabsTrigger>\n              <TabsTrigger value=\"newsletter\" data-testid=\"tab-newsletter\" className=\"whitespace-nowrap\">Newsletter</TabsTrigger>\n              <TabsTrigger value=\"messages\" data-testid=\"tab-messages\" className=\"whitespace-nowrap\">Poruke</TabsTrigger>\n              <TabsTrigger value=\"contracts\" data-testid=\"tab-contracts\" className=\"whitespace-nowrap\">Ugovori</TabsTrigger>\n              <TabsTrigger value=\"invoices\" data-testid=\"tab-invoices\" className=\"whitespace-nowrap\">Fakture</TabsTrigger>\n              <TabsTrigger value=\"cms\" data-testid=\"tab-cms\" className=\"whitespace-nowrap\">CMS</TabsTrigger>\n              <TabsTrigger value=\"settings\" data-testid=\"tab-settings\" className=\"whitespace-nowrap\">Pode≈°avanja</TabsTrigger>\n            </TabsList>\n          </div>\n\n          <TabsContent value=\"dashboard\">\n            <DashboardTab />\n          </TabsContent>\n\n          <TabsContent value=\"users\">\n            <UsersTab />\n          </TabsContent>\n\n          <TabsContent value=\"projects\">\n            <ProjectsTab />\n          </TabsContent>\n\n          <TabsContent value=\"comments\">\n            <CommentsTab />\n          </TabsContent>\n\n          <TabsContent value=\"user-songs\">\n            <UserSongsTab />\n          </TabsContent>\n\n          <TabsContent value=\"newsletter\">\n            <NewsletterTab />\n          </TabsContent>\n\n          <TabsContent value=\"messages\">\n            <MessagesTab />\n          </TabsContent>\n\n          <TabsContent value=\"contracts\">\n            <ContractsTab />\n          </TabsContent>\n\n          <TabsContent value=\"invoices\">\n            <InvoicesTab />\n          </TabsContent>\n\n          <TabsContent value=\"cms\">\n            <CMSTab />\n          </TabsContent>\n\n          <TabsContent value=\"settings\">\n            <SettingsTab />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n\nfunction SettingsTab() {\n  const { toast } = useToast();\n\n  // Fetch maintenance mode status\n  const { data: maintenanceData, isLoading: maintenanceLoading } = useQuery<{ maintenanceMode: boolean }>({\n    queryKey: [\"/api/maintenance\"],\n  });\n\n  // Toggle maintenance mode mutation\n  const toggleMaintenanceMutation = useMutation({\n    mutationFn: async (isActive: boolean) => {\n      return await apiRequest(\"POST\", \"/api/maintenance\", { maintenanceMode: isActive });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/maintenance\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Status sajta je a≈æuriran\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri a≈æuriranju statusa sajta\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleToggleMaintenanceMode = (checked: boolean) => {\n    toggleMaintenanceMutation.mutate(checked);\n  };\n\n  return (\n    <div className=\"grid gap-6\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Construction className=\"w-5 h-5 text-primary\" />\n            <CardTitle>Aktivnost Sajta</CardTitle>\n          </div>\n          <CardDescription>\n            Kontroli≈°ite dostupnost sajta za korisnike\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"maintenance-mode\" className=\"text-base\">\n                Maintenance Mode\n              </Label>\n              <p className=\"text-sm text-muted-foreground\">\n                Kada je aktivno, samo administratori mogu pristupiti sajtu. Ostali korisnici ƒáe videti poruku da je sajt u pripremi.\n              </p>\n            </div>\n            <Switch\n              id=\"maintenance-mode\"\n              checked={maintenanceData?.maintenanceMode || false}\n              onCheckedChange={handleToggleMaintenanceMode}\n              disabled={maintenanceLoading || toggleMaintenanceMutation.isPending}\n            />\n          </div>\n\n          {maintenanceData?.maintenanceMode && (\n            <div className=\"rounded-lg border border-orange-200 bg-orange-50 dark:border-orange-900 dark:bg-orange-950 p-4\">\n              <div className=\"flex items-start gap-3\">\n                <Construction className=\"w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5\" />\n                <div>\n                  <h4 className=\"font-medium text-orange-900 dark:text-orange-100\">\n                    Sajt je trenutno u Maintenance Modu\n                  </h4>\n                  <p className=\"text-sm text-orange-800 dark:text-orange-200 mt-1\">\n                    Samo administratori mogu pristupiti sajtu. Ostali korisnici vide stranicu \"Sajt je u pripremi\".\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Settings className=\"w-5 h-5 text-primary\" />\n            <CardTitle>Giveaway Pode≈°avanja</CardTitle>\n          </div>\n          <CardDescription>\n            Kontroli≈°ite aktivnost meseƒçnog giveaway sistema\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <GiveawaySettingsSection />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction NewsletterTab() {\n  const { toast } = useToast();\n  const [copiedEmail, setCopiedEmail] = useState<string | null>(null);\n  const [subject, setSubject] = useState(\"\");\n  const [htmlContent, setHtmlContent] = useState(\"\");\n  const [isSending, setIsSending] = useState(false);\n\n  const { data: subscribers = [], isLoading: subscribersLoading } = useQuery({\n    queryKey: [\"/api/newsletter/subscribers\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/newsletter/subscribers\");\n      if (!response.ok) throw new Error(\"Failed to load subscribers\");\n      return await response.json();\n    },\n  });\n\n  const { data: stats, isLoading: statsLoading } = useQuery({\n    queryKey: [\"/api/newsletter/stats\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/newsletter/stats\");\n      if (!response.ok) throw new Error(\"Failed to load stats\");\n      return await response.json();\n    },\n  });\n\n  const deleteSubscriberMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/newsletter/subscribers/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete subscriber\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/newsletter/subscribers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/newsletter/stats\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Pretplatnik je uspe≈°no uklonjen\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri brisanju pretplatnika\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSendNewsletter = async () => {\n    if (!subject.trim() || !htmlContent.trim()) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Subject i sadr≈æaj su obavezni\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSending(true);\n    try {\n      const response = await fetch(\"/api/newsletter/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ subject, htmlContent }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to send newsletter\");\n      }\n\n      const result = await response.json();\n      toast({\n        title: \"Uspeh\",\n        description: result.message,\n      });\n      setSubject(\"\");\n      setHtmlContent(\"\");\n    } catch (error: any) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Do≈°lo je do gre≈°ke pri slanju newslettera\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  const handleCopyEmail = (email: string) => {\n    navigator.clipboard.writeText(email);\n    setCopiedEmail(email);\n    toast({\n      title: \"Kopirano!\",\n      description: `Email ${email} je kopiran u clipboard`,\n    });\n    setTimeout(() => setCopiedEmail(null), 2000);\n  };\n\n  const handleCopyAll = () => {\n    const confirmedEmails = subscribers\n      .filter((s: any) => s.status === 'confirmed')\n      .map((s: any) => s.email)\n      .join(', ');\n    navigator.clipboard.writeText(confirmedEmails);\n    toast({\n      title: \"Kopirano!\",\n      description: `${subscribers.filter((s: any) => s.status === 'confirmed').length} email adresa kopirano`,\n    });\n  };\n\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return \"N/A\";\n    return new Date(dateString).toLocaleDateString(\"sr-RS\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"confirmed\":\n        return <Badge className=\"bg-green-500\">Potvrƒëeno</Badge>;\n      case \"pending\":\n        return <Badge variant=\"outline\">Na ƒçekanju</Badge>;\n      case \"unsubscribed\":\n        return <Badge variant=\"destructive\">Odjavljeno</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium\">Ukupno Pretplatnika</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <div className=\"text-3xl font-bold\">{stats?.total || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium\">Potvrƒëeno</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <div className=\"text-3xl font-bold text-green-600\">{stats?.confirmed || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-sm font-medium\">Na ƒçekanju</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <div className=\"text-3xl font-bold text-orange-600\">{stats?.pending || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Mail className=\"w-5 h-5 text-primary\" />\n            <div>\n              <CardTitle>Po≈°alji Newsletter</CardTitle>\n              <CardDescription>Kreirajte i po≈°aljite email kampanju svim potvrƒëenim pretplatnicima</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"newsletter-subject\">Subject</Label>\n            <Input\n              id=\"newsletter-subject\"\n              placeholder=\"Naslov newsletter poruke...\"\n              value={subject}\n              onChange={(e) => setSubject(e.target.value)}\n              className=\"mt-2\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"newsletter-content\">Sadr≈æaj</Label>\n            <div className=\"mt-2\">\n              <Suspense fallback={\n                <div className=\"border rounded-md p-4 min-h-[200px] flex items-center justify-center\">\n                  <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n                </div>\n              }>\n                <RichTextEditor\n                  content={htmlContent}\n                  onChange={setHtmlContent}\n                  placeholder=\"Unesite sadr≈æaj newsletter poruke...\"\n                />\n              </Suspense>\n            </div>\n          </div>\n          <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pt-4\">\n            <p className=\"text-sm text-muted-foreground text-center sm:text-left\">\n              Newsletter ƒáe biti poslat na {stats?.confirmed || 0} potvrƒëenih email adresa\n            </p>\n            <Button \n              onClick={handleSendNewsletter} \n              disabled={isSending || !subject.trim() || !htmlContent.trim()}\n              className=\"gap-2 w-full sm:w-auto\"\n            >\n              <Send className=\"w-4 h-4\" />\n              {isSending ? \"Slanje...\" : \"Po≈°alji Newsletter\"}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n            <div>\n              <CardTitle>Pretplatnici</CardTitle>\n              <CardDescription>Lista svih email pretplatnika</CardDescription>\n            </div>\n            <Button onClick={handleCopyAll} variant=\"outline\" size=\"sm\" className=\"w-full sm:w-auto\">\n              <span className=\"hidden sm:inline\">Kopiraj sve potvrƒëene email adrese</span>\n              <span className=\"sm:hidden\">Kopiraj sve</span>\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {subscribersLoading ? (\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-12 w-full\" />\n              <Skeleton className=\"h-12 w-full\" />\n              <Skeleton className=\"h-12 w-full\" />\n            </div>\n          ) : subscribers.length === 0 ? (\n            <p className=\"text-center text-muted-foreground py-8\">\n              Nema pretplatnika\n            </p>\n          ) : (\n            <div className=\"rounded-md border overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Datum prijave</TableHead>\n                    <TableHead>Datum potvrde</TableHead>\n                    <TableHead>Akcije</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {subscribers.map((subscriber: any) => (\n                    <TableRow key={subscriber.id}>\n                      <TableCell className=\"font-medium\">{subscriber.email}</TableCell>\n                      <TableCell>{getStatusBadge(subscriber.status)}</TableCell>\n                      <TableCell>{formatDate(subscriber.subscribedAt)}</TableCell>\n                      <TableCell>{formatDate(subscriber.confirmedAt)}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleCopyEmail(subscriber.email)}\n                          >\n                            {copiedEmail === subscriber.email ? \"Kopirano!\" : \"Kopiraj\"}\n                          </Button>\n                          <AlertDialog>\n                            <AlertDialogTrigger asChild>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"text-destructive hover:text-destructive\"\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </AlertDialogTrigger>\n                            <AlertDialogContent>\n                              <AlertDialogHeader>\n                                <AlertDialogTitle>Ukloni pretplatnika</AlertDialogTitle>\n                                <AlertDialogDescription>\n                                  Da li ste sigurni da ≈æelite da uklonite <strong>{subscriber.email}</strong> sa newsletter liste?\n                                  Ova akcija se ne mo≈æe poni≈°titi.\n                                </AlertDialogDescription>\n                              </AlertDialogHeader>\n                              <AlertDialogFooter>\n                                <AlertDialogCancel>Otka≈æi</AlertDialogCancel>\n                                <AlertDialogAction\n                                  onClick={() => deleteSubscriberMutation.mutate(subscriber.id)}\n                                  className=\"bg-destructive hover:bg-destructive/90\"\n                                >\n                                  Ukloni\n                                </AlertDialogAction>\n                              </AlertDialogFooter>\n                            </AlertDialogContent>\n                          </AlertDialog>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction MessagesTab() {\n  const { toast } = useToast();\n  const [selectedConversation, setSelectedConversation] = useState<ConversationWithUsers | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: conversations = [], isLoading: conversationsLoading } = useQuery<ConversationWithUsers[]>({\n    queryKey: [\"/api/admin/messages/conversations\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/messages/conversations\");\n      if (!response.ok) throw new Error(\"Failed to load conversations\");\n      return await response.json();\n    },\n  });\n\n  const { data: messages = [], isLoading: messagesLoading, refetch: refetchMessages } = useQuery<MessageWithSender[]>({\n    queryKey: [\"/api/admin/messages/conversation\", selectedConversation?.user1Id, selectedConversation?.user2Id],\n    queryFn: async () => {\n      if (!selectedConversation) return [];\n      const response = await fetch(`/api/admin/messages/conversation/${selectedConversation.user1Id}/${selectedConversation.user2Id}`);\n      if (!response.ok) throw new Error(\"Failed to load messages\");\n      return await response.json();\n    },\n    enabled: !!selectedConversation,\n  });\n\n  const { data: auditLogs = [], isLoading: auditLoading } = useQuery<AuditLogEntry[]>({\n    queryKey: [\"/api/admin/messages/audit-logs\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/messages/audit-logs\");\n      if (!response.ok) throw new Error(\"Failed to load audit logs\");\n      return await response.json();\n    },\n  });\n\n  const { data: stats, isLoading: statsLoading } = useQuery<MessagingStats>({\n    queryKey: [\"/api/admin/messages/stats\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/messages/stats\");\n      if (!response.ok) throw new Error(\"Failed to load messaging stats\");\n      return await response.json();\n    },\n  });\n\n  const deleteMessageMutation = useMutation({\n    mutationFn: async (messageId: number) => {\n      const response = await fetch(`/api/admin/messages/${messageId}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete message\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/messages/conversation\"] });\n      refetchMessages();\n      toast({\n        title: \"Uspeh\",\n        description: \"Poruka je obrisana\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri brisanju poruke\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (dateString: string) => {\n    return format(new Date(dateString), \"dd.MM.yyyy HH:mm\");\n  };\n\n  const filteredConversations = conversations.filter((conv) => {\n    const query = searchQuery.toLowerCase();\n    return (\n      conv.user1Username.toLowerCase().includes(query) ||\n      conv.user2Username.toLowerCase().includes(query)\n    );\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Ukupno Poruka</CardTitle>\n            <MessageCircle className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-20\" />\n            ) : (\n              <div className=\"text-2xl font-bold\">{stats?.totalMessages || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Ukupno Konverzacija</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-20\" />\n            ) : (\n              <div className=\"text-2xl font-bold\">{stats?.totalConversations || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Aktivne (30 dana)</CardTitle>\n            <Heart className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-20\" />\n            ) : (\n              <div className=\"text-2xl font-bold\">{stats?.activeConversations || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Obrisane Poruke</CardTitle>\n            <Trash2 className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            {statsLoading ? (\n              <Skeleton className=\"h-8 w-20\" />\n            ) : (\n              <div className=\"text-2xl font-bold text-destructive\">{stats?.deletedMessages || 0}</div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <MessageCircle className=\"w-5 h-5 text-primary\" />\n              <CardTitle>Konverzacije</CardTitle>\n            </div>\n            <CardDescription>\n              Lista svih konverzacija izmeƒëu korisnika\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"mb-4\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n                <Input\n                  type=\"text\"\n                  placeholder=\"Pretra≈æi po korisniƒçkim imenima...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9\"\n                  data-testid=\"input-search-conversations\"\n                />\n              </div>\n            </div>\n            {conversationsLoading ? (\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-16 w-full\" />\n                <Skeleton className=\"h-16 w-full\" />\n                <Skeleton className=\"h-16 w-full\" />\n              </div>\n            ) : conversations.length === 0 ? (\n              <p className=\"text-center text-muted-foreground py-8\">\n                Nema konverzacija\n              </p>\n            ) : filteredConversations.length === 0 ? (\n              <p className=\"text-center text-muted-foreground py-8\">\n                Nema rezultata pretrage\n              </p>\n            ) : (\n              <ScrollArea className=\"h-[500px] pr-4\">\n                <div className=\"space-y-2\">\n                  {filteredConversations.map((conversation) => (\n                    <Card\n                      key={conversation.id}\n                      className={`cursor-pointer transition-colors hover:bg-accent ${\n                        selectedConversation?.id === conversation.id ? \"bg-accent border-primary\" : \"\"\n                      }`}\n                      onClick={() => setSelectedConversation(conversation)}\n                      data-testid={`card-conversation-${conversation.id}`}\n                    >\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"flex items-center -space-x-2\">\n                              <AvatarWithInitials\n                                userId={conversation.user1Id}\n                                name={conversation.user1Username}\n                                src={conversation.user1AvatarUrl}\n                                className=\"w-8 h-8\"\n                              />\n                              <AvatarWithInitials\n                                userId={conversation.user2Id}\n                                name={conversation.user2Username}\n                                src={conversation.user2AvatarUrl}\n                                className=\"w-8 h-8\"\n                              />\n                            </div>\n                            <span className=\"font-medium\">\n                              {conversation.user1Username} ‚Üî {conversation.user2Username}\n                            </span>\n                          </div>\n                          <Badge variant=\"secondary\">{conversation.messageCount}</Badge>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Poslednja poruka: {formatDate(conversation.lastMessageAt)}\n                        </p>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </ScrollArea>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between gap-4\">\n              <div className=\"flex items-center gap-2\">\n                <MessageCircle className=\"w-5 h-5 text-primary\" />\n                <CardTitle>\n                  {selectedConversation\n                    ? `${selectedConversation.user1Username} i ${selectedConversation.user2Username} - Konverzacija`\n                    : \"Pregled Poruka\"}\n                </CardTitle>\n              </div>\n              {selectedConversation && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    const url = `/api/admin/messages/export/${selectedConversation.user1Id}/${selectedConversation.user2Id}`;\n                    window.open(url, '_blank');\n                  }}\n                  data-testid=\"button-export-conversation\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Izvezi\n                </Button>\n              )}\n            </div>\n            {selectedConversation ? (\n              <CardDescription>\n                {selectedConversation.lastMessageContent ? (\n                  <div className=\"space-y-1\">\n                    <p className=\"text-sm\">\n                      <span className=\"font-medium text-foreground\">\n                        {selectedConversation.lastMessageSenderUsername}:\n                      </span>{' '}\n                      {selectedConversation.lastMessageDeleted ? (\n                        <span className=\"italic text-destructive\">Poruka obrisana</span>\n                      ) : (\n                        selectedConversation.lastMessageContent.length > 80\n                          ? selectedConversation.lastMessageContent.substring(0, 80) + '...'\n                          : selectedConversation.lastMessageContent\n                      )}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Kliknite na poruku da biste je obrisali\n                    </p>\n                  </div>\n                ) : (\n                  \"Izaberite poruku da biste je obrisali\"\n                )}\n              </CardDescription>\n            ) : (\n              <CardDescription>Izaberite konverzaciju da biste videli poruke</CardDescription>\n            )}\n          </CardHeader>\n          <CardContent>\n            {!selectedConversation ? (\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                <MessageCircle className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                <p className=\"text-muted-foreground\">\n                  Izaberite konverzaciju\n                </p>\n              </div>\n            ) : messagesLoading ? (\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-20 w-full\" />\n                <Skeleton className=\"h-20 w-full\" />\n                <Skeleton className=\"h-20 w-full\" />\n              </div>\n            ) : messages.length === 0 ? (\n              <p className=\"text-center text-muted-foreground py-8\">\n                Nema poruka u ovoj konverzaciji\n              </p>\n            ) : (\n              <ScrollArea className=\"h-[500px] pr-4\">\n                <div className=\"space-y-3\">\n                  {messages.map((message) => (\n                    <Card key={message.id} className={message.deleted ? \"border-destructive/50 bg-destructive/5\" : \"\"}>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-start justify-between mb-2\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center justify-between gap-2 mb-1\">\n                              <span className=\"font-medium text-sm text-foreground\">\n                                {message.senderUsername}\n                              </span>\n                              <span className=\"text-xs text-muted-foreground\">\n                                {formatDate(message.createdAt)}\n                              </span>\n                            </div>\n                            {message.deleted ? (\n                              <p className=\"text-sm text-destructive italic\">\n                                Poruka obrisana\n                              </p>\n                            ) : (\n                              <p className=\"text-sm\">{message.content}</p>\n                            )}\n                            {message.imageUrl && !message.deleted && (\n                              <img\n                                src={message.imageUrl}\n                                alt=\"Message attachment\"\n                                className=\"mt-2 max-w-xs rounded-lg\"\n                              />\n                            )}\n                          </div>\n                          {!message.deleted && (\n                            <AlertDialog>\n                              <AlertDialogTrigger asChild>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  className=\"text-destructive hover:text-destructive\"\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              </AlertDialogTrigger>\n                              <AlertDialogContent>\n                                <AlertDialogHeader>\n                                  <AlertDialogTitle>Obri≈°i poruku</AlertDialogTitle>\n                                  <AlertDialogDescription>\n                                    Da li ste sigurni da ≈æelite da obri≈°ete ovu poruku? Poruka ƒáe biti oznaƒçena kao obrisana i njen sadr≈æaj ƒáe biti sakriven.\n                                  </AlertDialogDescription>\n                                </AlertDialogHeader>\n                                <AlertDialogFooter>\n                                  <AlertDialogCancel>Otka≈æi</AlertDialogCancel>\n                                  <AlertDialogAction\n                                    onClick={() => deleteMessageMutation.mutate(message.id)}\n                                    className=\"bg-destructive hover:bg-destructive/90\"\n                                  >\n                                    Obri≈°i\n                                  </AlertDialogAction>\n                                </AlertDialogFooter>\n                              </AlertDialogContent>\n                            </AlertDialog>\n                          )}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </ScrollArea>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Separator className=\"my-6\" />\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Eye className=\"w-5 h-5 text-primary\" />\n            <CardTitle>Audit Log - Pregled Poruka</CardTitle>\n          </div>\n          <CardDescription>\n            Evidencija svih administratorskih pregleda privatnih konverzacija\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {auditLoading ? (\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-12 w-full\" />\n              <Skeleton className=\"h-12 w-full\" />\n              <Skeleton className=\"h-12 w-full\" />\n            </div>\n          ) : auditLogs.length === 0 ? (\n            <p className=\"text-center text-muted-foreground py-8\">\n              Nema audit log zapisa\n            </p>\n          ) : (\n            <div className=\"rounded-md border overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Admin</TableHead>\n                    <TableHead>Pregledane Konverzacije</TableHead>\n                    <TableHead>Vreme Pregleda</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {auditLogs.map((log) => (\n                    <TableRow key={log.id}>\n                      <TableCell className=\"font-medium\">{log.adminUsername}</TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Users className=\"w-4 h-4 text-muted-foreground\" />\n                          <span>{log.user1Username} ‚Üî {log.user2Username}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>{formatDate(log.viewedAt)}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction GiveawaySettingsSection() {\n  const { toast } = useToast();\n\n  // Fetch giveaway settings\n  const { data: giveawaySettings, isLoading: settingsLoading } = useQuery<{ isActive: boolean }>({\n    queryKey: [\"/api/giveaway/settings\"],\n  });\n\n  // Toggle giveaway mutation\n  const toggleGiveawayMutation = useMutation({\n    mutationFn: async (isActive: boolean) => {\n      await apiRequest(\"POST\", \"/api/admin/giveaway/toggle\", { isActive });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/settings\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Giveaway status je a≈æuriran\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri a≈æuriranju giveaway statusa\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleToggleGiveaway = (checked: boolean) => {\n    toggleGiveawayMutation.mutate(checked);\n  };\n\n  return (\n    <div className=\"flex items-center justify-between\">\n      <div className=\"space-y-0.5\">\n        <Label htmlFor=\"giveaway-active\" className=\"text-base\">\n          Aktiviraj Giveaway\n        </Label>\n        <p className=\"text-sm text-muted-foreground\">\n          Omoguƒáite korisnicima da uploaduju projekte i uƒçestvuju u glasanju\n        </p>\n      </div>\n      <Switch\n        id=\"giveaway-active\"\n        checked={giveawaySettings?.isActive || false}\n        onCheckedChange={handleToggleGiveaway}\n        disabled={settingsLoading || toggleGiveawayMutation.isPending}\n      />\n    </div>\n  );\n}\n\nfunction DashboardTab() {\n  const { toast } = useToast();\n\n  // Fetch analytics summary\n  const { data: analytics, isLoading: analyticsLoading } = useQuery<AnalyticsSummary>({\n    queryKey: [\"/api/admin/analytics/summary\"],\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  // Fetch old stats for backward compatibility\n  const { data: stats } = useQuery<AdminStats>({\n    queryKey: [\"/api/admin/stats\"],\n  });\n\n  // Fetch giveaway settings\n  const { data: giveawaySettings, isLoading: settingsLoading } = useQuery<{ isActive: boolean }>({\n    queryKey: [\"/api/giveaway/settings\"],\n  });\n\n  // Toggle giveaway mutation\n  const toggleGiveawayMutation = useMutation({\n    mutationFn: async (isActive: boolean) => {\n      await apiRequest(\"POST\", \"/api/admin/giveaway/toggle\", { isActive });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/settings\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Giveaway status je a≈æuriran\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri a≈æuriranju giveaway statusa\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (analyticsLoading || settingsLoading) {\n    return (\n      <div className=\"space-y-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (\n            <Skeleton key={i} className=\"h-32\" data-testid={`skeleton-stat-${i}`} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\" data-testid=\"content-dashboard\">\n      <Card data-testid=\"card-giveaway-toggle\">\n        <CardHeader>\n          <CardTitle>Giveaway Kontrola</CardTitle>\n          <CardDescription>Ukljuƒçite ili iskljuƒçite giveaway</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center space-x-4\">\n            <Switch\n              id=\"giveaway-toggle\"\n              checked={giveawaySettings?.isActive || false}\n              onCheckedChange={(checked) => toggleGiveawayMutation.mutate(checked)}\n              disabled={toggleGiveawayMutation.isPending}\n              data-testid=\"switch-giveaway\"\n            />\n            <Label htmlFor=\"giveaway-toggle\" data-testid=\"label-giveaway\">\n              Giveaway aktivan\n            </Label>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4\">Aktivnost</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card data-testid=\"card-stat-active-users\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Aktivni Korisnici</CardTitle>\n              <Users className=\"h-4 w-4 text-green-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-active-users\">\n                {analytics?.activeUsers || 0}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">Trenutno online</p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-stat-new-users\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Nove Registracije</CardTitle>\n              <UserPlus className=\"h-4 w-4 text-blue-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-new-users-today\">\n                {analytics?.newUsers.today || 0}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Danas ‚Ä¢ {analytics?.newUsers.week || 0} ove nedelje ‚Ä¢ {analytics?.newUsers.month || 0} ovog meseca\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-stat-approved-songs\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Odobrene Pesme</CardTitle>\n              <Music className=\"h-4 w-4 text-purple-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-approved-songs-today\">\n                {analytics?.approvedSongs.today || 0}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Danas ‚Ä¢ {analytics?.approvedSongs.week || 0} ove nedelje ‚Ä¢ {analytics?.approvedSongs.month || 0} ovog meseca\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-stat-unread-messages\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Neproƒçitane Poruke</CardTitle>\n              <MessageCircle className=\"h-4 w-4 text-orange-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-unread-conversations\">\n                {analytics?.unreadConversations || 0}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">Konverzacija sa neproƒçitanim porukama</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4\">Ukupno</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card data-testid=\"card-stat-total-users\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Ukupno Korisnika</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-users\">\n                {stats?.totalUsers || 0}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-stat-total-projects\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Ukupno Projekata</CardTitle>\n              <Music className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-projects\">\n                {stats?.totalProjects || 0}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-stat-total-contracts\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Ukupno Ugovora</CardTitle>\n              <FileText className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-contracts\">\n                {analytics?.contracts.total || 0}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-stat-total-votes\">\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Ukupno Glasova</CardTitle>\n              <Heart className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-votes\">\n                {stats?.totalVotes || 0}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <Card data-testid=\"card-top-projects\">\n        <CardHeader>\n          <CardTitle>Top 5 Projekata</CardTitle>\n          <CardDescription>Projekti sa najvi≈°e glasova</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!analytics?.topProjects || analytics.topProjects.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\" data-testid=\"text-no-projects\">\n              Nema projekata za prikaz\n            </p>\n          ) : (\n            <div className=\"space-y-3\">\n              {analytics.topProjects.map((project, index) => (\n                <div\n                  key={project.id}\n                  className=\"flex items-center justify-between p-3 rounded-md bg-card hover-elevate\"\n                  data-testid={`project-${project.id}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary font-bold\">\n                      #{index + 1}\n                    </div>\n                    <div>\n                      <p className=\"font-medium\" data-testid={`project-title-${project.id}`}>\n                        {project.title}\n                      </p>\n                      <p className=\"text-sm text-muted-foreground\" data-testid={`project-username-${project.id}`}>\n                        {project.username}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-muted-foreground\">\n                    <Heart className=\"h-4 w-4\" />\n                    <span className=\"font-semibold\" data-testid={`project-votes-${project.id}`}>\n                      {project.votesCount}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction UsersTab() {\n  const { toast } = useToast();\n\n  const { data: users, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  const banMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      await apiRequest(\"POST\", `/api/admin/users/${userId}/ban`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Korisnik je banovan\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri banovanju korisnika\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const unbanMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      await apiRequest(\"POST\", `/api/admin/users/${userId}/unban`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Korisnik je odbanovan\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri odbanovanju korisnika\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      await apiRequest(\"DELETE\", `/api/admin/users/${userId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Korisnik je obrisan\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri brisanju korisnika\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const toggleAdminMutation = useMutation({\n    mutationFn: async (userId: number) => {\n      await apiRequest(\"POST\", `/api/admin/users/${userId}/toggle-admin`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Admin privilegije su a≈æurirane\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri a≈æuriranju admin privilegija\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateRankMutation = useMutation({\n    mutationFn: async ({ userId, rank }: { userId: number; rank: string }) => {\n      await apiRequest(\"PATCH\", `/api/users/${userId}/rank`, { rank });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Rank je uspe≈°no a≈æuriran\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri a≈æuriranju rank-a\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {[1, 2, 3, 4, 5].map((i) => (\n          <Skeleton key={i} className=\"h-16\" data-testid={`skeleton-user-${i}`} />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div data-testid=\"content-users\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Upravljanje Korisnicima</CardTitle>\n          <CardDescription>Pregled i upravljanje svim korisnicima</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table data-testid=\"table-users\">\n            <TableHeader>\n              <TableRow>\n                <TableHead data-testid=\"header-username\">Korisniƒçko Ime</TableHead>\n                <TableHead data-testid=\"header-email\">Email</TableHead>\n                <TableHead data-testid=\"header-role\">Uloga</TableHead>\n                <TableHead data-testid=\"header-rank\">Rank</TableHead>\n                <TableHead data-testid=\"header-status\">Status</TableHead>\n                <TableHead data-testid=\"header-created\">Kreiran</TableHead>\n                <TableHead data-testid=\"header-actions\">Akcije</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {users?.map((user) => (\n                <TableRow key={user.id} data-testid={`row-user-${user.id}`}>\n                  <TableCell data-testid={`cell-username-${user.id}`}>{user.username}</TableCell>\n                  <TableCell data-testid={`cell-email-${user.id}`}>{user.email}</TableCell>\n                  <TableCell data-testid={`cell-role-${user.id}`}>\n                    <Badge variant={user.role === 'admin' ? 'default' : 'secondary'} data-testid={`badge-role-${user.id}`}>\n                      {user.role}\n                    </Badge>\n                  </TableCell>\n                  <TableCell data-testid={`cell-rank-${user.id}`}>\n                    <Select\n                      value={user.rank}\n                      onValueChange={(rank) => updateRankMutation.mutate({ userId: user.id, rank })}\n                      disabled={updateRankMutation.isPending}\n                    >\n                      <SelectTrigger className=\"w-[140px]\" data-testid={`select-rank-${user.id}`}>\n                        <SelectValue>\n                          <div className=\"flex items-center gap-2\">\n                            {user.rank === 'legend' && <Trophy className=\"h-3 w-3 text-yellow-500\" />}\n                            {user.rank === 'vip' && <Crown className=\"h-3 w-3 text-blue-500\" />}\n                            {user.rank === 'admin' && <Shield className=\"h-3 w-3 text-destructive\" />}\n                            <span className={\n                              user.rank === 'vip' ? 'text-blue-500' :\n                              user.rank === 'legend' ? 'text-yellow-500' :\n                              user.rank === 'admin' ? 'text-destructive' :\n                              'text-muted-foreground'\n                            }>\n                              {user.rank === 'user' ? 'User' : \n                               user.rank === 'vip' ? 'VIP' : \n                               user.rank === 'legend' ? 'Legend' : \n                               'Admin'}\n                            </span>\n                          </div>\n                        </SelectValue>\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"user\">User</SelectItem>\n                        <SelectItem value=\"vip\">\n                          <div className=\"flex items-center gap-2\">\n                            <Crown className=\"h-3 w-3 text-blue-500\" />\n                            <span className=\"text-blue-500\">VIP</span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"legend\">\n                          <div className=\"flex items-center gap-2\">\n                            <Trophy className=\"h-3 w-3 text-yellow-500\" />\n                            <span className=\"text-yellow-500\">Legend</span>\n                          </div>\n                        </SelectItem>\n                        <SelectItem value=\"admin\">\n                          <div className=\"flex items-center gap-2\">\n                            <Shield className=\"h-3 w-3 text-destructive\" />\n                            <span className=\"text-destructive\">Admin</span>\n                          </div>\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </TableCell>\n                  <TableCell data-testid={`cell-status-${user.id}`}>\n                    {user.banned && (\n                      <Badge variant=\"destructive\" data-testid={`badge-banned-${user.id}`}>\n                        Banned\n                      </Badge>\n                    )}\n                  </TableCell>\n                  <TableCell data-testid={`cell-created-${user.id}`}>\n                    {format(new Date(user.createdAt), \"dd.MM.yyyy\")}\n                  </TableCell>\n                  <TableCell data-testid={`cell-actions-${user.id}`}>\n                    <div className=\"flex items-center gap-2\">\n                      {user.banned ? (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => unbanMutation.mutate(user.id)}\n                          disabled={unbanMutation.isPending}\n                          data-testid={`button-unban-${user.id}`}\n                        >\n                          <ShieldOff className=\"h-4 w-4 mr-1\" />\n                          Unban\n                        </Button>\n                      ) : (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => banMutation.mutate(user.id)}\n                          disabled={banMutation.isPending}\n                          data-testid={`button-ban-${user.id}`}\n                        >\n                          <ShieldOff className=\"h-4 w-4 mr-1\" />\n                          Ban\n                        </Button>\n                      )}\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => toggleAdminMutation.mutate(user.id)}\n                        disabled={toggleAdminMutation.isPending}\n                        data-testid={`button-toggle-admin-${user.id}`}\n                      >\n                        <Shield className=\"h-4 w-4 mr-1\" />\n                        {user.role === 'admin' ? 'Remove Admin' : 'Make Admin'}\n                      </Button>\n                      <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                          <Button\n                            size=\"sm\"\n                            variant=\"destructive\"\n                            data-testid={`button-delete-user-${user.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 mr-1\" />\n                            Obri≈°i\n                          </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent data-testid={`dialog-delete-user-${user.id}`}>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>Da li ste sigurni?</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              Ova akcija ne mo≈æe biti poni≈°tena. Korisnik \"{user.username}\" i svi njegovi podaci (projekti, glasovi, komentari) ƒáe biti trajno obrisani.\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel data-testid={`button-cancel-delete-user-${user.id}`}>\n                              Otka≈æi\n                            </AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={() => deleteUserMutation.mutate(user.id)}\n                              data-testid={`button-confirm-delete-user-${user.id}`}\n                            >\n                              Obri≈°i\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction ProjectsTab() {\n  const { toast } = useToast();\n\n  const { data: approvedProjects, isLoading: approvedLoading } = useQuery<ProjectWithUser[]>({\n    queryKey: [\"/api/giveaway/projects\"],\n  });\n\n  const { data: pendingProjects, isLoading: pendingLoading } = useQuery<ProjectWithUser[]>({\n    queryKey: [\"/api/admin/pending-projects\"],\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (projectId: number) => {\n      await apiRequest(\"POST\", `/api/admin/projects/${projectId}/approve`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/pending-projects\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Projekat je odobren i sada je vidljiv korisnicima\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri odobravanju projekta\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (projectId: number) => {\n      await apiRequest(\"DELETE\", `/api/admin/projects/${projectId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/giveaway/projects\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/pending-projects\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Projekat je obrisan\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri brisanju projekta\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (pendingLoading || approvedLoading) {\n    return (\n      <div className=\"space-y-8\">\n        <Skeleton className=\"h-12 w-64\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[1, 2, 3].map((i) => (\n            <Skeleton key={i} className=\"h-48\" data-testid={`skeleton-project-${i}`} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div data-testid=\"content-projects\" className=\"space-y-8\">\n      {/* Pending Projects Section */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4\">Projekti na ƒåekanju</h2>\n        <p className=\"text-muted-foreground mb-6\">\n          Projekti koje korisnici uploaduju moraju biti odobreni pre nego ≈°to budu vidljivi ostalim korisnicima.\n        </p>\n        {pendingProjects && pendingProjects.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {pendingProjects.map((project) => (\n              <Card key={project.id} data-testid={`card-pending-project-${project.id}`} className=\"border-yellow-500\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Badge variant=\"outline\" className=\"bg-yellow-500/10 text-yellow-600 border-yellow-500\">\n                      Na ƒçekanju\n                    </Badge>\n                  </div>\n                  <CardTitle className=\"text-lg\" data-testid={`title-pending-project-${project.id}`}>\n                    {project.title}\n                  </CardTitle>\n                  <CardDescription data-testid={`author-pending-project-${project.id}`}>\n                    by {project.username}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">≈Ωanr:</span>\n                      <Badge variant=\"secondary\" data-testid={`genre-pending-project-${project.id}`}>\n                        {project.genre}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Opis:</span>\n                      <span className=\"text-sm text-right line-clamp-2\">{project.description}</span>\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2 pt-2 border-t\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-2\">\n                      <Music className=\"h-4 w-4\" />\n                      <span>Preslu≈°aj pesmu:</span>\n                    </div>\n                    <audio\n                      controls\n                      className=\"w-full\"\n                      preload=\"metadata\"\n                      data-testid={`audio-player-${project.id}`}\n                    >\n                      <source src={project.mp3Url} type=\"audio/mpeg\" />\n                      Va≈° browser ne podr≈æava audio player.\n                    </audio>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Button\n                      variant=\"default\"\n                      size=\"sm\"\n                      className=\"w-full bg-green-600 hover:bg-green-700\"\n                      onClick={() => approveMutation.mutate(project.id)}\n                      disabled={approveMutation.isPending}\n                      data-testid={`button-approve-project-${project.id}`}\n                    >\n                      Odobri Projekat\n                    </Button>\n                    <AlertDialog>\n                      <AlertDialogTrigger asChild>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          className=\"w-full\"\n                          data-testid={`button-reject-project-${project.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4 mr-2\" />\n                          Odbij i Obri≈°i\n                        </Button>\n                      </AlertDialogTrigger>\n                      <AlertDialogContent data-testid={`dialog-reject-project-${project.id}`}>\n                        <AlertDialogHeader>\n                          <AlertDialogTitle>Da li ste sigurni?</AlertDialogTitle>\n                          <AlertDialogDescription>\n                            Projekat \"{project.title}\" ƒáe biti trajno odbijen i obrisan.\n                          </AlertDialogDescription>\n                        </AlertDialogHeader>\n                        <AlertDialogFooter>\n                          <AlertDialogCancel data-testid={`button-cancel-reject-project-${project.id}`}>\n                            Otka≈æi\n                          </AlertDialogCancel>\n                          <AlertDialogAction\n                            onClick={() => deleteMutation.mutate(project.id)}\n                            data-testid={`button-confirm-reject-project-${project.id}`}\n                          >\n                            Odbij i Obri≈°i\n                          </AlertDialogAction>\n                        </AlertDialogFooter>\n                      </AlertDialogContent>\n                    </AlertDialog>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card data-testid=\"card-no-pending-projects\">\n            <CardContent className=\"py-12 text-center\">\n              <p className=\"text-muted-foreground\" data-testid=\"text-no-pending-projects\">\n                Nema projekata na ƒçekanju\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {/* Approved Projects Section */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4\">Odobreni Projekti</h2>\n        <p className=\"text-muted-foreground mb-6\">\n          Projekti koji su odobreni i vidljivi svim korisnicima.\n        </p>\n        {approvedProjects && approvedProjects.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {approvedProjects.map((project) => (\n              <Card key={project.id} data-testid={`card-approved-project-${project.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-600 border-green-500\">\n                      Odobreno\n                    </Badge>\n                  </div>\n                  <CardTitle className=\"text-lg\" data-testid={`title-approved-project-${project.id}`}>\n                    {project.title}\n                  </CardTitle>\n                  <CardDescription data-testid={`author-approved-project-${project.id}`}>\n                    by {project.username}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">≈Ωanr:</span>\n                      <Badge variant=\"secondary\" data-testid={`genre-approved-project-${project.id}`}>\n                        {project.genre}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Glasovi:</span>\n                      <span className=\"font-medium\" data-testid={`votes-approved-project-${project.id}`}>\n                        {project.votesCount}\n                      </span>\n                    </div>\n                  </div>\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"w-full\"\n                        data-testid={`button-delete-approved-project-${project.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-2\" />\n                        Obri≈°i Projekat\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent data-testid={`dialog-delete-approved-project-${project.id}`}>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>Da li ste sigurni?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          Ova akcija ne mo≈æe biti poni≈°tena. Projekat \"{project.title}\" ƒáe biti trajno obrisan.\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel data-testid={`button-cancel-delete-approved-project-${project.id}`}>\n                          Otka≈æi\n                        </AlertDialogCancel>\n                        <AlertDialogAction\n                          onClick={() => deleteMutation.mutate(project.id)}\n                          data-testid={`button-confirm-delete-approved-project-${project.id}`}\n                        >\n                          Obri≈°i\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card data-testid=\"card-no-approved-projects\">\n            <CardContent className=\"py-12 text-center\">\n              <p className=\"text-muted-foreground\" data-testid=\"text-no-approved-projects\">\n                Nema odobrenih projekata\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n\ninterface UserSongWithDetails {\n  id: number;\n  userId: number;\n  username: string;\n  songTitle: string;\n  artistName: string;\n  youtubeUrl: string;\n  submittedAt: string;\n  approved: boolean;\n  votesCount: number;\n}\n\nfunction UserSongsTab() {\n  const { toast } = useToast();\n\n  const { data: songs, isLoading } = useQuery<UserSongWithDetails[]>({\n    queryKey: [\"/api/user-songs/all\"],\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (songId: number) => {\n      await apiRequest(\"POST\", `/api/user-songs/${songId}/approve`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-songs/all\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Pesma je odobrena\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri odobravanju pesme\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (songId: number) => {\n      await apiRequest(\"DELETE\", `/api/user-songs/${songId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-songs/all\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Pesma je obrisana\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri brisanju pesme\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {[1, 2, 3, 4, 5].map((i) => (\n          <Skeleton key={i} className=\"h-40\" data-testid={`skeleton-song-${i}`} />\n        ))}\n      </div>\n    );\n  }\n\n  const pendingSongs = songs?.filter(s => !s.approved) || [];\n  const approvedSongs = songs?.filter(s => s.approved) || [];\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"content-user-songs\">\n      {/* Pending Songs Section */}\n      {pendingSongs.length > 0 && (\n        <div>\n          <h3 className=\"text-lg font-semibold mb-4\" data-testid=\"heading-pending-songs\">\n            Pesme na ƒåekanju ({pendingSongs.length})\n          </h3>\n          <div className=\"space-y-4\">\n            {pendingSongs.map((song) => (\n              <Card key={song.id} data-testid={`card-song-${song.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-4\">\n                    <div className=\"flex-1 space-y-1\">\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <CardTitle className=\"text-base\" data-testid={`title-song-${song.id}`}>\n                          {song.songTitle}\n                        </CardTitle>\n                        <Badge variant=\"secondary\" data-testid={`status-song-${song.id}`}>\n                          Na ƒçekanju\n                        </Badge>\n                      </div>\n                      <CardDescription data-testid={`artist-song-${song.id}`}>\n                        {song.artistName}\n                      </CardDescription>\n                      <p className=\"text-xs text-muted-foreground\" data-testid={`user-song-${song.id}`}>\n                        Poslao: {song.username}\n                      </p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        variant=\"default\"\n                        size=\"sm\"\n                        onClick={() => approveMutation.mutate(song.id)}\n                        disabled={approveMutation.isPending}\n                        data-testid={`button-approve-song-${song.id}`}\n                      >\n                        Odobri\n                      </Button>\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        onClick={() => deleteMutation.mutate(song.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-song-${song.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    <a\n                      href={song.youtubeUrl}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-sm text-primary hover:underline inline-flex items-center gap-1\"\n                      data-testid={`link-youtube-${song.id}`}\n                    >\n                      <Music className=\"h-3 w-3\" />\n                      Otvori na YouTube\n                    </a>\n                    <p className=\"text-xs text-muted-foreground\" data-testid={`time-song-${song.id}`}>\n                      Poslato: {format(new Date(song.submittedAt), \"dd.MM.yyyy HH:mm\")}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Approved Songs Section */}\n      {approvedSongs.length > 0 && (\n        <div>\n          <h3 className=\"text-lg font-semibold mb-4\" data-testid=\"heading-approved-songs\">\n            Odobrene Pesme ({approvedSongs.length})\n          </h3>\n          <div className=\"space-y-4\">\n            {approvedSongs.map((song) => (\n              <Card key={song.id} data-testid={`card-approved-song-${song.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-4\">\n                    <div className=\"flex-1 space-y-1\">\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <CardTitle className=\"text-base\" data-testid={`title-approved-song-${song.id}`}>\n                          {song.songTitle}\n                        </CardTitle>\n                        <Badge variant=\"default\" data-testid={`status-approved-song-${song.id}`}>\n                          Odobreno\n                        </Badge>\n                        <Badge variant=\"secondary\" className=\"flex items-center gap-1\" data-testid={`votes-song-${song.id}`}>\n                          <Heart className=\"h-3 w-3\" />\n                          {song.votesCount} glasova\n                        </Badge>\n                      </div>\n                      <CardDescription data-testid={`artist-approved-song-${song.id}`}>\n                        {song.artistName}\n                      </CardDescription>\n                      <p className=\"text-xs text-muted-foreground\" data-testid={`user-approved-song-${song.id}`}>\n                        Poslao: {song.username}\n                      </p>\n                    </div>\n                    <Button\n                      variant=\"destructive\"\n                      size=\"sm\"\n                      onClick={() => deleteMutation.mutate(song.id)}\n                      disabled={deleteMutation.isPending}\n                      data-testid={`button-delete-approved-song-${song.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    <a\n                      href={song.youtubeUrl}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-sm text-primary hover:underline inline-flex items-center gap-1\"\n                      data-testid={`link-youtube-approved-${song.id}`}\n                    >\n                      <Music className=\"h-3 w-3\" />\n                      Otvori na YouTube\n                    </a>\n                    <p className=\"text-xs text-muted-foreground\" data-testid={`time-approved-song-${song.id}`}>\n                      Poslato: {format(new Date(song.submittedAt), \"dd.MM.yyyy HH:mm\")}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* No Songs */}\n      {songs?.length === 0 && (\n        <Card data-testid=\"card-no-songs\">\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\" data-testid=\"text-no-songs\">\n              Nema poslanih pesama\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\nfunction CommentsTab() {\n  const { toast } = useToast();\n\n  const { data: comments, isLoading } = useQuery<CommentWithDetails[]>({\n    queryKey: [\"/api/admin/comments\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (commentId: number) => {\n      await apiRequest(\"DELETE\", `/api/admin/comments/${commentId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/comments\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Komentar je obrisan\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri brisanju komentara\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        {[1, 2, 3, 4, 5].map((i) => (\n          <Skeleton key={i} className=\"h-32\" data-testid={`skeleton-comment-${i}`} />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\" data-testid=\"content-comments\">\n      {comments?.map((comment) => (\n        <Card key={comment.id} data-testid={`card-comment-${comment.id}`}>\n          <CardHeader>\n            <div className=\"flex items-start justify-between\">\n              <div className=\"space-y-1\">\n                <CardTitle className=\"text-base\" data-testid={`username-comment-${comment.id}`}>\n                  {comment.username}\n                </CardTitle>\n                <CardDescription data-testid={`project-comment-${comment.id}`}>\n                  na projektu: {comment.projectTitle}\n                </CardDescription>\n              </div>\n              <Button\n                variant=\"destructive\"\n                size=\"sm\"\n                onClick={() => deleteMutation.mutate(comment.id)}\n                disabled={deleteMutation.isPending}\n                data-testid={`button-delete-comment-${comment.id}`}\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm mb-2\" data-testid={`text-comment-${comment.id}`}>\n              {comment.text}\n            </p>\n            <p className=\"text-xs text-muted-foreground\" data-testid={`time-comment-${comment.id}`}>\n              {format(new Date(comment.createdAt), \"dd.MM.yyyy HH:mm\")}\n            </p>\n          </CardContent>\n        </Card>\n      ))}\n\n      {comments?.length === 0 && (\n        <Card data-testid=\"card-no-comments\">\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\" data-testid=\"text-no-comments\">\n              Nema komentara\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\nfunction CMSTab() {\n  return (\n    <Tabs defaultValue=\"home\" data-testid=\"tabs-cms\">\n      <TabsList data-testid=\"tabs-list-cms-pages\">\n        <TabsTrigger value=\"home\" data-testid=\"tab-cms-home\">Home Page</TabsTrigger>\n        <TabsTrigger value=\"team\" data-testid=\"tab-cms-team\">Team Page</TabsTrigger>\n      </TabsList>\n\n      <TabsContent value=\"home\">\n        <HomePageCMS />\n      </TabsContent>\n\n      <TabsContent value=\"team\">\n        <TeamPageCMS />\n      </TabsContent>\n    </Tabs>\n  );\n}\n\nfunction HomePageCMS() {\n  const { toast } = useToast();\n\n  const { data: content = [], isLoading } = useQuery<CmsContent[]>({\n    queryKey: [\"/api/cms/content\", \"home\"],\n    queryFn: () => fetch(\"/api/cms/content?page=home\").then(r => r.json()),\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (updates: InsertCmsContent[]) => {\n      return apiRequest(\"POST\", \"/api/cms/content\", updates);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/cms/content\", \"home\"] });\n      toast({ title: \"Uspe≈°no\", description: \"Sadr≈æaj a≈æuriran\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gre≈°ka\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const getContent = (section: string, key: string) => {\n    return content.find(c => c.section === section && c.contentKey === key)?.contentValue || \"\";\n  };\n\n  const [formData, setFormData] = useState({\n    hero_title: \"\",\n    hero_subtitle: \"\",\n    hero_description: \"\",\n    service_1_title: \"\",\n    service_1_description: \"\",\n    service_2_title: \"\",\n    service_2_description: \"\",\n    service_3_title: \"\",\n    service_3_description: \"\",\n    service_4_title: \"\",\n    service_4_description: \"\",\n    cta_title: \"\",\n    cta_description: \"\",\n  });\n\n  useEffect(() => {\n    if (content.length > 0) {\n      setFormData({\n        hero_title: getContent(\"hero\", \"title\"),\n        hero_subtitle: getContent(\"hero\", \"subtitle\"),\n        hero_description: getContent(\"hero\", \"description\"),\n        service_1_title: getContent(\"services\", \"service_1_title\"),\n        service_1_description: getContent(\"services\", \"service_1_description\"),\n        service_2_title: getContent(\"services\", \"service_2_title\"),\n        service_2_description: getContent(\"services\", \"service_2_description\"),\n        service_3_title: getContent(\"services\", \"service_3_title\"),\n        service_3_description: getContent(\"services\", \"service_3_description\"),\n        service_4_title: getContent(\"services\", \"service_4_title\"),\n        service_4_description: getContent(\"services\", \"service_4_description\"),\n        cta_title: getContent(\"cta\", \"title\"),\n        cta_description: getContent(\"cta\", \"description\"),\n      });\n    }\n  }, [content]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    const updates: InsertCmsContent[] = [\n      { page: \"home\", section: \"hero\", contentKey: \"title\", contentValue: formData.hero_title },\n      { page: \"home\", section: \"hero\", contentKey: \"subtitle\", contentValue: formData.hero_subtitle },\n      { page: \"home\", section: \"hero\", contentKey: \"description\", contentValue: formData.hero_description },\n      { page: \"home\", section: \"services\", contentKey: \"service_1_title\", contentValue: formData.service_1_title },\n      { page: \"home\", section: \"services\", contentKey: \"service_1_description\", contentValue: formData.service_1_description },\n      { page: \"home\", section: \"services\", contentKey: \"service_2_title\", contentValue: formData.service_2_title },\n      { page: \"home\", section: \"services\", contentKey: \"service_2_description\", contentValue: formData.service_2_description },\n      { page: \"home\", section: \"services\", contentKey: \"service_3_title\", contentValue: formData.service_3_title },\n      { page: \"home\", section: \"services\", contentKey: \"service_3_description\", contentValue: formData.service_3_description },\n      { page: \"home\", section: \"services\", contentKey: \"service_4_title\", contentValue: formData.service_4_title },\n      { page: \"home\", section: \"services\", contentKey: \"service_4_description\", contentValue: formData.service_4_description },\n      { page: \"home\", section: \"cta\", contentKey: \"title\", contentValue: formData.cta_title },\n      { page: \"home\", section: \"cta\", contentKey: \"description\", contentValue: formData.cta_description },\n    ];\n\n    updateMutation.mutate(updates);\n  };\n\n  if (isLoading) return <Skeleton className=\"h-96 w-full\" />;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-8\">\n      <Card data-testid=\"card-cms-home-hero\">\n        <CardHeader>\n          <CardTitle>Hero Section</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"hero_title\">Naslov</Label>\n            <Input\n              id=\"hero_title\"\n              value={formData.hero_title}\n              onChange={(e) => setFormData({ ...formData, hero_title: e.target.value })}\n              data-testid=\"input-hero-title\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"hero_subtitle\">Podnaslov</Label>\n            <Input\n              id=\"hero_subtitle\"\n              value={formData.hero_subtitle}\n              onChange={(e) => setFormData({ ...formData, hero_subtitle: e.target.value })}\n              data-testid=\"input-hero-subtitle\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"hero_description\">Opis</Label>\n            <Textarea\n              id=\"hero_description\"\n              value={formData.hero_description}\n              onChange={(e) => setFormData({ ...formData, hero_description: e.target.value })}\n              rows={3}\n              data-testid=\"textarea-hero-description\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-cms-home-services\">\n        <CardHeader>\n          <CardTitle>Usluge (Services)</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {[1, 2, 3, 4].map(num => (\n            <div key={num} className=\"pl-4 space-y-3\">\n              <h3 className=\"font-semibold\">Usluga {num}</h3>\n              <div>\n                <Label>Naslov</Label>\n                <Input\n                  value={formData[`service_${num}_title` as keyof typeof formData]}\n                  onChange={(e) => setFormData({ ...formData, [`service_${num}_title`]: e.target.value })}\n                  data-testid={`input-service-${num}-title`}\n                />\n              </div>\n              <div>\n                <Label>Opis</Label>\n                <Textarea\n                  value={formData[`service_${num}_description` as keyof typeof formData]}\n                  onChange={(e) => setFormData({ ...formData, [`service_${num}_description`]: e.target.value })}\n                  rows={2}\n                  data-testid={`textarea-service-${num}-description`}\n                />\n              </div>\n            </div>\n          ))}\n        </CardContent>\n      </Card>\n\n      <Card data-testid=\"card-cms-home-cta\">\n        <CardHeader>\n          <CardTitle>Call to Action (CTA)</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label>Naslov</Label>\n            <Input\n              value={formData.cta_title}\n              onChange={(e) => setFormData({ ...formData, cta_title: e.target.value })}\n              data-testid=\"input-cta-title\"\n            />\n          </div>\n          <div>\n            <Label>Opis</Label>\n            <Textarea\n              value={formData.cta_description}\n              onChange={(e) => setFormData({ ...formData, cta_description: e.target.value })}\n              rows={2}\n              data-testid=\"textarea-cta-description\"\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex items-center gap-4\">\n        <Button\n          type=\"submit\"\n          disabled={updateMutation.isPending}\n          data-testid=\"button-save-home-cms\"\n        >\n          {updateMutation.isPending ? \"ƒåuvanje...\" : \"Saƒçuvaj Izmene\"}\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          onClick={() => window.open(\"/\", \"_blank\")}\n          data-testid=\"button-preview-home\"\n        >\n          Pregled Home Page\n        </Button>\n      </div>\n    </form>\n  );\n}\n\nfunction TeamPageCMS() {\n  const { toast } = useToast();\n\n  const { data: content = [], isLoading } = useQuery<CmsContent[]>({\n    queryKey: [\"/api/cms/content\", \"team\"],\n    queryFn: () => fetch(\"/api/cms/content?page=team\").then(r => r.json()),\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (updates: InsertCmsContent[]) => {\n      return apiRequest(\"POST\", \"/api/cms/content\", updates);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/cms/content\", \"team\"] });\n      toast({ title: \"Uspe≈°no\", description: \"Sadr≈æaj a≈æuriran\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gre≈°ka\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const getContent = (section: string, key: string) => {\n    return content.find(c => c.section === section && c.contentKey === key)?.contentValue || \"\";\n  };\n\n  const [formData, setFormData] = useState({\n    member_1_name: \"\",\n    member_1_role: \"\",\n    member_1_description: \"\",\n    member_1_instagram: \"\",\n    member_2_name: \"\",\n    member_2_role: \"\",\n    member_2_description: \"\",\n    member_2_instagram: \"\",\n    member_3_name: \"\",\n    member_3_role: \"\",\n    member_3_description: \"\",\n    member_3_instagram: \"\",\n    member_4_name: \"\",\n    member_4_role: \"\",\n    member_4_description: \"\",\n    member_4_instagram: \"\",\n  });\n\n  useEffect(() => {\n    if (content.length > 0) {\n      setFormData({\n        member_1_name: getContent(\"members\", \"member_1_name\"),\n        member_1_role: getContent(\"members\", \"member_1_role\"),\n        member_1_description: getContent(\"members\", \"member_1_description\"),\n        member_1_instagram: getContent(\"members\", \"member_1_instagram\"),\n        member_2_name: getContent(\"members\", \"member_2_name\"),\n        member_2_role: getContent(\"members\", \"member_2_role\"),\n        member_2_description: getContent(\"members\", \"member_2_description\"),\n        member_2_instagram: getContent(\"members\", \"member_2_instagram\"),\n        member_3_name: getContent(\"members\", \"member_3_name\"),\n        member_3_role: getContent(\"members\", \"member_3_role\"),\n        member_3_description: getContent(\"members\", \"member_3_description\"),\n        member_3_instagram: getContent(\"members\", \"member_3_instagram\"),\n        member_4_name: getContent(\"members\", \"member_4_name\"),\n        member_4_role: getContent(\"members\", \"member_4_role\"),\n        member_4_description: getContent(\"members\", \"member_4_description\"),\n        member_4_instagram: getContent(\"members\", \"member_4_instagram\"),\n      });\n    }\n  }, [content]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    const updates: InsertCmsContent[] = [\n      { page: \"team\", section: \"members\", contentKey: \"member_1_name\", contentValue: formData.member_1_name },\n      { page: \"team\", section: \"members\", contentKey: \"member_1_role\", contentValue: formData.member_1_role },\n      { page: \"team\", section: \"members\", contentKey: \"member_1_description\", contentValue: formData.member_1_description },\n      { page: \"team\", section: \"members\", contentKey: \"member_1_instagram\", contentValue: formData.member_1_instagram },\n      { page: \"team\", section: \"members\", contentKey: \"member_2_name\", contentValue: formData.member_2_name },\n      { page: \"team\", section: \"members\", contentKey: \"member_2_role\", contentValue: formData.member_2_role },\n      { page: \"team\", section: \"members\", contentKey: \"member_2_description\", contentValue: formData.member_2_description },\n      { page: \"team\", section: \"members\", contentKey: \"member_2_instagram\", contentValue: formData.member_2_instagram },\n      { page: \"team\", section: \"members\", contentKey: \"member_3_name\", contentValue: formData.member_3_name },\n      { page: \"team\", section: \"members\", contentKey: \"member_3_role\", contentValue: formData.member_3_role },\n      { page: \"team\", section: \"members\", contentKey: \"member_3_description\", contentValue: formData.member_3_description },\n      { page: \"team\", section: \"members\", contentKey: \"member_3_instagram\", contentValue: formData.member_3_instagram },\n      { page: \"team\", section: \"members\", contentKey: \"member_4_name\", contentValue: formData.member_4_name },\n      { page: \"team\", section: \"members\", contentKey: \"member_4_role\", contentValue: formData.member_4_role },\n      { page: \"team\", section: \"members\", contentKey: \"member_4_description\", contentValue: formData.member_4_description },\n      { page: \"team\", section: \"members\", contentKey: \"member_4_instagram\", contentValue: formData.member_4_instagram },\n    ];\n\n    updateMutation.mutate(updates);\n  };\n\n  if (isLoading) return <Skeleton className=\"h-96 w-full\" />;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-8\">\n      {[1, 2, 3, 4].map(num => (\n        <Card key={num} data-testid={`card-cms-team-member-${num}`}>\n          <CardHeader>\n            <CardTitle>Tim ƒålan {num}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label>Ime</Label>\n              <Input\n                value={formData[`member_${num}_name` as keyof typeof formData]}\n                onChange={(e) => setFormData({ ...formData, [`member_${num}_name`]: e.target.value })}\n                data-testid={`input-member-${num}-name`}\n              />\n            </div>\n            <div>\n              <Label>Uloga</Label>\n              <Input\n                value={formData[`member_${num}_role` as keyof typeof formData]}\n                onChange={(e) => setFormData({ ...formData, [`member_${num}_role`]: e.target.value })}\n                data-testid={`input-member-${num}-role`}\n              />\n            </div>\n            <div>\n              <Label>Opis</Label>\n              <Textarea\n                value={formData[`member_${num}_description` as keyof typeof formData]}\n                onChange={(e) => setFormData({ ...formData, [`member_${num}_description`]: e.target.value })}\n                rows={3}\n                data-testid={`textarea-member-${num}-description`}\n              />\n            </div>\n            <div>\n              <Label>Instagram</Label>\n              <Input\n                value={formData[`member_${num}_instagram` as keyof typeof formData]}\n                onChange={(e) => setFormData({ ...formData, [`member_${num}_instagram`]: e.target.value })}\n                placeholder=\"@username\"\n                data-testid={`input-member-${num}-instagram`}\n              />\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n\n      <div className=\"flex items-center gap-4\">\n        <Button\n          type=\"submit\"\n          disabled={updateMutation.isPending}\n          data-testid=\"button-save-team-cms\"\n        >\n          {updateMutation.isPending ? \"ƒåuvanje...\" : \"Saƒçuvaj Izmene\"}\n        </Button>\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          onClick={() => window.open(\"/tim\", \"_blank\")}\n          data-testid=\"button-preview-team\"\n        >\n          Pregled Team Page\n        </Button>\n      </div>\n    </form>\n  );\n}\n\n// ============================================================================\n// INVOICES TAB\n// ============================================================================\n\nfunction InvoicesTab() {\n  const { toast } = useToast();\n  const [showCreateForm, setShowCreateForm] = useState(false);\n\n  // Fetch all invoices\n  const { data: invoices = [], isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/admin/invoices\"],\n  });\n\n  // Fetch all users for dropdown\n  const { data: users = [] } = useQuery<any[]>({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  // Create invoice mutation\n  const createInvoiceMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest(\"POST\", \"/api/admin/invoices\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/invoices\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Faktura uspe≈°no kreirana\",\n      });\n      setShowCreateForm(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri kreiranju fakture\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update invoice status mutation\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return apiRequest(\"PATCH\", `/api/admin/invoices/${id}/status`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/invoices\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Status fakture a≈æuriran\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri a≈æuriranju statusa\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete invoice mutation\n  const deleteInvoiceMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/admin/invoices/${id}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/invoices\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Faktura obrisana\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri brisanju fakture\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateInvoice = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n    const data = {\n      userId: parseInt(formData.get(\"userId\") as string),\n      amount: parseFloat(formData.get(\"amount\") as string),\n      currency: formData.get(\"currency\") as string || \"RSD\",\n      description: formData.get(\"description\") as string,\n      dueDate: formData.get(\"dueDate\") as string,\n      notes: formData.get(\"notes\") as string || \"\",\n    };\n    createInvoiceMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <Skeleton className=\"h-12 w-full\" />\n        <Skeleton className=\"h-96 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\" data-testid=\"heading-invoices\">Fakture</h2>\n          <p className=\"text-muted-foreground\">Kreiranje i upravljanje fakturama</p>\n        </div>\n        <Button\n          onClick={() => setShowCreateForm(!showCreateForm)}\n          data-testid=\"button-toggle-invoice-form\"\n        >\n          {showCreateForm ? \"Zatvori Formu\" : \"Kreiraj Fakturu\"}\n        </Button>\n      </div>\n\n      {showCreateForm && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Nova Faktura</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleCreateInvoice} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"userId\">Korisnik *</Label>\n                  <select\n                    id=\"userId\"\n                    name=\"userId\"\n                    required\n                    className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n                    data-testid=\"select-invoice-user\"\n                  >\n                    <option value=\"\">Izaberite korisnika</option>\n                    {users.map((user: any) => (\n                      <option key={user.id} value={user.id}>\n                        {user.username} ({user.email})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n                <div>\n                  <Label htmlFor=\"amount\">Iznos *</Label>\n                  <Input\n                    id=\"amount\"\n                    name=\"amount\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    required\n                    data-testid=\"input-invoice-amount\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"currency\">Valuta *</Label>\n                  <select\n                    id=\"currency\"\n                    name=\"currency\"\n                    className=\"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n                    data-testid=\"select-invoice-currency\"\n                  >\n                    <option value=\"RSD\">RSD</option>\n                    <option value=\"EUR\">EUR</option>\n                  </select>\n                </div>\n                <div>\n                  <Label htmlFor=\"dueDate\">Rok Plaƒáanja *</Label>\n                  <Input\n                    id=\"dueDate\"\n                    name=\"dueDate\"\n                    type=\"date\"\n                    required\n                    data-testid=\"input-invoice-due-date\"\n                  />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Opis *</Label>\n                <Textarea\n                  id=\"description\"\n                  name=\"description\"\n                  required\n                  rows={3}\n                  data-testid=\"textarea-invoice-description\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"notes\">Napomene</Label>\n                <Textarea\n                  id=\"notes\"\n                  name=\"notes\"\n                  rows={2}\n                  data-testid=\"textarea-invoice-notes\"\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                disabled={createInvoiceMutation.isPending}\n                data-testid=\"button-submit-invoice\"\n              >\n                {createInvoiceMutation.isPending ? \"Kreiranje...\" : \"Kreiraj Fakturu\"}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Lista Faktura ({invoices.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead>\n                <tr className=\"border-b\">\n                  <th className=\"text-left p-2\">Broj</th>\n                  <th className=\"text-left p-2\">Korisnik</th>\n                  <th className=\"text-left p-2\">Iznos</th>\n                  <th className=\"text-left p-2\">Status</th>\n                  <th className=\"text-left p-2\">Rok</th>\n                  <th className=\"text-left p-2\">Akcije</th>\n                </tr>\n              </thead>\n              <tbody>\n                {invoices.length === 0 ? (\n                  <tr>\n                    <td colSpan={6} className=\"text-center p-4 text-muted-foreground\">\n                      Nema faktura\n                    </td>\n                  </tr>\n                ) : (\n                  invoices.map((invoice: any) => (\n                    <tr key={invoice.id} className=\"border-b\" data-testid={`row-invoice-${invoice.id}`}>\n                      <td className=\"p-2\">{invoice.invoiceNumber}</td>\n                      <td className=\"p-2\">ID: {invoice.userId}</td>\n                      <td className=\"p-2\">\n                        {invoice.amount} {invoice.currency}\n                      </td>\n                      <td className=\"p-2\">\n                        <Badge\n                          variant={\n                            invoice.status === \"paid\"\n                              ? \"default\"\n                              : invoice.status === \"overdue\"\n                              ? \"destructive\"\n                              : \"secondary\"\n                          }\n                          data-testid={`badge-invoice-status-${invoice.id}`}\n                        >\n                          {invoice.status}\n                        </Badge>\n                      </td>\n                      <td className=\"p-2\">\n                        {new Date(invoice.dueDate).toLocaleDateString(\"sr-RS\")}\n                      </td>\n                      <td className=\"p-2\">\n                        <div className=\"flex items-center gap-2\">\n                          {invoice.status === \"pending\" && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() =>\n                                updateStatusMutation.mutate({ id: invoice.id, status: \"paid\" })\n                              }\n                              disabled={updateStatusMutation.isPending}\n                              data-testid={`button-mark-paid-${invoice.id}`}\n                            >\n                              Oznaƒçi kao Plaƒáeno\n                            </Button>\n                          )}\n                          <Button\n                            size=\"sm\"\n                            variant=\"destructive\"\n                            onClick={() => {\n                              if (confirm(\"Da li ste sigurni?\")) {\n                                deleteInvoiceMutation.mutate(invoice.id);\n                              }\n                            }}\n                            disabled={deleteInvoiceMutation.isPending}\n                            data-testid={`button-delete-invoice-${invoice.id}`}\n                          >\n                            Obri≈°i\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":114184},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { wsHelpers, notifyUser, getOnlineUsersSnapshot } from \"./websocket-helpers\";\nimport { insertContactSubmissionSchema, insertCmsContentSchema, insertCmsMediaSchema, insertVideoSpotSchema, insertUserSongSchema, insertNewsletterSubscriberSchema, insertInvoiceSchema, insertCommunityMessageSchema, mixMasterContractDataSchema, copyrightTransferContractDataSchema, instrumentalSaleContractDataSchema, type CmsContent, type CmsMedia, type VideoSpot, type UserSong } from \"@shared/schema\";\nimport { sendEmail, getLastVerificationCode } from \"./resend-client\";\nimport { setupAuth, hashPassword, comparePasswords } from \"./auth\";\nimport multer from \"multer\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { z } from \"zod\";\nimport { randomBytes } from \"crypto\";\nimport { createRouteHandler } from \"uploadthing/express\";\nimport { uploadRouter } from \"./uploadthing\";\nimport { generateMixMasterPDF, generateCopyrightTransferPDF, generateInstrumentalSalePDF, type MixMasterContract, type CopyrightTransferContract, type InstrumentalSaleContract } from \"./pdf-generators\";\n\n// Configure multer for CMS media uploads (disk storage for images)\nconst multerUpload = multer({\n  storage: multer.diskStorage({\n    destination: (_req, _file, cb) => {\n      const uploadDir = path.join(process.cwd(), 'attached_assets', 'temp');\n      fs.mkdirSync(uploadDir, { recursive: true });\n      cb(null, uploadDir);\n    },\n    filename: (_req, file, cb) => {\n      cb(null, `${Date.now()}-${file.originalname}`);\n    },\n  }),\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB max for images\n  },\n  fileFilter: (_req, file, cb) => {\n    // Only accept image files\n    if (file.mimetype.startsWith('image/')) {\n      cb(null, true);\n    } else {\n      cb(new Error('Samo slike su dozvoljene'));\n    }\n  },\n});\n\n// HTML escape funkcija za bezbednost\nfunction escapeHtml(text: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  };\n  return text.replace(/[&<>\"']/g, (m) => map[m] || m);\n}\n\n// Simple in-memory cache for analytics (30-60s TTL)\ninterface CacheEntry<T> {\n  data: T;\n  expiresAt: number;\n}\n\nconst analyticsCache = new Map<string, CacheEntry<any>>();\nconst CACHE_TTL = 45000; // 45 seconds\n\nfunction getCachedData<T>(key: string): T | null {\n  const entry = analyticsCache.get(key);\n  if (!entry) return null;\n  \n  if (Date.now() > entry.expiresAt) {\n    analyticsCache.delete(key);\n    return null;\n  }\n  \n  return entry.data;\n}\n\nfunction setCachedData<T>(key: string, data: T): void {\n  analyticsCache.set(key, {\n    data,\n    expiresAt: Date.now() + CACHE_TTL,\n  });\n}\n\n// Sanitize user object by removing sensitive fields\nfunction sanitizeUser<T extends Record<string, any>>(user: T): Omit<T, 'password' | 'verificationCode' | 'passwordResetToken' | 'passwordResetExpiry' | 'adminLoginToken' | 'adminLoginExpiry'> {\n  const {\n    password,\n    verificationCode,\n    passwordResetToken,\n    passwordResetExpiry,\n    adminLoginToken,\n    adminLoginExpiry,\n    ...sanitized\n  } = user;\n  return sanitized;\n}\n\n// Rate limiting za kontakt formu - ƒçuva IP adrese i timestamps\nconst contactRateLimits = new Map<string, number[]>();\nconst RATE_LIMIT_WINDOW = 60 * 60 * 1000; // 1 sat u milisekundama\nconst MAX_REQUESTS_PER_HOUR = 3;\n\n// Rate limiting za community chat - 10 sekundi izmeƒëu poruka\nconst communityMessageRateLimits = new Map<number, number>();\nconst COMMUNITY_MESSAGE_COOLDOWN = 10 * 1000; // 10 sekundi u milisekundama\n\n// Funkcija za dobijanje prave IP adrese klijenta (koristi Express req.ip koji je siguran)\nfunction getClientIp(req: any): string | null {\n  // req.ip je automatski popunjen od Express-a kada je trust proxy omoguƒáen\n  // Express ispravno parsira X-Forwarded-For i vraƒáa pravu IP adresu\n  const ip = req.ip;\n  \n  // Ignori≈°i localhost adrese\n  if (!ip || ip === '::1' || ip === '127.0.0.1' || ip === '::ffff:127.0.0.1') {\n    return null;\n  }\n  \n  return ip;\n}\n\nfunction checkContactRateLimit(ip: string): { allowed: boolean; remainingTime?: number } {\n  const now = Date.now();\n  const timestamps = contactRateLimits.get(ip) || [];\n  \n  // Ukloni stare timestamps (starije od 1 sata)\n  const recentTimestamps = timestamps.filter(ts => now - ts < RATE_LIMIT_WINDOW);\n  \n  if (recentTimestamps.length >= MAX_REQUESTS_PER_HOUR) {\n    // Izraƒçunaj kada ƒáe najstariji timestamp isteƒái\n    const oldestTimestamp = Math.min(...recentTimestamps);\n    const remainingTime = Math.ceil((RATE_LIMIT_WINDOW - (now - oldestTimestamp)) / 60000); // u minutima\n    return { allowed: false, remainingTime };\n  }\n  \n  // Dodaj novi timestamp\n  recentTimestamps.push(now);\n  contactRateLimits.set(ip, recentTimestamps);\n  \n  return { allowed: true };\n}\n\n// Funkcija za proveru rate limita za community chat poruke\nfunction canUserSendMessage(userId: number): boolean {\n  const now = Date.now();\n  const lastMessageTime = communityMessageRateLimits.get(userId);\n  \n  if (!lastMessageTime) {\n    communityMessageRateLimits.set(userId, now);\n    return true;\n  }\n  \n  const timeSinceLastMessage = now - lastMessageTime;\n  \n  if (timeSinceLastMessage < COMMUNITY_MESSAGE_COOLDOWN) {\n    return false;\n  }\n  \n  communityMessageRateLimits.set(userId, now);\n  return true;\n}\n\n// Middleware to check if user is banned\nfunction requireNotBanned(req: any, res: any, next: any) {\n  if (!req.isAuthenticated()) {\n    return res.sendStatus(401);\n  }\n  \n  if (req.user!.banned) {\n    return res.status(403).json({ \n      error: \"Va≈° nalog je suspendovan. Kontaktirajte administratora za vi≈°e informacija.\",\n      banned: true \n    });\n  }\n  \n  next();\n}\n\n// Middleware to check if user is admin\nfunction requireAdmin(req: any, res: any, next: any) {\n  if (!req.isAuthenticated()) {\n    return res.sendStatus(401);\n  }\n  \n  if (req.user!.banned) {\n    return res.status(403).json({ \n      error: \"Va≈° nalog je suspendovan. Kontaktirajte administratora za vi≈°e informacija.\",\n      banned: true \n    });\n  }\n  \n  if (req.user!.role !== 'admin') {\n    return res.status(403).json({ error: \"Samo administratori mogu pristupiti ovoj funkcionalnosti\" });\n  }\n  \n  next();\n}\n\n// Middleware to check if email is verified\nfunction requireVerifiedEmail(req: any, res: any, next: any) {\n  if (!req.isAuthenticated()) {\n    return res.sendStatus(401);\n  }\n  \n  if (req.user!.banned) {\n    return res.status(403).json({ \n      error: \"Va≈° nalog je suspendovan. Kontaktirajte administratora za vi≈°e informacija.\",\n      banned: true \n    });\n  }\n  \n  if (!req.user!.emailVerified) {\n    return res.status(403).json({ \n      error: \"Morate verifikovati email adresu da biste pristupili ovoj funkcionalnosti\",\n      requiresVerification: true \n    });\n  }\n  \n  next();\n}\n\n// Middleware to check if site is in maintenance mode (for API routes only)\nasync function checkMaintenanceMode(req: any, res: any, next: any) {\n  // Allow access to maintenance check, auth routes, and admin routes\n  // NOTE: Paths do NOT include /api prefix because middleware is mounted on /api\n  const allowedPaths = [\n    '/maintenance',\n    '/login',\n    '/logout',\n    '/user',\n    '/register',\n    '/verify-email',\n    '/forgot-password',\n    '/reset-password',\n    '/admin',\n    '/admin-login-request',\n    '/admin-login-verify',\n  ];\n  \n  // Check if the request is for an allowed path\n  const isAllowedPath = allowedPaths.some(path => req.path.startsWith(path));\n  \n  if (isAllowedPath) {\n    return next();\n  }\n  \n  // If user is admin, allow access\n  if (req.isAuthenticated() && req.user!.role === \"admin\") {\n    return next();\n  }\n  \n  // Check if maintenance mode is active\n  const isMaintenanceMode = await storage.getMaintenanceMode();\n  \n  if (isMaintenanceMode) {\n    return res.status(503).json({ \n      error: \"Sajt je trenutno u pripremi\",\n      maintenanceMode: true \n    });\n  }\n  \n  next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Setup authentication routes: /api/register, /api/login, /api/logout, /api/user\n  setupAuth(app);\n\n  // Maintenance mode API routes\n  // GET is public (anyone can check if site is in maintenance)\n  app.get(\"/api/maintenance\", async (_req, res) => {\n    try {\n      const isActive = await storage.getMaintenanceMode();\n      res.json({ maintenanceMode: isActive });\n    } catch (error) {\n      console.error(\"Error getting maintenance mode:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST is admin only (only admins can toggle maintenance mode)\n  app.post(\"/api/maintenance\", requireAdmin, async (req, res) => {\n    try {\n      const { maintenanceMode } = req.body;\n      \n      if (typeof maintenanceMode !== \"boolean\") {\n        return res.status(400).json({ error: \"maintenanceMode mora biti boolean\" });\n      }\n      \n      await storage.setMaintenanceMode(maintenanceMode);\n      \n      console.log(`[ADMIN] Maintenance mode ${maintenanceMode ? 'aktiviran' : 'deaktiviran'} od strane ${req.user!.username}`);\n      \n      res.json({ success: true, maintenanceMode });\n    } catch (error) {\n      console.error(\"Error setting maintenance mode:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Development debug endpoint for verification codes (only in development mode)\n  app.get(\"/api/debug/verification-code\", (req, res) => {\n    if (process.env.NODE_ENV !== 'development') {\n      return res.status(404).json({ error: \"Not found\" });\n    }\n\n    const lastCode = getLastVerificationCode();\n    \n    if (!lastCode) {\n      return res.json({ \n        message: \"No verification code available yet. Register a new user to generate one.\" \n      });\n    }\n\n    return res.json({\n      email: lastCode.email,\n      code: lastCode.code,\n      subject: lastCode.subject,\n      timestamp: new Date(lastCode.timestamp).toISOString(),\n      age: Math.round((Date.now() - lastCode.timestamp) / 1000) + ' seconds ago'\n    });\n  });\n\n  // Setup UploadThing routes for file uploads\n  // Use UPLOADTHING_SECRET (same as UPLOADTHING_TOKEN, just different name)\n  app.use(\n    \"/api/uploadthing\",\n    createRouteHandler({\n      router: uploadRouter,\n      config: {\n        token: process.env.UPLOADTHING_SECRET || process.env.UPLOADTHING_TOKEN,\n      },\n    })\n  );\n\n  // Apply maintenance mode middleware to all API routes (except allowed paths)\n  // This allows static files and index.html to load, but blocks API calls when in maintenance mode\n  app.use('/api', checkMaintenanceMode);\n\n  // Image upload endpoint for CMS\n  app.post(\"/api/upload-image\", requireAdmin, multerUpload.single(\"file\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Fajl nije prilo≈æen\" });\n      }\n\n      // Move file from temp to permanent location\n      const tempPath = req.file.path;\n      const fileName = req.file.filename;\n      const permanentDir = path.join(process.cwd(), 'attached_assets', 'cms_images');\n      fs.mkdirSync(permanentDir, { recursive: true });\n      const permanentPath = path.join(permanentDir, fileName);\n\n      fs.renameSync(tempPath, permanentPath);\n\n      // Return relative URL\n      const url = `/attached_assets/cms_images/${fileName}`;\n      res.json({ url });\n    } catch (error) {\n      console.error(\"Image upload error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri upload-u slike\" });\n    }\n  });\n\n  // Email verification endpoint\n  // This endpoint verifies email for PENDING users and moves them to the users table\n  app.post(\"/api/verify-email\", async (req, res) => {\n    try {\n      const { code } = req.body;\n      \n      if (!code) {\n        return res.status(400).json({ error: \"Verifikacioni kod je obavezan\" });\n      }\n      \n      // Find pending user by verification code\n      const pendingUser = await storage.getPendingUserByCode(code);\n      \n      if (!pendingUser) {\n        return res.status(400).json({ error: \"Neva≈æeƒái verifikacioni kod\" });\n      }\n      \n      // Check if pending user has expired (24 hours)\n      if (new Date() > new Date(pendingUser.expiresAt)) {\n        // Delete expired pending user\n        await storage.deletePendingUser(pendingUser.id);\n        return res.status(400).json({ \n          error: \"Verifikacioni kod je istekao. Molimo registrujte se ponovo.\" \n        });\n      }\n      \n      // Move pending user to users table (atomic transaction with race condition protection)\n      let user;\n      try {\n        user = await storage.movePendingToUsers(pendingUser.id);\n      } catch (moveError: any) {\n        console.error(\"[VERIFY] Failed to move pending user to users:\", moveError);\n        \n        // Check if error is due to duplicate email/username\n        if (moveError.message.includes(\"already\")) {\n          return res.status(400).json({ error: moveError.message });\n        }\n        \n        return res.status(500).json({ error: \"Gre≈°ka pri kreiranju naloga\" });\n      }\n      \n      console.log(`[VERIFY] Successfully created and verified user ${user.username} (id: ${user.id})`);\n      \n      // SECURITY: Check if user is banned before logging them in (paranoid check)\n      if (user.banned) {\n        return res.status(403).json({ error: \"Va≈° nalog je banovan\" });\n      }\n      \n      // Log the user in automatically after successful verification\n      req.login(user, (err) => {\n        if (err) {\n          console.error(\"[VERIFY] Login error after verification:\", err);\n          return res.status(500).json({ error: \"Gre≈°ka pri prijavljivanju\" });\n        }\n        \n        // SECURITY: Don't expose password hash\n        const { password, ...userWithoutPassword } = user;\n        res.json({ success: true, user: userWithoutPassword });\n      });\n    } catch (error) {\n      console.error(\"[VERIFY] Verification error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Resend verification code\n  app.post(\"/api/resend-verification\", async (req, res) => {\n    try {\n      const { email } = req.body;\n      \n      if (!email) {\n        return res.status(400).json({ error: \"Email je obavezan\" });\n      }\n      \n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(404).json({ error: \"Korisnik sa ovim emailom nije pronaƒëen\" });\n      }\n      \n      if (user.emailVerified) {\n        return res.status(400).json({ error: \"Email je veƒá verifikovan\" });\n      }\n      \n      // Generate new verification code\n      const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();\n      await storage.setVerificationCode(user.id, verificationCode);\n      \n      // Send verification email\n      try {\n        await sendEmail({\n          to: email,\n          subject: 'Novi Verifikacioni Kod - Studio LeFlow',\n          html: `\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <h2 style=\"color: #7c3aed;\">Studio LeFlow</h2>\n              <h3>Novi Verifikacioni Kod</h3>\n              <p>Ovde je Va≈° novi verifikacioni kod:</p>\n              <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; margin: 30px 0; border-radius: 8px;\">\n                <h1 style=\"color: #7c3aed; font-size: 36px; letter-spacing: 8px; margin: 0;\">${verificationCode}</h1>\n              </div>\n              <p>Ovaj kod istiƒçe za 15 minuta.</p>\n              <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n              <p style=\"color: #666; font-size: 12px;\">Studio LeFlow - Profesionalna Muziƒçka Produkcija</p>\n            </div>\n          `\n        });\n        return res.json({ success: true, message: \"Novi verifikacioni kod je poslat\" });\n      } catch (emailError) {\n        console.error(\"Gre≈°ka pri slanju emaila:\", emailError);\n        return res.status(500).json({ error: \"Gre≈°ka pri slanju emaila\" });\n      }\n    } catch (error) {\n      return res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Admin login request - sends verification code to admin email (2FA)\n  app.post(\"/api/admin-login-request\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ error: \"Korisniƒçko ime ili email i lozinka su obavezni\" });\n      }\n      \n      // Get user by username OR email (check if input contains @)\n      const isEmail = username.includes('@');\n      const user = isEmail \n        ? await storage.getUserByEmail(username)\n        : await storage.getUserByUsername(username);\n      \n      // Generic error message to prevent user enumeration\n      if (!user) {\n        console.log(`[Admin Login] Failed: User not found (${username})`);\n        return res.status(401).json({ error: \"Neispravno korisniƒçko ime ili lozinka\" });\n      }\n      \n      // Verify password\n      const validPassword = await comparePasswords(password, user.password);\n      if (!validPassword) {\n        console.log(`[Admin Login] Failed: Invalid password for user ${user.username}`);\n        return res.status(401).json({ error: \"Neispravno korisniƒçko ime ili lozinka\" });\n      }\n      \n      // Check if user is admin - return same generic error\n      if (user.role !== 'admin') {\n        console.log(`[Admin Login] Failed: User ${user.username} is not admin (role: ${user.role})`);\n        return res.status(401).json({ error: \"Neispravno korisniƒçko ime ili lozinka\" });\n      }\n      \n      // Check if user is banned - return same generic error\n      if (user.banned) {\n        console.log(`[Admin Login] Failed: User ${user.username} is banned`);\n        return res.status(401).json({ error: \"Neispravno korisniƒçko ime ili lozinka\" });\n      }\n      \n      // Generate 6-digit verification code\n      const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();\n      await storage.setAdminLoginToken(user.id, verificationCode);\n      \n      // Send verification email\n      try {\n        await sendEmail({\n          to: user.email,\n          subject: 'Verifikacioni Kod Za Admin Prijavu - Studio LeFlow',\n          html: `\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <h2 style=\"color: #7c3aed;\">Studio LeFlow - Admin Prijava</h2>\n              <h3>Verifikacioni Kod</h3>\n              <p>Poku≈°aj prijave na admin panel. Ako ovo niste Vi, ignori≈°ite ovaj email.</p>\n              <div style=\"background-color: #f3f4f6; padding: 20px; text-align: center; margin: 30px 0; border-radius: 8px;\">\n                <h1 style=\"color: #7c3aed; font-size: 36px; letter-spacing: 8px; margin: 0;\">${verificationCode}</h1>\n              </div>\n              <p>Ovaj kod istiƒçe za 15 minuta.</p>\n              <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n              <p style=\"color: #666; font-size: 12px;\">Studio LeFlow - Profesionalna Muziƒçka Produkcija</p>\n            </div>\n          `\n        });\n        \n        return res.json({ \n          success: true, \n          message: \"Verifikacioni kod je poslat na Va≈° email\",\n          userId: user.id \n        });\n      } catch (emailError) {\n        console.error(\"Gre≈°ka pri slanju emaila:\", emailError);\n        return res.status(500).json({ error: \"Gre≈°ka pri slanju emaila\" });\n      }\n    } catch (error) {\n      console.error(\"Admin login request error:\", error);\n      return res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Admin login verify - verifies code and logs in user\n  app.post(\"/api/admin-login-verify\", async (req, res) => {\n    try {\n      const { userId, code } = req.body;\n      \n      if (!userId || !code) {\n        return res.status(400).json({ error: \"Svi podaci su obavezni\" });\n      }\n      \n      // Verify code\n      const isValid = await storage.verifyAdminLoginToken(userId, code);\n      \n      if (!isValid) {\n        return res.status(401).json({ error: \"Neispravan ili istekao kod\" });\n      }\n      \n      // Get user\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n      \n      // Final security checks\n      if (user.role !== 'admin') {\n        return res.status(403).json({ error: \"Nemate admin privilegije\" });\n      }\n      \n      if (user.banned) {\n        return res.status(403).json({ error: \"Va≈° nalog je banovan\" });\n      }\n      \n      // Clear the admin login token\n      await storage.clearAdminLoginToken(userId);\n      \n      // Log user in by setting session\n      req.login(user, (err) => {\n        if (err) {\n          console.error(\"Login error:\", err);\n          return res.status(500).json({ error: \"Gre≈°ka pri prijavljivanju\" });\n        }\n        \n        const { password, verificationCode, adminLoginToken, ...userWithoutSensitiveData } = user;\n        res.json({ success: true, user: userWithoutSensitiveData });\n      });\n    } catch (error) {\n      console.error(\"Admin login verify error:\", error);\n      return res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  app.post(\"/api/contact\", async (req, res) => {\n    try {\n      // Proveri rate limit samo ako mo≈æemo da odredimo IP adresu\n      const clientIp = getClientIp(req);\n      if (clientIp) {\n        const rateLimitCheck = checkContactRateLimit(clientIp);\n        \n        if (!rateLimitCheck.allowed) {\n          return res.status(429).json({ \n            error: `Poslali ste previ≈°e upita. Molimo poku≈°ajte ponovo za ${rateLimitCheck.remainingTime} minuta.` \n          });\n        }\n      }\n      \n      const validatedData = insertContactSubmissionSchema.parse(req.body);\n      const submission = await storage.createContactSubmission(validatedData);\n      \n      // ≈†alji email notifikaciju\n      try {\n        await sendEmail({\n          to: 'business@studioleflow.com',\n          subject: `Novi upit - ${escapeHtml(validatedData.service)}`,\n          html: `\n            <h2>Novi upit sa Studio LeFlow sajta</h2>\n            <p><strong>Usluga:</strong> ${escapeHtml(validatedData.service)}</p>\n            <p><strong>Ime:</strong> ${escapeHtml(validatedData.name)}</p>\n            <p><strong>Email:</strong> ${escapeHtml(validatedData.email)}</p>\n            <p><strong>Telefon:</strong> ${escapeHtml(validatedData.phone)}</p>\n            ${validatedData.preferredDate ? `<p><strong>≈Ωeljeni termin:</strong> ${escapeHtml(validatedData.preferredDate)}</p>` : ''}\n            <p><strong>Poruka:</strong></p>\n            <p>${escapeHtml(validatedData.message).replace(/\\n/g, '<br>')}</p>\n            <hr>\n            <p style=\"color: #666; font-size: 12px;\">Poslato automatski sa Studio LeFlow sajta</p>\n          `\n        });\n      } catch (emailError) {\n        console.error(\"Gre≈°ka pri slanju email-a:\", emailError);\n        // Nastavi sa odgovorom ƒçak i ako email ne uspe\n      }\n      \n      res.json(submission);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  app.get(\"/api/contact\", async (_req, res) => {\n    try {\n      const submissions = await storage.getAllContactSubmissions();\n      res.json(submissions);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // ==================== NEWSLETTER API ROUTES ====================\n\n  // Subscribe to newsletter (public)\n  app.post(\"/api/newsletter/subscribe\", async (req, res) => {\n    try {\n      const { email } = insertNewsletterSubscriberSchema.parse(req.body);\n\n      // Check if email already exists\n      const existingSubscriber = await storage.getNewsletterSubscriberByEmail(email);\n\n      if (existingSubscriber) {\n        if (existingSubscriber.status === 'confirmed') {\n          return res.status(400).json({ error: \"Email je veƒá prijavljen na newsletter\" });\n        } else if (existingSubscriber.status === 'pending') {\n          return res.status(400).json({ error: \"Email veƒá postoji - proverite inbox za link za potvrdu\" });\n        } else if (existingSubscriber.status === 'unsubscribed') {\n          // Resubscribe - generate new token\n          const confirmationToken = randomBytes(32).toString('hex');\n          \n          await storage.createNewsletterSubscriber(email, confirmationToken);\n          \n          // Send confirmation email\n          try {\n            const baseUrl = process.env.REPLIT_DOMAINS \n              ? `https://${process.env.REPLIT_DOMAINS}` \n              : 'http://localhost:5000';\n            const confirmUrl = `${baseUrl}/newsletter/potvrda/${confirmationToken}`;\n            \n            await sendEmail({\n              to: email,\n              subject: 'Potvrdite prijavu na Studio LeFlow newsletter',\n              html: `\n                <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n                  <div style=\"background-color: #4542f5; padding: 30px; text-align: center;\">\n                    <h1 style=\"color: white; margin: 0;\">Studio LeFlow</h1>\n                  </div>\n                  <div style=\"padding: 30px; background-color: #ffffff;\">\n                    <h2 style=\"color: #333;\">Potvrdite svoju email adresu</h2>\n                    <p>Hvala ≈°to ste se prijavili na Studio LeFlow newsletter!</p>\n                    <p>Kliknite na dugme ispod da potvrdite svoju email adresu:</p>\n                    <div style=\"text-align: center; margin: 30px 0;\">\n                      <a href=\"${confirmUrl}\" style=\"background-color: #4542f5; color: white; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block;\">Potvrdi email</a>\n                    </div>\n                    <p style=\"color: #666; font-size: 14px;\">Ili kopirajte i nalepite ovaj link u pretra≈æivaƒç:</p>\n                    <p style=\"color: #4542f5; word-break: break-all; font-size: 12px;\">${confirmUrl}</p>\n                    <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n                    <p style=\"color: #666; font-size: 12px;\">Ako niste zatra≈æili prijavu na newsletter, ignori≈°ite ovaj email.</p>\n                  </div>\n                </div>\n              `\n            });\n          } catch (emailError) {\n            console.error(\"Gre≈°ka pri slanju confirmation email-a:\", emailError);\n            return res.status(500).json({ error: \"Gre≈°ka pri slanju email-a za potvrdu\" });\n          }\n\n          return res.json({ message: \"Uspe≈°no! Proverite email za link za potvrdu\" });\n        }\n      }\n\n      // Create new subscriber with confirmation token\n      const confirmationToken = randomBytes(32).toString('hex');\n      await storage.createNewsletterSubscriber(email, confirmationToken);\n\n      // Send confirmation email\n      try {\n        const baseUrl = process.env.REPLIT_DOMAINS \n          ? `https://${process.env.REPLIT_DOMAINS}` \n          : 'http://localhost:5000';\n        const confirmUrl = `${baseUrl}/newsletter/potvrda/${confirmationToken}`;\n        \n        await sendEmail({\n          to: email,\n          subject: 'Potvrdite prijavu na Studio LeFlow newsletter',\n          html: `\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n              <div style=\"background-color: #4542f5; padding: 30px; text-align: center;\">\n                <h1 style=\"color: white; margin: 0;\">Studio LeFlow</h1>\n              </div>\n              <div style=\"padding: 30px; background-color: #ffffff;\">\n                <h2 style=\"color: #333;\">Potvrdite svoju email adresu</h2>\n                <p>Hvala ≈°to ste se prijavili na Studio LeFlow newsletter!</p>\n                <p>Kliknite na dugme ispod da potvrdite svoju email adresu:</p>\n                <div style=\"text-align: center; margin: 30px 0;\">\n                  <a href=\"${confirmUrl}\" style=\"background-color: #4542f5; color: white; padding: 15px 40px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block;\">Potvrdi email</a>\n                </div>\n                <p style=\"color: #666; font-size: 14px;\">Ili kopirajte i nalepite ovaj link u pretra≈æivaƒç:</p>\n                <p style=\"color: #4542f5; word-break: break-all; font-size: 12px;\">${confirmUrl}</p>\n                <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n                <p style=\"color: #666; font-size: 12px;\">Ako niste zatra≈æili prijavu na newsletter, ignori≈°ite ovaj email.</p>\n              </div>\n            </div>\n          `\n        });\n      } catch (emailError) {\n        console.error(\"Gre≈°ka pri slanju confirmation email-a:\", emailError);\n        return res.status(500).json({ error: \"Gre≈°ka pri slanju email-a za potvrdu\" });\n      }\n\n      res.json({ message: \"Uspe≈°no! Proverite email za link za potvrdu\" });\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Unesite validnu email adresu\" });\n      } else {\n        console.error(\"Newsletter subscribe error:\", error);\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // Confirm newsletter subscription (public)\n  app.get(\"/api/newsletter/confirm/:token\", async (req, res) => {\n    try {\n      const { token } = req.params;\n      const success = await storage.confirmNewsletterSubscription(token);\n\n      if (!success) {\n        return res.status(400).json({ error: \"Link za potvrdu je neva≈æeƒái ili je veƒá iskori≈°ƒáen\" });\n      }\n\n      res.json({ message: \"Email uspe≈°no potvrƒëen! Hvala ≈°to ste se prijavili na na≈° newsletter\" });\n    } catch (error) {\n      console.error(\"Newsletter confirm error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Unsubscribe from newsletter (public)\n  app.post(\"/api/newsletter/unsubscribe\", async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email || typeof email !== 'string') {\n        return res.status(400).json({ error: \"Email je obavezan\" });\n      }\n\n      const success = await storage.unsubscribeNewsletter(email);\n\n      if (!success) {\n        return res.status(400).json({ error: \"Email nije pronaƒëen u listi pretplatnika\" });\n      }\n\n      res.json({ message: \"Uspe≈°no ste se odjavili sa newslettera\" });\n    } catch (error) {\n      console.error(\"Newsletter unsubscribe error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get newsletter subscribers list (admin only)\n  app.get(\"/api/newsletter/subscribers\", requireAdmin, async (_req, res) => {\n    try {\n      const subscribers = await storage.getAllNewsletterSubscribers();\n      res.json(subscribers);\n    } catch (error) {\n      console.error(\"Newsletter subscribers error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get newsletter statistics (admin only)\n  app.get(\"/api/newsletter/stats\", requireAdmin, async (_req, res) => {\n    try {\n      const stats = await storage.getNewsletterStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Newsletter stats error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Delete newsletter subscriber (admin only)\n  app.delete(\"/api/newsletter/subscribers/:id\", requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      if (isNaN(id)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n\n      const success = await storage.deleteNewsletterSubscriber(id);\n      \n      if (!success) {\n        return res.status(404).json({ error: \"Pretplatnik nije pronaƒëen\" });\n      }\n\n      res.json({ message: \"Pretplatnik je uspe≈°no uklonjen\" });\n    } catch (error) {\n      console.error(\"Delete newsletter subscriber error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Send newsletter campaign (admin only)\n  app.post(\"/api/newsletter/send\", requireAdmin, async (req, res) => {\n    try {\n      const { subject, htmlContent } = req.body;\n\n      if (!subject || !htmlContent) {\n        return res.status(400).json({ error: \"Subject i sadr≈æaj su obavezni\" });\n      }\n\n      // Get all confirmed subscribers\n      const subscribers = await storage.getConfirmedNewsletterSubscribers();\n\n      if (subscribers.length === 0) {\n        return res.status(400).json({ error: \"Nema potvrƒëenih pretplatnika\" });\n      }\n\n      // Send email to all confirmed subscribers\n      const emailPromises = subscribers.map(subscriber => \n        sendEmail({\n          to: subscriber.email,\n          subject: subject,\n          html: htmlContent,\n        })\n      );\n\n      await Promise.all(emailPromises);\n\n      res.json({ \n        message: `Newsletter uspe≈°no poslat na ${subscribers.length} email adresa`,\n        count: subscribers.length \n      });\n    } catch (error) {\n      console.error(\"Send newsletter error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri slanju newslettera\" });\n    }\n  });\n\n  // ==================== GIVEAWAY API ROUTES ====================\n  \n  // Accept terms of service\n  app.post(\"/api/user/accept-terms\", requireVerifiedEmail, async (req, res) => {\n    \n    try {\n      await storage.acceptTerms(req.user!.id);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Update user profile (username, email)\n  app.put(\"/api/user/update-profile\", requireVerifiedEmail, async (req, res) => {\n    try {\n      let { username, email } = req.body;\n      const userId = req.user!.id;\n\n      // Normalize email and username to lowercase for consistency\n      if (email) email = email.toLowerCase();\n      if (username) username = username.toLowerCase();\n\n      // Validation\n      if (username && username.trim().length < 3) {\n        return res.status(400).json({ error: \"Korisniƒçko ime mora imati najmanje 3 karaktera\" });\n      }\n\n      if (email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n        return res.status(400).json({ error: \"Unesite validnu email adresu\" });\n      }\n\n      // Check if username can be changed (once per month)\n      if (username && username !== req.user!.username.toLowerCase()) {\n        const user = await storage.getUser(userId);\n        if (user?.usernameLastChanged) {\n          const daysSinceLastChange = Math.floor(\n            (Date.now() - new Date(user.usernameLastChanged).getTime()) / (1000 * 60 * 60 * 24)\n          );\n          if (daysSinceLastChange < 30) {\n            return res.status(400).json({ \n              error: `Mo≈æete promeniti korisniƒçko ime tek za ${30 - daysSinceLastChange} dana` \n            });\n          }\n        }\n\n        // Check if username is already taken\n        const existingUser = await storage.getUserByUsername(username);\n        if (existingUser && existingUser.id !== userId) {\n          return res.status(400).json({ error: \"Korisniƒçko ime je veƒá zauzeto\" });\n        }\n      }\n\n      // Check if email is already taken\n      if (email && email !== req.user!.email.toLowerCase()) {\n        const existingUser = await storage.getUserByEmail(email);\n        if (existingUser && existingUser.id !== userId) {\n          return res.status(400).json({ error: \"Email adresa je veƒá zauzeta\" });\n        }\n      }\n\n      // Update profile\n      await storage.updateUserProfile(userId, { username, email });\n      \n      // Return updated user (sanitized)\n      const updatedUser = await storage.getUser(userId);\n      if (!updatedUser) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n      res.json(sanitizeUser(updatedUser));\n    } catch (error: any) {\n      console.error(\"Update profile error:\", error);\n      res.status(500).json({ error: error.message || \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Change password\n  app.put(\"/api/user/change-password\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      const userId = req.user!.id;\n\n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ error: \"Trenutna i nova lozinka su obavezne\" });\n      }\n\n      if (newPassword.length < 6) {\n        return res.status(400).json({ error: \"Nova lozinka mora imati najmanje 6 karaktera\" });\n      }\n\n      // Verify current password\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n\n      const isValidPassword = await comparePasswords(currentPassword, user.password);\n      if (!isValidPassword) {\n        return res.status(400).json({ error: \"Trenutna lozinka nije taƒçna\" });\n      }\n\n      // Hash new password\n      const hashedPassword = await hashPassword(newPassword);\n      \n      // Update password\n      await storage.updateUserPassword(userId, hashedPassword);\n      \n      res.json({ message: \"Lozinka je uspe≈°no promenjena\" });\n    } catch (error: any) {\n      console.error(\"Change password error:\", error);\n      res.status(500).json({ error: error.message || \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Update user avatar\n  app.put(\"/api/user/avatar\", async (req, res) => {\n    try {\n      const { avatarUrl } = req.body;\n      const userId = req.user?.id;\n\n      if (!userId) {\n        return res.status(401).json({ error: \"Neautorizovan pristup\" });\n      }\n\n      if (!avatarUrl || typeof avatarUrl !== 'string') {\n        return res.status(400).json({ error: \"Avatar URL je obavezan\" });\n      }\n\n      // Update avatar\n      await storage.updateUserAvatar(userId, avatarUrl);\n      \n      // Return updated user (sanitized)\n      const updatedUser = await storage.getUser(userId);\n      if (!updatedUser) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n      res.json(sanitizeUser(updatedUser));\n    } catch (error: any) {\n      console.error(\"Update avatar error:\", error);\n      res.status(500).json({ error: error.message || \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Remove user avatar\n  app.delete(\"/api/user/avatar\", async (req, res) => {\n    try {\n      const userId = req.user?.id;\n\n      if (!userId) {\n        return res.status(401).json({ error: \"Neautorizovan pristup\" });\n      }\n\n      // Remove avatar by setting it to null\n      await storage.updateUserAvatar(userId, null);\n      \n      // Return updated user (sanitized)\n      const updatedUser = await storage.getUser(userId);\n      if (!updatedUser) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n      res.json(sanitizeUser(updatedUser));\n    } catch (error: any) {\n      console.error(\"Remove avatar error:\", error);\n      res.status(500).json({ error: error.message || \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get giveaway settings\n  app.get(\"/api/giveaway/settings\", async (_req, res) => {\n    try {\n      const settings = await storage.getGiveawaySettings();\n      res.json(settings);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get all projects\n  app.get(\"/api/giveaway/projects\", async (_req, res) => {\n    try {\n      const projects = await storage.getAllProjects();\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Upload a project - now using UploadThing for file hosting\n  app.post(\"/api/giveaway/projects\", requireVerifiedEmail, async (req, res) => {\n    // SECURITY: Enforce terms acceptance on server side\n    if (!req.user!.termsAccepted) {\n      return res.status(403).json({ error: \"Morate prihvatiti pravila pre uƒçe≈°ƒáa u giveaway-u\" });\n    }\n    \n    try {\n      // Check if mp3Url was provided (uploaded via UploadThing)\n      if (!req.body.mp3Url) {\n        return res.status(400).json({ error: \"MP3 URL je obavezan\" });\n      }\n      \n      // Check if user has already uploaded this month\n      const currentMonth = new Date().toISOString().substring(0, 7); // \"2025-01\"\n      const userProjects = await storage.getUserProjectsForMonth(req.user!.id, currentMonth);\n      \n      if (userProjects.length > 0) {\n        return res.status(400).json({ error: \"Veƒá ste uploadovali projekat ovog meseca. Mo≈æete uploadovati samo 1 projekat meseƒçno.\" });\n      }\n      \n      // Parse and validate project data from request body\n      const { insertProjectSchema } = await import(\"@shared/schema\");\n      const validatedData = insertProjectSchema.parse({\n        title: req.body.title,\n        description: req.body.description || '',\n        genre: req.body.genre,\n        mp3Url: req.body.mp3Url, // Use the URL from UploadThing\n      });\n      \n      const project = await storage.createProject({\n        ...validatedData,\n        userId: req.user!.id,\n        currentMonth,\n      });\n      \n      // Notify user about successful upload\n      notifyUser(\n        req.user!.id,\n        \"Projekat uploadovan! üéâ\",\n        `Va≈° projekat \"${project.title}\" je uspe≈°no poslat. Sada mo≈æete glasati za druge projekte.`\n      );\n      \n      // Notify all admins about new project submission\n      const admins = await storage.getAdminUsers();\n      admins.forEach(admin => {\n        notifyUser(\n          admin.id,\n          \"Novi projekat uploadovan\",\n          `${req.user!.username} je uploadovao projekat \"${project.title}\"`\n        );\n      });\n      \n      res.status(201).json(project);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        console.error(\"Project upload error:\", error);\n        res.status(500).json({ error: error.message || \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // Vote on a project (toggle functionality - add or remove vote)\n  app.post(\"/api/giveaway/vote\", requireVerifiedEmail, async (req, res) => {\n    // SECURITY: Enforce terms acceptance on server side\n    if (!req.user!.termsAccepted) {\n      return res.status(403).json({ error: \"Morate prihvatiti pravila pre glasanja\" });\n    }\n    \n    try {\n      const { projectId } = req.body;\n      \n      if (!projectId || typeof projectId !== \"number\") {\n        return res.status(400).json({ error: \"ID projekta je obavezan\" });\n      }\n      \n      // SECURITY: Get IP address\n      const ipAddress = req.socket.remoteAddress || 'unknown';\n      \n      // Check if user already voted - if yes, remove vote (toggle off)\n      const userAlreadyVoted = await storage.hasUserVoted(req.user!.id, projectId);\n      \n      if (userAlreadyVoted) {\n        // Remove vote (toggle off)\n        await storage.deleteVote(req.user!.id, projectId);\n        return res.json({ action: 'removed' });\n      } else {\n        // Check if a DIFFERENT user from this IP has voted\n        // This prevents multiple accounts from same IP, but allows same user to toggle\n        const votes = await storage.getProjectVotes(projectId);\n        const ipVoteByDifferentUser = votes.find(\n          vote => vote.ipAddress === ipAddress && vote.userId !== req.user!.id\n        );\n        \n        if (ipVoteByDifferentUser) {\n          return res.status(400).json({ error: \"Sa ove IP adrese je veƒá glasano za ovaj projekat (drugi korisnik)\" });\n        }\n        \n        // Add vote (toggle on)\n        await storage.createVote({\n          userId: req.user!.id,\n          projectId,\n          ipAddress,\n        });\n        return res.json({ action: 'added' });\n      }\n    } catch (error: any) {\n      console.error(\"Vote toggle error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get comments for a project\n  app.get(\"/api/giveaway/projects/:id/comments\", async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID projekta\" });\n      }\n      \n      const comments = await storage.getProjectComments(projectId);\n      res.json(comments);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Add a comment to a project\n  app.post(\"/api/giveaway/comments\", requireVerifiedEmail, async (req, res) => {\n    // SECURITY: Enforce terms acceptance on server side\n    if (!req.user!.termsAccepted) {\n      return res.status(403).json({ error: \"Morate prihvatiti pravila pre komentarisanja\" });\n    }\n    \n    try {\n      const { insertCommentSchema } = await import(\"@shared/schema\");\n      const validatedData = insertCommentSchema.parse(req.body);\n      \n      const comment = await storage.createComment({\n        ...validatedData,\n        userId: req.user!.id,\n      });\n      \n      res.status(201).json(comment);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // ==================== ADMIN API ROUTES ====================\n  \n  // Get dashboard statistics\n  app.get(\"/api/admin/stats\", requireAdmin, async (_req, res) => {\n    try {\n      const stats = await storage.getAdminStats();\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get all users\n  app.get(\"/api/admin/users\", requireAdmin, async (_req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Search users for admin (used in dropdowns/assignments)\n  app.get(\"/api/admin/users/search\", requireAdmin, async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      const limit = parseInt(req.query.limit as string) || 20;\n\n      if (!query || query.trim().length === 0) {\n        return res.json({ users: [] });\n      }\n\n      const users = await storage.adminSearchUsers(query.trim(), limit);\n      res.json({ users });\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Ban a user\n  app.post(\"/api/admin/users/:id/ban\", requireAdmin, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      await storage.banUser(userId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Unban a user\n  app.post(\"/api/admin/users/:id/unban\", requireAdmin, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      await storage.unbanUser(userId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Delete a user\n  app.delete(\"/api/admin/users/:id\", requireAdmin, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      // Don't allow deleting yourself\n      if (userId === req.user!.id) {\n        return res.status(400).json({ error: \"Ne mo≈æete obrisati sami sebe\" });\n      }\n      \n      await storage.deleteUser(userId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Toggle admin role\n  app.post(\"/api/admin/users/:id/toggle-admin\", requireAdmin, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      // Don't allow removing your own admin role\n      if (userId === req.user!.id) {\n        return res.status(400).json({ error: \"Ne mo≈æete ukloniti sebi admin privilegije\" });\n      }\n      \n      await storage.toggleAdminRole(userId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Update user rank (user, vip, legend, admin)\n  app.patch(\"/api/users/:userId/rank\", requireAdmin, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      if (isNaN(userId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      // Validate rank\n      const rankSchema = z.object({ \n        rank: z.enum(['user', 'vip', 'legend', 'admin']) \n      });\n      const validated = rankSchema.parse(req.body);\n      \n      // Get user to notify them\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n      \n      // Update rank\n      await storage.updateUserRank(userId, validated.rank);\n      \n      // Notify user about rank change\n      const rankNames: Record<string, string> = {\n        user: 'Korisnik',\n        vip: 'VIP',\n        legend: 'Legenda',\n        admin: 'Administrator'\n      };\n      notifyUser(\n        userId,\n        \"Rank a≈æuriran\",\n        `Va≈° rank je promenjen na: ${rankNames[validated.rank]}`\n      );\n      \n      res.json({ success: true, message: \"Rank uspe≈°no a≈æuriran\" });\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      }\n      console.error(\"Error updating user rank:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get all projects (approved and pending) for admin\n  app.get(\"/api/admin/all-projects\", requireAdmin, async (_req, res) => {\n    try {\n      const projects = await storage.getAllProjectsForAdmin();\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get pending (unapproved) projects\n  app.get(\"/api/admin/pending-projects\", requireAdmin, async (_req, res) => {\n    try {\n      const projects = await storage.getPendingProjects();\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Approve a project\n  app.post(\"/api/admin/projects/:id/approve\", requireAdmin, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID projekta\" });\n      }\n      \n      await storage.approveProject(projectId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Delete a project\n  app.delete(\"/api/admin/projects/:id\", requireAdmin, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID projekta\" });\n      }\n      \n      await storage.deleteProject(projectId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Get all comments\n  app.get(\"/api/admin/comments\", requireAdmin, async (_req, res) => {\n    try {\n      const comments = await storage.getAllComments();\n      res.json(comments);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Delete a comment\n  app.delete(\"/api/admin/comments/:id\", requireAdmin, async (req, res) => {\n    try {\n      const commentId = parseInt(req.params.id);\n      if (isNaN(commentId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID komentara\" });\n      }\n      \n      await storage.deleteComment(commentId);\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // Toggle giveaway active status\n  app.post(\"/api/admin/giveaway/toggle\", requireAdmin, async (req, res) => {\n    try {\n      const { isActive } = req.body;\n      \n      if (typeof isActive !== 'boolean') {\n        return res.status(400).json({ error: \"isActive mora biti boolean\" });\n      }\n      \n      await storage.setSetting('giveaway_active', isActive.toString());\n      res.sendStatus(200);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // ==================== CMS API ROUTES ====================\n\n  // GET /api/cms/content?page=home - PUBLIC (for Home/Team pages to read content)\n  app.get(\"/api/cms/content\", async (req, res) => {\n    try {\n      const page = req.query.page as string | undefined;\n      const content = await storage.listCmsContent(page);\n      res.json(content);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST /api/cms/content - batch upsert multiple content entries\n  app.post(\"/api/cms/content\", requireAdmin, async (req, res) => {\n    try {\n      const schema = z.array(insertCmsContentSchema);\n      const validated = schema.parse(req.body);\n      \n      const results = [];\n      for (const item of validated) {\n        const result = await storage.upsertCmsContent(item);\n        results.push(result);\n      }\n      res.json(results);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // PUT /api/cms/content/single - update single content item\n  app.put(\"/api/cms/content/single\", requireAdmin, async (req, res) => {\n    try {\n      const validated = insertCmsContentSchema.parse(req.body);\n      const result = await storage.upsertCmsContent(validated);\n      res.json(result);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // DELETE /api/cms/team-member/:memberIndex - delete team member\n  app.delete(\"/api/cms/team-member/:memberIndex\", requireAdmin, async (req, res) => {\n    try {\n      const memberIndex = parseInt(req.params.memberIndex);\n      if (isNaN(memberIndex)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái member index\" });\n      }\n\n      // Delete all entries for this team member\n      await storage.deleteCmsContentByPattern(\"team\", \"members\", `member_${memberIndex}_`);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting team member:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri brisanju ƒçlana tima\" });\n    }\n  });\n\n  // GET /api/cms/media?page=home - PUBLIC (for frontend to read media paths)\n  app.get(\"/api/cms/media\", async (req, res) => {\n    try {\n      const page = req.query.page as string | undefined;\n      const media = await storage.listCmsMedia(page);\n      res.json(media);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST /api/cms/media - upload image and save to database\n  app.post(\"/api/cms/media\", requireAdmin, multerUpload.single(\"file\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No file uploaded\" });\n      }\n\n      // Validacija metadata iz req.body\n      const metadata = insertCmsMediaSchema.omit({ filePath: true }).parse({\n        page: req.body.page,\n        section: req.body.section,\n        assetKey: req.body.assetKey,\n      });\n\n      // Create CMS directory if doesn't exist\n      const cmsDir = path.join(process.cwd(), \"attached_assets\", \"cms\", metadata.page);\n      await fs.promises.mkdir(cmsDir, { recursive: true });\n\n      // Generate filename: page-section-assetKey-timestamp.ext\n      const ext = path.extname(req.file.originalname);\n      const filename = `${metadata.page}-${metadata.section}-${metadata.assetKey}-${Date.now()}${ext}`;\n      const filePath = `attached_assets/cms/${metadata.page}/${filename}`;\n      const fullPath = path.join(process.cwd(), filePath);\n\n      // Move uploaded file to CMS directory\n      await fs.promises.rename(req.file.path, fullPath);\n\n      // Save to database\n      const mediaEntry = await storage.upsertCmsMedia({\n        ...metadata,\n        filePath,\n      });\n\n      res.json(mediaEntry);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // DELETE /api/cms/media/:id\n  app.delete(\"/api/cms/media/:id\", requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n      await storage.deleteCmsMedia(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // ============================================================================\n  // VIDEO SPOTS API ROUTES\n  // ============================================================================\n\n  // GET /api/video-spots - PUBLIC (get all video spots ordered)\n  app.get(\"/api/video-spots\", async (_req, res) => {\n    try {\n      const spots = await storage.getVideoSpots();\n      res.json(spots);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST /api/video-spots - ADMIN (create new video spot)\n  app.post(\"/api/video-spots\", requireAdmin, async (req, res) => {\n    try {\n      const validated = insertVideoSpotSchema.parse(req.body);\n      const newSpot = await storage.createVideoSpot(validated);\n      res.json(newSpot);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // PUT /api/video-spots/:id - ADMIN (update video spot)\n  app.put(\"/api/video-spots/:id\", requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n      const validated = insertVideoSpotSchema.parse(req.body);\n      const updated = await storage.updateVideoSpot(id, validated);\n      res.json(updated);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      } else {\n        res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n      }\n    }\n  });\n\n  // DELETE /api/video-spots/:id - ADMIN (delete video spot)\n  app.delete(\"/api/video-spots/:id\", requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      if (isNaN(id)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n      await storage.deleteVideoSpot(id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // PUT /api/video-spots/:id/order - ADMIN (update spot order)\n  app.put(\"/api/video-spots/:id/order\", requireAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { order } = req.body;\n      if (isNaN(id) || typeof order !== 'number') {\n        return res.status(400).json({ error: \"Neva≈æeƒái parametri\" });\n      }\n      const updated = await storage.updateVideoSpotOrder(id, order);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // ============================================================================\n  // USER SONGS ENDPOINTS (User-submitted YouTube songs with 36h rate limit)\n  // ============================================================================\n\n  // POST /api/user-songs - PROTECTED (create new user song with rate limiting)\n  app.post(\"/api/user-songs\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      \n      // 1. Validate input\n      const validated = insertUserSongSchema.parse(req.body);\n      \n      // 2. Check 36-hour rate limit\n      const lastSubmissionTime = await storage.getUserLastSongSubmissionTime(userId);\n      if (lastSubmissionTime) {\n        const hoursSinceLastSubmission = (Date.now() - lastSubmissionTime.getTime()) / (1000 * 60 * 60);\n        if (hoursSinceLastSubmission < 36) {\n          const hoursRemaining = Math.ceil(36 - hoursSinceLastSubmission);\n          return res.status(429).json({ \n            error: `Mo≈æete postaviti novu pesmu za ${hoursRemaining} ${hoursRemaining === 1 ? 'sat' : hoursRemaining < 5 ? 'sata' : 'sati'}`,\n            hoursRemaining \n          });\n        }\n      }\n      \n      // 3. Create song (duplicate URL check is handled by DB unique constraint)\n      const newSong = await storage.createUserSong({\n        userId,\n        songTitle: validated.songTitle,\n        artistName: validated.artistName,\n        youtubeUrl: validated.youtubeUrl,\n      });\n      \n      // Notify all admins about new song submission\n      const admins = await storage.getAdminUsers();\n      admins.forEach(admin => {\n        notifyUser(\n          admin.id,\n          \"Nova pesma za odobrenje\",\n          `${req.user!.username} je poslao pesmu \"${newSong.songTitle}\" - ${newSong.artistName}`\n        );\n      });\n      \n      res.json(newSong);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      }\n      // Check for duplicate YouTube URL error\n      if (error.message?.includes('duplicate') || error.code === '23505') {\n        return res.status(409).json({ error: \"Ova pesma je veƒá postavljena\" });\n      }\n      console.error(\"Error creating user song:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // GET /api/user-songs - PROTECTED (get current user's songs)\n  app.get(\"/api/user-songs\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const songs = await storage.getUserSongs(userId);\n      res.json(songs);\n    } catch (error) {\n      console.error(\"Error fetching user songs:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // GET /api/user-songs/all - ADMIN (get all user songs with usernames)\n  app.get(\"/api/user-songs/all\", requireAdmin, async (req, res) => {\n    try {\n      const songs = await storage.getAllUserSongs();\n      res.json(songs);\n    } catch (error) {\n      console.error(\"Error fetching all user songs:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // DELETE /api/user-songs/:id - PROTECTED (delete own song)\n  app.delete(\"/api/user-songs/:id\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const songId = parseInt(req.params.id);\n      const userId = req.user!.id;\n      const isAdmin = req.user!.role === 'admin';\n      \n      if (isNaN(songId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n      \n      // Verify ownership before deletion (admins can delete any)\n      if (!isAdmin) {\n        const song = await storage.getUserSongById(songId);\n        if (!song) {\n          return res.status(404).json({ error: \"Pesma nije pronaƒëena\" });\n        }\n        if (song.userId !== userId) {\n          return res.status(403).json({ error: \"Nemate dozvolu da obri≈°ete ovu pesmu\" });\n        }\n      }\n      \n      await storage.deleteUserSong(songId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting user song:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST /api/user-songs/:id/approve - ADMIN (approve a song)\n  app.post(\"/api/user-songs/:id/approve\", requireAdmin, async (req, res) => {\n    try {\n      const songId = parseInt(req.params.id);\n      \n      if (isNaN(songId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n      \n      // Get song details to notify the user\n      const song = await storage.getUserSongById(songId);\n      if (!song) {\n        return res.status(404).json({ error: \"Pesma nije pronaƒëena\" });\n      }\n      \n      await storage.approveUserSong(songId);\n      \n      // Notify the user that their song was approved\n      notifyUser(\n        song.userId, \n        \"Pesma odobrena! üéµ\",\n        `Va≈°a pesma \"${song.songTitle}\" je odobrena i sada je vidljiva svima.`\n      );\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error approving user song:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // GET /api/user-songs/public - PUBLIC (get all approved songs with voting info)\n  app.get(\"/api/user-songs/public\", async (req, res) => {\n    try {\n      const userId = req.user?.id;\n      const songs = await storage.getApprovedUserSongs(userId);\n      res.json(songs);\n    } catch (error) {\n      console.error(\"Error fetching public user songs:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST /api/user-songs/:id/vote - PROTECTED (toggle vote for a song)\n  app.post(\"/api/user-songs/:id/vote\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const songId = parseInt(req.params.id);\n      const userId = req.user!.id;\n      \n      if (isNaN(songId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID\" });\n      }\n      \n      const result = await storage.toggleUserSongVote(userId, songId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error toggling song vote:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // ============================================================================\n  // COMMUNITY CHAT ENDPOINTS\n  // ============================================================================\n\n  // GET /api/community-chat - Get community messages\n  app.get(\"/api/community-chat\", requireNotBanned, async (req, res) => {\n    try {\n      const limit = Math.min(Math.max(parseInt(req.query.limit as string) || 100, 1), 100);\n      const messages = await storage.getCommunityMessages(limit);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching community messages:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // POST /api/community-chat - Send a community message\n  app.post(\"/api/community-chat\", requireVerifiedEmail, async (req, res) => {\n    try {\n      // Rate limit check using storage (persisted check)\n      const canSend = await storage.canUserSendMessage(req.user!.id);\n      if (!canSend) {\n        return res.status(429).json({ \n          error: \"Mo≈æete slati poruke samo jednom na 10 sekundi\", \n          retryAfterSeconds: 10 \n        });\n      }\n\n      // Validate message\n      const validated = insertCommunityMessageSchema.parse(req.body);\n      \n      // Create message\n      const createdMessage = await storage.createCommunityMessage(req.user!.id, validated.message);\n      \n      // Fetch enriched message data with username, rank, avatarUrl\n      const messages = await storage.getCommunityMessages(1);\n      const enrichedMessage = messages.find(m => m.id === createdMessage.id);\n      \n      if (!enrichedMessage) {\n        throw new Error(\"Failed to fetch enriched message data\");\n      }\n      \n      // Broadcast to all online users\n      const onlineUsers = getOnlineUsersSnapshot();\n      if (wsHelpers.broadcastToUser) {\n        onlineUsers.forEach(userId => {\n          wsHelpers.broadcastToUser!(userId, {\n            type: \"community-chat:new\",\n            message: enrichedMessage\n          });\n        });\n      }\n      \n      res.json(enrichedMessage);\n    } catch (error: any) {\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Validacija nije uspela\", details: error.errors });\n      }\n      if (error.message?.includes(\"10 sekundi\")) {\n        return res.status(429).json({ \n          error: error.message, \n          retryAfterSeconds: 10 \n        });\n      }\n      console.error(\"Error creating community message:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // DELETE /api/community-chat/:id - Delete a community message\n  app.delete(\"/api/community-chat/:id\", requireNotBanned, async (req, res) => {\n    try {\n      const messageId = parseInt(req.params.id);\n      \n      if (isNaN(messageId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID poruke\" });\n      }\n      \n      const success = await storage.deleteCommunityMessage(messageId, req.user!.id);\n      \n      if (!success) {\n        return res.status(403).json({ error: \"Nemate dozvolu da obri≈°ete ovu poruku\" });\n      }\n      \n      // Broadcast deletion to all online users\n      const onlineUsers = getOnlineUsersSnapshot();\n      if (wsHelpers.broadcastToUser) {\n        onlineUsers.forEach(userId => {\n          wsHelpers.broadcastToUser!(userId, {\n            type: \"community-chat:delete\",\n            payload: { id: messageId }\n          });\n        });\n      }\n      \n      res.status(204).end();\n    } catch (error) {\n      console.error(\"Error deleting community message:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // DELETE /api/community-chat/clear - Clear all community messages (ADMIN only)\n  app.delete(\"/api/community-chat/clear\", requireAdmin, async (req, res) => {\n    try {\n      await storage.clearAllCommunityMessages();\n      \n      // Broadcast clear to all online users\n      const onlineUsers = getOnlineUsersSnapshot();\n      if (wsHelpers.broadcastToUser) {\n        onlineUsers.forEach(userId => {\n          wsHelpers.broadcastToUser!(userId, {\n            type: \"community-chat:clear\"\n          });\n        });\n      }\n      \n      res.json({ success: true, message: \"Sve poruke su obrisane\" });\n    } catch (error) {\n      console.error(\"Error clearing community messages:\", error);\n      res.status(500).json({ error: \"Gre≈°ka na serveru\" });\n    }\n  });\n\n  // SEO routes - robots.txt\n  app.get(\"/robots.txt\", (req, res) => {\n    const host = req.get('host') || 'localhost:5000';\n    const protocol = req.protocol || 'https';\n    const siteUrl = `${protocol}://${host}`;\n    \n    const robotsTxt = `User-agent: *\nAllow: /\n\nSitemap: ${siteUrl}/sitemap.xml\n`;\n    res.type(\"text/plain\");\n    res.send(robotsTxt);\n  });\n\n  // SEO routes - sitemap.xml\n  app.get(\"/sitemap.xml\", (req, res) => {\n    const host = req.get('host') || 'localhost:5000';\n    const protocol = req.protocol || 'https';\n    const siteUrl = `${protocol}://${host}`;\n    \n    const sitemap = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url>\n    <loc>${siteUrl}/</loc>\n    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n    <changefreq>weekly</changefreq>\n    <priority>1.0</priority>\n  </url>\n  <url>\n    <loc>${siteUrl}/kontakt</loc>\n    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.8</priority>\n  </url>\n  <url>\n    <loc>${siteUrl}/tim</loc>\n    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n    <changefreq>monthly</changefreq>\n    <priority>0.7</priority>\n  </url>\n  <url>\n    <loc>${siteUrl}/giveaway</loc>\n    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n    <changefreq>weekly</changefreq>\n    <priority>0.9</priority>\n  </url>\n  <url>\n    <loc>${siteUrl}/pravila</loc>\n    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n    <changefreq>yearly</changefreq>\n    <priority>0.5</priority>\n  </url>\n  <url>\n    <loc>${siteUrl}/usluge</loc>\n    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n    <changefreq>yearly</changefreq>\n    <priority>0.5</priority>\n  </url>\n</urlset>`;\n    res.type(\"application/xml\");\n    res.send(sitemap);\n  });\n\n  // ===== MESSAGING ENDPOINTS =====\n  \n  // Search users (verified users only) - MUST BE BEFORE /api/users/:id\n  app.get(\"/api/users/search\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const { q } = req.query;\n      \n      if (!q || typeof q !== 'string' || q.trim().length < 2) {\n        return res.status(400).json({ error: \"Query mora imati najmanje 2 karaktera\" });\n      }\n      \n      const results = await storage.searchUsers(q.trim(), req.user!.id);\n      res.json(results);\n    } catch (error: any) {\n      console.error(\"[MESSAGING] User search error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri pretrazi korisnika\" });\n    }\n  });\n  \n  // Get user by ID (verified users only)\n  app.get(\"/api/users/:id\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      \n      if (isNaN(userId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n      }\n      \n      const sanitized = sanitizeUser(user);\n      res.json(sanitized);\n    } catch (error: any) {\n      console.error(\"[MESSAGING] Get user error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju korisnika\" });\n    }\n  });\n\n  // Get all user conversations\n  app.get(\"/api/conversations\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const conversations = await storage.getUserConversations(req.user!.id);\n      res.json(conversations);\n    } catch (error: any) {\n      console.error(\"[MESSAGING] Get conversations error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju konverzacija\" });\n    }\n  });\n\n  // Get messages for specific conversation\n  app.get(\"/api/messages/conversation/:userId\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const otherUserId = parseInt(req.params.userId);\n      \n      if (isNaN(otherUserId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      const conversation = await storage.getConversation(req.user!.id, otherUserId);\n      \n      if (!conversation) {\n        return res.json([]);\n      }\n      \n      const messages = await storage.getConversationMessages(conversation.id, req.user!.id);\n      \n      await storage.markMessagesAsRead(conversation.id, req.user!.id);\n      \n      // Broadcast message_read event to the sender (otherUserId)\n      if (wsHelpers.broadcastToUser) {\n        wsHelpers.broadcastToUser(otherUserId, {\n          type: 'message_read',\n          conversationId: conversation.id,\n          readBy: req.user!.id,\n        });\n      }\n      \n      res.json(messages);\n    } catch (error: any) {\n      console.error(\"[MESSAGING] Get messages error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju poruka\" });\n    }\n  });\n\n  // Send a message\n  app.post(\"/api/messages/send\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const { receiverId, content, imageUrl } = req.body;\n      \n      if (!receiverId || typeof receiverId !== 'number') {\n        return res.status(400).json({ error: \"receiverId je obavezan\" });\n      }\n      \n      if (receiverId === req.user!.id) {\n        return res.status(400).json({ error: \"Ne mo≈æete slati poruke samom sebi\" });\n      }\n      \n      if (!content || typeof content !== 'string' || content.trim().length === 0) {\n        return res.status(400).json({ error: \"Poruka ne mo≈æe biti prazna\" });\n      }\n      \n      if (content.length > 5000) {\n        return res.status(400).json({ error: \"Poruka mo≈æe imati najvi≈°e 5000 karaktera\" });\n      }\n      \n      // Check if receiver exists and is not banned\n      const receiver = await storage.getUser(receiverId);\n      if (!receiver) {\n        return res.status(404).json({ error: \"Korisnik ne postoji\" });\n      }\n      \n      if (receiver.banned) {\n        return res.status(403).json({ error: \"Ne mo≈æete slati poruke banovanom korisniku\" });\n      }\n      \n      const message = await storage.sendMessage(\n        req.user!.id, \n        receiverId, \n        content.trim(),\n        imageUrl\n      );\n      \n      // Broadcast new_message event to receiver via WebSocket\n      if (wsHelpers.broadcastToUser) {\n        wsHelpers.broadcastToUser(receiverId, {\n          type: 'new_message',\n          message,\n        });\n        \n        // Also broadcast to sender to update their own conversation list\n        wsHelpers.broadcastToUser(req.user!.id, {\n          type: 'new_message',\n          message,\n        });\n      }\n      \n      res.json(message);\n    } catch (error: any) {\n      console.error(\"[MESSAGING] Send message error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri slanju poruke\" });\n    }\n  });\n\n  // DEPRECATED - Messages are now auto-marked as read when fetched (GET /api/messages/conversation/:userId)\n  // This endpoint is kept for backward compatibility with cached JavaScript\n  app.put(\"/api/messages/mark-read\", requireVerifiedEmail, async (req, res) => {\n    console.warn(\"[DEPRECATED] PUT /api/messages/mark-read called - browser cache issue! User needs hard refresh (Ctrl+F5)\");\n    res.json({ \n      success: true,\n      deprecated: true,\n      message: \"Please perform a hard refresh of your browser (Ctrl+F5 or Ctrl+Shift+R)\" \n    });\n  });\n\n  // Get unread message count\n  app.get(\"/api/messages/unread-count\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const count = await storage.getUnreadMessageCount(req.user!.id);\n      res.json({ count });\n    } catch (error: any) {\n      console.error(\"[MESSAGING] Get unread count error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju broja neproƒçitanih poruka\" });\n    }\n  });\n\n  // Delete a message (user can only delete their own messages)\n  app.delete(\"/api/messages/:id\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const messageId = parseInt(req.params.id);\n      \n      if (isNaN(messageId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID poruke\" });\n      }\n      \n      // Get message details before deletion for WebSocket broadcast\n      const message = await storage.getMessageById(messageId);\n      \n      const success = await storage.deleteMessage(messageId, req.user!.id);\n      \n      if (!success) {\n        return res.status(403).json({ error: \"Ne mo≈æete obrisati ovu poruku\" });\n      }\n      \n      // Broadcast message deletion to both sender and receiver via WebSocket\n      if (message && wsHelpers.broadcastToUser) {\n        const deletedMessageEvent = {\n          type: 'message_deleted',\n          messageId,\n        };\n        \n        wsHelpers.broadcastToUser(message.senderId, deletedMessageEvent);\n        wsHelpers.broadcastToUser(message.receiverId, deletedMessageEvent);\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"[MESSAGING] Delete message error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri brisanju poruke\" });\n    }\n  });\n\n  // ===== DASHBOARD ENDPOINTS =====\n  \n  // Get dashboard overview for logged-in user\n  app.get(\"/api/dashboard/overview\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const overview = await storage.getDashboardOverview(req.user!.id);\n      res.json(overview);\n    } catch (error: any) {\n      console.error(\"[DASHBOARD] Get overview error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju dashboard pregleda\" });\n    }\n  });\n\n  // Get user's projects\n  app.get(\"/api/user/projects\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const projects = await storage.getUserProjects(req.user!.id);\n      res.json(projects);\n    } catch (error: any) {\n      console.error(\"[DASHBOARD] Get user projects error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju projekata\" });\n    }\n  });\n\n  // Get user's contracts\n  app.get(\"/api/user/contracts\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const contracts = await storage.getUserContracts(req.user!.id);\n      res.json(contracts);\n    } catch (error: any) {\n      console.error(\"[DASHBOARD] Get user contracts error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju ugovora\" });\n    }\n  });\n\n  // Get user's invoices\n  app.get(\"/api/user/invoices\", requireVerifiedEmail, async (req, res) => {\n    try {\n      const invoices = await storage.getUserInvoices(req.user!.id);\n      res.json(invoices);\n    } catch (error: any) {\n      console.error(\"[DASHBOARD] Get user invoices error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju faktura\" });\n    }\n  });\n\n  // Update project status (admin only)\n  app.put(\"/api/admin/projects/:id/status\", requireAdmin, async (req, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const { status } = req.body;\n\n      if (isNaN(projectId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID projekta\" });\n      }\n\n      if (!status || !['waiting', 'in_progress', 'completed', 'cancelled'].includes(status)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái status. Dozvoljeni: waiting, in_progress, completed, cancelled\" });\n      }\n\n      await storage.updateProjectStatus(projectId, status);\n      \n      // Get project info for notification\n      const project = await storage.getProject(projectId);\n      if (project) {\n        // Notify the user about status change\n        notifyUser(\n          project.userId,\n          \"Status projekta a≈æuriran\",\n          `Status va≈°eg projekta \"${project.title}\" je promenjen na: ${status}`\n        );\n      }\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"[ADMIN] Update project status error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri a≈æuriranju statusa projekta\" });\n    }\n  });\n\n  // ===== ADMIN MESSAGING ENDPOINTS =====\n  \n  // Get all conversations (admin only)\n  app.get(\"/api/admin/messages/conversations\", requireAdmin, async (req, res) => {\n    try {\n      const conversations = await storage.adminGetAllConversations();\n      res.json(conversations);\n    } catch (error: any) {\n      console.error(\"[ADMIN MESSAGING] Get all conversations error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju konverzacija\" });\n    }\n  });\n\n  // Get messages between two users (admin only)\n  app.get(\"/api/admin/messages/conversation/:user1Id/:user2Id\", requireAdmin, async (req, res) => {\n    try {\n      const user1Id = parseInt(req.params.user1Id);\n      const user2Id = parseInt(req.params.user2Id);\n      \n      if (isNaN(user1Id) || isNaN(user2Id)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n      \n      // Log admin viewing this conversation\n      await storage.adminLogConversationView(req.user!.id, user1Id, user2Id);\n      \n      const messages = await storage.adminGetConversationMessages(user1Id, user2Id);\n      res.json(messages);\n    } catch (error: any) {\n      console.error(\"[ADMIN MESSAGING] Get conversation messages error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju poruka\" });\n    }\n  });\n\n  // Delete any message (admin only)\n  app.delete(\"/api/admin/messages/:id\", requireAdmin, async (req, res) => {\n    try {\n      const messageId = parseInt(req.params.id);\n      \n      if (isNaN(messageId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID poruke\" });\n      }\n      \n      await storage.adminDeleteMessage(messageId);\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"[ADMIN MESSAGING] Delete message error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri brisanju poruke\" });\n    }\n  });\n\n  // Get admin audit logs\n  app.get(\"/api/admin/messages/audit-logs\", requireAdmin, async (req, res) => {\n    try {\n      const logs = await storage.adminGetAuditLogs();\n      res.json(logs);\n    } catch (error: any) {\n      console.error(\"[ADMIN MESSAGING] Get audit logs error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju audit logova\" });\n    }\n  });\n\n  // Export conversation to TXT file\n  app.get(\"/api/admin/messages/export/:user1Id/:user2Id\", requireAdmin, async (req, res) => {\n    try {\n      const user1Id = parseInt(req.params.user1Id);\n      const user2Id = parseInt(req.params.user2Id);\n\n      if (isNaN(user1Id) || isNaN(user2Id)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID korisnika\" });\n      }\n\n      const txtContent = await storage.adminExportConversation(user1Id, user2Id);\n\n      const user1 = await storage.getUser(user1Id);\n      const user2 = await storage.getUser(user2Id);\n      const filename = `konverzacija_${user1?.username}_${user2?.username}_${Date.now()}.txt`;\n\n      res.setHeader(\"Content-Type\", \"text/plain; charset=utf-8\");\n      res.setHeader(\"Content-Disposition\", `attachment; filename=\"${filename}\"`);\n      res.send(txtContent);\n    } catch (error: any) {\n      console.error(\"[ADMIN MESSAGING] Export conversation error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri izvozu konverzacije\" });\n    }\n  });\n\n  // Get messaging statistics\n  app.get(\"/api/admin/messages/stats\", requireAdmin, async (req, res) => {\n    try {\n      const stats = await storage.adminGetMessagingStats();\n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"[ADMIN MESSAGING] Get stats error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju statistike\" });\n    }\n  });\n\n  // ========== CONTRACTS ==========\n\n  // Helper function to sanitize client name for filename\n  function sanitizeNameForFilename(name: string): string {\n    return name\n      .replace(/\\s+/g, '') // Remove all spaces\n      .replace(/[^a-zA-Z0-9]/g, '') // Remove special characters\n      .substring(0, 30); // Limit to 30 characters\n  }\n\n  // Generate contract PDF\n  app.post(\"/api/admin/contracts/generate\", requireAdmin, async (req, res) => {\n    try {\n      const { contractType, contractData } = req.body;\n\n      if (!contractType || !contractData) {\n        return res.status(400).json({ error: \"Tip ugovora i podaci su obavezni\" });\n      }\n\n      // Validate contractData based on contract type\n      let validatedData: any;\n      try {\n        switch (contractType) {\n          case \"mix_master\":\n            validatedData = mixMasterContractDataSchema.parse(contractData);\n            break;\n          case \"copyright_transfer\":\n            validatedData = copyrightTransferContractDataSchema.parse(contractData);\n            break;\n          case \"instrumental_sale\":\n            validatedData = instrumentalSaleContractDataSchema.parse(contractData);\n            break;\n          default:\n            return res.status(400).json({ error: \"Neva≈æeƒái tip ugovora\" });\n        }\n      } catch (validationError: any) {\n        console.error(\"[CONTRACTS] Validation error:\", validationError);\n        return res.status(400).json({ \n          error: \"Validacija podataka nije uspela\", \n          details: validationError.errors || validationError.message \n        });\n      }\n\n      // Get next contract number\n      const contractNumber = await storage.getNextContractNumber();\n\n      // Generate PDF based on contract type\n      let pdfBuffer: Buffer;\n      switch (contractType) {\n        case \"mix_master\":\n          pdfBuffer = await generateMixMasterPDF(validatedData as MixMasterContract);\n          break;\n        case \"copyright_transfer\":\n          pdfBuffer = await generateCopyrightTransferPDF(validatedData as CopyrightTransferContract);\n          break;\n        case \"instrumental_sale\":\n          pdfBuffer = await generateInstrumentalSalePDF(validatedData as InstrumentalSaleContract);\n          break;\n        default:\n          return res.status(400).json({ error: \"Neva≈æeƒái tip ugovora\" });\n      }\n\n      // Save PDF to disk\n      const contractsDir = path.join(process.cwd(), 'attached_assets', 'contracts');\n      fs.mkdirSync(contractsDir, { recursive: true });\n      \n      // Extract client/buyer name based on contract type\n      let clientName = '';\n      if (contractType === 'mix_master') {\n        clientName = validatedData.clientName || '';\n      } else {\n        // copyright_transfer and instrumental_sale use buyerName\n        clientName = validatedData.buyerName || '';\n      }\n      const sanitizedName = sanitizeNameForFilename(clientName);\n      \n      // Build filename with client name suffix (or without if name is empty)\n      const filename = sanitizedName \n        ? `ugovor_${contractNumber.replace('/', '_')}_${sanitizedName}.pdf`\n        : `ugovor_${contractNumber.replace('/', '_')}.pdf`;\n      const pdfPath = path.join(contractsDir, filename);\n      fs.writeFileSync(pdfPath, pdfBuffer);\n\n      // Save contract to database\n      const contract = await storage.createContract({\n        contractNumber,\n        contractType,\n        contractData,\n        pdfPath: `attached_assets/contracts/${filename}`,\n        clientEmail: contractData.clientEmail || null,\n        createdBy: req.user!.id,\n      });\n\n      res.json({ \n        success: true, \n        contract: {\n          id: contract.id,\n          contractNumber: contract.contractNumber,\n          contractType: contract.contractType,\n        }\n      });\n    } catch (error: any) {\n      console.error(\"[CONTRACTS] Generate error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri generisanju ugovora\" });\n    }\n  });\n\n  // Get all contracts\n  app.get(\"/api/admin/contracts\", requireAdmin, async (req, res) => {\n    try {\n      const contracts = await storage.getAllContracts();\n      res.json(contracts);\n    } catch (error: any) {\n      console.error(\"[CONTRACTS] Get all error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju ugovora\" });\n    }\n  });\n\n  // Download contract PDF\n  app.get(\"/api/admin/contracts/:id/download\", requireAdmin, async (req, res) => {\n    try {\n      const contractId = parseInt(req.params.id);\n      \n      if (isNaN(contractId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID ugovora\" });\n      }\n\n      const contract = await storage.getContractById(contractId);\n      if (!contract) {\n        return res.status(404).json({ error: \"Ugovor nije pronaƒëen\" });\n      }\n\n      const pdfPath = path.join(process.cwd(), contract.pdfPath!);\n      \n      if (!fs.existsSync(pdfPath)) {\n        return res.status(404).json({ error: \"PDF fajl nije pronaƒëen\" });\n      }\n\n      // Extract filename from pdfPath for consistent download name\n      const downloadFilename = path.basename(contract.pdfPath || `ugovor_${contract.contractNumber.replace('/', '_')}.pdf`);\n\n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${downloadFilename}\"`);\n      \n      const fileStream = fs.createReadStream(pdfPath);\n      fileStream.pipe(res);\n    } catch (error: any) {\n      console.error(\"[CONTRACTS] Download error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri preuzimanju ugovora\" });\n    }\n  });\n\n  // Send contract via email\n  app.post(\"/api/admin/contracts/:id/send-email\", requireAdmin, async (req, res) => {\n    try {\n      const contractId = parseInt(req.params.id);\n      const { email } = req.body;\n\n      if (isNaN(contractId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID ugovora\" });\n      }\n\n      if (!email || !email.match(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/)) {\n        return res.status(400).json({ error: \"Neva≈æeƒáa email adresa\" });\n      }\n\n      const contract = await storage.getContractById(contractId);\n      if (!contract) {\n        return res.status(404).json({ error: \"Ugovor nije pronaƒëen\" });\n      }\n\n      const pdfPath = path.join(process.cwd(), contract.pdfPath!);\n      \n      if (!fs.existsSync(pdfPath)) {\n        return res.status(404).json({ error: \"PDF fajl nije pronaƒëen\" });\n      }\n\n      // Read PDF as base64\n      const pdfBuffer = fs.readFileSync(pdfPath);\n      const pdfBase64 = pdfBuffer.toString('base64');\n\n      // Professional HTML email template\n      const emailHtml = `\n<!DOCTYPE html>\n<html lang=\"sr\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Arial', sans-serif; background-color: #f4f4f7;\">\n  <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #f4f4f7;\">\n    <tr>\n      <td style=\"padding: 40px 20px;\">\n        <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);\">\n          \n          <!-- Header -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 30px; text-align: center;\">\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: 700; letter-spacing: -0.5px;\">\n                Studio LeFlow\n              </h1>\n              <p style=\"margin: 8px 0 0; color: rgba(255,255,255,0.9); font-size: 14px;\">\n                Profesionalna muziƒçka produkcija\n              </p>\n            </td>\n          </tr>\n\n          <!-- Content -->\n          <tr>\n            <td style=\"padding: 40px 30px;\">\n              <h2 style=\"margin: 0 0 16px; color: #1a1a1a; font-size: 22px; font-weight: 600;\">\n                Po≈°tovani,\n              </h2>\n              \n              <p style=\"margin: 0 0 16px; color: #4a4a4a; font-size: 16px; line-height: 1.6;\">\n                U prilogu Vam dostavljamo ugovor broj <strong>${contract.contractNumber}</strong>.\n              </p>\n\n              <p style=\"margin: 0 0 24px; color: #4a4a4a; font-size: 16px; line-height: 1.6;\">\n                Molimo Vas da pa≈æljivo pregledate dokument. Ukoliko imate bilo kakvih pitanja ili nedoumica, \n                slobodno nas kontaktirajte.\n              </p>\n\n              <!-- Contract Info Box -->\n              <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #f8f9fa; border-radius: 6px; margin-bottom: 24px;\">\n                <tr>\n                  <td style=\"padding: 20px;\">\n                    <table role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" width=\"100%\">\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #6b7280; font-size: 14px;\">\n                          Broj ugovora:\n                        </td>\n                        <td style=\"padding: 8px 0; color: #1a1a1a; font-size: 14px; font-weight: 600; text-align: right;\">\n                          ${contract.contractNumber}\n                        </td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #6b7280; font-size: 14px;\">\n                          Tip:\n                        </td>\n                        <td style=\"padding: 8px 0; color: #1a1a1a; font-size: 14px; font-weight: 600; text-align: right;\">\n                          ${contract.contractType === 'mix_master' ? 'Mix & Master' : contract.contractType === 'copyright_transfer' ? 'Prenos autorskih prava' : 'Prodaja instrumentala'}\n                        </td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #6b7280; font-size: 14px;\">\n                          Datum:\n                        </td>\n                        <td style=\"padding: 8px 0; color: #1a1a1a; font-size: 14px; font-weight: 600; text-align: right;\">\n                          ${new Date(contract.createdAt).toLocaleDateString('sr-RS')}\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n\n              <p style=\"margin: 0 0 8px; color: #4a4a4a; font-size: 16px; line-height: 1.6;\">\n                Srdaƒçan pozdrav,\n              </p>\n              <p style=\"margin: 0 0 24px; color: #667eea; font-size: 16px; font-weight: 600; line-height: 1.6;\">\n                Studio LeFlow tim\n              </p>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"background-color: #f8f9fa; padding: 30px; text-align: center; border-top: 1px solid #e5e7eb;\">\n              <p style=\"margin: 0 0 8px; color: #6b7280; font-size: 14px;\">\n                Studio LeFlow | Beograd, Srbija\n              </p>\n              <p style=\"margin: 0; color: #9ca3af; font-size: 12px;\">\n                Ova poruka je automatski generisana. Molimo ne odgovarajte direktno na ovaj email.\n              </p>\n            </td>\n          </tr>\n\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n      `;\n\n      // Send email with PDF attachment\n      // Extract filename from pdfPath for consistent email attachment name\n      const emailFilename = path.basename(contract.pdfPath || `ugovor_${contract.contractNumber.replace('/', '_')}.pdf`);\n\n      await sendEmail({\n        to: email,\n        subject: `Studio LeFlow - Ugovor ${contract.contractNumber}`,\n        html: emailHtml,\n        attachments: [{\n          filename: emailFilename,\n          content: pdfBase64,\n          encoding: 'base64',\n          contentType: 'application/pdf',\n        }],\n      });\n\n      res.json({ success: true, message: \"Email uspe≈°no poslat\" });\n    } catch (error: any) {\n      console.error(\"[CONTRACTS] Send email error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri slanju email-a\" });\n    }\n  });\n\n  // Assign contract to user (or remove assignment with null)\n  app.patch(\"/api/admin/contracts/:id/assign-user\", requireAdmin, async (req, res) => {\n    try {\n      const contractId = parseInt(req.params.id);\n      const { userId } = req.body;\n\n      if (isNaN(contractId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID ugovora\" });\n      }\n\n      // userId can be null to remove assignment\n      let parsedUserId: number | null = null;\n      \n      if (userId !== null && userId !== undefined) {\n        parsedUserId = parseInt(userId);\n        if (isNaN(parsedUserId)) {\n          return res.status(400).json({ error: \"Neva≈æeƒái userId\" });\n        }\n\n        // Check if user exists (only if userId is provided)\n        const user = await storage.getUser(parsedUserId);\n        if (!user) {\n          return res.status(404).json({ error: \"Korisnik nije pronaƒëen\" });\n        }\n      }\n\n      // Update contract userId (can be null to remove assignment)\n      await storage.updateContractUser(contractId, parsedUserId);\n\n      const message = parsedUserId === null \n        ? \"Dodela ugovora uspe≈°no uklonjena\" \n        : \"Ugovor uspe≈°no dodeljen korisniku\";\n\n      res.json({ success: true, message });\n    } catch (error: any) {\n      console.error(\"[CONTRACTS] Assign user error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri dodeljivanju ugovora\" });\n    }\n  });\n\n  // Delete contract\n  app.delete(\"/api/admin/contracts/:id\", requireAdmin, async (req, res) => {\n    try {\n      const contractId = parseInt(req.params.id);\n      \n      if (isNaN(contractId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID ugovora\" });\n      }\n\n      const contract = await storage.getContractById(contractId);\n      if (!contract) {\n        return res.status(404).json({ error: \"Ugovor nije pronaƒëen\" });\n      }\n\n      // Delete PDF file\n      if (contract.pdfPath) {\n        const pdfPath = path.join(process.cwd(), contract.pdfPath);\n        if (fs.existsSync(pdfPath)) {\n          fs.unlinkSync(pdfPath);\n        }\n      }\n\n      // Delete from database\n      await storage.deleteContract(contractId);\n\n      res.json({ success: true, message: \"Ugovor uspe≈°no obrisan\" });\n    } catch (error: any) {\n      console.error(\"[CONTRACTS] Delete error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri brisanju ugovora\" });\n    }\n  });\n\n  // ============================================================================\n  // INVOICE MANAGEMENT ENDPOINTS (Admin only)\n  // ============================================================================\n\n  // Create invoice\n  app.post(\"/api/admin/invoices\", requireAdmin, async (req, res) => {\n    try {\n      // Generate invoice number (will be done automatically in storage)\n      const invoiceNumber = await storage.getNextInvoiceNumber();\n      \n      // Validate and prepare invoice data\n      const invoiceData = insertInvoiceSchema.parse({\n        ...req.body,\n        invoiceNumber,\n        createdBy: req.user!.id,\n        currency: req.body.currency || \"RSD\",\n        status: req.body.status || \"pending\",\n      });\n\n      const invoice = await storage.createInvoice(invoiceData);\n      res.json(invoice);\n    } catch (error: any) {\n      console.error(\"[INVOICES] Create error:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Neva≈æeƒái podaci\", details: error.errors });\n      }\n      res.status(500).json({ error: \"Gre≈°ka pri kreiranju fakture\" });\n    }\n  });\n\n  // Get all invoices\n  app.get(\"/api/admin/invoices\", requireAdmin, async (req, res) => {\n    try {\n      const invoices = await storage.getAllInvoices();\n      res.json(invoices);\n    } catch (error: any) {\n      console.error(\"[INVOICES] Get all error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju faktura\" });\n    }\n  });\n\n  // Update invoice status\n  app.patch(\"/api/admin/invoices/:id/status\", requireAdmin, async (req, res) => {\n    try {\n      const invoiceId = parseInt(req.params.id);\n      const { status } = req.body;\n\n      if (isNaN(invoiceId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID fakture\" });\n      }\n\n      if (!status || ![\"pending\", \"paid\", \"cancelled\"].includes(status)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái status fakture\" });\n      }\n\n      const paidDate = status === \"paid\" ? new Date() : undefined;\n      await storage.updateInvoiceStatus(invoiceId, status, paidDate);\n\n      res.json({ success: true, message: \"Status fakture a≈æuriran\" });\n    } catch (error: any) {\n      console.error(\"[INVOICES] Update status error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri a≈æuriranju statusa fakture\" });\n    }\n  });\n\n  // Delete invoice\n  app.delete(\"/api/admin/invoices/:id\", requireAdmin, async (req, res) => {\n    try {\n      const invoiceId = parseInt(req.params.id);\n\n      if (isNaN(invoiceId)) {\n        return res.status(400).json({ error: \"Neva≈æeƒái ID fakture\" });\n      }\n\n      await storage.deleteInvoice(invoiceId);\n      res.json({ success: true, message: \"Faktura uspe≈°no obrisana\" });\n    } catch (error: any) {\n      console.error(\"[INVOICES] Delete error:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri brisanju fakture\" });\n    }\n  });\n\n  // ============================================================================\n  // ANALYTICS ENDPOINTS (Admin only, with caching)\n  // ============================================================================\n\n  // GET /api/admin/analytics/summary - Cached analytics summary\n  app.get(\"/api/admin/analytics/summary\", requireAdmin, async (_req, res) => {\n    try {\n      const cacheKey = 'analytics:summary';\n      const cached = getCachedData<any>(cacheKey);\n      \n      if (cached) {\n        return res.json(cached);\n      }\n\n      // Gather all metrics in parallel\n      const [\n        newUsersToday,\n        newUsersWeek,\n        newUsersMonth,\n        topProjects,\n        approvedSongsToday,\n        approvedSongsWeek,\n        approvedSongsMonth,\n        contractStats,\n        unreadConversations,\n      ] = await Promise.all([\n        storage.getNewUsersCount('today'),\n        storage.getNewUsersCount('week'),\n        storage.getNewUsersCount('month'),\n        storage.getTopProjects(10),\n        storage.getApprovedSongsCount('today'),\n        storage.getApprovedSongsCount('week'),\n        storage.getApprovedSongsCount('month'),\n        storage.getContractStats(),\n        storage.getUnreadConversationsCount(),\n      ]);\n\n      const summary = {\n        newUsers: {\n          today: newUsersToday,\n          week: newUsersWeek,\n          month: newUsersMonth,\n        },\n        approvedSongs: {\n          today: approvedSongsToday,\n          week: approvedSongsWeek,\n          month: approvedSongsMonth,\n        },\n        topProjects: topProjects.slice(0, 5),\n        contracts: contractStats,\n        unreadConversations,\n        activeUsers: getOnlineUsersSnapshot().length,\n      };\n\n      setCachedData(cacheKey, summary);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error fetching analytics summary:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju analitike\" });\n    }\n  });\n\n  // GET /api/admin/analytics/active-users - Current active users\n  app.get(\"/api/admin/analytics/active-users\", requireAdmin, async (_req, res) => {\n    try {\n      const onlineUserIds = getOnlineUsersSnapshot();\n      \n      // Fetch user details for online users\n      const onlineUsers = await Promise.all(\n        onlineUserIds.map(async (userId) => {\n          const user = await storage.getUser(userId);\n          if (!user) return null;\n          return {\n            id: user.id,\n            username: user.username,\n            email: user.email,\n            avatarUrl: user.avatarUrl,\n            role: user.role,\n          };\n        })\n      );\n\n      const validUsers = onlineUsers.filter(u => u !== null);\n      res.json({ count: validUsers.length, users: validUsers });\n    } catch (error) {\n      console.error(\"Error fetching active users:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju aktivnih korisnika\" });\n    }\n  });\n\n  // GET /api/admin/analytics/top-projects - Top projects with optional limit\n  app.get(\"/api/admin/analytics/top-projects\", requireAdmin, async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 10;\n      const cacheKey = `analytics:top-projects:${limit}`;\n      \n      const cached = getCachedData<any>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n\n      const topProjects = await storage.getTopProjects(limit);\n      setCachedData(cacheKey, topProjects);\n      \n      res.json(topProjects);\n    } catch (error) {\n      console.error(\"Error fetching top projects:\", error);\n      res.status(500).json({ error: \"Gre≈°ka pri uƒçitavanju top projekata\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","size_bytes":107570},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/SEO.tsx":{"content":"import { useEffect } from 'react';\n\ninterface SEOProps {\n  title?: string;\n  description?: string;\n  keywords?: string[];\n  ogImage?: string;\n  ogType?: string;\n  structuredData?: object;\n}\n\n// Get absolute URL for Open Graph images\nfunction getAbsoluteUrl(path: string): string {\n  // In production, use the actual domain\n  if (typeof window !== 'undefined') {\n    const protocol = window.location.protocol;\n    const host = window.location.host;\n    return `${protocol}//${host}${path}`;\n  }\n  return path;\n}\n\nexport function SEO({\n  title = \"Studio LeFlow - Profesionalni Muziƒçki Studio u Beogradu | Snimanje, Miks, Mastering\",\n  description = \"Vrhunski muziƒçki studio u Beogradu. Snimanje, mix/mastering, instrumentali, video spotovi. WA-47, Apollo Twin X, UAD plugins. Preko 5 godina iskustva.\",\n  keywords = [\n    \"studio leflow\",\n    \"leflow studio\",\n    \"leflow\",\n    \"leflow beograd\",\n    \"studio leflow beograd\",\n    \"leflow studio beograd\",\n    \"muziƒçki studio beograd\",\n    \"muzicki studio beograd\",\n    \"snimanje pesme beograd\",\n    \"snimanje vokala beograd\",\n    \"miks i mastering\",\n    \"mix mastering beograd\",\n    \"voice over studio\",\n    \"podcast studio beograd\",\n    \"muziƒçka produkcija\",\n    \"audio produkcija beograd\",\n    \"mastering beograd\",\n    \"producent muzike beograd\",\n    \"beatmaker beograd\",\n    \"recording studio belgrade\",\n    \"leflow music studio\",\n    \"najbolji muziƒçki studio beograd\"\n  ],\n  ogImage = \"/public/og-image.jpg\",\n  ogType = \"website\",\n  structuredData,\n}: SEOProps) {\n  useEffect(() => {\n    // Set document title\n    document.title = title;\n    \n    // Set/update meta tags\n    const setMetaTag = (name: string, content: string, property = false) => {\n      const attr = property ? 'property' : 'name';\n      let element = document.querySelector(`meta[${attr}=\"${name}\"]`);\n      if (!element) {\n        element = document.createElement('meta');\n        element.setAttribute(attr, name);\n        document.head.appendChild(element);\n      }\n      element.setAttribute('content', content);\n    };\n    \n    // Standard meta tags\n    setMetaTag('description', description);\n    setMetaTag('keywords', keywords.join(', '));\n    \n    // Get absolute URL for Open Graph image\n    const absoluteOgImage = getAbsoluteUrl(ogImage);\n    \n    // Open Graph tags\n    setMetaTag('og:title', title, true);\n    setMetaTag('og:description', description, true);\n    setMetaTag('og:image', absoluteOgImage, true);\n    setMetaTag('og:image:width', '1200', true);\n    setMetaTag('og:image:height', '630', true);\n    setMetaTag('og:type', ogType, true);\n    setMetaTag('og:site_name', 'Studio LeFlow', true);\n    setMetaTag('og:locale', 'sr_RS', true);\n    setMetaTag('og:url', window.location.href, true);\n    \n    // Twitter cards\n    setMetaTag('twitter:card', 'summary_large_image');\n    setMetaTag('twitter:title', title);\n    setMetaTag('twitter:description', description);\n    setMetaTag('twitter:image', absoluteOgImage);\n    \n    // Structured data\n    if (structuredData) {\n      let script = document.querySelector('script[type=\"application/ld+json\"]');\n      if (!script) {\n        script = document.createElement('script');\n        script.setAttribute('type', 'application/ld+json');\n        document.head.appendChild(script);\n      }\n      script.textContent = JSON.stringify(structuredData);\n    }\n  }, [title, description, keywords, ogImage, ogType, structuredData]);\n  \n  return <></>;\n}\n","size_bytes":3436},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useUploadThing } from \"@/lib/uploadthing\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { User, Mail, Lock, AlertCircle, Upload, Loader2, ImageIcon, Trash2 } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\nexport default function Settings() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [isUploadingAvatar, setIsUploadingAvatar] = useState(false);\n\n  const [profileForm, setProfileForm] = useState({\n    username: user?.username || \"\",\n    email: user?.email || \"\",\n  });\n\n  const [passwordForm, setPasswordForm] = useState({\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\",\n  });\n\n  const { startUpload: startAvatarUpload } = useUploadThing(\"avatarUploader\", {\n    onClientUploadComplete: async (files) => {\n      if (files && files.length > 0) {\n        const file = files[0];\n        if (!file) return;\n        \n        try {\n          await apiRequest(\"PUT\", \"/api/user/avatar\", {\n            avatarUrl: file.url,\n          });\n          \n          queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n          setIsUploadingAvatar(false);\n          \n          toast({\n            title: \"Avatar a≈æuriran\",\n            description: \"Va≈°a profilna slika je uspe≈°no promenjena\",\n          });\n        } catch (error: any) {\n          setIsUploadingAvatar(false);\n          toast({\n            title: \"Gre≈°ka\",\n            description: error.message || \"Gre≈°ka pri ƒçuvanju avatara\",\n            variant: \"destructive\",\n          });\n        }\n      }\n    },\n    onUploadError: (error: Error) => {\n      setIsUploadingAvatar(false);\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri upload-u slike\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAvatarUpload = async (file: File) => {\n    if (!file) return;\n    \n    setIsUploadingAvatar(true);\n    await startAvatarUpload([file]);\n  };\n\n  const removeAvatarMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"DELETE\", \"/api/user/avatar\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      toast({\n        title: \"Avatar uklonjen\",\n        description: \"Va≈°a profilna slika je uspe≈°no uklonjena\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri uklanjanju avatara\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: { username?: string; email?: string }) => {\n      return await apiRequest(\"PUT\", \"/api/user/update-profile\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      toast({\n        title: \"Profil a≈æuriran\",\n        description: \"Va≈°i podaci su uspe≈°no izmenjeni\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const changePasswordMutation = useMutation({\n    mutationFn: async (data: { currentPassword: string; newPassword: string }) => {\n      return await apiRequest(\"PUT\", \"/api/user/change-password\", data);\n    },\n    onSuccess: () => {\n      setPasswordForm({\n        currentPassword: \"\",\n        newPassword: \"\",\n        confirmPassword: \"\",\n      });\n      toast({\n        title: \"Lozinka promenjena\",\n        description: \"Va≈°a lozinka je uspe≈°no promenjena\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleProfileUpdate = () => {\n    const updates: { username?: string; email?: string } = {};\n    \n    if (profileForm.username !== user?.username && profileForm.username.trim()) {\n      updates.username = profileForm.username.trim();\n    }\n    \n    if (profileForm.email !== user?.email && profileForm.email.trim()) {\n      updates.email = profileForm.email.trim();\n    }\n\n    if (Object.keys(updates).length === 0) {\n      toast({\n        title: \"Nema promena\",\n        description: \"Niste promenili nijedan podatak\",\n        variant: \"default\",\n      });\n      return;\n    }\n\n    updateProfileMutation.mutate(updates);\n  };\n\n  const handlePasswordChange = () => {\n    if (!passwordForm.currentPassword || !passwordForm.newPassword || !passwordForm.confirmPassword) {\n      toast({\n        title: \"Popunite sva polja\",\n        description: \"Sva polja za promenu lozinke su obavezna\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (passwordForm.newPassword !== passwordForm.confirmPassword) {\n      toast({\n        title: \"Lozinke se ne poklapaju\",\n        description: \"Nova lozinka i potvrda lozinke moraju biti iste\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (passwordForm.newPassword.length < 6) {\n      toast({\n        title: \"Lozinka je prekratka\",\n        description: \"Nova lozinka mora imati najmanje 6 karaktera\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    changePasswordMutation.mutate({\n      currentPassword: passwordForm.currentPassword,\n      newPassword: passwordForm.newPassword,\n    });\n  };\n\n  const daysSinceUsernameChange = user?.usernameLastChanged \n    ? Math.floor((Date.now() - new Date(user.usernameLastChanged).getTime()) / (1000 * 60 * 60 * 24))\n    : null;\n\n  const canChangeUsername = !daysSinceUsernameChange || daysSinceUsernameChange >= 30;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-4xl mx-auto px-4 md:px-6 py-20\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold mb-2\">Pode≈°avanja</h1>\n          <p className=\"text-muted-foreground\">\n            Upravljajte va≈°im nalogom i podacima\n          </p>\n        </div>\n\n        <div className=\"space-y-6\">\n          {/* Avatar Upload */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <ImageIcon className=\"w-5 h-5\" />\n                Profilna slika\n              </CardTitle>\n              <CardDescription>\n                Postavite ili promenite va≈°u profilnu sliku\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center gap-6\">\n                <Avatar className=\"w-24 h-24\">\n                  {user?.avatarUrl ? (\n                    <AvatarImage src={user.avatarUrl} alt={user.username} />\n                  ) : (\n                    <AvatarFallback className=\"text-2xl bg-primary/10\">\n                      <User className=\"w-12 h-12 text-primary\" />\n                    </AvatarFallback>\n                  )}\n                </Avatar>\n                \n                <div className=\"flex-1 space-y-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Preporuƒçena veliƒçina: 400x400px. Max: 4MB\n                  </p>\n                  <div className=\"flex gap-2 flex-wrap\">\n                    <Button\n                      variant=\"outline\"\n                      disabled={isUploadingAvatar || removeAvatarMutation.isPending}\n                      onClick={() => {\n                        const input = document.createElement('input');\n                        input.type = 'file';\n                        input.accept = 'image/png,image/jpeg,image/webp';\n                        input.onchange = (e: any) => {\n                          const file = e.target?.files?.[0];\n                          if (file) handleAvatarUpload(file);\n                        };\n                        input.click();\n                      }}\n                      data-testid=\"button-upload-avatar\"\n                    >\n                      {isUploadingAvatar ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Upload u toku...\n                        </>\n                      ) : (\n                        <>\n                          <Upload className=\"w-4 h-4 mr-2\" />\n                          Upload slike\n                        </>\n                      )}\n                    </Button>\n                    {user?.avatarUrl && (\n                      <Button\n                        variant=\"outline\"\n                        disabled={isUploadingAvatar || removeAvatarMutation.isPending}\n                        onClick={() => removeAvatarMutation.mutate()}\n                        data-testid=\"button-remove-avatar\"\n                      >\n                        {removeAvatarMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                            Uklanjanje...\n                          </>\n                        ) : (\n                          <>\n                            <Trash2 className=\"w-4 h-4 mr-2\" />\n                            Ukloni sliku\n                          </>\n                        )}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Profile Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <User className=\"w-5 h-5\" />\n                Podaci o nalogu\n              </CardTitle>\n              <CardDescription>\n                Promenite svoje korisniƒçko ime ili email adresu\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {!canChangeUsername && daysSinceUsernameChange !== null && (\n                <Alert>\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    Mo≈æete promeniti korisniƒçko ime tek za {30 - daysSinceUsernameChange} dana\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Korisniƒçko ime</Label>\n                <Input\n                  id=\"username\"\n                  value={profileForm.username}\n                  onChange={(e) => setProfileForm({ ...profileForm, username: e.target.value })}\n                  placeholder=\"Unesite korisniƒçko ime\"\n                  disabled={!canChangeUsername || updateProfileMutation.isPending}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Korisniƒçko ime mo≈æete menjati samo jednom meseƒçno\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">\n                  <Mail className=\"w-4 h-4 inline mr-1\" />\n                  Email adresa\n                </Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={profileForm.email}\n                  onChange={(e) => setProfileForm({ ...profileForm, email: e.target.value })}\n                  placeholder=\"Unesite email adresu\"\n                  disabled={updateProfileMutation.isPending}\n                />\n              </div>\n\n              <Button \n                onClick={handleProfileUpdate}\n                disabled={updateProfileMutation.isPending}\n                className=\"w-full sm:w-auto\"\n              >\n                {updateProfileMutation.isPending ? \"ƒåuvanje...\" : \"Saƒçuvaj izmene\"}\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Password Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Lock className=\"w-5 h-5\" />\n                Promena lozinke\n              </CardTitle>\n              <CardDescription>\n                Promenite lozinku va≈°eg naloga\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"currentPassword\">Trenutna lozinka</Label>\n                <Input\n                  id=\"currentPassword\"\n                  type=\"password\"\n                  value={passwordForm.currentPassword}\n                  onChange={(e) => setPasswordForm({ ...passwordForm, currentPassword: e.target.value })}\n                  placeholder=\"Unesite trenutnu lozinku\"\n                  autoComplete=\"current-password\"\n                  disabled={changePasswordMutation.isPending}\n                />\n              </div>\n\n              <Separator />\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"newPassword\">Nova lozinka</Label>\n                <Input\n                  id=\"newPassword\"\n                  type=\"password\"\n                  value={passwordForm.newPassword}\n                  onChange={(e) => setPasswordForm({ ...passwordForm, newPassword: e.target.value })}\n                  placeholder=\"Unesite novu lozinku\"\n                  autoComplete=\"new-password\"\n                  disabled={changePasswordMutation.isPending}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Lozinka mora imati najmanje 6 karaktera\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\">Potvrdite novu lozinku</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  value={passwordForm.confirmPassword}\n                  onChange={(e) => setPasswordForm({ ...passwordForm, confirmPassword: e.target.value })}\n                  placeholder=\"Potvrdite novu lozinku\"\n                  autoComplete=\"new-password\"\n                  disabled={changePasswordMutation.isPending}\n                />\n              </div>\n\n              <Button \n                onClick={handlePasswordChange}\n                disabled={changePasswordMutation.isPending}\n                className=\"w-full sm:w-auto\"\n                variant=\"default\"\n              >\n                {changePasswordMutation.isPending ? \"Promena...\" : \"Promeni lozinku\"}\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Account Info */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Informacije o nalogu</CardTitle>\n              <CardDescription>\n                Osnovne informacije o va≈°em nalogu\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <div className=\"flex justify-between py-2\">\n                <span className=\"text-muted-foreground\">Status verifikacije:</span>\n                <span className=\"font-medium\">\n                  {user?.emailVerified ? \"‚úÖ Verifikovano\" : \"‚ùå Nije verifikovano\"}\n                </span>\n              </div>\n              <Separator />\n              <div className=\"flex justify-between py-2\">\n                <span className=\"text-muted-foreground\">Uloga:</span>\n                <span className=\"font-medium capitalize\">{user?.role}</span>\n              </div>\n              <Separator />\n              <div className=\"flex justify-between py-2\">\n                <span className=\"text-muted-foreground\">Nalog kreiran:</span>\n                <span className=\"font-medium\">\n                  {user?.createdAt ? new Date(user.createdAt).toLocaleDateString('sr-RS') : 'N/A'}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":16347},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"server/storage.ts":{"content":"// Blueprint reference: blueprint:javascript_database, blueprint:javascript_auth_all_persistance\nimport { \n  type ContactSubmission, \n  type InsertContactSubmission,\n  type User,\n  type InsertUser,\n  type Project,\n  type InsertProject,\n  type Comment,\n  type InsertComment,\n  type Vote,\n  type Setting,\n  type CmsContent,\n  type InsertCmsContent,\n  type CmsMedia,\n  type InsertCmsMedia,\n  type VideoSpot,\n  type InsertVideoSpot,\n  type UserSong,\n  type InsertUserSong,\n  type NewsletterSubscriber,\n  type InsertNewsletterSubscriber,\n  type Conversation,\n  type Message,\n  type MessageRead,\n  type AdminMessageAudit,\n  type Contract,\n  type InsertContract,\n  type Invoice,\n  type InsertInvoice,\n  type PendingUser,\n  type RegistrationAttempt,\n  type CommunityMessage,\n  type InsertCommunityMessage,\n  contactSubmissions,\n  users,\n  projects,\n  comments,\n  votes,\n  settings,\n  cmsContent,\n  cmsMedia,\n  videoSpots,\n  userSongs,\n  userSongVotes,\n  newsletterSubscribers,\n  conversations,\n  messages,\n  messageReads,\n  adminMessageAudit,\n  contracts,\n  invoices,\n  pendingUsers,\n  registrationAttempts,\n  communityMessages,\n} from \"@shared/schema\";\nimport { db, pool } from \"./db\";\nimport { eq, and, or, desc, sql, notInArray } from \"drizzle-orm\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport type { Store } from \"express-session\";\n\nconst PostgresSessionStore = connectPg(session);\n\nexport interface IStorage {\n  // Contact submissions\n  createContactSubmission(submission: InsertContactSubmission): Promise<ContactSubmission>;\n  getContactSubmission(id: string): Promise<ContactSubmission | undefined>;\n  getAllContactSubmissions(): Promise<ContactSubmission[]>;\n\n  // Users\n  getUser(id: number): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(insertUser: InsertUser): Promise<User>;\n  updateUserRole(id: number, role: string): Promise<void>;\n  banUser(id: number): Promise<void>;\n  unbanUser(id: number): Promise<void>;\n  acceptTerms(id: number): Promise<void>;\n  getAllUsers(): Promise<User[]>;\n  adminSearchUsers(query: string, limit?: number): Promise<Array<{ id: number; username: string; email: string }>>;\n  getAdminUsers(): Promise<User[]>;\n  setVerificationCode(userId: number, code: string): Promise<void>;\n  verifyEmail(userId: number, code: string): Promise<boolean>;\n  setPasswordResetToken(userId: number, token: string): Promise<void>;\n  verifyPasswordResetToken(userId: number, token: string): Promise<boolean>;\n  updatePassword(userId: number, newPassword: string): Promise<void>;\n  clearPasswordResetToken(userId: number): Promise<void>;\n  setAdminLoginToken(userId: number, token: string): Promise<void>;\n  verifyAdminLoginToken(userId: number, token: string): Promise<boolean>;\n  clearAdminLoginToken(userId: number): Promise<void>;\n  updateUserProfile(userId: number, data: { username?: string; email?: string }): Promise<void>;\n  updateUserPassword(userId: number, hashedPassword: string): Promise<void>;\n  updateUserAvatar(userId: number, avatarUrl: string | null): Promise<void>;\n  updateUserLastSeen(userId: number): Promise<void>;\n\n  // Pending Users (for email verification before full registration)\n  createPendingUser(data: { email: string; password: string; username: string; verificationCode: string; ipAddress: string; userAgent?: string; termsAccepted: boolean; expiresAt: Date }): Promise<PendingUser>;\n  getPendingUserByEmail(email: string): Promise<PendingUser | undefined>;\n  getPendingUserByUsername(username: string): Promise<PendingUser | undefined>;\n  getPendingUserByCode(code: string): Promise<PendingUser | undefined>;\n  deletePendingUser(id: number): Promise<void>;\n  movePendingToUsers(pendingUserId: number): Promise<User>;\n  cleanupExpiredPendingUsers(): Promise<number>; // Returns count of deleted records\n\n  // Registration Rate Limiting\n  createRegistrationAttempt(data: { ipAddress: string; email?: string; userAgent?: string }): Promise<RegistrationAttempt>;\n  getRecentRegistrationAttempts(ipAddress: string, minutesAgo: number): Promise<RegistrationAttempt[]>;\n  cleanupOldRegistrationAttempts(hoursAgo: number): Promise<number>; // Returns count of deleted records\n\n  // Projects\n  createProject(data: { title: string; description: string; genre: string; mp3Url: string; userId: number; currentMonth: string }): Promise<Project>;\n  getProject(id: number): Promise<Project | undefined>;\n  getAllProjects(): Promise<Array<Project & { username: string }>>;\n  getUserProjectsForMonth(userId: number, month: string): Promise<Project[]>;\n  deleteProject(id: number): Promise<void>;\n  incrementVoteCount(projectId: number): Promise<void>;\n\n  // Votes\n  createVote(data: { userId: number; projectId: number; ipAddress: string }): Promise<Vote>;\n  deleteVote(userId: number, projectId: number): Promise<void>;\n  hasUserVoted(userId: number, projectId: number): Promise<boolean>;\n  getProjectVotes(projectId: number): Promise<Vote[]>;\n  decrementVoteCount(projectId: number): Promise<void>;\n\n  // Comments\n  createComment(data: { text: string; projectId: number; userId: number }): Promise<Comment>;\n  getProjectComments(projectId: number): Promise<Array<Comment & { username: string }>>;\n  deleteComment(id: number): Promise<void>;\n  getAllComments(): Promise<Array<Comment & { username: string; projectTitle: string }>>;\n\n  // Settings\n  getSetting(key: string): Promise<Setting | undefined>;\n  setSetting(key: string, value: string): Promise<void>;\n  getGiveawaySettings(): Promise<{ isActive: boolean }>;\n  getMaintenanceMode(): Promise<boolean>;\n  setMaintenanceMode(isActive: boolean): Promise<void>;\n\n  // Newsletter\n  createNewsletterSubscriber(email: string, confirmationToken: string): Promise<NewsletterSubscriber>;\n  getNewsletterSubscriberByEmail(email: string): Promise<NewsletterSubscriber | undefined>;\n  getNewsletterSubscriberByToken(token: string): Promise<NewsletterSubscriber | undefined>;\n  confirmNewsletterSubscription(token: string): Promise<boolean>;\n  unsubscribeNewsletter(email: string): Promise<boolean>;\n  deleteNewsletterSubscriber(id: number): Promise<boolean>;\n  getAllNewsletterSubscribers(): Promise<NewsletterSubscriber[]>;\n  getConfirmedNewsletterSubscribers(): Promise<NewsletterSubscriber[]>;\n  getNewsletterStats(): Promise<{ total: number; confirmed: number; pending: number }>;\n\n  // CMS Content\n  getCmsContent(page: string, section: string, contentKey: string): Promise<CmsContent | undefined>;\n  setCmsContent(page: string, section: string, contentType: string, contentKey: string, contentValue: string): Promise<void>;\n  getAllCmsContent(): Promise<CmsContent[]>;\n  listCmsContent(page?: string): Promise<CmsContent[]>;\n  upsertCmsContent(data: InsertCmsContent): Promise<CmsContent>;\n  deleteCmsContentByPattern(page: string, section: string, keyPattern: string): Promise<void>;\n\n  // CMS Media\n  listCmsMedia(page?: string): Promise<CmsMedia[]>;\n  upsertCmsMedia(data: InsertCmsMedia): Promise<CmsMedia>;\n  deleteCmsMedia(id: number): Promise<void>;\n\n  // Video Spots\n  getVideoSpots(): Promise<VideoSpot[]>;\n  createVideoSpot(data: InsertVideoSpot): Promise<VideoSpot>;\n  updateVideoSpot(id: number, data: InsertVideoSpot): Promise<VideoSpot>;\n  deleteVideoSpot(id: number): Promise<void>;\n  updateVideoSpotOrder(id: number, order: number): Promise<VideoSpot>;\n\n  // User Songs (User-submitted YouTube songs)\n  createUserSong(data: { userId: number; songTitle: string; artistName: string; youtubeUrl: string }): Promise<UserSong>;\n  getUserSongById(id: number): Promise<UserSong | undefined>;\n  getUserSongs(userId: number): Promise<UserSong[]>;\n  getAllUserSongs(): Promise<Array<UserSong & { username: string }>>;\n  getApprovedUserSongs(userId?: number): Promise<Array<UserSong & { username: string; hasVoted: boolean }>>;\n  deleteUserSong(id: number): Promise<void>;\n  approveUserSong(id: number): Promise<void>;\n  getUserLastSongSubmissionTime(userId: number): Promise<Date | null>;\n  toggleUserSongVote(userId: number, songId: number): Promise<{ voted: boolean; votesCount: number }>;\n  hasUserVotedForSong(userId: number, songId: number): Promise<boolean>;\n\n  // Messaging\n  searchUsers(query: string, currentUserId: number): Promise<Array<{ id: number; username: string; email: string }>>;\n  getOrCreateConversation(user1Id: number, user2Id: number): Promise<Conversation>;\n  getConversation(user1Id: number, user2Id: number): Promise<Conversation | undefined>;\n  getUserConversations(userId: number): Promise<Array<Conversation & { otherUser: { id: number; username: string; avatarUrl: string | null }; lastMessage?: Message; unreadCount: number }>>;\n  sendMessage(senderId: number, receiverId: number, content: string, imageUrl?: string): Promise<Message>;\n  getMessageById(messageId: number): Promise<Message | undefined>;\n  getConversationMessages(conversationId: number, userId: number): Promise<Message[]>;\n  markMessagesAsRead(conversationId: number, userId: number): Promise<void>;\n  getUnreadMessageCount(userId: number): Promise<number>;\n  deleteMessage(messageId: number, userId: number): Promise<boolean>;\n  adminGetAllConversations(): Promise<Array<{ id: number; user1Id: number; user2Id: number; user1Username: string; user2Username: string; user1AvatarUrl: string | null; user2AvatarUrl: string | null; messageCount: number; lastMessageAt: Date | null; lastMessageContent: string | null; lastMessageSenderUsername: string | null; lastMessageDeleted: boolean }>>;\n  adminGetConversationMessages(user1Id: number, user2Id: number): Promise<Message[]>;\n  adminDeleteMessage(messageId: number): Promise<boolean>;\n  adminLogConversationView(adminId: number, viewedUser1Id: number, viewedUser2Id: number): Promise<void>;\n  adminGetAuditLogs(): Promise<Array<AdminMessageAudit & { adminUsername: string; user1Username: string; user2Username: string }>>;\n  adminExportConversation(user1Id: number, user2Id: number): Promise<string>;\n  adminGetMessagingStats(): Promise<{ totalMessages: number; totalConversations: number; deletedMessages: number; activeConversations: number }>;\n\n  // Contracts\n  createContract(data: InsertContract): Promise<Contract>;\n  getAllContracts(): Promise<Array<Contract & { username: string | null }>>;\n  getContractById(id: number): Promise<Contract | undefined>;\n  getNextContractNumber(): Promise<string>;\n  updateContractUser(contractId: number, userId: number | null): Promise<void>;\n  deleteContract(id: number): Promise<void>;\n\n  // Invoices\n  createInvoice(data: InsertInvoice): Promise<Invoice>;\n  getAllInvoices(): Promise<Invoice[]>;\n  getUserInvoices(userId: number): Promise<Array<Invoice & { contractNumber: string | null; contractType: string | null }>>;\n  getInvoiceById(id: number): Promise<Invoice | undefined>;\n  getNextInvoiceNumber(): Promise<string>;\n  updateInvoiceStatus(id: number, status: string, paidDate?: Date): Promise<void>;\n  deleteInvoice(id: number): Promise<void>;\n\n  // Community Chat\n  createCommunityMessage(userId: number, message: string): Promise<CommunityMessage>;\n  getCommunityMessages(limit?: number): Promise<Array<CommunityMessage & { username: string; rank: string; avatarUrl: string | null }>>;\n  deleteCommunityMessage(messageId: number, userId: number): Promise<boolean>;\n  clearAllCommunityMessages(): Promise<void>;\n  canUserSendMessage(userId: number): Promise<boolean>;\n  updateUserRank(userId: number, rank: string): Promise<void>;\n\n  // Dashboard\n  getUserProjects(userId: number): Promise<Array<Project & { username: string }>>;\n  getUserContracts(userId: number): Promise<Array<Contract & { username: string }>>;\n  getDashboardOverview(userId: number): Promise<{\n    totalProjects: number;\n    projectsByStatus: Record<string, number>;\n    totalContracts: number;\n    totalInvoices: number;\n    pendingInvoices: number;\n    overdueInvoices: number;\n    totalAmountPending: string;\n    unreadMessages: number;\n  }>;\n  updateProjectStatus(projectId: number, status: string): Promise<void>;\n\n  // Analytics\n  getNewUsersCount(period: 'today' | 'week' | 'month'): Promise<number>;\n  getTopProjects(limit: number): Promise<Array<Project & { username: string; votesCount: number }>>;\n  getApprovedSongsCount(period: 'today' | 'week' | 'month'): Promise<number>;\n  getContractStats(): Promise<{ total: number; byType: Record<string, number> }>;\n  getUnreadConversationsCount(): Promise<number>;\n\n  // Session store\n  sessionStore: Store;\n}\n\nexport class DatabaseStorage implements IStorage {\n  sessionStore: Store;\n\n  constructor() {\n    this.sessionStore = new PostgresSessionStore({ pool, createTableIfMissing: true });\n  }\n\n  // Contact Submissions\n  async createContactSubmission(insertSubmission: InsertContactSubmission): Promise<ContactSubmission> {\n    const [submission] = await db.insert(contactSubmissions).values(insertSubmission).returning();\n    return submission!;\n  }\n\n  async getContactSubmission(id: string): Promise<ContactSubmission | undefined> {\n    const [submission] = await db.select().from(contactSubmissions).where(eq(contactSubmissions.id, id));\n    return submission || undefined;\n  }\n\n  async getAllContactSubmissions(): Promise<ContactSubmission[]> {\n    return await db.select().from(contactSubmissions).orderBy(desc(contactSubmissions.createdAt));\n  }\n\n  // Users\n  async getUser(id: number): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    // Case-insensitive email lookup\n    const [user] = await db.select().from(users).where(sql`LOWER(${users.email}) = LOWER(${email})`);\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    // Case-insensitive username lookup\n    const [user] = await db.select().from(users).where(sql`LOWER(${users.username}) = LOWER(${username})`);\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(insertUser).returning();\n    return user!;\n  }\n\n  async updateUserRole(id: number, role: string): Promise<void> {\n    await db.update(users).set({ role }).where(eq(users.id, id));\n  }\n\n  async banUser(id: number): Promise<void> {\n    await db.update(users).set({ banned: true }).where(eq(users.id, id));\n  }\n\n  async unbanUser(id: number): Promise<void> {\n    await db.update(users).set({ banned: false }).where(eq(users.id, id));\n  }\n\n  async deleteUser(id: number): Promise<void> {\n    // Get all user's projects to delete votes and comments on them\n    const userProjects = await db.select({ id: projects.id }).from(projects).where(eq(projects.userId, id));\n    const projectIds = userProjects.map(p => p.id);\n    \n    // Delete votes and comments on user's projects from other users\n    if (projectIds.length > 0) {\n      await db.delete(votes).where(sql`${votes.projectId} IN (${sql.join(projectIds.map(id => sql`${id}`), sql`, `)})`);\n      await db.delete(comments).where(sql`${comments.projectId} IN (${sql.join(projectIds.map(id => sql`${id}`), sql`, `)})`);\n    }\n    \n    // Delete user's own votes (on other projects)\n    await db.delete(votes).where(eq(votes.userId, id));\n    \n    // Delete user's own comments (on other projects)\n    await db.delete(comments).where(eq(comments.userId, id));\n    \n    // Delete user's projects (now safe - all votes and comments are gone)\n    await db.delete(projects).where(eq(projects.userId, id));\n    \n    // Finally delete the user\n    await db.delete(users).where(eq(users.id, id));\n  }\n\n  async acceptTerms(id: number): Promise<void> {\n    await db.update(users).set({ termsAccepted: true }).where(eq(users.id, id));\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users).orderBy(desc(users.createdAt));\n  }\n\n  async adminSearchUsers(query: string, limit: number = 20): Promise<Array<{ id: number; username: string; email: string }>> {\n    const searchTerm = `%${query.toLowerCase()}%`;\n    \n    const results = await db\n      .select({\n        id: users.id,\n        username: users.username,\n        email: users.email,\n      })\n      .from(users)\n      .where(\n        or(\n          sql`LOWER(${users.username}) LIKE ${searchTerm}`,\n          sql`LOWER(${users.email}) LIKE ${searchTerm}`\n        )\n      )\n      .orderBy(users.username)\n      .limit(limit);\n\n    return results;\n  }\n\n  async getAdminUsers(): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.role, 'admin'));\n  }\n\n  async setVerificationCode(userId: number, code: string): Promise<void> {\n    await db.update(users).set({ verificationCode: code }).where(eq(users.id, userId));\n  }\n\n  async verifyEmail(userId: number, code: string): Promise<boolean> {\n    const [user] = await db.select().from(users).where(eq(users.id, userId));\n    if (!user || user.verificationCode !== code) {\n      return false;\n    }\n    await db.update(users).set({ emailVerified: true, verificationCode: null }).where(eq(users.id, userId));\n    return true;\n  }\n\n  async setPasswordResetToken(userId: number, token: string): Promise<void> {\n    const expiry = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes from now\n    await db.update(users).set({ \n      passwordResetToken: token, \n      passwordResetExpiry: expiry \n    }).where(eq(users.id, userId));\n  }\n\n  async verifyPasswordResetToken(userId: number, token: string): Promise<boolean> {\n    const [user] = await db.select().from(users).where(eq(users.id, userId));\n    if (!user || user.passwordResetToken !== token) {\n      return false;\n    }\n    // Check if token has expired\n    if (!user.passwordResetExpiry || user.passwordResetExpiry < new Date()) {\n      return false;\n    }\n    return true;\n  }\n\n  async updatePassword(userId: number, newPassword: string): Promise<void> {\n    await db.update(users).set({ password: newPassword }).where(eq(users.id, userId));\n  }\n\n  async clearPasswordResetToken(userId: number): Promise<void> {\n    await db.update(users).set({ \n      passwordResetToken: null, \n      passwordResetExpiry: null \n    }).where(eq(users.id, userId));\n  }\n\n  async setAdminLoginToken(userId: number, token: string): Promise<void> {\n    const expiry = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n    await db.update(users).set({ \n      adminLoginToken: token,\n      adminLoginExpiry: expiry\n    }).where(eq(users.id, userId));\n  }\n\n  async verifyAdminLoginToken(userId: number, token: string): Promise<boolean> {\n    const [user] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n    \n    if (!user || user.adminLoginToken !== token) {\n      return false;\n    }\n    \n    if (!user.adminLoginExpiry || user.adminLoginExpiry < new Date()) {\n      return false;\n    }\n    \n    return true;\n  }\n\n  async clearAdminLoginToken(userId: number): Promise<void> {\n    await db.update(users).set({ \n      adminLoginToken: null, \n      adminLoginExpiry: null \n    }).where(eq(users.id, userId));\n  }\n\n  async updateUserProfile(userId: number, data: { username?: string; email?: string }): Promise<void> {\n    const updateData: any = {};\n    \n    if (data.username) {\n      updateData.username = data.username;\n      updateData.usernameLastChanged = new Date();\n    }\n    \n    if (data.email) {\n      updateData.email = data.email;\n    }\n    \n    if (Object.keys(updateData).length > 0) {\n      await db.update(users).set(updateData).where(eq(users.id, userId));\n    }\n  }\n\n  async updateUserPassword(userId: number, hashedPassword: string): Promise<void> {\n    await db.update(users).set({ password: hashedPassword }).where(eq(users.id, userId));\n  }\n\n  async updateUserAvatar(userId: number, avatarUrl: string | null): Promise<void> {\n    await db.update(users).set({ avatarUrl }).where(eq(users.id, userId));\n  }\n\n  async updateUserLastSeen(userId: number): Promise<void> {\n    await db.update(users).set({ lastSeen: sql`now()` }).where(eq(users.id, userId));\n  }\n\n  // Pending Users - for email verification before full registration\n  async createPendingUser(data: { email: string; password: string; username: string; verificationCode: string; ipAddress: string; userAgent?: string; termsAccepted: boolean; expiresAt: Date }): Promise<PendingUser> {\n    const [pendingUser] = await db.insert(pendingUsers).values(data).returning();\n    if (!pendingUser) throw new Error(\"Failed to create pending user\");\n    return pendingUser;\n  }\n\n  async getPendingUserByEmail(email: string): Promise<PendingUser | undefined> {\n    const results = await db.select().from(pendingUsers).where(sql`LOWER(${pendingUsers.email}) = LOWER(${email})`).limit(1);\n    return results[0];\n  }\n\n  async getPendingUserByUsername(username: string): Promise<PendingUser | undefined> {\n    const results = await db.select().from(pendingUsers).where(sql`LOWER(${pendingUsers.username}) = LOWER(${username})`).limit(1);\n    return results[0];\n  }\n\n  async getPendingUserByCode(code: string): Promise<PendingUser | undefined> {\n    const results = await db.select().from(pendingUsers).where(eq(pendingUsers.verificationCode, code)).limit(1);\n    return results[0];\n  }\n\n  async deletePendingUser(id: number): Promise<void> {\n    await db.delete(pendingUsers).where(eq(pendingUsers.id, id));\n  }\n\n  async movePendingToUsers(pendingUserId: number): Promise<User> {\n    // Use transaction to ensure atomicity\n    return await db.transaction(async (tx) => {\n      // Get pending user\n      const [pendingUser] = await tx.select().from(pendingUsers).where(eq(pendingUsers.id, pendingUserId));\n      if (!pendingUser) {\n        throw new Error(\"Pending user not found\");\n      }\n\n      // Check if email or username already exists in users table (race condition protection)\n      const existingByEmail = await tx.select().from(users).where(sql`LOWER(${users.email}) = LOWER(${pendingUser.email})`).limit(1);\n      if (existingByEmail.length > 0) {\n        throw new Error(\"Email already registered\");\n      }\n\n      const existingByUsername = await tx.select().from(users).where(sql`LOWER(${users.username}) = LOWER(${pendingUser.username})`).limit(1);\n      if (existingByUsername.length > 0) {\n        throw new Error(\"Username already taken\");\n      }\n\n      // Create verified user\n      const [newUser] = await tx.insert(users).values({\n        email: pendingUser.email,\n        password: pendingUser.password, // Already hashed\n        username: pendingUser.username,\n        termsAccepted: pendingUser.termsAccepted,\n        emailVerified: true, // They verified via email\n        role: \"user\",\n        banned: false,\n      }).returning();\n      \n      if (!newUser) throw new Error(\"Failed to create user\");\n\n      // Delete pending user\n      await tx.delete(pendingUsers).where(eq(pendingUsers.id, pendingUserId));\n\n      return newUser;\n    });\n  }\n\n  async cleanupExpiredPendingUsers(): Promise<number> {\n    const result = await db.delete(pendingUsers).where(sql`${pendingUsers.expiresAt} < now()`);\n    return result.rowCount || 0;\n  }\n\n  // Registration Rate Limiting\n  async createRegistrationAttempt(data: { ipAddress: string; email?: string; userAgent?: string }): Promise<RegistrationAttempt> {\n    const [attempt] = await db.insert(registrationAttempts).values(data).returning();\n    if (!attempt) throw new Error(\"Failed to create registration attempt\");\n    return attempt;\n  }\n\n  async getRecentRegistrationAttempts(ipAddress: string, minutesAgo: number): Promise<RegistrationAttempt[]> {\n    return await db\n      .select()\n      .from(registrationAttempts)\n      .where(\n        and(\n          eq(registrationAttempts.ipAddress, ipAddress),\n          sql`${registrationAttempts.attemptedAt} > now() - interval '${sql.raw(minutesAgo.toString())} minutes'`\n        )\n      )\n      .orderBy(desc(registrationAttempts.attemptedAt));\n  }\n\n  async cleanupOldRegistrationAttempts(hoursAgo: number): Promise<number> {\n    const result = await db.delete(registrationAttempts).where(\n      sql`${registrationAttempts.attemptedAt} < now() - interval '${sql.raw(hoursAgo.toString())} hours'`\n    );\n    return result.rowCount || 0;\n  }\n\n  // Projects\n  async createProject(data: { title: string; description: string; genre: string; mp3Url: string; userId: number; currentMonth: string }): Promise<Project> {\n    const [project] = await db.insert(projects).values(data).returning();\n    return project!;\n  }\n\n  async getProject(id: number): Promise<Project | undefined> {\n    const [project] = await db.select().from(projects).where(eq(projects.id, id));\n    return project || undefined;\n  }\n\n  async getAllProjects(): Promise<Array<Project & { username: string }>> {\n    const result = await db\n      .select({\n        id: projects.id,\n        title: projects.title,\n        description: projects.description,\n        genre: projects.genre,\n        mp3Url: projects.mp3Url,\n        userId: projects.userId,\n        uploadDate: projects.uploadDate,\n        votesCount: projects.votesCount,\n        currentMonth: projects.currentMonth,\n        approved: projects.approved,\n        username: users.username,\n      })\n      .from(projects)\n      .leftJoin(users, eq(projects.userId, users.id))\n      .where(eq(projects.approved, true)) // Only show approved projects to regular users\n      .orderBy(desc(projects.uploadDate));\n    \n    return result as Array<Project & { username: string }>;\n  }\n\n  async getAllProjectsForAdmin(): Promise<Array<Project & { username: string }>> {\n    const result = await db\n      .select({\n        id: projects.id,\n        title: projects.title,\n        description: projects.description,\n        genre: projects.genre,\n        mp3Url: projects.mp3Url,\n        userId: projects.userId,\n        uploadDate: projects.uploadDate,\n        votesCount: projects.votesCount,\n        currentMonth: projects.currentMonth,\n        approved: projects.approved,\n        username: users.username,\n      })\n      .from(projects)\n      .leftJoin(users, eq(projects.userId, users.id))\n      .orderBy(desc(projects.uploadDate));\n    \n    return result as Array<Project & { username: string }>;\n  }\n\n  async getPendingProjects(): Promise<Array<Project & { username: string }>> {\n    const result = await db\n      .select({\n        id: projects.id,\n        title: projects.title,\n        description: projects.description,\n        genre: projects.genre,\n        mp3Url: projects.mp3Url,\n        userId: projects.userId,\n        uploadDate: projects.uploadDate,\n        votesCount: projects.votesCount,\n        currentMonth: projects.currentMonth,\n        approved: projects.approved,\n        username: users.username,\n      })\n      .from(projects)\n      .leftJoin(users, eq(projects.userId, users.id))\n      .where(eq(projects.approved, false)) // Only show pending (unapproved) projects\n      .orderBy(desc(projects.uploadDate));\n    \n    return result as Array<Project & { username: string }>;\n  }\n\n  async approveProject(id: number): Promise<void> {\n    await db.update(projects).set({ approved: true }).where(eq(projects.id, id));\n  }\n\n  async getUserProjectsForMonth(userId: number, month: string): Promise<Project[]> {\n    return await db.select().from(projects).where(\n      and(eq(projects.userId, userId), eq(projects.currentMonth, month))\n    );\n  }\n\n  async deleteProject(id: number): Promise<void> {\n    await db.delete(projects).where(eq(projects.id, id));\n  }\n\n  async incrementVoteCount(projectId: number): Promise<void> {\n    await db.update(projects).set({\n      votesCount: sql`${projects.votesCount} + 1`\n    }).where(eq(projects.id, projectId));\n  }\n\n  // Votes\n  async createVote(data: { userId: number; projectId: number; ipAddress: string }): Promise<Vote> {\n    const [vote] = await db.insert(votes).values(data).returning();\n    \n    // Increment vote count\n    await this.incrementVoteCount(data.projectId);\n    \n    return vote!;\n  }\n\n  async hasUserVoted(userId: number, projectId: number): Promise<boolean> {\n    const existingVotes = await db.select().from(votes).where(\n      and(eq(votes.userId, userId), eq(votes.projectId, projectId))\n    );\n    return existingVotes.length > 0;\n  }\n\n  async hasIpVoted(ipAddress: string, projectId: number): Promise<boolean> {\n    const existingVotes = await db.select().from(votes).where(\n      and(eq(votes.ipAddress, ipAddress), eq(votes.projectId, projectId))\n    );\n    return existingVotes.length > 0;\n  }\n\n  async getProjectVotes(projectId: number): Promise<Vote[]> {\n    return await db.select().from(votes).where(eq(votes.projectId, projectId));\n  }\n\n  async deleteVote(userId: number, projectId: number): Promise<void> {\n    await db.delete(votes).where(\n      and(eq(votes.userId, userId), eq(votes.projectId, projectId))\n    );\n    \n    // Decrement vote count\n    await this.decrementVoteCount(projectId);\n  }\n\n  async decrementVoteCount(projectId: number): Promise<void> {\n    await db.update(projects).set({\n      votesCount: sql`${projects.votesCount} - 1`\n    }).where(eq(projects.id, projectId));\n  }\n\n  // Comments\n  async createComment(data: { text: string; projectId: number; userId: number }): Promise<Comment> {\n    const [comment] = await db.insert(comments).values(data).returning();\n    return comment!;\n  }\n\n  async getProjectComments(projectId: number): Promise<Array<Comment & { username: string }>> {\n    const result = await db\n      .select({\n        id: comments.id,\n        projectId: comments.projectId,\n        userId: comments.userId,\n        text: comments.text,\n        createdAt: comments.createdAt,\n        username: users.username,\n      })\n      .from(comments)\n      .leftJoin(users, eq(comments.userId, users.id))\n      .where(eq(comments.projectId, projectId))\n      .orderBy(desc(comments.createdAt));\n    \n    return result as Array<Comment & { username: string }>;\n  }\n\n  async deleteComment(id: number): Promise<void> {\n    await db.delete(comments).where(eq(comments.id, id));\n  }\n\n  async getAllComments(): Promise<Array<Comment & { username: string; projectTitle: string }>> {\n    const result = await db\n      .select({\n        id: comments.id,\n        projectId: comments.projectId,\n        projectTitle: projects.title,\n        userId: comments.userId,\n        username: users.username,\n        text: comments.text,\n        createdAt: comments.createdAt,\n      })\n      .from(comments)\n      .leftJoin(users, eq(comments.userId, users.id))\n      .leftJoin(projects, eq(comments.projectId, projects.id))\n      .orderBy(desc(comments.createdAt));\n    \n    return result as Array<Comment & { username: string; projectTitle: string }>;\n  }\n\n  // Settings\n  async getSetting(key: string): Promise<Setting | undefined> {\n    const [setting] = await db.select().from(settings).where(eq(settings.key, key));\n    return setting || undefined;\n  }\n\n  async setSetting(key: string, value: string): Promise<void> {\n    const existing = await this.getSetting(key);\n    if (existing) {\n      await db.update(settings).set({ value, updatedAt: new Date() }).where(eq(settings.key, key));\n    } else {\n      await db.insert(settings).values({ key, value });\n    }\n  }\n\n  // CMS Content\n  async getCmsContent(page: string, section: string, contentKey: string): Promise<CmsContent | undefined> {\n    const [content] = await db.select().from(cmsContent).where(\n      and(\n        eq(cmsContent.page, page),\n        eq(cmsContent.section, section),\n        eq(cmsContent.contentKey, contentKey)\n      )\n    );\n    return content || undefined;\n  }\n\n  async setCmsContent(page: string, section: string, contentType: string, contentKey: string, contentValue: string): Promise<void> {\n    const existing = await this.getCmsContent(page, section, contentKey);\n    if (existing) {\n      await db.update(cmsContent).set({ contentValue, updatedAt: new Date() }).where(\n        and(\n          eq(cmsContent.page, page),\n          eq(cmsContent.section, section),\n          eq(cmsContent.contentKey, contentKey)\n        )\n      );\n    } else {\n      await db.insert(cmsContent).values({ page, section, contentKey, contentValue } as any);\n    }\n  }\n\n  async getAllCmsContent(): Promise<CmsContent[]> {\n    return await db.select().from(cmsContent);\n  }\n\n  async listCmsContent(page?: string): Promise<CmsContent[]> {\n    if (page) {\n      return await db\n        .select()\n        .from(cmsContent)\n        .where(eq(cmsContent.page, page))\n        .orderBy(cmsContent.page, cmsContent.section, cmsContent.contentKey);\n    }\n    return await db\n      .select()\n      .from(cmsContent)\n      .orderBy(cmsContent.page, cmsContent.section, cmsContent.contentKey);\n  }\n\n  async upsertCmsContent(data: InsertCmsContent): Promise<CmsContent> {\n    const [result] = await db\n      .insert(cmsContent)\n      .values(data)\n      .onConflictDoUpdate({\n        target: [cmsContent.page, cmsContent.section, cmsContent.contentKey],\n        set: {\n          contentValue: sql`EXCLUDED.content_value`,\n          updatedAt: sql`NOW()`,\n        },\n      })\n      .returning();\n    return result!;\n  }\n\n  async deleteCmsContentByPattern(page: string, section: string, keyPattern: string): Promise<void> {\n    await db.delete(cmsContent).where(\n      and(\n        eq(cmsContent.page, page),\n        eq(cmsContent.section, section),\n        sql`${cmsContent.contentKey} LIKE ${keyPattern + '%'}`\n      )\n    );\n  }\n\n  async listCmsMedia(page?: string): Promise<CmsMedia[]> {\n    if (page) {\n      return await db\n        .select()\n        .from(cmsMedia)\n        .where(eq(cmsMedia.page, page))\n        .orderBy(cmsMedia.page, cmsMedia.section, cmsMedia.assetKey);\n    }\n    return await db\n      .select()\n      .from(cmsMedia)\n      .orderBy(cmsMedia.page, cmsMedia.section, cmsMedia.assetKey);\n  }\n\n  async upsertCmsMedia(data: InsertCmsMedia): Promise<CmsMedia> {\n    const [result] = await db\n      .insert(cmsMedia)\n      .values(data)\n      .onConflictDoUpdate({\n        target: [cmsMedia.page, cmsMedia.section, cmsMedia.assetKey],\n        set: {\n          filePath: sql`EXCLUDED.file_path`,\n          updatedAt: sql`NOW()`,\n        },\n      })\n      .returning();\n    return result!;\n  }\n\n  async deleteCmsMedia(id: number): Promise<void> {\n    await db.delete(cmsMedia).where(eq(cmsMedia.id, id));\n  }\n\n  async getGiveawaySettings(): Promise<{ isActive: boolean }> {\n    const setting = await this.getSetting('giveaway_active');\n    return { isActive: setting?.value === 'true' };\n  }\n\n  async getMaintenanceMode(): Promise<boolean> {\n    const setting = await this.getSetting('maintenance_mode');\n    return setting?.value === 'true';\n  }\n\n  async setMaintenanceMode(isActive: boolean): Promise<void> {\n    await this.setSetting('maintenance_mode', isActive.toString());\n  }\n\n  // Newsletter functions\n  async createNewsletterSubscriber(email: string, confirmationToken: string): Promise<NewsletterSubscriber> {\n    const [subscriber] = await db.insert(newsletterSubscribers)\n      .values({\n        email: email.toLowerCase(),\n        confirmationToken,\n        status: 'pending',\n      })\n      .returning();\n    return subscriber!;\n  }\n\n  async getNewsletterSubscriberByEmail(email: string): Promise<NewsletterSubscriber | undefined> {\n    const [subscriber] = await db.select()\n      .from(newsletterSubscribers)\n      .where(sql`LOWER(${newsletterSubscribers.email}) = LOWER(${email})`)\n      .limit(1);\n    return subscriber;\n  }\n\n  async getNewsletterSubscriberByToken(token: string): Promise<NewsletterSubscriber | undefined> {\n    const [subscriber] = await db.select()\n      .from(newsletterSubscribers)\n      .where(eq(newsletterSubscribers.confirmationToken, token))\n      .limit(1);\n    return subscriber;\n  }\n\n  async confirmNewsletterSubscription(token: string): Promise<boolean> {\n    const subscriber = await this.getNewsletterSubscriberByToken(token);\n    \n    if (!subscriber || subscriber.status === 'confirmed') {\n      return false;\n    }\n\n    await db.update(newsletterSubscribers)\n      .set({\n        status: 'confirmed',\n        confirmedAt: new Date(),\n        confirmationToken: null,\n      })\n      .where(eq(newsletterSubscribers.id, subscriber.id));\n\n    return true;\n  }\n\n  async unsubscribeNewsletter(email: string): Promise<boolean> {\n    const subscriber = await this.getNewsletterSubscriberByEmail(email);\n    \n    if (!subscriber || subscriber.status === 'unsubscribed') {\n      return false;\n    }\n\n    await db.update(newsletterSubscribers)\n      .set({\n        status: 'unsubscribed',\n        unsubscribedAt: new Date(),\n      })\n      .where(eq(newsletterSubscribers.id, subscriber.id));\n\n    return true;\n  }\n\n  async deleteNewsletterSubscriber(id: number): Promise<boolean> {\n    const result = await db.delete(newsletterSubscribers)\n      .where(eq(newsletterSubscribers.id, id))\n      .returning();\n    \n    return result.length > 0;\n  }\n\n  async getAllNewsletterSubscribers(): Promise<NewsletterSubscriber[]> {\n    return await db.select()\n      .from(newsletterSubscribers)\n      .orderBy(desc(newsletterSubscribers.subscribedAt));\n  }\n\n  async getConfirmedNewsletterSubscribers(): Promise<NewsletterSubscriber[]> {\n    return await db.select()\n      .from(newsletterSubscribers)\n      .where(eq(newsletterSubscribers.status, 'confirmed'))\n      .orderBy(desc(newsletterSubscribers.confirmedAt));\n  }\n\n  async getNewsletterStats(): Promise<{ total: number; confirmed: number; pending: number }> {\n    const allSubscribers = await db.select()\n      .from(newsletterSubscribers)\n      .where(sql`${newsletterSubscribers.status} != 'unsubscribed'`);\n\n    const total = allSubscribers.length;\n    const confirmed = allSubscribers.filter(s => s.status === 'confirmed').length;\n    const pending = allSubscribers.filter(s => s.status === 'pending').length;\n\n    return { total, confirmed, pending };\n  }\n\n  // Video Spots\n  async getVideoSpots(): Promise<VideoSpot[]> {\n    return await db\n      .select()\n      .from(videoSpots)\n      .orderBy(videoSpots.order, desc(videoSpots.createdAt));\n  }\n\n  async createVideoSpot(data: InsertVideoSpot): Promise<VideoSpot> {\n    const [result] = await db\n      .insert(videoSpots)\n      .values(data)\n      .returning();\n    return result!;\n  }\n\n  async updateVideoSpot(id: number, data: InsertVideoSpot): Promise<VideoSpot> {\n    const [result] = await db\n      .update(videoSpots)\n      .set(data)\n      .where(eq(videoSpots.id, id))\n      .returning();\n    if (!result) throw new Error(\"Video spot not found\");\n    return result;\n  }\n\n  async deleteVideoSpot(id: number): Promise<void> {\n    await db.delete(videoSpots).where(eq(videoSpots.id, id));\n  }\n\n  async updateVideoSpotOrder(id: number, order: number): Promise<VideoSpot> {\n    const [result] = await db\n      .update(videoSpots)\n      .set({ order })\n      .where(eq(videoSpots.id, id))\n      .returning();\n    if (!result) throw new Error(\"Video spot not found\");\n    return result;\n  }\n\n  // User Songs\n  async createUserSong(data: { userId: number; songTitle: string; artistName: string; youtubeUrl: string }): Promise<UserSong> {\n    const [result] = await db\n      .insert(userSongs)\n      .values({\n        userId: data.userId,\n        songTitle: data.songTitle,\n        artistName: data.artistName,\n        youtubeUrl: data.youtubeUrl,\n      })\n      .returning();\n    return result!;\n  }\n\n  async getUserSongById(id: number): Promise<UserSong | undefined> {\n    const [result] = await db\n      .select()\n      .from(userSongs)\n      .where(eq(userSongs.id, id));\n    return result || undefined;\n  }\n\n  async getUserSongs(userId: number): Promise<UserSong[]> {\n    return await db\n      .select()\n      .from(userSongs)\n      .where(eq(userSongs.userId, userId))\n      .orderBy(desc(userSongs.submittedAt));\n  }\n\n  async getAllUserSongs(): Promise<Array<UserSong & { username: string }>> {\n    const results = await db\n      .select({\n        id: userSongs.id,\n        userId: userSongs.userId,\n        songTitle: userSongs.songTitle,\n        artistName: userSongs.artistName,\n        youtubeUrl: userSongs.youtubeUrl,\n        submittedAt: userSongs.submittedAt,\n        approved: userSongs.approved,\n        votesCount: userSongs.votesCount,\n        username: users.username,\n      })\n      .from(userSongs)\n      .leftJoin(users, eq(userSongs.userId, users.id))\n      .orderBy(desc(userSongs.submittedAt));\n    \n    return results.map(r => ({\n      ...r,\n      username: r.username || 'Unknown',\n    }));\n  }\n\n  async deleteUserSong(id: number): Promise<void> {\n    await db.delete(userSongs).where(eq(userSongs.id, id));\n  }\n\n  async approveUserSong(id: number): Promise<void> {\n    await db\n      .update(userSongs)\n      .set({ approved: true })\n      .where(eq(userSongs.id, id));\n  }\n\n  async getUserLastSongSubmissionTime(userId: number): Promise<Date | null> {\n    const [result] = await db\n      .select({ submittedAt: userSongs.submittedAt })\n      .from(userSongs)\n      .where(eq(userSongs.userId, userId))\n      .orderBy(desc(userSongs.submittedAt))\n      .limit(1);\n    \n    if (!result?.submittedAt) {\n      return null;\n    }\n    \n    return new Date(result.submittedAt);\n  }\n\n  async getApprovedUserSongs(userId?: number): Promise<Array<UserSong & { username: string; hasVoted: boolean }>> {\n    const results = await db\n      .select({\n        id: userSongs.id,\n        userId: userSongs.userId,\n        songTitle: userSongs.songTitle,\n        artistName: userSongs.artistName,\n        youtubeUrl: userSongs.youtubeUrl,\n        submittedAt: userSongs.submittedAt,\n        approved: userSongs.approved,\n        votesCount: userSongs.votesCount,\n        username: users.username,\n        voteId: userId ? userSongVotes.id : sql<number | null>`NULL`,\n      })\n      .from(userSongs)\n      .leftJoin(users, eq(userSongs.userId, users.id))\n      .leftJoin(\n        userSongVotes,\n        userId \n          ? and(eq(userSongVotes.songId, userSongs.id), eq(userSongVotes.userId, userId))\n          : sql`false`\n      )\n      .where(eq(userSongs.approved, true))\n      .orderBy(desc(userSongs.votesCount), desc(userSongs.submittedAt));\n    \n    return results.map(r => ({\n      id: r.id,\n      userId: r.userId,\n      songTitle: r.songTitle,\n      artistName: r.artistName,\n      youtubeUrl: r.youtubeUrl,\n      submittedAt: r.submittedAt,\n      approved: r.approved,\n      votesCount: r.votesCount,\n      username: r.username || \"Unknown\",\n      hasVoted: r.voteId !== null,\n    }));\n  }\n\n  async toggleUserSongVote(userId: number, songId: number): Promise<{ voted: boolean; votesCount: number }> {\n    return await db.transaction(async (tx) => {\n      // Check if user has already voted\n      const [existingVote] = await tx\n        .select()\n        .from(userSongVotes)\n        .where(and(eq(userSongVotes.userId, userId), eq(userSongVotes.songId, songId)));\n      \n      if (existingVote) {\n        // Remove vote (atomic decrement)\n        await tx\n          .delete(userSongVotes)\n          .where(eq(userSongVotes.id, existingVote.id));\n        \n        await tx\n          .update(userSongs)\n          .set({ votesCount: sql`${userSongs.votesCount} - 1` })\n          .where(eq(userSongs.id, songId));\n        \n        const [updated] = await tx\n          .select({ votesCount: userSongs.votesCount })\n          .from(userSongs)\n          .where(eq(userSongs.id, songId));\n        \n        return { voted: false, votesCount: updated?.votesCount || 0 };\n      } else {\n        // Add vote (atomic increment)\n        await tx\n          .insert(userSongVotes)\n          .values({ userId, songId });\n        \n        await tx\n          .update(userSongs)\n          .set({ votesCount: sql`${userSongs.votesCount} + 1` })\n          .where(eq(userSongs.id, songId));\n        \n        const [updated] = await tx\n          .select({ votesCount: userSongs.votesCount })\n          .from(userSongs)\n          .where(eq(userSongs.id, songId));\n        \n        return { voted: true, votesCount: updated?.votesCount || 1 };\n      }\n    });\n  }\n\n  async hasUserVotedForSong(userId: number, songId: number): Promise<boolean> {\n    const [result] = await db\n      .select()\n      .from(userSongVotes)\n      .where(and(eq(userSongVotes.userId, userId), eq(userSongVotes.songId, songId)));\n    \n    return !!result;\n  }\n\n  // Admin methods\n  async getAdminStats(): Promise<{\n    totalUsers: number;\n    totalProjects: number;\n    totalVotes: number;\n    totalComments: number;\n  }> {\n    const [userCount] = await db.select({ count: sql<number>`count(*)` }).from(users);\n    const [projectCount] = await db.select({ count: sql<number>`count(*)` }).from(projects);\n    const [voteCount] = await db.select({ count: sql<number>`count(*)` }).from(votes);\n    const [commentCount] = await db.select({ count: sql<number>`count(*)` }).from(comments);\n    \n    return {\n      totalUsers: Number(userCount?.count ?? 0),\n      totalProjects: Number(projectCount?.count ?? 0),\n      totalVotes: Number(voteCount?.count ?? 0),\n      totalComments: Number(commentCount?.count ?? 0),\n    };\n  }\n\n  async toggleAdminRole(userId: number): Promise<void> {\n    const [user] = await db.select().from(users).where(eq(users.id, userId));\n    if (!user) throw new Error(\"User not found\");\n    \n    const newRole = user.role === 'admin' ? 'user' : 'admin';\n    await db.update(users).set({ role: newRole }).where(eq(users.id, userId));\n  }\n\n  // Messaging methods\n  async searchUsers(query: string, currentUserId: number): Promise<Array<{ id: number; username: string; email: string }>> {\n    const results = await db\n      .select({\n        id: users.id,\n        username: users.username,\n        email: users.email,\n      })\n      .from(users)\n      .where(\n        and(\n          sql`LOWER(${users.username}) LIKE LOWER(${`%${query}%`})`,\n          sql`${users.id} != ${currentUserId}`,\n          eq(users.banned, false),\n          eq(users.emailVerified, true)\n        )\n      )\n      .limit(10);\n    return results;\n  }\n\n  async getOrCreateConversation(user1Id: number, user2Id: number): Promise<Conversation> {\n    const existing = await this.getConversation(user1Id, user2Id);\n    if (existing) return existing;\n\n    const [canonicalUser1, canonicalUser2] = user1Id < user2Id ? [user1Id, user2Id] : [user2Id, user1Id];\n    \n    const [conversation] = await db\n      .insert(conversations)\n      .values({ user1Id: canonicalUser1, user2Id: canonicalUser2 })\n      .returning();\n    return conversation!;\n  }\n\n  async getConversation(user1Id: number, user2Id: number): Promise<Conversation | undefined> {\n    const [canonicalUser1, canonicalUser2] = user1Id < user2Id ? [user1Id, user2Id] : [user2Id, user1Id];\n    \n    const [conversation] = await db\n      .select()\n      .from(conversations)\n      .where(\n        and(\n          eq(conversations.user1Id, canonicalUser1),\n          eq(conversations.user2Id, canonicalUser2)\n        )\n      );\n    return conversation || undefined;\n  }\n\n  async getUserConversations(userId: number): Promise<Array<Conversation & { otherUser: { id: number; username: string; avatarUrl: string | null }; lastMessage?: Message; unreadCount: number }>> {\n    const userConvos = await db\n      .select()\n      .from(conversations)\n      .where(\n        sql`${conversations.user1Id} = ${userId} OR ${conversations.user2Id} = ${userId}`\n      )\n      .orderBy(desc(conversations.lastMessageAt));\n\n    const results = await Promise.all(\n      userConvos.map(async (convo) => {\n        const otherUserId = convo.user1Id === userId ? convo.user2Id : convo.user1Id;\n        const [otherUser] = await db\n          .select({ id: users.id, username: users.username, avatarUrl: users.avatarUrl })\n          .from(users)\n          .where(eq(users.id, otherUserId));\n\n        const [lastMsg] = await db\n          .select()\n          .from(messages)\n          .where(eq(messages.conversationId, convo.id))\n          .orderBy(desc(messages.createdAt))\n          .limit(1);\n\n        const unreadMsgs = await db\n          .select({ count: sql<number>`count(*)` })\n          .from(messages)\n          .leftJoin(\n            messageReads,\n            and(\n              eq(messageReads.messageId, messages.id),\n              eq(messageReads.userId, userId)\n            )\n          )\n          .where(\n            and(\n              eq(messages.conversationId, convo.id),\n              sql`${messages.receiverId} = ${userId}`,\n              sql`${messageReads.id} IS NULL`\n            )\n          );\n\n        return {\n          ...convo,\n          otherUser: otherUser!,\n          lastMessage: lastMsg || undefined,\n          unreadCount: Number(unreadMsgs[0]?.count ?? 0),\n        };\n      })\n    );\n\n    return results;\n  }\n\n  async sendMessage(senderId: number, receiverId: number, content: string, imageUrl?: string): Promise<Message> {\n    const conversation = await this.getOrCreateConversation(senderId, receiverId);\n\n    const [message] = await db\n      .insert(messages)\n      .values({\n        conversationId: conversation.id,\n        senderId,\n        receiverId,\n        content,\n        imageUrl,\n      })\n      .returning();\n\n    await db\n      .update(conversations)\n      .set({ lastMessageAt: new Date() })\n      .where(eq(conversations.id, conversation.id));\n\n    return message!;\n  }\n\n  async getMessageById(messageId: number): Promise<Message | undefined> {\n    const [message] = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.id, messageId));\n    \n    return message || undefined;\n  }\n\n  async getConversationMessages(conversationId: number, userId: number): Promise<Message[]> {\n    const msgs = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.conversationId, conversationId))\n      .orderBy(messages.createdAt);\n\n    return msgs;\n  }\n\n  async markMessagesAsRead(conversationId: number, userId: number): Promise<void> {\n    const unreadMessages = await db\n      .select({ id: messages.id })\n      .from(messages)\n      .leftJoin(\n        messageReads,\n        and(\n          eq(messageReads.messageId, messages.id),\n          eq(messageReads.userId, userId)\n        )\n      )\n      .where(\n        and(\n          eq(messages.conversationId, conversationId),\n          eq(messages.receiverId, userId),\n          sql`${messageReads.id} IS NULL`\n        )\n      );\n\n    for (const msg of unreadMessages) {\n      await db.insert(messageReads).values({\n        messageId: msg.id,\n        userId,\n      });\n    }\n  }\n\n  async getUnreadMessageCount(userId: number): Promise<number> {\n    const [result] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(messages)\n      .leftJoin(\n        messageReads,\n        and(\n          eq(messageReads.messageId, messages.id),\n          eq(messageReads.userId, userId)\n        )\n      )\n      .where(\n        and(\n          eq(messages.receiverId, userId),\n          sql`${messageReads.id} IS NULL`\n        )\n      );\n\n    return Number(result?.count ?? 0);\n  }\n\n  async deleteMessage(messageId: number, userId: number): Promise<boolean> {\n    const [message] = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.id, messageId));\n\n    if (!message || message.senderId !== userId) {\n      return false;\n    }\n\n    await db\n      .update(messages)\n      .set({ deleted: true })\n      .where(eq(messages.id, messageId));\n\n    return true;\n  }\n\n  async adminGetAllConversations(): Promise<Array<{ id: number; user1Id: number; user2Id: number; user1Username: string; user2Username: string; user1AvatarUrl: string | null; user2AvatarUrl: string | null; messageCount: number; lastMessageAt: Date | null; lastMessageContent: string | null; lastMessageSenderUsername: string | null; lastMessageDeleted: boolean }>> {\n    const allConvos = await db\n      .select()\n      .from(conversations)\n      .orderBy(desc(conversations.lastMessageAt));\n\n    const results = await Promise.all(\n      allConvos.map(async (convo) => {\n        const [user1] = await db\n          .select({ id: users.id, username: users.username, avatarUrl: users.avatarUrl })\n          .from(users)\n          .where(eq(users.id, convo.user1Id));\n\n        const [user2] = await db\n          .select({ id: users.id, username: users.username, avatarUrl: users.avatarUrl })\n          .from(users)\n          .where(eq(users.id, convo.user2Id));\n\n        const [msgCount] = await db\n          .select({ count: sql<number>`count(*)` })\n          .from(messages)\n          .where(eq(messages.conversationId, convo.id));\n\n        // Get last message with sender info\n        const [lastMsg] = await db\n          .select({\n            content: messages.content,\n            senderId: messages.senderId,\n            deleted: messages.deleted,\n          })\n          .from(messages)\n          .where(eq(messages.conversationId, convo.id))\n          .orderBy(desc(messages.createdAt))\n          .limit(1);\n\n        let lastMessageSenderUsername: string | null = null;\n        if (lastMsg) {\n          const [sender] = await db\n            .select({ username: users.username })\n            .from(users)\n            .where(eq(users.id, lastMsg.senderId));\n          lastMessageSenderUsername = sender?.username || null;\n        }\n\n        return {\n          id: convo.id,\n          user1Id: convo.user1Id,\n          user2Id: convo.user2Id,\n          user1Username: user1?.username || 'Unknown',\n          user2Username: user2?.username || 'Unknown',\n          user1AvatarUrl: user1?.avatarUrl || null,\n          user2AvatarUrl: user2?.avatarUrl || null,\n          messageCount: Number(msgCount?.count ?? 0),\n          lastMessageAt: convo.lastMessageAt,\n          lastMessageContent: lastMsg?.content || null,\n          lastMessageSenderUsername,\n          lastMessageDeleted: lastMsg?.deleted || false,\n        };\n      })\n    );\n\n    return results;\n  }\n\n  async adminGetConversationMessages(user1Id: number, user2Id: number): Promise<Message[]> {\n    const conversation = await this.getConversation(user1Id, user2Id);\n    if (!conversation) return [];\n\n    const msgs = await db\n      .select({\n        id: messages.id,\n        conversationId: messages.conversationId,\n        senderId: messages.senderId,\n        receiverId: messages.receiverId,\n        content: messages.content,\n        imageUrl: messages.imageUrl,\n        createdAt: messages.createdAt,\n        deleted: messages.deleted,\n        senderUsername: users.username,\n      })\n      .from(messages)\n      .leftJoin(users, eq(messages.senderId, users.id))\n      .where(eq(messages.conversationId, conversation.id))\n      .orderBy(messages.createdAt);\n\n    return msgs as any;\n  }\n\n  async adminDeleteMessage(messageId: number): Promise<boolean> {\n    await db\n      .update(messages)\n      .set({ deleted: true })\n      .where(eq(messages.id, messageId));\n    return true;\n  }\n\n  async adminLogConversationView(adminId: number, viewedUser1Id: number, viewedUser2Id: number): Promise<void> {\n    await db.insert(adminMessageAudit).values({\n      adminId,\n      viewedUser1Id,\n      viewedUser2Id,\n    });\n  }\n\n  async adminGetAuditLogs(): Promise<Array<AdminMessageAudit & { adminUsername: string; user1Username: string; user2Username: string }>> {\n    const logs = await db\n      .select({\n        id: adminMessageAudit.id,\n        adminId: adminMessageAudit.adminId,\n        viewedUser1Id: adminMessageAudit.viewedUser1Id,\n        viewedUser2Id: adminMessageAudit.viewedUser2Id,\n        viewedAt: adminMessageAudit.viewedAt,\n      })\n      .from(adminMessageAudit)\n      .orderBy(desc(adminMessageAudit.viewedAt));\n\n    const results = await Promise.all(\n      logs.map(async (log) => {\n        const [admin] = await db\n          .select({ username: users.username })\n          .from(users)\n          .where(eq(users.id, log.adminId));\n\n        const [user1] = await db\n          .select({ username: users.username })\n          .from(users)\n          .where(eq(users.id, log.viewedUser1Id));\n\n        const [user2] = await db\n          .select({ username: users.username })\n          .from(users)\n          .where(eq(users.id, log.viewedUser2Id));\n\n        return {\n          ...log,\n          adminUsername: admin?.username ?? 'Unknown',\n          user1Username: user1?.username ?? 'Unknown',\n          user2Username: user2?.username ?? 'Unknown',\n        };\n      })\n    );\n\n    return results;\n  }\n\n  async adminExportConversation(user1Id: number, user2Id: number): Promise<string> {\n    const [smallerId, largerId] = user1Id < user2Id ? [user1Id, user2Id] : [user2Id, user1Id];\n\n    const conversation = await db\n      .select()\n      .from(conversations)\n      .where(\n        and(\n          eq(conversations.user1Id, smallerId),\n          eq(conversations.user2Id, largerId)\n        )\n      )\n      .limit(1);\n\n    if (!conversation[0]) {\n      throw new Error(\"Conversation not found\");\n    }\n\n    const user1 = await db\n      .select({ username: users.username })\n      .from(users)\n      .where(eq(users.id, user1Id))\n      .limit(1);\n\n    const user2 = await db\n      .select({ username: users.username })\n      .from(users)\n      .where(eq(users.id, user2Id))\n      .limit(1);\n\n    if (!user1[0] || !user2[0]) {\n      throw new Error(\"Users not found\");\n    }\n\n    const msgs = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.conversationId, conversation[0].id))\n      .orderBy(messages.createdAt);\n\n    let txtContent = `Konverzacija izmeƒëu: ${user1[0].username} i ${user2[0].username}\\n`;\n    txtContent += `Datum izvoza: ${new Date().toLocaleString(\"sr-RS\")}\\n`;\n    txtContent += `Ukupno poruka: ${msgs.length}\\n`;\n    txtContent += `\\n${\"=\".repeat(60)}\\n\\n`;\n\n    for (const msg of msgs) {\n      const senderUsername = msg.senderId === user1Id ? user1[0].username : user2[0].username;\n      const timestamp = new Date(msg.createdAt).toLocaleString(\"sr-RS\");\n      const deletedSuffix = msg.deleted ? \" (OBRISANA)\" : \"\";\n      const content = msg.deleted ? \"[Poruka obrisana]\" : msg.content;\n      \n      txtContent += `[${timestamp}] ${senderUsername}: ${content}${deletedSuffix}\\n`;\n    }\n\n    return txtContent;\n  }\n\n  async adminGetMessagingStats(): Promise<{ totalMessages: number; totalConversations: number; deletedMessages: number; activeConversations: number }> {\n    const [totalMessagesResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(messages);\n\n    const [totalConversationsResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(conversations);\n\n    const [deletedMessagesResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(messages)\n      .where(eq(messages.deleted, true));\n\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    const [activeConversationsResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(conversations)\n      .where(sql`${conversations.lastMessageAt} >= ${thirtyDaysAgo}`);\n\n    return {\n      totalMessages: Number(totalMessagesResult?.count ?? 0),\n      totalConversations: Number(totalConversationsResult?.count ?? 0),\n      deletedMessages: Number(deletedMessagesResult?.count ?? 0),\n      activeConversations: Number(activeConversationsResult?.count ?? 0),\n    };\n  }\n\n  // Contracts\n  async createContract(data: InsertContract): Promise<Contract> {\n    const [contract] = await db.insert(contracts).values(data).returning();\n    return contract!;\n  }\n\n  async getAllContracts(): Promise<Array<Contract & { username: string | null }>> {\n    const result = await db\n      .select({\n        id: contracts.id,\n        contractNumber: contracts.contractNumber,\n        contractType: contracts.contractType,\n        contractData: contracts.contractData,\n        pdfPath: contracts.pdfPath,\n        clientEmail: contracts.clientEmail,\n        createdAt: contracts.createdAt,\n        createdBy: contracts.createdBy,\n        userId: contracts.userId,\n        username: users.username,\n      })\n      .from(contracts)\n      .leftJoin(users, eq(contracts.userId, users.id))\n      .orderBy(desc(contracts.createdAt));\n    \n    return result as Array<Contract & { username: string | null }>;\n  }\n\n  async getContractById(id: number): Promise<Contract | undefined> {\n    const [contract] = await db.select().from(contracts).where(eq(contracts.id, id));\n    return contract || undefined;\n  }\n\n  async getNextContractNumber(): Promise<string> {\n    const currentYear = new Date().getFullYear();\n    const yearSuffix = `${currentYear}`;\n    \n    // Get the latest contract for this year (format: NNN/YYYY)\n    const [latestContract] = await db\n      .select()\n      .from(contracts)\n      .where(sql`${contracts.contractNumber} LIKE ${'%/' + yearSuffix}`)\n      .orderBy(desc(contracts.contractNumber))\n      .limit(1);\n\n    if (!latestContract) {\n      return `001/${yearSuffix}`;\n    }\n\n    // Extract number from format \"NNN/YYYY\"\n    const parts = latestContract.contractNumber.split('/');\n    if (parts.length < 2 || !parts[0]) {\n      return `001/${yearSuffix}`;\n    }\n    \n    const lastNumber = parseInt(parts[0]);\n    const nextNumber = lastNumber + 1;\n    \n    return `${nextNumber.toString().padStart(3, '0')}/${yearSuffix}`;\n  }\n\n  async updateContractUser(contractId: number, userId: number | null): Promise<void> {\n    await db.update(contracts).set({ userId }).where(eq(contracts.id, contractId));\n  }\n\n  async deleteContract(id: number): Promise<void> {\n    await db.delete(contracts).where(eq(contracts.id, id));\n  }\n\n  // Get next invoice number\n  async getNextInvoiceNumber(): Promise<string> {\n    const currentYear = new Date().getFullYear();\n    const yearPrefix = `INV-${currentYear}`;\n    \n    // Get the latest invoice for this year (format: INV-YYYY-NNN)\n    const [latestInvoice] = await db\n      .select()\n      .from(invoices)\n      .where(sql`${invoices.invoiceNumber} LIKE ${yearPrefix + '-%'}`)\n      .orderBy(desc(invoices.invoiceNumber))\n      .limit(1);\n\n    if (!latestInvoice) {\n      return `${yearPrefix}-001`;\n    }\n\n    // Extract number from format \"INV-YYYY-NNN\"\n    const parts = latestInvoice.invoiceNumber.split('-');\n    if (parts.length < 3 || !parts[2]) {\n      return `${yearPrefix}-001`;\n    }\n    \n    const lastNumber = parseInt(parts[2]);\n    const nextNumber = lastNumber + 1;\n    \n    return `${yearPrefix}-${nextNumber.toString().padStart(3, '0')}`;\n  }\n\n  // Invoices\n  async createInvoice(data: InsertInvoice): Promise<Invoice> {\n    // Generate invoice number if not provided\n    const invoiceNumber = data.invoiceNumber || await this.getNextInvoiceNumber();\n    \n    // Convert amount to string for numeric column and dates to Date objects\n    const invoiceData = {\n      ...data,\n      invoiceNumber,\n      amount: typeof data.amount === 'number' ? data.amount.toString() : data.amount,\n      dueDate: typeof data.dueDate === 'string' ? new Date(data.dueDate) : data.dueDate,\n      paidDate: data.paidDate ? (typeof data.paidDate === 'string' ? new Date(data.paidDate) : data.paidDate) : null,\n    };\n    const [invoice] = await db.insert(invoices).values([invoiceData]).returning();\n    if (!invoice) throw new Error(\"Failed to create invoice\");\n    return invoice;\n  }\n\n  async getAllInvoices(): Promise<Invoice[]> {\n    return await db.select().from(invoices).orderBy(desc(invoices.createdAt));\n  }\n\n  async getUserInvoices(userId: number): Promise<Array<Invoice & { contractNumber: string | null; contractType: string | null }>> {\n    const results = await db\n      .select({\n        id: invoices.id,\n        userId: invoices.userId,\n        contractId: invoices.contractId,\n        invoiceNumber: invoices.invoiceNumber,\n        amount: invoices.amount,\n        currency: invoices.currency,\n        status: invoices.status,\n        description: invoices.description,\n        notes: invoices.notes,\n        issuedDate: invoices.issuedDate,\n        dueDate: invoices.dueDate,\n        paidDate: invoices.paidDate,\n        createdAt: invoices.createdAt,\n        createdBy: invoices.createdBy,\n        contractNumber: contracts.contractNumber,\n        contractType: contracts.contractType,\n      })\n      .from(invoices)\n      .leftJoin(contracts, eq(invoices.contractId, contracts.id))\n      .where(eq(invoices.userId, userId))\n      .orderBy(desc(invoices.dueDate));\n    \n    return results.map(r => ({\n      id: r.id,\n      userId: r.userId,\n      contractId: r.contractId,\n      invoiceNumber: r.invoiceNumber,\n      amount: r.amount,\n      currency: r.currency,\n      status: r.status,\n      description: r.description,\n      notes: r.notes,\n      issuedDate: r.issuedDate,\n      dueDate: r.dueDate,\n      paidDate: r.paidDate,\n      createdAt: r.createdAt,\n      createdBy: r.createdBy,\n      contractNumber: r.contractNumber,\n      contractType: r.contractType,\n    }));\n  }\n\n  async getInvoiceById(id: number): Promise<Invoice | undefined> {\n    const [invoice] = await db.select().from(invoices).where(eq(invoices.id, id));\n    return invoice || undefined;\n  }\n\n  async updateInvoiceStatus(id: number, status: string, paidDate?: Date): Promise<void> {\n    await db\n      .update(invoices)\n      .set({ status: status as any, paidDate: paidDate || null })\n      .where(eq(invoices.id, id));\n  }\n\n  async deleteInvoice(id: number): Promise<void> {\n    await db.delete(invoices).where(eq(invoices.id, id));\n  }\n\n  // Dashboard\n  async getUserProjects(userId: number): Promise<Array<Project & { username: string }>> {\n    const results = await db\n      .select({\n        id: projects.id,\n        userId: projects.userId,\n        title: projects.title,\n        description: projects.description,\n        genre: projects.genre,\n        mp3Url: projects.mp3Url,\n        uploadDate: projects.uploadDate,\n        votesCount: projects.votesCount,\n        currentMonth: projects.currentMonth,\n        approved: projects.approved,\n        status: projects.status,\n        username: users.username,\n      })\n      .from(projects)\n      .leftJoin(users, eq(projects.userId, users.id))\n      .where(eq(projects.userId, userId))\n      .orderBy(desc(projects.uploadDate));\n    \n    return results.map(r => ({\n      id: r.id,\n      userId: r.userId,\n      title: r.title,\n      description: r.description,\n      genre: r.genre,\n      mp3Url: r.mp3Url,\n      uploadDate: r.uploadDate,\n      votesCount: r.votesCount,\n      currentMonth: r.currentMonth,\n      approved: r.approved,\n      status: r.status,\n      username: r.username || \"Unknown\",\n    }));\n  }\n\n  async getUserContracts(userId: number): Promise<Array<Contract & { username: string }>> {\n    // Get user to match contracts by userId or email\n    const user = await this.getUser(userId);\n    if (!user) return [];\n    \n    // Get contracts where:\n    // 1. userId matches directly (preferred), OR\n    // 2. clientEmail matches user's email (fallback for older contracts)\n    const results = await db\n      .select({\n        id: contracts.id,\n        contractNumber: contracts.contractNumber,\n        contractType: contracts.contractType,\n        clientEmail: contracts.clientEmail,\n        userId: contracts.userId,\n        pdfPath: contracts.pdfPath,\n        contractData: contracts.contractData,\n        createdAt: contracts.createdAt,\n        createdBy: contracts.createdBy,\n        username: users.username,\n      })\n      .from(contracts)\n      .leftJoin(users, eq(contracts.clientEmail, users.email))\n      .where(\n        or(\n          eq(contracts.userId, userId),\n          eq(contracts.clientEmail, user.email)\n        )\n      )\n      .orderBy(desc(contracts.createdAt));\n    \n    return results.map(r => ({\n      id: r.id,\n      contractNumber: r.contractNumber,\n      contractType: r.contractType,\n      clientEmail: r.clientEmail,\n      userId: r.userId,\n      pdfPath: r.pdfPath,\n      contractData: r.contractData,\n      createdAt: r.createdAt,\n      createdBy: r.createdBy,\n      username: r.username || \"Unknown\",\n    }));\n  }\n\n  async getDashboardOverview(userId: number): Promise<{\n    totalProjects: number;\n    projectsByStatus: Record<string, number>;\n    totalContracts: number;\n    totalInvoices: number;\n    pendingInvoices: number;\n    overdueInvoices: number;\n    totalAmountPending: string;\n    unreadMessages: number;\n  }> {\n    // Get all user projects\n    const userProjects = await this.getUserProjects(userId);\n    \n    // Count projects by status\n    const projectsByStatus = userProjects.reduce((acc, project) => {\n      const status = project.status || 'waiting';\n      acc[status] = (acc[status] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    // Get user contracts\n    const userContracts = await this.getUserContracts(userId);\n\n    // Get user invoices with dynamic overdue status\n    const userInvoices = await db\n      .select({\n        id: invoices.id,\n        status: invoices.status,\n        amount: invoices.amount,\n        dueDate: invoices.dueDate,\n        isOverdue: sql<boolean>`${invoices.dueDate} < now() AND ${invoices.status} = 'pending'`,\n      })\n      .from(invoices)\n      .where(eq(invoices.userId, userId));\n\n    // Count invoices\n    const pendingInvoices = userInvoices.filter(inv => \n      inv.status === 'pending' && !inv.isOverdue\n    ).length;\n    const overdueInvoices = userInvoices.filter(inv => inv.isOverdue).length;\n\n    // Calculate total amount pending (including overdue)\n    const totalAmountPending = userInvoices\n      .filter(inv => inv.status === 'pending' || inv.isOverdue)\n      .reduce((sum, inv) => sum + parseFloat(inv.amount || '0'), 0)\n      .toFixed(2);\n\n    // Get unread message count\n    const unreadMessages = await this.getUnreadMessageCount(userId);\n\n    return {\n      totalProjects: userProjects.length,\n      projectsByStatus,\n      totalContracts: userContracts.length,\n      totalInvoices: userInvoices.length,\n      pendingInvoices,\n      overdueInvoices,\n      totalAmountPending,\n      unreadMessages,\n    };\n  }\n\n  async updateProjectStatus(projectId: number, status: string): Promise<void> {\n    await db\n      .update(projects)\n      .set({ status: status as any })\n      .where(eq(projects.id, projectId));\n  }\n\n  // Analytics\n  async getNewUsersCount(period: 'today' | 'week' | 'month'): Promise<number> {\n    const now = new Date();\n    let startDate: Date;\n\n    if (period === 'today') {\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    } else if (period === 'week') {\n      const dayOfWeek = now.getDay();\n      const diff = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n      startDate = new Date(now.getTime() - diff * 24 * 60 * 60 * 1000);\n      startDate.setHours(0, 0, 0, 0);\n    } else {\n      startDate = new Date(now.getFullYear(), now.getMonth(), 1);\n    }\n\n    const result = await db\n      .select({ count: sql<number>`count(*)::int` })\n      .from(users)\n      .where(sql`${users.createdAt} >= ${startDate}`);\n\n    return result[0]?.count || 0;\n  }\n\n  async getTopProjects(limit: number): Promise<Array<Project & { username: string; votesCount: number }>> {\n    const result = await db\n      .select({\n        id: projects.id,\n        title: projects.title,\n        description: projects.description,\n        genre: projects.genre,\n        mp3Url: projects.mp3Url,\n        userId: projects.userId,\n        votesCount: projects.votesCount,\n        currentMonth: projects.currentMonth,\n        uploadDate: projects.uploadDate,\n        approved: projects.approved,\n        status: projects.status,\n        username: users.username,\n      })\n      .from(projects)\n      .leftJoin(users, eq(projects.userId, users.id))\n      .orderBy(desc(projects.votesCount))\n      .limit(limit);\n\n    return result.map(r => ({\n      ...r,\n      username: r.username || 'Unknown',\n    }));\n  }\n\n  async getApprovedSongsCount(period: 'today' | 'week' | 'month'): Promise<number> {\n    const now = new Date();\n    let startDate: Date;\n\n    if (period === 'today') {\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    } else if (period === 'week') {\n      const dayOfWeek = now.getDay();\n      const diff = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n      startDate = new Date(now.getTime() - diff * 24 * 60 * 60 * 1000);\n      startDate.setHours(0, 0, 0, 0);\n    } else {\n      startDate = new Date(now.getFullYear(), now.getMonth(), 1);\n    }\n\n    const result = await db\n      .select({ count: sql<number>`count(*)::int` })\n      .from(userSongs)\n      .where(and(\n        eq(userSongs.approved, true),\n        sql`${userSongs.submittedAt} >= ${startDate}`\n      ));\n\n    return result[0]?.count || 0;\n  }\n\n  async getContractStats(): Promise<{ total: number; byType: Record<string, number> }> {\n    const allContracts = await db.select().from(contracts);\n    const total = allContracts.length;\n    \n    const byType: Record<string, number> = {};\n    allContracts.forEach(contract => {\n      const type = contract.contractType || 'unknown';\n      byType[type] = (byType[type] || 0) + 1;\n    });\n\n    return { total, byType };\n  }\n\n  async getUnreadConversationsCount(): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(DISTINCT ${messages.conversationId})::int` })\n      .from(messages)\n      .leftJoin(\n        messageReads,\n        and(\n          eq(messages.id, messageReads.messageId),\n          sql`${messageReads.userId} = ${messages.receiverId}`\n        )\n      )\n      .where(and(\n        eq(messages.deleted, false),\n        sql`${messageReads.id} IS NULL`\n      ));\n\n    return result[0]?.count || 0;\n  }\n\n  // Community Chat\n  async canUserSendMessage(userId: number): Promise<boolean> {\n    try {\n      const [lastMessage] = await db\n        .select()\n        .from(communityMessages)\n        .where(eq(communityMessages.userId, userId))\n        .orderBy(desc(communityMessages.createdAt))\n        .limit(1);\n\n      if (!lastMessage) {\n        return true;\n      }\n\n      const result = await db\n        .select({ \n          canSend: sql<boolean>`NOW() - INTERVAL '10 seconds' >= ${lastMessage.createdAt}` \n        })\n        .from(communityMessages)\n        .limit(1);\n\n      return result[0]?.canSend ?? true;\n    } catch (error) {\n      console.error('Error checking message rate limit:', error);\n      return false;\n    }\n  }\n\n  async createCommunityMessage(userId: number, message: string): Promise<CommunityMessage> {\n    try {\n      const canSend = await this.canUserSendMessage(userId);\n      \n      if (!canSend) {\n        throw new Error('Mo≈æete slati poruke samo jednom na 10 sekundi');\n      }\n\n      const newMessage = await db.transaction(async (tx) => {\n        const [inserted] = await tx\n          .insert(communityMessages)\n          .values({ userId, message })\n          .returning();\n\n        if (!inserted) {\n          throw new Error('Failed to create community message');\n        }\n\n        await tx.execute(sql`\n          DELETE FROM community_messages\n          WHERE id IN (\n            SELECT id FROM community_messages\n            ORDER BY created_at DESC, id DESC\n            OFFSET 20\n          )\n        `);\n\n        return inserted;\n      });\n\n      return newMessage;\n    } catch (error) {\n      if (error instanceof Error) {\n        throw error;\n      }\n      throw new Error('Failed to create community message');\n    }\n  }\n\n  async getCommunityMessages(limit?: number): Promise<Array<CommunityMessage & { username: string; rank: string; avatarUrl: string | null }>> {\n    try {\n      const effectiveLimit = Math.min(limit || 20, 20);\n\n      const results = await db\n        .select({\n          id: communityMessages.id,\n          userId: communityMessages.userId,\n          message: communityMessages.message,\n          createdAt: communityMessages.createdAt,\n          username: users.username,\n          rank: users.rank,\n          avatarUrl: users.avatarUrl,\n        })\n        .from(communityMessages)\n        .leftJoin(users, eq(communityMessages.userId, users.id))\n        .orderBy(desc(communityMessages.createdAt))\n        .limit(effectiveLimit);\n\n      return results.map(r => ({\n        id: r.id,\n        userId: r.userId,\n        message: r.message,\n        createdAt: r.createdAt,\n        username: r.username || 'Unknown',\n        rank: r.rank || 'user',\n        avatarUrl: r.avatarUrl,\n      }));\n    } catch (error) {\n      console.error('Error fetching community messages:', error);\n      return [];\n    }\n  }\n\n  async deleteCommunityMessage(messageId: number, userId: number): Promise<boolean> {\n    try {\n      // Get the message to check ownership\n      const [message] = await db\n        .select()\n        .from(communityMessages)\n        .where(eq(communityMessages.id, messageId));\n\n      if (!message) {\n        return false; // Message not found\n      }\n\n      // Get user to check if admin\n      const user = await this.getUser(userId);\n      if (!user) {\n        return false; // User not found\n      }\n\n      // Check if user is owner or admin\n      const isOwner = message.userId === userId;\n      const isAdmin = user.role === 'admin';\n\n      if (!isOwner && !isAdmin) {\n        return false; // Not authorized\n      }\n\n      // Delete the message\n      const result = await db\n        .delete(communityMessages)\n        .where(eq(communityMessages.id, messageId))\n        .returning();\n\n      return result.length > 0;\n    } catch (error) {\n      console.error('Error deleting community message:', error);\n      return false;\n    }\n  }\n\n  async clearAllCommunityMessages(): Promise<void> {\n    try {\n      await db.delete(communityMessages);\n    } catch (error) {\n      console.error('Error clearing all community messages:', error);\n      throw new Error('Failed to clear all community messages');\n    }\n  }\n\n  async updateUserRank(userId: number, rank: string): Promise<void> {\n    try {\n      const validRanks = ['user', 'vip', 'legend', 'admin'];\n      \n      if (!validRanks.includes(rank)) {\n        throw new Error('Neva≈æeƒái rank');\n      }\n\n      await db\n        .update(users)\n        .set({ rank: rank as any })\n        .where(eq(users.id, userId));\n    } catch (error) {\n      if (error instanceof Error) {\n        throw error;\n      }\n      throw new Error('Failed to update user rank');\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":78137},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    \n    // Try to parse as JSON only if it looks like JSON\n    if (text.trim().startsWith('{') || text.trim().startsWith('[')) {\n      try {\n        const errorData = JSON.parse(text);\n        // If error object has an 'error' property, use that\n        if (errorData.error) {\n          throw new Error(errorData.error);\n        }\n        // If it's an object with message property\n        if (errorData.message) {\n          throw new Error(errorData.message);\n        }\n      } catch (parseError) {\n        // If JSON parsing fails, fall through to use plain text\n      }\n    }\n    \n    // Use plain text (for non-JSON responses or if parsing failed)\n    throw new Error(text);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2016},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/pages/team.tsx":{"content":"import { Users, Instagram, Mic2, Headphones, Video, Zap, Plus, Trash2 } from \"lucide-react\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { motion } from \"framer-motion\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { EditableText } from \"@/components/cms/EditableText\";\nimport { EditableImage } from \"@/components/cms/EditableImage\";\nimport { useEditMode } from \"@/contexts/EditModeContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { SEO } from \"@/components/SEO\";\nimport type { CmsContent } from \"@shared/schema\";\nimport leflowImage from \"@assets/image_1762303735569.png\";\nimport dicviImage from \"@assets/image_1762303783224.png\";\nimport kuleImage from \"@assets/image_1762303820348.png\";\nimport culiImage from \"@assets/image_1762303853641.png\";\n\nexport default function Team() {\n  const { isEditMode } = useEditMode();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const { data: cmsContent = [] } = useQuery<CmsContent[]>({\n    queryKey: [\"/api/cms/content\"],\n    queryFn: () => fetch(\"/api/cms/content\").then(r => r.json()),\n  });\n\n  const getCmsValue = (section: string, key: string, fallback: string = \"\") => {\n    return cmsContent.find(c => c.section === section && c.contentKey === key)?.contentValue || fallback;\n  };\n\n  // Find next available member index\n  const getNextMemberIndex = () => {\n    const memberKeys = cmsContent.filter(c => c.section === \"members\" && c.contentKey.includes(\"_name\"));\n    const memberNumbers = memberKeys.map(k => {\n      const parts = k.contentKey.split(\"_\");\n      return parseInt(parts[1] || \"0\");\n    }).filter(n => !isNaN(n));\n    return memberNumbers.length > 0 ? Math.max(...memberNumbers) + 1 : 5;\n  };\n\n  const addMemberMutation = useMutation({\n    mutationFn: async () => {\n      const nextIndex = getNextMemberIndex();\n      const newMemberData = [\n        { page: \"team\", section: \"members\", contentKey: `member_${nextIndex}_name`, contentValue: \"Novo Ime\" },\n        { page: \"team\", section: \"members\", contentKey: `member_${nextIndex}_role`, contentValue: \"Nova Uloga\" },\n        { page: \"team\", section: \"members\", contentKey: `member_${nextIndex}_description`, contentValue: \"\" },\n        { page: \"team\", section: \"members\", contentKey: `member_${nextIndex}_instagram`, contentValue: \"https://instagram.com/\" },\n      ];\n\n      const response = await fetch(\"/api/cms/content\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(newMemberData),\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Gre≈°ka pri dodavanju ƒçlana\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/cms/content\"] });\n      toast({\n        title: \"Uspe≈°no dodato\",\n        description: \"Novi ƒçlan tima je dodat. Kliknite na tekst da ga izmenite.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri dodavanju ƒçlana\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMemberMutation = useMutation({\n    mutationFn: async (memberIndex: number) => {\n      const response = await fetch(`/api/cms/team-member/${memberIndex}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Gre≈°ka pri brisanju ƒçlana\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/cms/content\"] });\n      toast({\n        title: \"Uspe≈°no obrisano\",\n        description: \"ƒålan tima je obrisan\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri brisanju ƒçlana\",\n        variant: \"destructive\",\n      });\n    },\n  });\n  // Dynamic member loading from CMS\n  const memberImages: Record<number, string> = {\n    1: leflowImage,\n    2: kuleImage,\n    3: dicviImage,\n    4: culiImage\n  };\n\n  const memberAliases: Record<number, string> = {\n    1: \"LeFlow\",\n    2: \"Kule\",\n    3: \"Dicvi\",\n    4: \"Culi\"\n  };\n\n  // Find all unique member indices from CMS\n  const memberIndices = Array.from(new Set(\n    cmsContent\n      .filter(c => c.section === \"members\" && c.contentKey.includes(\"_name\"))\n      .map(c => parseInt(c.contentKey.split(\"_\")[1] || \"0\"))\n      .filter(n => !isNaN(n))\n  )).sort((a, b) => a - b);\n\n  const teamMembers = memberIndices.map(index => {\n    const name = getCmsValue(\"members\", `member_${index}_name`, `ƒålan ${index}`);\n    const role = getCmsValue(\"members\", `member_${index}_role`, \"Team Member\");\n    const description = getCmsValue(\"members\", `member_${index}_description`, \"\");\n    const instagram = getCmsValue(\"members\", `member_${index}_instagram`, \"https://instagram.com/\");\n    \n    // Extract initials from name\n    const nameParts = name.split(\" \");\n    const initials = nameParts.length >= 2 && nameParts[0] && nameParts[1]\n      ? `${nameParts[0][0]}${nameParts[1][0]}`.toUpperCase()\n      : name.substring(0, Math.min(2, name.length)).toUpperCase();\n\n    // Extract Instagram handle from URL\n    const instagramHandle = instagram.includes(\"instagram.com/\")\n      ? \"@\" + instagram.split(\"instagram.com/\")[1]?.replace(\"/\", \"\") || \"@user\"\n      : \"@user\";\n\n    return {\n      name,\n      alias: memberAliases[index] || `Member${index}`,\n      role,\n      positions: description.split(\" ‚Ä¢ \").filter(p => p.trim()),\n      instagram,\n      instagramHandle,\n      initials,\n      image: getCmsValue(\"members\", `member_${index}_image`, memberImages[index] || leflowImage),\n      featured: index === 1,\n      index\n    };\n  });\n\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <SEO\n        title=\"Na≈° Tim - Studio LeFlow | Profesionalni Producenti i In≈æenjeri Zvuka\"\n        description=\"Upoznajte tim Studio LeFlow-a. Aleksa ƒåomor (LeFlow), Matija Kalajd≈æiƒá (Kule), Mihailo Vidiƒá (Dicvi), Aleksandar ƒÜulibrk (Culi). Iskusni producenti, tekstopisci i in≈æenjeri zvuka.\"\n        keywords={[\n          \"tim studio leflow\",\n          \"leflow studio tim\",\n          \"leflow tim\",\n          \"producent muzike beograd\",\n          \"in≈æenjer zvuka beograd\",\n          \"leflow producent\",\n          \"aleksa ƒçomor producent\",\n          \"matija kalajd≈æiƒá\",\n          \"muziƒçki producenti beograd\",\n          \"tekstopisac beograd\",\n          \"najbolji producent beograd\"\n        ]}\n      />\n      <section className=\"py-20 lg:py-32\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n          <div className=\"text-center mb-16\">\n            <div className=\"mb-6 inline-flex items-center gap-2 flex-wrap px-4 py-2 rounded-full bg-primary/10 border border-primary/20\">\n              <Users className=\"w-4 h-4 text-primary\" />\n              <span className=\"text-sm font-medium text-primary\">Upoznajte Nas</span>\n            </div>\n            \n            <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold mb-6 tracking-tight font-[Montserrat]\" data-testid=\"text-team-title\">\n              Na≈° Tim\n            </h1>\n            \n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Kreativni tim profesionalaca posveƒáenih izvrsnosti u muziƒçkoj i video produkciji\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto\">\n            {teamMembers.map((member, mapIndex) => (\n              <FadeInWhenVisible \n                key={member.index}\n                delay={mapIndex * 0.15}\n                className={member.featured ? 'md:col-span-2' : ''}\n              >\n                <motion.div\n                  whileHover={{ y: -8, scale: 1.02 }}\n                  transition={{ duration: 0.3 }}\n                >\n                  <Card \n                    className=\"overflow-visible h-full hover-elevate active-elevate-2 cursor-pointer\"\n                    data-testid={`card-team-${member.alias.toLowerCase()}`}\n                  >\n                <CardHeader className=\"flex flex-row items-start justify-between gap-4 flex-wrap space-y-0 pb-4\">\n                  <div className=\"flex items-start gap-4 flex-wrap flex-1\">\n                    {isEditMode ? (\n                      <EditableImage\n                        page=\"team\"\n                        section=\"members\"\n                        contentKey={`member_${member.index}_image`}\n                        currentImageUrl={getCmsValue(\"members\", `member_${member.index}_image`, \"\")}\n                        fallbackSrc={member.image}\n                        alt={member.name}\n                        className=\"w-16 h-16 rounded-full border-2 border-primary/20 object-cover\"\n                        containerClassName=\"w-16 h-16 flex-shrink-0\"\n                      />\n                    ) : (\n                      <Avatar className=\"w-16 h-16 border-2 border-primary/20\">\n                        <AvatarImage src={member.image} alt={member.name} />\n                        <AvatarFallback className=\"bg-primary/10 text-primary text-lg font-bold\">\n                          {member.initials}\n                        </AvatarFallback>\n                      </Avatar>\n                    )}\n                    \n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-3 mb-2 flex-wrap\">\n                        <EditableText\n                          page=\"team\"\n                          section=\"members\"\n                          contentKey={`member_${member.index}_name`}\n                          value={member.name}\n                          as=\"h3\"\n                          className=\"text-2xl font-bold\"\n                        />\n                        <Badge variant=\"secondary\" className=\"text-sm\" data-testid={`badge-alias-${member.alias.toLowerCase()}`}>\n                          {member.alias}\n                        </Badge>\n                      </div>\n                      \n                      <EditableText\n                        page=\"team\"\n                        section=\"members\"\n                        contentKey={`member_${member.index}_role`}\n                        value={member.role}\n                        as=\"p\"\n                        className=\"text-primary font-semibold mb-1\"\n                      />\n                      \n                      {member.positions.length > 0 && (\n                        <p className=\"text-sm text-muted-foreground\" data-testid={`text-positions-${member.alias.toLowerCase()}`}>\n                          {member.positions.join(\" ‚Ä¢ \")}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex gap-2 items-start\">\n                    {isEditMode && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => {\n                          if (confirm(`Da li ste sigurni da ≈æelite da obri≈°ete ƒçlana \"${member.name}\"?`)) {\n                            deleteMemberMutation.mutate(member.index);\n                          }\n                        }}\n                        disabled={deleteMemberMutation.isPending}\n                        className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    )}\n                    \n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      asChild\n                    >\n                      <a \n                        href={member.instagram}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"flex items-center gap-2 flex-wrap\"\n                        data-testid={`link-instagram-${member.alias.toLowerCase()}`}\n                      >\n                        <motion.div\n                          whileHover={{ scale: 1.2, rotate: 5 }}\n                          transition={{ type: \"spring\", stiffness: 400, damping: 10 }}\n                        >\n                          <Instagram className=\"w-4 h-4\" />\n                        </motion.div>\n                        <span className=\"hidden sm:inline text-sm\">{member.instagramHandle}</span>\n                      </a>\n                    </Button>\n                  </div>\n                </CardHeader>\n                  </Card>\n                </motion.div>\n              </FadeInWhenVisible>\n            ))}\n            \n            {isEditMode && (\n              <FadeInWhenVisible delay={teamMembers.length * 0.15} className=\"md:col-span-2\">\n                <Button\n                  onClick={() => addMemberMutation.mutate()}\n                  disabled={addMemberMutation.isPending}\n                  className=\"w-full h-full min-h-[120px] border-2 border-dashed border-primary/30 bg-primary/5 hover:bg-primary/10 transition-colors\"\n                  variant=\"outline\"\n                >\n                  <div className=\"flex flex-col items-center gap-2\">\n                    <Plus className=\"w-8 h-8 text-primary\" />\n                    <span className=\"text-lg font-semibold\">Dodaj Novog ƒålana Tima</span>\n                  </div>\n                </Button>\n              </FadeInWhenVisible>\n            )}\n          </div>\n\n          <div className=\"mt-20 text-center\">\n            <Card className=\"max-w-3xl mx-auto bg-primary/5 border-primary/20 hover-elevate\">\n              <CardContent className=\"p-8\">\n                <h2 className=\"text-2xl font-bold mb-4\">Pridru≈æite Se Na≈°oj Kreativnoj Porodici</h2>\n                <p className=\"text-muted-foreground mb-6\">\n                  Radimo sa talentovanim artistima iz cele Srbije i regiona. Va≈°a vizija, na≈°a ekspertiza.\n                </p>\n                <div className=\"flex flex-wrap gap-3 justify-center text-sm\">\n                  <Badge variant=\"outline\">\n                    <Mic2 className=\"w-3 h-3 mr-1.5\" />\n                    Profesionalan pristup\n                  </Badge>\n                  <Badge variant=\"outline\">\n                    <Headphones className=\"w-3 h-3 mr-1.5\" />\n                    Vrhunska oprema\n                  </Badge>\n                  <Badge variant=\"outline\">\n                    <Video className=\"w-3 h-3 mr-1.5\" />\n                    Kompletna produkcija\n                  </Badge>\n                  <Badge variant=\"outline\">\n                    <Zap className=\"w-3 h-3 mr-1.5\" />\n                    Brza realizacija\n                  </Badge>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":15177},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/cms/EditableText.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useEditMode } from \"@/contexts/EditModeContext\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Edit2, Check, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface EditableTextProps {\n  page: string;\n  section: string;\n  contentKey: string;\n  value: string;\n  className?: string;\n  as?: \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"h5\" | \"h6\" | \"p\" | \"span\";\n  multiline?: boolean;\n  placeholder?: string;\n}\n\nexport function EditableText({\n  page,\n  section,\n  contentKey,\n  value,\n  className = \"\",\n  as: Tag = \"p\",\n  multiline = false,\n  placeholder = \"Kliknite da izmenite tekst...\"\n}: EditableTextProps) {\n  const { isEditMode } = useEditMode();\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(value);\n  const inputRef = useRef<HTMLInputElement | HTMLTextAreaElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  useEffect(() => {\n    setEditValue(value);\n  }, [value]);\n\n  useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [isEditing]);\n\n  const updateMutation = useMutation({\n    mutationFn: async (newValue: string) => {\n      const response = await fetch(\"/api/cms/content/single\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          page,\n          section,\n          contentKey,\n          contentValue: newValue,\n        }),\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Gre≈°ka pri ƒçuvanju izmena\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/cms/content`] });\n      toast({\n        title: \"Saƒçuvano\",\n        description: \"Izmene su uspe≈°no saƒçuvane\",\n      });\n      setIsEditing(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Do≈°lo je do gre≈°ke pri ƒçuvanju izmena\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    if (editValue.trim() === \"\") {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Tekst ne mo≈æe biti prazan\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    updateMutation.mutate(editValue);\n  };\n\n  const handleCancel = () => {\n    setEditValue(value);\n    setIsEditing(false);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !multiline) {\n      e.preventDefault();\n      handleSave();\n    } else if (e.key === \"Escape\") {\n      handleCancel();\n    }\n  };\n\n  if (!isEditMode) {\n    return <Tag className={className}>{value}</Tag>;\n  }\n\n  if (isEditing) {\n    return (\n      <div className=\"relative group\">\n        {multiline ? (\n          <textarea\n            ref={inputRef as React.RefObject<HTMLTextAreaElement>}\n            value={editValue}\n            onChange={(e) => setEditValue(e.target.value)}\n            onKeyDown={handleKeyDown}\n            className={`${className} w-full border-2 border-primary rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-primary min-h-[100px]`}\n            placeholder={placeholder}\n          />\n        ) : (\n          <input\n            ref={inputRef as React.RefObject<HTMLInputElement>}\n            type=\"text\"\n            value={editValue}\n            onChange={(e) => setEditValue(e.target.value)}\n            onKeyDown={handleKeyDown}\n            className={`${className} w-full border-2 border-primary rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-primary`}\n            placeholder={placeholder}\n          />\n        )}\n        <div className=\"flex gap-2 mt-2\">\n          <Button\n            size=\"sm\"\n            onClick={handleSave}\n            disabled={updateMutation.isPending}\n            className=\"gap-1\"\n          >\n            <Check className=\"w-4 h-4\" />\n            Saƒçuvaj\n          </Button>\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={handleCancel}\n            disabled={updateMutation.isPending}\n            className=\"gap-1\"\n          >\n            <X className=\"w-4 h-4\" />\n            Otka≈æi\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"relative group cursor-pointer hover:bg-primary/5 rounded-lg transition-colors p-2 -m-2\"\n      onClick={() => setIsEditing(true)}\n    >\n      <Tag className={className}>{value || placeholder}</Tag>\n      <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n        <div className=\"bg-primary text-primary-foreground rounded-md p-1\">\n          <Edit2 className=\"w-3 h-3\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4911},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"replit.md":{"content":"# Studio LeFlow - Music Production Studio Website\n\n## Overview\nStudio LeFlow is a professional music production studio in Belgrade, Serbia, offering comprehensive music production services including recording, mixing/mastering, instrumental production, and complete song creation. The project aims to establish a dynamic online presence to showcase services, engage users through project giveaways, and provide robust content management for administrators. The ambition is to expand market reach and user base through an interactive and modern website, reaching a broader audience and increasing user engagement.\n\n## User Preferences\nI want iterative development. Ask before making major changes. I prefer detailed explanations.\n\n## System Architecture\n\n### UI/UX Decisions\nThe website features a modern, responsive design using Tailwind CSS and shadcn/ui components, enhanced by Framer Motion for animations. It incorporates the Studio LeFlow transparent emblem logo with automatic color inversion for dark/light themes. SEO optimization is a key focus, including dynamic meta tags, Open Graph tags, structured data, sitemap, robots.txt, and geo-tags. The UI is primarily in Serbian.\n\n### Technical Implementations\n**Frontend:** React 18 with TypeScript, Vite, Tailwind CSS + shadcn/ui, Framer Motion, Wouter for routing, TanStack Query for server state management, React Hook Form + Zod for form validation.\n**Backend:** Express.js with TypeScript, Drizzle ORM (PostgreSQL), Passport.js for authentication, Express Session.\n**Features:**\n- **CMS Content Management**: Inline editing for text, image uploads, and team member management.\n- **User Authentication**: Email/password authentication with verification, including 2FA for admin login.\n- **Real-Time Messaging System**: Full-featured messaging with real-time updates, admin oversight, and legal compliance.\n- **Project Giveaways**: Monthly project uploads, voting system, and admin approval with audio preview.\n- **Portfolio (Projekti Page)**: Showcase studio work with YouTube embeds.\n- **Contact Form**: Direct email notifications.\n- **File Uploads**: MP3 files for projects, images for CMS and user avatars.\n- **Admin Panel**: Comprehensive management for users, project approvals, portfolio, CMS editing, newsletter subscribers, and maintenance mode. Includes messaging oversight and audit logs.\n- **Newsletter System**: Double opt-in email confirmation with admin management and campaign sending.\n- **Password Management**: Secure forgot/reset password flows.\n- **Maintenance Mode**: Site-wide control for administrators.\n- **Content Protection**: Three-layer protection on all images and logos.\n- **Google Search SEO & Favicon Optimization**: Comprehensive SEO improvements.\n- **User Profile Pictures**: Avatar management with upload, deletion, and dynamic initials display.\n- **Contract Builder System**: Generates three types of contracts (Mix & Master, Copyright Transfer, Instrumental Sale) with PDF features like DejaVu Sans font support for Serbian characters, Studio LeFlow logo, automatic numbering, and storage. Admin panel features include contract generation via form, preview, download, email sending, deletion, history tracking, and **user assignment with async search** (admins can assign/unassign contracts to users using a searchable Command/Combobox interface with debouncing, loading states, and keyboard navigation; users then see assigned contracts in their dashboard).\n- **User Song Sharing & Voting (Zajednica)**: Public community page (/zajednica) where users can share their favorite songs via YouTube links. Features include admin approval workflow, community voting system with atomic vote tracking, unique vote constraints (one vote per user per song), vote count display, and songs sorted by popularity. Only verified users can vote.\n- **4-Tier Rank System & Community Chat**: Cosmetic rank system (User, VIP, Legend, Admin) with colored usernames and badge icons. Global community chat with real-time WebSocket updates, 10-second rate limiting, auto-scroll, delete authorization (owner + admin), and admin rank control. Chat features countdown timer, form auto-reset after sending, unconditional query synchronization, and **automatic message limit (max 20 messages)** with atomic cleanup to prevent race conditions. Integrated in /zajednica page for real-time community engagement.\n- **Progressive Web App (PWA)**: Full PWA support for iOS and Android devices. Features include installable app experience via \"Add to Home Screen\", offline support with service worker caching, standalone display mode (full-screen without browser UI), auto-updating content, iOS-specific install prompt with clear instructions, and manifest with app icons and branding. Users can access Studio LeFlow as a native-like app without downloading from App Store.\n\n### System Design Choices\n- **Database**: PostgreSQL managed by Replit, utilizing Drizzle ORM for schema management.\n- **Performance**: Optimized for Core Web Vitals (LCP) through lazy loading, prioritized image fetching, async font loading, server compression, and Vite build optimizations.\n  - **Vite Build Configuration**: Uses `splitVendorChunkPlugin()` with `modulePreload: { polyfill: true }` to ensure proper chunk loading order and prevent React initialization errors. Vendor bundle optimized to ~446KB (down from 1.1MB).\n  - **Bundle Analysis**: Integrated `rollup-plugin-visualizer` for ongoing performance monitoring.\n  - **CSS Page Transitions**: Replaced Framer Motion AnimatePresence in App.tsx with lightweight `.page-transition` CSS class (fade-in animation) for improved performance and accessibility (prefers-reduced-motion support).\n  - **TipTap Lazy Loading**: RichTextEditor component (TipTap) lazy loaded with React.lazy() and Suspense in admin panel. Reduced admin bundle from 455KB ‚Üí 99KB (78% reduction). TipTap now loads in separate 356KB chunk only when admin opens Newsletter tab.\n  - **Asset Optimization**: Removed 90MB of unused images from attached_assets folder (Apollo Twin 18MB, AutoTune 11MB, etc). Folder reduced from 107MB ‚Üí 17MB (84% reduction).\n- **Language**: All UI and content are primarily in Serbian.\n- **Security**: Implements case-insensitive email/username lookups, banned user authorization, robust password hashing (Node.js scrypt), and security measures for messaging.\n- **Messaging UI**: User's own messages appear on the left (gray/muted), other user's messages appear on the right (blue/primary).\n- **Deployment**: Production builds use Vite's default modulePreload system to guarantee correct chunk execution order. All routes use lazy loading for code splitting.\n\n## External Dependencies\n- **PostgreSQL**: Replit managed database for all persistent data.\n- **Resend**: Email service for user verification, password resets, contact form notifications, newsletter confirmations, and contract delivery.\n- **UploadThing**: File upload service for MP3 files and user avatars.","size_bytes":6967},"client/src/pages/home.tsx":{"content":"import { useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Music, Mic2, Video, ArrowRight, CheckCircle2, Headphones, Phone, Play, Mail } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { motion } from \"framer-motion\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { EditableText } from \"@/components/cms/EditableText\";\nimport { EditableImage } from \"@/components/cms/EditableImage\";\nimport { OptimizedImage } from \"@/components/OptimizedImage\";\nimport { ScrollIndicator } from \"@/components/ScrollIndicator\";\nimport { SEO } from \"@/components/SEO\";\nimport { NewsletterForm } from \"@/components/newsletter-form\";\nimport type { CmsContent } from \"@shared/schema\";\nimport videoSetupImage from \"@assets/generated_images/Video_camera_production_setup_199f7c64.png\";\n\nexport default function Home() {\n  const [location] = useLocation();\n  \n  const { data: cmsContent = [] } = useQuery<CmsContent[]>({\n    queryKey: [\"/api/cms/content\", \"home\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/cms/content?page=home\");\n      if (!response.ok) {\n        throw new Error(`Failed to load content: ${response.statusText}`);\n      }\n      const data = await response.json();\n      // Ensure we always return an array\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  // Handle hash navigation for services section\n  useEffect(() => {\n    if (window.location.hash === \"#usluge\") {\n      // Wait for layout to paint before scrolling\n      setTimeout(() => {\n        const element = document.getElementById(\"usluge\");\n        if (element) {\n          element.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n        }\n      }, 100);\n    }\n  }, [location]);\n\n  const getCmsValue = (section: string, key: string, fallback: string = \"\") => {\n    return cmsContent.find(c => c.section === section && c.contentKey === key)?.contentValue || fallback;\n  };\n  const services = [\n    {\n      icon: Mic2,\n      title: getCmsValue(\"services\", \"service_1_title\", \"Snimanje & Mix/Master\"),\n      description: getCmsValue(\"services\", \"service_1_description\", \"Profesionalno snimanje vokala i instrumenata u akustiƒçki tretiranom studiju\"),\n      features: [\n        \"Warm Audio WA-47 mikrofon za kristalno ƒçist zvuk\",\n        \"Apollo Twin X interface i UAD plugin suite\",\n        \"Yamaha HS8 monitori za precizan mix\",\n        \"Finalni fajlovi u WAV i MP3 formatu\"\n      ],\n      imageKey: \"service_1_image\",\n      imageFallback: \"/services/wa47-microphone-service.jpg\"\n    },\n    {\n      icon: Music,\n      title: getCmsValue(\"services\", \"service_2_title\", \"Instrumentali & Gotove Pesme\"),\n      description: getCmsValue(\"services\", \"service_2_description\", \"Kreiranje originalnih bitova i kompletna produkcija va≈°ih pesama\"),\n      features: [\n        \"Profesionalni synthesizeri i MIDI kontroleri\",\n        \"Produkcija od ideje do finalnog miksa\",\n        \"Raznovrsni ≈æanrovi (Hip-Hop, Pop, R&B, Trap)\",\n        \"Ekskluzivna i neekskluzivna prava\"\n      ],\n      imageKey: \"service_2_image\",\n      imageFallback: \"/services/midi-keyboard-service.jpg\"\n    },\n    {\n      icon: Video,\n      title: getCmsValue(\"services\", \"service_3_title\", \"Video Produkcija\"),\n      description: getCmsValue(\"services\", \"service_3_description\", \"Snimanje i editing profesionalnih muziƒçkih spotova\"),\n      features: [\n        \"4K video snimanje sa profesionalnom opremom\",\n        \"Kreativni koncept i scenario\",\n        \"Color grading i post-produkcija\",\n        \"Finalni video optimizovan za YouTube i socijalne mre≈æe\"\n      ],\n      imageKey: \"service_3_image\",\n      imageFallback: videoSetupImage\n    }\n  ];\n\n  const whyChooseUs = [\n    \"Preko 5 godina iskustva u muziƒçkoj produkciji\",\n    \"Profesionalna oprema (WA-47, Apollo Twin X, HS8)\",\n    \"Universal Audio plugin suite i vrhunski processing\",\n    \"Individualan pristup svakom klijentu\",\n    \"Fleksibilni termini i prilagoƒëeni paketi\"\n  ];\n\n  return (\n    <div className=\"min-h-screen\">\n      <SEO\n        title=\"Studio LeFlow - Muziƒçki Studio Beograd | Snimanje Pesama, Miks, Mastering\"\n        description=\"Vrhunski muziƒçki studio u Beogradu. Snimanje, mix/mastering, instrumentali, video spotovi. WA-47, Apollo Twin X, UAD plugins. Preko 5 godina iskustva.\"\n        keywords={[\n          \"studio leflow\",\n          \"leflow studio\",\n          \"leflow\",\n          \"leflow beograd\",\n          \"studio leflow beograd\",\n          \"leflow studio beograd\",\n          \"muziƒçki studio beograd\",\n          \"muzicki studio beograd\",\n          \"snimanje pesme beograd\",\n          \"snimanje vokala beograd\",\n          \"miks i mastering\",\n          \"mix mastering beograd\",\n          \"muziƒçka produkcija\",\n          \"muzicka produkcija\",\n          \"audio produkcija beograd\",\n          \"recording studio belgrade\",\n          \"voice over studio\",\n          \"podcast studio beograd\",\n          \"producent muzike beograd\",\n          \"beatmaker beograd\",\n          \"snimanje pesme dorƒáol\",\n          \"najbolji muziƒçki studio beograd\",\n          \"leflow music studio\",\n          \"music studio belgrade\"\n        ]}\n        structuredData={{\n          \"@context\": \"https://schema.org\",\n          \"@type\": \"MusicRecordingStudio\",\n          \"name\": \"Studio LeFlow\",\n          \"alternateName\": [\"LeFlow Studio\", \"LeFlow\", \"Studio LeFlow Beograd\", \"LeFlow Studio Beograd\"],\n          \"description\": \"Profesionalni muziƒçki studio u Beogradu. Snimanje vokala, miks i mastering, voice over, podcast produkcija.\",\n          \"address\": {\n            \"@type\": \"PostalAddress\",\n            \"addressLocality\": \"Beograd\",\n            \"addressCountry\": \"RS\"\n          },\n          \"geo\": {\n            \"@type\": \"GeoCoordinates\",\n            \"latitude\": \"44.7866\",\n            \"longitude\": \"20.4489\"\n          },\n          \"priceRange\": \"$$\",\n          \"telephone\": \"+381\",\n          \"openingHoursSpecification\": {\n            \"@type\": \"OpeningHoursSpecification\",\n            \"dayOfWeek\": [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"],\n            \"opens\": \"10:00\",\n            \"closes\": \"22:00\"\n          }\n        }}\n      />\n      <section className=\"relative min-h-screen flex items-center justify-center overflow-hidden\">\n        <div className=\"absolute inset-0\">\n          <OptimizedImage \n            src=\"/equipment/hero-studio-background.jpg\" \n            alt=\"Studio LeFlow - Profesionalni muziƒçki studio\"\n            priority={true}\n            className=\"w-full h-full object-cover scale-105 [filter:blur(6px)]\"\n          />\n        </div>\n        <div className=\"absolute inset-0 bg-gradient-to-b from-black/80 via-black/70 to-black/80\" />\n        \n        <div className=\"relative z-10 max-w-7xl mx-auto px-4 md:px-6 py-20 text-center\">\n          <motion.div \n            className=\"mb-6 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/20 backdrop-blur-md border border-primary/30\"\n            initial={{ opacity: 0, y: -20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 0.1 }}\n          >\n            <Headphones className=\"w-4 h-4 text-primary\" />\n            <span className=\"text-sm font-medium text-white\" data-testid=\"text-location\">Beograd, Srbija</span>\n          </motion.div>\n          \n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, delay: 0.2 }}\n          >\n            <EditableText\n              page=\"home\"\n              section=\"hero\"\n              contentKey=\"title\"\n              value={getCmsValue(\"hero\", \"title\", \"Studio LeFlow\")}\n              as=\"h1\"\n              className=\"text-6xl md:text-7xl lg:text-8xl font-bold mb-6 text-white tracking-tight font-[Montserrat]\"\n            />\n          </motion.div>\n          \n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, delay: 0.4 }}\n          >\n            <EditableText\n              page=\"home\"\n              section=\"hero\"\n              contentKey=\"subtitle\"\n              value={getCmsValue(\"hero\", \"subtitle\", \"Profesionalna Muziƒçka Produkcija\")}\n              as=\"p\"\n              className=\"text-xl md:text-2xl lg:text-3xl mb-4 text-white/90 max-w-3xl mx-auto font-light\"\n            />\n          </motion.div>\n          \n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, delay: 0.6 }}\n          >\n            <EditableText\n              page=\"home\"\n              section=\"hero\"\n              contentKey=\"description\"\n              value={getCmsValue(\"hero\", \"description\", \"Mix ‚Ä¢ Master ‚Ä¢ Instrumentali ‚Ä¢ Video Produkcija\")}\n              as=\"p\"\n              className=\"text-lg md:text-xl mb-12 text-white/70 max-w-2xl mx-auto\"\n            />\n          </motion.div>\n          \n          <motion.div \n            className=\"flex flex-wrap gap-4 justify-center\"\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.8, delay: 0.8 }}\n          >\n            <Link href=\"/kontakt\">\n              <Button \n                size=\"lg\" \n                className=\"text-lg px-8 py-6 bg-primary hover:bg-primary border border-primary-border backdrop-blur-md transition-transform hover:scale-105 font-semibold\"\n                data-testid=\"button-book-session\"\n              >\n                <Phone className=\"mr-2 w-5 h-5\" />\n                Zaka≈æite Termin\n                <ArrowRight className=\"ml-2 w-5 h-5\" />\n              </Button>\n            </Link>\n            <Link href=\"/projekti\">\n              <Button \n                size=\"lg\" \n                variant=\"outline\" \n                className=\"text-lg px-8 py-6 backdrop-blur-md bg-white/10 text-white border-white/30 hover:bg-white/20 transition-transform hover:scale-105 font-semibold\"\n                data-testid=\"button-view-projects\"\n              >\n                <Play className=\"mr-2 w-5 h-5\" />\n                Pogledaj Projekte\n              </Button>\n            </Link>\n          </motion.div>\n        </div>\n        \n        <ScrollIndicator targetId=\"usluge\" />\n      </section>\n\n      <section className=\"py-20 lg:py-32 bg-background\" id=\"usluge\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"heading-lg mb-6\" data-testid=\"text-services-title\">\n              Na≈°e Usluge\n            </h2>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Pru≈æamo kompletne usluge muziƒçke i video produkcije, od ideje do finalnog proizvoda\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            {services.map((service, index) => (\n              <FadeInWhenVisible key={index} delay={index * 0.15}>\n                <motion.div\n                  whileHover={{ y: -8, scale: 1.02 }}\n                  transition={{ duration: 0.3 }}\n                >\n                  <Card className=\"overflow-visible h-full hover-elevate active-elevate-2 cursor-pointer\" data-testid={`card-service-${index}`}>\n                    <div className=\"aspect-video overflow-hidden\">\n                      <motion.div\n                        whileHover={{ scale: 1.1 }}\n                        transition={{ duration: 0.3 }}\n                        className=\"w-full h-full\"\n                      >\n                        <EditableImage\n                          page=\"home\"\n                          section=\"services\"\n                          contentKey={service.imageKey}\n                          currentImageUrl={getCmsValue(\"services\", service.imageKey, service.imageFallback)}\n                          alt={service.title}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      </motion.div>\n                    </div>\n                    <CardContent className=\"p-6\">\n                      <div className=\"mb-4 inline-flex items-center justify-center w-12 h-12 rounded-lg bg-primary/10\">\n                        <service.icon className=\"w-6 h-6 text-primary\" />\n                      </div>\n                      \n                      <h3 className=\"text-2xl font-bold mb-3\" data-testid={`text-service-title-${index}`}>\n                        {service.title}\n                      </h3>\n                      \n                      <p className=\"text-muted-foreground mb-4\">\n                        {service.description}\n                      </p>\n                      \n                      <ul className=\"space-y-2\">\n                        {service.features.map((feature, fIndex) => (\n                          <li key={fIndex} className=\"flex items-start gap-2 text-sm\">\n                            <CheckCircle2 className=\"w-4 h-4 text-primary mt-0.5 flex-shrink-0\" />\n                            <span>{feature}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              </FadeInWhenVisible>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-20 lg:py-32 bg-muted/30\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n          <div className=\"grid md:grid-cols-2 gap-12 items-center\">\n            <FadeInWhenVisible>\n              <motion.div\n                whileHover={{ scale: 1.05 }}\n                transition={{ duration: 0.3 }}\n                className=\"w-full\"\n              >\n                <EditableImage\n                  page=\"home\"\n                  section=\"equipment\"\n                  contentKey=\"equipment_image\"\n                  currentImageUrl={getCmsValue(\"equipment\", \"equipment_image\", \"/services/yamaha-hs8-service.jpg\")}\n                  alt=\"Studio oprema\"\n                  className=\"rounded-xl shadow-2xl w-full\"\n                />\n              </motion.div>\n            </FadeInWhenVisible>\n            \n            <FadeInWhenVisible delay={0.2}>\n              <div>\n                <h2 className=\"heading-lg mb-6\" data-testid=\"text-why-choose-title\">\n                  Za≈°to Izabrati Studio LeFlow?\n                </h2>\n                \n                <p className=\"text-lg text-muted-foreground mb-8\">\n                  Na≈° studio kombinuje najsavremeniju tehnologiju sa kreativnim pristupom i struƒçno≈°ƒáu, \n                  pru≈æajuƒái vam profesionalnu produkciju koja ƒáe istaƒái va≈° muziƒçki rad.\n                </p>\n                \n                <ul className=\"space-y-4 mb-8\">\n                  {whyChooseUs.map((reason, index) => (\n                    <motion.li \n                      key={index} \n                      className=\"flex items-start gap-3\" \n                      data-testid={`text-reason-${index}`}\n                      initial={{ opacity: 0, x: -20 }}\n                      whileInView={{ opacity: 1, x: 0 }}\n                      viewport={{ once: true }}\n                      transition={{ duration: 0.5, delay: index * 0.1 }}\n                    >\n                      <CheckCircle2 className=\"w-6 h-6 text-primary mt-0.5 flex-shrink-0\" />\n                      <span className=\"text-lg\">{reason}</span>\n                    </motion.li>\n                  ))}\n                </ul>\n                \n                <Link href=\"/kontakt\">\n                  <Button size=\"lg\" className=\"text-lg transition-transform hover:scale-105\" data-testid=\"button-contact-us\">\n                    Kontaktirajte Nas\n                    <ArrowRight className=\"ml-2 w-5 h-5\" />\n                  </Button>\n                </Link>\n              </div>\n            </FadeInWhenVisible>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-20 lg:py-32 bg-gradient-to-br from-primary/5 to-primary/10\">\n        <div className=\"max-w-4xl mx-auto px-4 md:px-6 text-center\">\n          <FadeInWhenVisible>\n            <h2 className=\"heading-lg mb-6\">\n              Budite u Toku sa Najnovijim Novostima\n            </h2>\n          </FadeInWhenVisible>\n          \n          <FadeInWhenVisible delay={0.2}>\n            <p className=\"text-xl mb-4 text-muted-foreground max-w-2xl mx-auto flex items-center justify-center gap-2 flex-wrap\">\n              <Mail className=\"w-5 h-5 text-primary\" />\n              Prijavite se na na≈° newsletter i budite prvi koji ƒáe saznati o novim projektima, promocijama i ekskluzivnim ponudama\n            </p>\n            <p className=\"text-sm text-muted-foreground/70 mb-12 flex items-center justify-center gap-2\">\n              <CheckCircle2 className=\"w-4 h-4 text-primary\" />\n              Nikada neƒáemo deliti va≈° email sa treƒáim stranama\n            </p>\n          </FadeInWhenVisible>\n          \n          <FadeInWhenVisible delay={0.4}>\n            <NewsletterForm />\n          </FadeInWhenVisible>\n        </div>\n      </section>\n\n      <section className=\"py-20 lg:py-32 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6\">\n          <FadeInWhenVisible>\n            <div className=\"text-center mb-16\">\n              <h2 className=\"heading-md mb-4\">\n                Studio Oprema\n              </h2>\n              <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n                Profesionalna oprema koja garantuje vrhunski zvuk i produkciju\n              </p>\n            </div>\n          </FadeInWhenVisible>\n\n          <div className=\"grid md:grid-cols-2 gap-8 max-w-6xl mx-auto\">\n            <FadeInWhenVisible delay={0.1}>\n              <Card className=\"overflow-hidden hover-elevate transition-all duration-300\">\n                <CardContent className=\"p-0\">\n                  <OptimizedImage\n                    src=\"/equipment/apollo-twin-duo.jpg\"\n                    alt=\"Universal Audio Apollo Twin X Duo\"\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <div className=\"p-6\">\n                    <h3 className=\"text-xl font-bold mb-3 flex items-center gap-2\">\n                      <Headphones className=\"w-5 h-5 text-primary\" />\n                      Universal Audio Apollo Twin X Duo\n                    </h3>\n                    <p className=\"text-muted-foreground\">\n                      Profesionalni Thunderbolt audio interface sa Realtime UAD processing-om. Kristalno ƒçist konvertor i ultra niska latencija za precizno snimanje i monitoring.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </FadeInWhenVisible>\n\n            <FadeInWhenVisible delay={0.2}>\n              <Card className=\"overflow-hidden hover-elevate transition-all duration-300\">\n                <CardContent className=\"p-0\">\n                  <OptimizedImage\n                    src=\"/equipment/dt990-headphones.jpg\"\n                    alt=\"Beyerdynamic DT 990 PRO\"\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <div className=\"p-6\">\n                    <h3 className=\"text-xl font-bold mb-3 flex items-center gap-2\">\n                      <Headphones className=\"w-5 h-5 text-primary\" />\n                      Beyerdynamic DT 990 PRO & DT 770 PRO\n                    </h3>\n                    <p className=\"text-muted-foreground\">\n                      Studio referentne slu≈°alice za precizno miksovanje i mastering. DT 990 PRO (otvorene) za analitiƒçko slu≈°anje, DT 770 PRO (zatvorene) za snimanje bez curenja zvuka.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </FadeInWhenVisible>\n\n            <FadeInWhenVisible delay={0.3}>\n              <Card className=\"overflow-hidden hover-elevate transition-all duration-300\">\n                <CardContent className=\"p-0\">\n                  <OptimizedImage\n                    src=\"/equipment/uad-plugins.jpg\"\n                    alt=\"UAD Plugin Collection\"\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <div className=\"p-6\">\n                    <h3 className=\"text-xl font-bold mb-3 flex items-center gap-2\">\n                      <CheckCircle2 className=\"w-5 h-5 text-primary\" />\n                      UAD Plugin Suite - Sve Originalne Licence\n                    </h3>\n                    <p className=\"text-muted-foreground\">\n                      Kompletna kolekcija originalnih Universal Audio pluginova: Neve 1073, Pultec EQ, 1176 Compressor, LA-2A, Avalon 737 i mnogi drugi. Legendarni analog zvuk u digitalnom domenu.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </FadeInWhenVisible>\n\n            <FadeInWhenVisible delay={0.4}>\n              <Card className=\"overflow-hidden hover-elevate transition-all duration-300\">\n                <CardContent className=\"p-0\">\n                  <OptimizedImage\n                    src=\"/equipment/autotune-uad.jpg\"\n                    alt=\"AutoTune RealTime Advanced\"\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <div className=\"p-6\">\n                    <h3 className=\"text-xl font-bold mb-3 flex items-center gap-2\">\n                      <CheckCircle2 className=\"w-5 h-5 text-primary\" />\n                      AutoTune RealTime Advanced - Bez Kasnjenja\n                    </h3>\n                    <p className=\"text-muted-foreground\">\n                      Realtime Auto-Tune processing sa ultra niskom latencijom - performeri mogu da snimaju sa live pitch correction efektom bez ƒçujnog kasnjenja. Profesionalni zvuk tokom snimanja.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </FadeInWhenVisible>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-20 lg:py-32 bg-primary text-primary-foreground\">\n        <div className=\"max-w-4xl mx-auto px-4 md:px-6 text-center\">\n          <FadeInWhenVisible>\n            <EditableText\n              page=\"home\"\n              section=\"cta\"\n              contentKey=\"title\"\n              value={getCmsValue(\"cta\", \"title\", \"Spremni za Va≈°u Sledeƒáu Produkciju?\")}\n              as=\"h2\"\n              className=\"text-4xl md:text-5xl font-bold mb-6 tracking-tight\"\n            />\n          </FadeInWhenVisible>\n          \n          <FadeInWhenVisible delay={0.2}>\n            <EditableText\n              page=\"home\"\n              section=\"cta\"\n              contentKey=\"description\"\n              value={getCmsValue(\"cta\", \"description\", \"Zaka≈æite besplatnu konsultaciju i razgovarajmo o va≈°oj muziƒçkoj viziji\")}\n              as=\"p\"\n              className=\"text-xl mb-12 text-primary-foreground/90\"\n            />\n          </FadeInWhenVisible>\n          \n          <FadeInWhenVisible delay={0.4}>\n            <div className=\"flex flex-wrap gap-4 justify-center\">\n              <Link href=\"/kontakt\">\n                <Button \n                  size=\"lg\" \n                  variant=\"outline\"\n                  className=\"text-lg px-8 py-6 bg-white/10 text-primary-foreground border-white/30 hover:bg-white/20 backdrop-blur-md animate-pulse-slow transition-transform hover:scale-105\"\n                  data-testid=\"button-cta-book\"\n                >\n                  Zaka≈æite Termin\n                  <ArrowRight className=\"ml-2 w-5 h-5\" />\n                </Button>\n              </Link>\n              <Link href=\"/pravila\">\n                <Button \n                  size=\"lg\" \n                  variant=\"outline\"\n                  className=\"text-lg px-8 py-6 bg-white/10 text-primary-foreground border-white/30 hover:bg-white/20 backdrop-blur-md transition-transform hover:scale-105\"\n                  data-testid=\"button-view-terms\"\n                >\n                  Pogledajte Pravila\n                </Button>\n              </Link>\n            </div>\n          </FadeInWhenVisible>\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":24329},"DEPLOYMENT_GUIDE.md":{"content":"# Studio LeFlow - Deployment Guide\n\n## Prerequisites\n\nBefore deploying, ensure you have all required API keys and services configured:\n\n1. **Resend Account** - For email verification\n   - Domain `studioleflow.com` verified with SPF, DKIM, DMARC records\n   - API Key generated\n\n2. **UploadThing Account** - For music file uploads\n   - Project created\n   - API Token generated\n\n3. **PostgreSQL Database** - For production data\n   - Must be provisioned before first deployment (creates a separate production database)\n   - Replit automatically provides DATABASE_URL for the production database\n\n## Deployment Steps\n\n### 1. Provision Production Database (First Time Only)\n\nIf this is your first deployment, you need to create a production PostgreSQL database:\n\n1. Open Replit Database tool (left sidebar)\n2. Click \"Create Database\" or ask Agent to provision one\n3. Database schema will be automatically synchronized on first deployment\n\n**Note:** This creates a separate production database. Your development database remains unchanged.\n\n### 2. Configure Deployment Secrets\n\nIn Replit, go to: **Deploy ‚Üí Secrets** and add the following:\n\n| Secret Name | Description | Example Value |\n|------------|-------------|---------------|\n| `SESSION_SECRET` | Random string for session encryption | Generate with: `openssl rand -base64 32` |\n| `RESEND_API_KEY` | Resend API key for emails | `re_xxxxxxxxxxxxx` |\n| `UPLOADTHING_TOKEN` | UploadThing API token | `sk_live_xxxxxxxxxxxxx` |\n\n**Important Notes:**\n- `DATABASE_URL` is automatically provided by Replit - you don't need to add it manually\n- `SESSION_SECRET` should be a strong random string (minimum 32 characters)\n- Never commit these values to git\n\n### 3. Deploy the Application\n\n1. Click the **\"Deploy\"** button in Replit (top right)\n2. Replit will automatically:\n   - Run `npm run build` to compile frontend and backend\n   - Create a production deployment\n   - Provide a live URL (e.g., `studioleflow-username.replit.app`)\n   - **Automatically populate default CMS content** on first startup (hero section, services, CTA)\n\n**Automatic CMS Initialization:**\n- The server automatically checks if CMS content exists on startup\n- If the `cms_content` table is empty, it will seed default content for the home page\n- This ensures the website displays correctly on first deployment\n- Existing content is never overwritten\n\n### 4. Configure Custom Domain (Optional)\n\nAfter deployment:\n\n1. In Replit Deploy settings, add custom domain: `studioleflow.com`\n2. In Namecheap DNS settings, add the CNAME record provided by Replit\n3. Wait for DNS propagation (5-30 minutes)\n\n## Environment Variable Validation\n\nThe server includes automatic validation and will **fail to start** with a clear error message if any required environment variables are missing:\n\n```\n================================================================================\nDEPLOYMENT CONFIGURATION ERROR\n================================================================================\n\nThe following environment variables are required but not set:\n  - DATABASE_URL\n  - SESSION_SECRET\n  - RESEND_API_KEY\n\nPlease add these in Replit Deployment ‚Üí Secrets\n================================================================================\n```\n\n## Deployment Configuration\n\nThe deployment is configured in `.replit`:\n\n```toml\n[deployment]\ndeploymentTarget = \"autoscale\"\nbuild = [\"npm\", \"run\", \"build\"]\nrun = [\"node\", \"dist/index.js\"]\n```\n\n- **Mode**: Autoscale (automatically scales based on traffic)\n- **Build**: Compiles Vite frontend and esbuild backend\n- **Run**: Executes production server on port 5000\n\n## Troubleshooting\n\n### Server shows \"Internal Server Error\"\n\nCheck deployment logs:\n1. Go to Deploy ‚Üí Your Deployment ‚Üí Logs\n2. Look for environment variable validation errors\n3. Ensure all secrets are properly configured\n\n### Database connection errors\n\n- `DATABASE_URL` is automatically provided by Replit when you deploy\n- No manual database configuration needed\n- Database schema will be automatically created on first startup\n- Ensure database schema is up to date with `npm run db:push` if you make schema changes\n\n### Email verification not working\n\n- Verify `RESEND_API_KEY` is set\n- Check that `studioleflow.com` domain is verified in Resend\n- Ensure DNS records (SPF, DKIM, DMARC) are properly configured\n\n### Upload functionality broken\n\n- Verify `UPLOADTHING_TOKEN` is set\n- Check UploadThing dashboard for API quota/errors\n- Ensure CSP headers allow `https://uploadthing.com`\n\n## Security Features\n\nThe production deployment includes:\n\n- **Content Security Policy (CSP)** headers to prevent XSS attacks\n- **Secure session management** with HttpOnly cookies\n- **Rate limiting** on contact form (3 submissions per hour per IP)\n- **Email verification** required for user registration\n- **Admin-only routes** protected by authentication middleware\n\n## Monitoring\n\nAfter deployment:\n- Monitor logs in Deploy ‚Üí Logs tab\n- Check error rates and response times\n- Verify email delivery in Resend dashboard\n- Monitor database performance in Replit database tab\n\n## Production Checklist\n\nBefore going live:\n\n- [ ] All environment variables configured in Deployment Secrets\n- [ ] Custom domain `studioleflow.com` configured and DNS propagated\n- [ ] Email verification tested with real email addresses\n- [ ] File upload tested with MP3/WAV files\n- [ ] Admin panel accessible and functional\n- [ ] Contact form tested with spam protection\n- [ ] All features tested in production environment\n","size_bytes":5506},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/App.tsx":{"content":"import { lazy, Suspense } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { AuthProvider } from \"@/hooks/use-auth\";\nimport { ProtectedRoute } from \"@/lib/protected-route\";\nimport { EditModeProvider } from \"@/contexts/EditModeContext\";\nimport { WebSocketProvider } from \"@/contexts/WebSocketContext\";\nimport { Header } from \"@/components/layout/header\";\nimport { Footer } from \"@/components/layout/footer\";\nimport { useScrollToTop } from \"@/hooks/use-scroll-to-top\";\nimport { usePWARedirect } from \"@/hooks/use-pwa-redirect\";\nimport { HelmetProvider } from \"react-helmet-async\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { InstallPrompt } from \"@/components/pwa/InstallPrompt\";\n\nconst Home = lazy(() => import(\"@/pages/home\"));\nconst Terms = lazy(() => import(\"@/pages/terms\"));\nconst Team = lazy(() => import(\"@/pages/team\"));\nconst Contact = lazy(() => import(\"@/pages/contact\"));\nconst AuthPage = lazy(() => import(\"@/pages/auth-page\"));\nconst VerifyEmailPage = lazy(() => import(\"@/pages/verify-email\"));\nconst Giveaway = lazy(() => import(\"@/pages/giveaway\"));\nconst Dashboard = lazy(() => import(\"@/pages/dashboard\"));\nconst AdminPage = lazy(() => import(\"@/pages/admin\"));\nconst TermsOfUse = lazy(() => import(\"@/pages/terms-of-use\"));\nconst Settings = lazy(() => import(\"@/pages/settings\"));\nconst VideoSpots = lazy(() => import(\"@/pages/video-spots\"));\nconst Inbox = lazy(() => import(\"@/pages/inbox\"));\nconst MojePesme = lazy(() => import(\"@/pages/moje-pesme\"));\nconst Zajednica = lazy(() => import(\"@/pages/zajednica\"));\nconst NotFound = lazy(() => import(\"@/pages/not-found\"));\nconst MaintenancePage = lazy(() => import(\"@/pages/maintenance\"));\nconst NewsletterConfirmation = lazy(() => import(\"@/pages/newsletter-confirmation\"));\n\nconst LazyHome = () => <Home />;\nconst LazyTerms = () => <Terms />;\nconst LazyTeam = () => <Team />;\nconst LazyContact = () => <Contact />;\nconst LazyVideoSpots = () => <VideoSpots />;\nconst LazyAuthPage = () => <AuthPage />;\nconst LazyVerifyEmailPage = () => <VerifyEmailPage />;\nconst LazyNewsletterConfirmation = () => <NewsletterConfirmation />;\nconst LazyTermsOfUse = () => <TermsOfUse />;\nconst LazyGiveaway = () => <Giveaway />;\nconst LazyDashboard = () => <Dashboard />;\nconst LazyInbox = () => <Inbox />;\nconst LazyMojePesme = () => <MojePesme />;\nconst LazyZajednica = () => <Zajednica />;\nconst LazyAdminPage = () => <AdminPage />;\nconst LazySettings = () => <Settings />;\nconst LazyNotFound = () => <NotFound />;\n\nfunction Router() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  \n  useScrollToTop();\n  usePWARedirect(); // Auto-redirect in PWA standalone mode\n\n  // Check if maintenance mode is active\n  const { data: maintenanceData } = useQuery<{ maintenanceMode: boolean }>({\n    queryKey: [\"/api/maintenance\"],\n    retry: false,\n    staleTime: 30000, // Cache for 30 seconds\n  });\n\n  // If maintenance mode is active and user is not admin, show maintenance page\n  const isMaintenanceMode = maintenanceData?.maintenanceMode && user?.role !== \"admin\";\n  \n  if (isMaintenanceMode) {\n    return <MaintenancePage />;\n  }\n  \n  return (\n    <>\n      <Header />\n      <main className=\"min-h-[calc(100vh-200px)]\">\n        <Suspense fallback={\n          <div className=\"flex items-center justify-center min-h-[60vh]\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        }>\n          <div key={location} className=\"w-full page-transition\">\n            <Switch location={location}>\n                <Route path=\"/\" component={LazyHome} />\n                <Route path=\"/terms\" component={LazyTerms} />\n                <Route path=\"/pravila\" component={LazyTerms} />\n                <Route path=\"/tim\" component={LazyTeam} />\n                <Route path=\"/kontakt\" component={LazyContact} />\n                <Route path=\"/projekti\" component={LazyVideoSpots} />\n                <Route path=\"/auth\" component={LazyAuthPage} />\n                <Route path=\"/prijava\" component={LazyAuthPage} />\n                <Route path=\"/registracija\" component={LazyAuthPage} />\n                <Route path=\"/verify-email\" component={LazyVerifyEmailPage} />\n                <Route path=\"/newsletter/potvrda/:token\" component={LazyNewsletterConfirmation} />\n                <Route path=\"/uslovi-koriscenja\" component={LazyTermsOfUse} />\n                <ProtectedRoute path=\"/zajednica\" component={LazyZajednica} />\n                <ProtectedRoute path=\"/giveaway\" component={LazyGiveaway} />\n                <ProtectedRoute path=\"/moje-pesme\" component={LazyMojePesme} />\n                <ProtectedRoute path=\"/inbox\" component={LazyInbox} />\n                <ProtectedRoute path=\"/dashboard\" component={LazyDashboard} />\n                <ProtectedRoute path=\"/admin\" component={LazyAdminPage} />\n                <ProtectedRoute path=\"/settings\" component={LazySettings} />\n                <Route component={LazyNotFound} />\n            </Switch>\n          </div>\n        </Suspense>\n      </main>\n      <Footer />\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <HelmetProvider>\n      <QueryClientProvider client={queryClient}>\n        <ThemeProvider>\n          <AuthProvider>\n            <WebSocketProvider>\n              <EditModeProvider>\n                <TooltipProvider>\n                  <Toaster />\n                  <InstallPrompt />\n                  <Router />\n                </TooltipProvider>\n              </EditModeProvider>\n            </WebSocketProvider>\n          </AuthProvider>\n        </ThemeProvider>\n      </QueryClientProvider>\n    </HelmetProvider>\n  );\n}\n\nexport default App;\n","size_bytes":5992},"client/src/pages/maintenance.tsx":{"content":"import { Construction, Lock, User, KeyRound } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { InputOTP, InputOTPGroup, InputOTPSlot } from \"@/components/ui/input-otp\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\n\nconst loginSchema = z.object({\n  username: z.string().min(3, \"Korisniƒçko ime mora imati najmanje 3 karaktera\"),\n  password: z.string().min(8, \"Lozinka mora imati najmanje 8 karaktera\"),\n});\n\nconst codeSchema = z.object({\n  code: z.string().length(6, \"Kod mora imati taƒçno 6 cifara\"),\n});\n\ntype LoginFormData = z.infer<typeof loginSchema>;\ntype CodeFormData = z.infer<typeof codeSchema>;\n\ntype DialogView = \"credentials\" | \"verification\";\n\nexport default function MaintenancePage() {\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\n  const [dialogView, setDialogView] = useState<DialogView>(\"credentials\");\n  const [userId, setUserId] = useState<number | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  const loginForm = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const codeForm = useForm<CodeFormData>({\n    resolver: zodResolver(codeSchema),\n    defaultValues: {\n      code: \"\",\n    },\n  });\n\n  const onCredentialsSubmit = async (data: LoginFormData) => {\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/admin-login-request\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || \"Gre≈°ka pri slanju koda\");\n      }\n\n      setUserId(result.userId);\n      setDialogView(\"verification\");\n      toast({\n        title: \"Kod poslat!\",\n        description: \"Proverite svoj email za verifikacioni kod.\",\n      });\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: error.message || \"Neispravno korisniƒçko ime ili lozinka.\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const onCodeSubmit = async (data: CodeFormData) => {\n    if (!userId) {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: \"Neispravan session. Poku≈°ajte ponovo.\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/admin-login-verify\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ userId, code: data.code }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || \"Neispravan kod\");\n      }\n\n      queryClient.setQueryData([\"/api/user\"], result.user);\n      setShowLoginDialog(false);\n      resetDialog();\n      toast({\n        title: \"Uspe≈°no!\",\n        description: \"Prijavili ste se kao admin.\",\n      });\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka pri verifikaciji\",\n        description: error.message || \"Neispravan ili istekao kod.\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const resetDialog = () => {\n    setDialogView(\"credentials\");\n    setUserId(null);\n    loginForm.reset();\n    codeForm.reset();\n  };\n\n  const handleDialogClose = (open: boolean) => {\n    setShowLoginDialog(open);\n    if (!open) {\n      resetDialog();\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n      <div className=\"max-w-2xl w-full text-center space-y-8\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5 }}\n        >\n          <div className=\"flex justify-center mb-8\">\n            <img\n              src=\"/attached_assets/logo/studioleflow-transparent.png\"\n              alt=\"Studio LeFlow\"\n              className=\"h-32 w-auto filter invert\"\n            />\n          </div>\n\n          <Construction className=\"w-24 h-24 text-primary mx-auto mb-6\" />\n          \n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4 font-[Montserrat]\">\n            Sajt je u pripremi\n          </h1>\n          \n          <p className=\"text-xl text-muted-foreground mb-8\">\n            Trenutno radimo na unapreƒëenju na≈°ih servisa. Uskoro se vraƒáamo!\n          </p>\n\n          <div className=\"bg-muted rounded-lg p-6 max-w-md mx-auto\">\n            <p className=\"text-sm text-muted-foreground\">\n              Mo≈æete nas kontaktirati putem:\n            </p>\n            <div className=\"mt-4 space-y-2\">\n              <p className=\"font-medium\">\n                Email: <a href=\"mailto:info@studioleflow.com\" className=\"text-primary hover:underline\">info@studioleflow.com</a>\n              </p>\n              <p className=\"font-medium\">\n                Telefon: <a href=\"tel:+381637347023\" className=\"text-primary hover:underline\">+381 63 734 7023</a>\n              </p>\n              <p className=\"font-medium\">\n                Instagram: <a href=\"https://instagram.com/studioleflow\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline\">@studioleflow</a>\n              </p>\n            </div>\n          </div>\n\n          <div className=\"mt-12\">\n            <button\n              onClick={() => setShowLoginDialog(true)}\n              className=\"text-sm text-muted-foreground hover:text-primary transition-colors\"\n            >\n              Admin Prijava\n            </button>\n          </div>\n        </motion.div>\n      </div>\n\n      <Dialog open={showLoginDialog} onOpenChange={handleDialogClose}>\n        <DialogContent className=\"sm:max-w-md\">\n          {dialogView === \"credentials\" && (\n            <>\n              <DialogHeader>\n                <DialogTitle className=\"flex items-center gap-2\">\n                  <Lock className=\"w-5 h-5\" />\n                  Admin Prijava\n                </DialogTitle>\n                <DialogDescription>\n                  Unesite kredencijale. Verifikacioni kod ƒáe biti poslat na va≈° email.\n                </DialogDescription>\n              </DialogHeader>\n              \n              <Form {...loginForm}>\n                <form onSubmit={loginForm.handleSubmit(onCredentialsSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={loginForm.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Korisniƒçko ime ili Email</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <User className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                              placeholder=\"Unesite korisniƒçko ime ili email\"\n                              {...field}\n                              className=\"pl-10\"\n                              autoComplete=\"username\"\n                              disabled={isLoading}\n                            />\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={loginForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Lozinka</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Lock className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                            <Input\n                              type=\"password\"\n                              placeholder=\"Unesite lozinku\"\n                              {...field}\n                              className=\"pl-10\"\n                              autoComplete=\"current-password\"\n                              disabled={isLoading}\n                            />\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full\"\n                    disabled={isLoading}\n                  >\n                    {isLoading ? \"Slanje koda...\" : \"Po≈°alji verifikacioni kod\"}\n                  </Button>\n                </form>\n              </Form>\n            </>\n          )}\n\n          {dialogView === \"verification\" && (\n            <>\n              <DialogHeader>\n                <DialogTitle className=\"flex items-center gap-2\">\n                  <KeyRound className=\"w-5 h-5\" />\n                  Verifikacioni Kod\n                </DialogTitle>\n                <DialogDescription>\n                  Unesite 6-cifreni kod koji smo poslali na va≈° email.\n                </DialogDescription>\n              </DialogHeader>\n              \n              <Form {...codeForm}>\n                <form onSubmit={codeForm.handleSubmit(onCodeSubmit)} className=\"space-y-6\">\n                  <FormField\n                    control={codeForm.control}\n                    name=\"code\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Verifikacioni kod</FormLabel>\n                        <FormControl>\n                          <div className=\"flex justify-center\">\n                            <InputOTP maxLength={6} {...field} disabled={isLoading}>\n                              <InputOTPGroup>\n                                <InputOTPSlot index={0} />\n                                <InputOTPSlot index={1} />\n                                <InputOTPSlot index={2} />\n                                <InputOTPSlot index={3} />\n                                <InputOTPSlot index={4} />\n                                <InputOTPSlot index={5} />\n                              </InputOTPGroup>\n                            </InputOTP>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"flex gap-2\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      className=\"flex-1\"\n                      onClick={() => setDialogView(\"credentials\")}\n                      disabled={isLoading}\n                    >\n                      Nazad\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      className=\"flex-1\"\n                      disabled={isLoading}\n                    >\n                      {isLoading ? \"Verifikacija...\" : \"Verifikuj\"}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":11843},"client/src/pages/newsletter-confirmation.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useRoute } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { CheckCircle2, XCircle, Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\n\nexport default function NewsletterConfirmation() {\n  const [, params] = useRoute(\"/newsletter/potvrda/:token\");\n  const [status, setStatus] = useState<\"loading\" | \"success\" | \"error\">(\"loading\");\n  const [message, setMessage] = useState(\"\");\n\n  useEffect(() => {\n    const confirmSubscription = async () => {\n      if (!params?.token) {\n        setStatus(\"error\");\n        setMessage(\"Link za potvrdu je neva≈æeƒái\");\n        return;\n      }\n\n      try {\n        const response = await fetch(`/api/newsletter/confirm/${params.token}`);\n        const data = await response.json();\n\n        if (response.ok) {\n          setStatus(\"success\");\n          setMessage(data.message || \"Email uspe≈°no potvrƒëen!\");\n        } else {\n          setStatus(\"error\");\n          setMessage(data.error || \"Gre≈°ka pri potvrƒëivanju email-a\");\n        }\n      } catch (error) {\n        console.error(\"Confirmation error:\", error);\n        setStatus(\"error\");\n        setMessage(\"Gre≈°ka pri potvrƒëivanju email-a\");\n      }\n    };\n\n    confirmSubscription();\n  }, [params?.token]);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted p-4\">\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.4 }}\n      >\n        <Card className=\"max-w-md w-full p-8\">\n          <div className=\"text-center space-y-6\">\n            {status === \"loading\" && (\n              <>\n                <Loader2 className=\"h-16 w-16 mx-auto text-primary animate-spin\" />\n                <h1 className=\"text-2xl font-bold\">Potvrƒëujemo va≈°u prijavu...</h1>\n              </>\n            )}\n\n            {status === \"success\" && (\n              <>\n                <CheckCircle2 className=\"h-16 w-16 mx-auto text-green-500\" />\n                <h1 className=\"text-2xl font-bold\">Uspe≈°no!</h1>\n                <p className=\"text-muted-foreground\">{message}</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Hvala ≈°to ste se prijavili na Studio LeFlow newsletter. Biƒáete obave≈°teni o najnovijim projektima, promocijama i novostima.\n                </p>\n                <Button asChild className=\"w-full\">\n                  <a href=\"/\">Nazad na poƒçetnu</a>\n                </Button>\n              </>\n            )}\n\n            {status === \"error\" && (\n              <>\n                <XCircle className=\"h-16 w-16 mx-auto text-destructive\" />\n                <h1 className=\"text-2xl font-bold\">Gre≈°ka</h1>\n                <p className=\"text-muted-foreground\">{message}</p>\n                <Button asChild variant=\"outline\" className=\"w-full\">\n                  <a href=\"/\">Nazad na poƒçetnu</a>\n                </Button>\n              </>\n            )}\n          </div>\n        </Card>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":3142},"client/src/components/newsletter-form.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Mail, Loader2 } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\n\ninterface NewsletterFormProps {\n  variant?: \"default\" | \"footer\";\n  className?: string;\n}\n\nexport function NewsletterForm({ variant = \"default\", className = \"\" }: NewsletterFormProps) {\n  const [email, setEmail] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!email || !email.includes(\"@\")) {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Unesite validnu email adresu\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\"/api/newsletter/subscribe\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        toast({\n          title: \"Uspe≈°no!\",\n          description: data.message || \"Proverite email za link za potvrdu\",\n        });\n        setEmail(\"\");\n      } else {\n        toast({\n          title: \"Gre≈°ka\",\n          description: data.error || \"Do≈°lo je do gre≈°ke\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Newsletter subscribe error:\", error);\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka na serveru. Poku≈°ajte ponovo.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (variant === \"footer\") {\n    return (\n      <form onSubmit={handleSubmit} className={`flex gap-2 ${className}`}>\n        <Input\n          type=\"email\"\n          placeholder=\"Va≈°a email adresa\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          disabled={isLoading}\n          className=\"flex-1\"\n        />\n        <Button type=\"submit\" disabled={isLoading} size=\"icon\">\n          {isLoading ? (\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\n          ) : (\n            <Mail className=\"h-4 w-4\" />\n          )}\n        </Button>\n      </form>\n    );\n  }\n\n  return (\n    <motion.form\n      onSubmit={handleSubmit}\n      className={`max-w-md mx-auto ${className}`}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: 0.2 }}\n    >\n      <div className=\"flex gap-2\">\n        <Input\n          type=\"email\"\n          placeholder=\"Unesite va≈°u email adresu\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n          disabled={isLoading}\n          className=\"flex-1\"\n        />\n        <Button type=\"submit\" disabled={isLoading}>\n          {isLoading ? (\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\n          ) : (\n            \"Prijavi se\"\n          )}\n        </Button>\n      </div>\n      <p className=\"text-xs text-muted-foreground text-center mt-2\">\n        Prijavom na newsletter prihvatate na≈°u politiku privatnosti\n      </p>\n    </motion.form>\n  );\n}\n","size_bytes":3265},"scripts/generate-favicons.ts":{"content":"import sharp from 'sharp';\nimport { readFileSync, writeFileSync } from 'fs';\nimport { join } from 'path';\n\nconst sourceImage = 'attached_assets/icon_1762539841884.png';\nconst outputDir = 'client/public';\n\nconst sizes = [\n  { name: 'favicon-16x16.png', size: 16 },\n  { name: 'favicon-32x32.png', size: 32 },\n  { name: 'favicon.png', size: 48 }, // Default favicon\n  { name: 'favicon-192x192.png', size: 192 }, // Android\n  { name: 'favicon-512x512.png', size: 512 }, // Google Search recommended\n  { name: 'apple-touch-icon.png', size: 180 }, // iOS\n];\n\nasync function generateFavicons() {\n  console.log('üé® Generating favicons...');\n  \n  for (const { name, size } of sizes) {\n    try {\n      await sharp(sourceImage)\n        .resize(size, size, {\n          fit: 'contain',\n          background: { r: 0, g: 0, b: 0, alpha: 0 } // Transparent background\n        })\n        .png()\n        .toFile(join(outputDir, name));\n      \n      console.log(`‚úÖ Generated ${name} (${size}x${size})`);\n    } catch (error) {\n      console.error(`‚ùå Failed to generate ${name}:`, error);\n    }\n  }\n  \n  // Generate ICO file for older browsers (32x32)\n  try {\n    await sharp(sourceImage)\n      .resize(32, 32, {\n        fit: 'contain',\n        background: { r: 0, g: 0, b: 0, alpha: 0 }\n      })\n      .toFile(join(outputDir, 'favicon.ico'));\n    \n    console.log('‚úÖ Generated favicon.ico (32x32)');\n  } catch (error) {\n    console.error('‚ùå Failed to generate favicon.ico:', error);\n  }\n  \n  console.log('üéâ All favicons generated successfully!');\n}\n\ngenerateFavicons().catch(console.error);\n","size_bytes":1584},"client/src/components/RichTextEditor.tsx":{"content":"import { useEditor, EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport Link from '@tiptap/extension-link';\nimport Underline from '@tiptap/extension-underline';\nimport TextAlign from '@tiptap/extension-text-align';\nimport { Button } from '@/components/ui/button';\nimport { \n  Bold, \n  Italic, \n  Underline as UnderlineIcon, \n  List, \n  ListOrdered,\n  Heading2,\n  Heading3,\n  AlignLeft,\n  AlignCenter,\n  AlignRight,\n  Link2,\n  Undo,\n  Redo\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface RichTextEditorProps {\n  content: string;\n  onChange: (html: string) => void;\n  placeholder?: string;\n}\n\nexport function RichTextEditor({ content, onChange, placeholder }: RichTextEditorProps) {\n  const editor = useEditor({\n    extensions: [\n      StarterKit,\n      Underline,\n      Link.configure({\n        openOnClick: false,\n        HTMLAttributes: {\n          class: 'text-primary underline',\n        },\n      }),\n      TextAlign.configure({\n        types: ['heading', 'paragraph'],\n      }),\n    ],\n    content,\n    onUpdate: ({ editor }) => {\n      onChange(editor.getHTML());\n    },\n    editorProps: {\n      attributes: {\n        class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-xl focus:outline-none min-h-[200px] max-w-none p-4',\n      },\n    },\n  });\n\n  if (!editor) {\n    return null;\n  }\n\n  const addLink = () => {\n    const url = window.prompt('Unesite URL:');\n    if (url) {\n      editor.chain().focus().setLink({ href: url }).run();\n    }\n  };\n\n  return (\n    <div className=\"border rounded-lg overflow-hidden\">\n      <div className=\"bg-muted/50 border-b p-2 flex flex-wrap gap-1\">\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleBold().run()}\n          className={cn(editor.isActive('bold') && 'bg-accent')}\n        >\n          <Bold className=\"h-4 w-4\" />\n        </Button>\n        \n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleItalic().run()}\n          className={cn(editor.isActive('italic') && 'bg-accent')}\n        >\n          <Italic className=\"h-4 w-4\" />\n        </Button>\n        \n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleUnderline().run()}\n          className={cn(editor.isActive('underline') && 'bg-accent')}\n        >\n          <UnderlineIcon className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"w-px h-8 bg-border mx-1\" />\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}\n          className={cn(editor.isActive('heading', { level: 2 }) && 'bg-accent')}\n        >\n          <Heading2 className=\"h-4 w-4\" />\n        </Button>\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}\n          className={cn(editor.isActive('heading', { level: 3 }) && 'bg-accent')}\n        >\n          <Heading3 className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"w-px h-8 bg-border mx-1\" />\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleBulletList().run()}\n          className={cn(editor.isActive('bulletList') && 'bg-accent')}\n        >\n          <List className=\"h-4 w-4\" />\n        </Button>\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().toggleOrderedList().run()}\n          className={cn(editor.isActive('orderedList') && 'bg-accent')}\n        >\n          <ListOrdered className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"w-px h-8 bg-border mx-1\" />\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().setTextAlign('left').run()}\n          className={cn(editor.isActive({ textAlign: 'left' }) && 'bg-accent')}\n        >\n          <AlignLeft className=\"h-4 w-4\" />\n        </Button>\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().setTextAlign('center').run()}\n          className={cn(editor.isActive({ textAlign: 'center' }) && 'bg-accent')}\n        >\n          <AlignCenter className=\"h-4 w-4\" />\n        </Button>\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().setTextAlign('right').run()}\n          className={cn(editor.isActive({ textAlign: 'right' }) && 'bg-accent')}\n        >\n          <AlignRight className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"w-px h-8 bg-border mx-1\" />\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={addLink}\n        >\n          <Link2 className=\"h-4 w-4\" />\n        </Button>\n\n        <div className=\"w-px h-8 bg-border mx-1\" />\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().undo().run()}\n          disabled={!editor.can().undo()}\n        >\n          <Undo className=\"h-4 w-4\" />\n        </Button>\n\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => editor.chain().focus().redo().run()}\n          disabled={!editor.can().redo()}\n        >\n          <Redo className=\"h-4 w-4\" />\n        </Button>\n      </div>\n\n      <EditorContent \n        editor={editor} \n        className=\"bg-background\"\n        placeholder={placeholder}\n      />\n    </div>\n  );\n}\n","size_bytes":5874},"client/src/hooks/use-websocket.ts":{"content":"import { useEffect, useRef, useState, useCallback } from \"react\";\nimport { useAuth } from \"./use-auth\";\n\nexport type WebSocketMessage = \n  | { type: 'online_status'; userId: number; online: boolean }\n  | { type: 'typing_start'; userId: number }\n  | { type: 'typing_stop'; userId: number }\n  | { type: 'new_message'; message: any }\n  | { type: 'message_read'; conversationId: number; readBy: number }\n  | { type: 'message_deleted'; messageId: number }\n  | { type: 'notification'; title: string; description?: string; variant?: 'default' | 'destructive' };\n\nexport function useWebSocket() {\n  const { user } = useAuth();\n  const ws = useRef<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const reconnectTimeout = useRef<NodeJS.Timeout>();\n  const messageListeners = useRef<Set<(message: WebSocketMessage) => void>>(new Set());\n\n  const connect = useCallback(() => {\n    if (!user || ws.current?.readyState === WebSocket.OPEN) return;\n\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/api/ws`;\n\n    ws.current = new WebSocket(wsUrl);\n\n    ws.current.onopen = () => {\n      console.log('[WebSocket] Connected');\n      setIsConnected(true);\n      \n      // Send authentication\n      if (user) {\n        ws.current?.send(JSON.stringify({ type: 'auth', userId: user.id }));\n      }\n    };\n\n    ws.current.onmessage = (event) => {\n      try {\n        const message = JSON.parse(event.data) as WebSocketMessage;\n        messageListeners.current.forEach(listener => listener(message));\n      } catch (error) {\n        console.error('[WebSocket] Failed to parse message:', error);\n      }\n    };\n\n    ws.current.onclose = () => {\n      console.log('[WebSocket] Disconnected');\n      setIsConnected(false);\n      \n      // Reconnect after 3 seconds\n      reconnectTimeout.current = setTimeout(() => {\n        console.log('[WebSocket] Reconnecting...');\n        connect();\n      }, 3000);\n    };\n\n    ws.current.onerror = (error) => {\n      console.error('[WebSocket] Error:', error);\n    };\n  }, [user]);\n\n  const disconnect = useCallback(() => {\n    if (reconnectTimeout.current) {\n      clearTimeout(reconnectTimeout.current);\n    }\n    \n    if (ws.current) {\n      ws.current.close();\n      ws.current = null;\n    }\n    \n    setIsConnected(false);\n  }, []);\n\n  const send = useCallback((message: any) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify(message));\n    }\n  }, []);\n\n  const subscribe = useCallback((listener: (message: WebSocketMessage) => void) => {\n    messageListeners.current.add(listener);\n    \n    return () => {\n      messageListeners.current.delete(listener);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (user) {\n      connect();\n    }\n    \n    return () => {\n      disconnect();\n    };\n  }, [user, connect, disconnect]);\n\n  return {\n    isConnected,\n    send,\n    subscribe,\n  };\n}\n","size_bytes":2962},"client/src/components/messaging/ChatInterface.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useWebSocketContext } from \"@/contexts/WebSocketContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Card } from \"@/components/ui/card\";\nimport { AvatarWithInitials } from \"@/components/ui/avatar-with-initials\";\nimport { \n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { ArrowLeft, Send, Loader2, Check, CheckCheck, Trash2 } from \"lucide-react\";\nimport { format, isToday, isYesterday, isSameDay } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Helper function to format date headers\nfunction formatDateHeader(date: Date): string {\n  if (isToday(date)) return \"Danas\";\n  if (isYesterday(date)) return \"Juƒçe\";\n  return format(date, \"dd.MM.yyyy\");\n}\n\n// Helper function to format last seen status\nfunction formatLastSeen(lastSeen: string | null): string {\n  if (!lastSeen) return \"Nepoznato\";\n  \n  const now = new Date();\n  const lastSeenDate = new Date(lastSeen);\n  const diffInMs = now.getTime() - lastSeenDate.getTime();\n  const diffInMinutes = Math.floor(diffInMs / 60000);\n  \n  if (diffInMinutes < 1) return \"Online\";\n  if (diffInMinutes < 60) return `Aktivan pre ${diffInMinutes} min`;\n  \n  const diffInHours = Math.floor(diffInMinutes / 60);\n  if (diffInHours < 24) return `Aktivan pre ${diffInHours} h`;\n  \n  const diffInDays = Math.floor(diffInHours / 24);\n  if (diffInDays === 1) return \"Aktivan juƒçe\";\n  if (diffInDays < 7) return `Aktivan pre ${diffInDays} dana`;\n  \n  return \"Aktivan davno\";\n}\n\ninterface Message {\n  id: number;\n  senderId: number;\n  receiverId: number;\n  content: string;\n  imageUrl: string | null;\n  deleted: boolean;\n  createdAt: string;\n  isRead: boolean;\n}\n\ninterface OtherUser {\n  id: number;\n  username: string;\n  email: string;\n  avatarUrl: string | null;\n  lastSeen: string | null;\n}\n\ninterface ChatInterfaceProps {\n  selectedUserId: number;\n  onBack: () => void;\n}\n\nexport default function ChatInterface({ selectedUserId, onBack }: ChatInterfaceProps) {\n  const { user } = useAuth();\n  const { send, subscribe } = useWebSocketContext();\n  const queryClient = useQueryClient();\n  const [messageText, setMessageText] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(false);\n  const [otherUserTyping, setOtherUserTyping] = useState(false);\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const typingTimeoutRef = useRef<NodeJS.Timeout>();\n  const lastUnreadMessagesRef = useRef<Set<number>>(new Set());\n\n  const { data: messages, isLoading: messagesLoading } = useQuery<Message[]>({\n    queryKey: [\"/api/messages/conversation\", selectedUserId],\n    queryFn: async () => {\n      const res = await fetch(`/api/messages/conversation/${selectedUserId}`, { cache: \"no-store\" });\n      if (!res.ok) throw new Error(\"Failed to fetch messages\");\n      return res.json();\n    },\n  });\n\n  const { data: otherUser } = useQuery<OtherUser>({\n    queryKey: [\"/api/users\", selectedUserId],\n    queryFn: async () => {\n      const res = await fetch(`/api/users/${selectedUserId}`, { cache: \"no-store\" });\n      if (!res.ok) throw new Error(\"Failed to fetch user\");\n      return res.json();\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      const res = await fetch(\"/api/messages/send\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          receiverId: selectedUserId,\n          content,\n        }),\n      });\n      if (!res.ok) throw new Error(\"Failed to send message\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/messages/conversation\", selectedUserId] });\n      setMessageText(\"\");\n    },\n  });\n\n  const deleteMessageMutation = useMutation({\n    mutationFn: async (messageId: number) => {\n      return await apiRequest(\"DELETE\", `/api/messages/${messageId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/messages/conversation\", selectedUserId] });\n    },\n  });\n\n  const scrollToBottom = useCallback(() => {\n    if (scrollAreaRef.current) {\n      const scrollContainer = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');\n      if (scrollContainer) {\n        scrollContainer.scrollTop = scrollContainer.scrollHeight;\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n\n  useEffect(() => {\n    const unsubscribe = subscribe((message) => {\n      if (message.type === \"new_message\") {\n        queryClient.invalidateQueries({ queryKey: [\"/api/messages/conversation\", selectedUserId] });\n        scrollToBottom();\n      }\n      \n      if (message.type === \"message_deleted\") {\n        queryClient.invalidateQueries({ queryKey: [\"/api/messages/conversation\", selectedUserId] });\n      }\n      \n      if (message.type === \"typing_start\" && message.userId === selectedUserId) {\n        setOtherUserTyping(true);\n      }\n      \n      if (message.type === \"typing_stop\" && message.userId === selectedUserId) {\n        setOtherUserTyping(false);\n      }\n    });\n\n    return unsubscribe;\n  }, [subscribe, selectedUserId, queryClient, scrollToBottom]);\n\n  const handleTyping = useCallback(() => {\n    if (!isTyping) {\n      setIsTyping(true);\n      send({ type: \"typing_start\", receiverId: selectedUserId });\n    }\n\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n\n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n      send({ type: \"typing_stop\", receiverId: selectedUserId });\n    }, 500);\n  }, [isTyping, send, selectedUserId]);\n\n  const handleSendMessage = () => {\n    if (!messageText.trim()) return;\n    \n    sendMessageMutation.mutate(messageText.trim());\n    \n    if (isTyping) {\n      setIsTyping(false);\n      send({ type: \"typing_stop\", receiverId: selectedUserId });\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  if (messagesLoading) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 flex flex-col h-full\">\n      <Card className=\"border-0 md:border-b rounded-none\">\n        <div className=\"p-4 flex items-center gap-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onBack}\n            className=\"md:hidden\"\n            data-testid=\"button-back-to-inbox\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n          <AvatarWithInitials\n            src={otherUser?.avatarUrl}\n            alt={otherUser?.username || \"User\"}\n            name={otherUser?.username || \"User\"}\n            userId={selectedUserId}\n            className=\"w-10 h-10 flex-shrink-0\"\n          />\n          <div className=\"flex-1\">\n            <h3 className=\"font-semibold\">{otherUser?.username || \"Uƒçitavanje...\"}</h3>\n            {otherUserTyping ? (\n              <p className=\"text-xs text-muted-foreground italic\">Korisnik kuca...</p>\n            ) : otherUser?.lastSeen && (\n              <p className=\"text-xs text-muted-foreground\">{formatLastSeen(otherUser.lastSeen)}</p>\n            )}\n          </div>\n        </div>\n      </Card>\n\n      <ScrollArea className=\"flex-1 p-4\" ref={scrollAreaRef}>\n        <div className=\"flex flex-col gap-1 pb-4\">\n          {messages && messages.length > 0 ? (\n            messages.map((message, index) => {\n              const isOwn = message.senderId === user?.id;\n              const isAlignedRight = isOwn; // User's messages RIGHT, other's LEFT (WhatsApp style)\n              const currentDate = new Date(message.createdAt);\n              const previousMessage = index > 0 ? messages[index - 1] : null;\n              const previousDate = previousMessage ? new Date(previousMessage.createdAt) : null;\n              const showDateHeader = !previousDate || !isSameDay(currentDate, previousDate);\n              \n              // Check if this message is from the same sender as previous one (for grouping)\n              const isGrouped = previousMessage && \n                previousMessage.senderId === message.senderId && \n                !showDateHeader &&\n                (new Date(message.createdAt).getTime() - new Date(previousMessage.createdAt).getTime()) < 60000; // Within 1 minute\n              \n              return (\n                <div key={message.id}>\n                  {showDateHeader && (\n                    <div className=\"flex items-center justify-center my-4\">\n                      <div className=\"bg-secondary/70 px-3 py-1 rounded-full\">\n                        <span className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                          {formatDateHeader(currentDate)}\n                        </span>\n                      </div>\n                    </div>\n                  )}\n                  <div\n                    className={cn(\n                      \"flex gap-2 items-end\",\n                      isAlignedRight ? \"justify-end\" : \"justify-start\",\n                      isGrouped ? \"mt-1\" : \"mt-4\"\n                    )}\n                  >\n                    {!isGrouped && (\n                      <AvatarWithInitials\n                        src={isOwn ? user?.avatarUrl : otherUser?.avatarUrl}\n                        alt={isOwn ? user?.username : otherUser?.username}\n                        name={isOwn ? user?.username || \"User\" : otherUser?.username || \"User\"}\n                        userId={isOwn ? user?.id : selectedUserId}\n                        className={cn(\n                          \"w-8 h-8 flex-shrink-0\",\n                          isAlignedRight && \"order-2\"\n                        )}\n                      />\n                    )}\n                    {isGrouped && <div className=\"w-8 flex-shrink-0\" />}\n                    <div className=\"flex items-start gap-1\">\n                      <div\n                        className={cn(\n                          \"rounded-lg px-3 py-2 group relative shadow-sm\",\n                          \"max-w-[min(42rem,90vw)]\",\n                          isAlignedRight\n                            ? \"bg-primary text-primary-foreground rounded-br-sm\"\n                            : \"bg-muted text-foreground rounded-bl-sm\",\n                          message.deleted && \"opacity-60\"\n                        )}\n                      >\n                        {message.deleted ? (\n                          <p className=\"text-sm italic text-muted-foreground\">Poruka obrisana</p>\n                        ) : (\n                          <>\n                            <p className=\"text-sm whitespace-pre-wrap break-words leading-relaxed [word-break:break-word] [overflow-wrap:anywhere]\">\n                              {message.content}\n                            </p>\n                            {message.imageUrl && (\n                              <img\n                                src={message.imageUrl}\n                                alt=\"attachment\"\n                                className=\"mt-2 rounded max-w-full h-auto\"\n                              />\n                            )}\n                          </>\n                        )}\n                        <div className={cn(\n                          \"flex items-center gap-1.5 mt-1\",\n                          isAlignedRight ? \"justify-end\" : \"justify-start\"\n                        )}>\n                          <span className={cn(\n                            \"text-[11px] leading-none\",\n                            isAlignedRight ? \"text-primary-foreground/60\" : \"text-muted-foreground/70\"\n                          )}>\n                            {format(new Date(message.createdAt), \"HH:mm\")}\n                          </span>\n                          {isOwn && (\n                            <span className={cn(\n                              \"flex items-center\",\n                              isAlignedRight ? \"text-primary-foreground/60\" : \"text-muted-foreground/70\"\n                            )}>\n                              {message.isRead ? (\n                                <CheckCheck className=\"w-3.5 h-3.5\" />\n                              ) : (\n                                <Check className=\"w-3.5 h-3.5\" />\n                              )}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                      {isOwn && !message.deleted && (\n                        <AlertDialog>\n                          <AlertDialogTrigger asChild>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-muted-foreground hover:text-destructive\"\n                              data-testid={`button-delete-message-${message.id}`}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </AlertDialogTrigger>\n                          <AlertDialogContent>\n                            <AlertDialogHeader>\n                              <AlertDialogTitle>Obri≈°i poruku</AlertDialogTitle>\n                              <AlertDialogDescription>\n                                Da li ste sigurni da ≈æelite da obri≈°ete ovu poruku? Poruka ƒáe biti oznaƒçena kao obrisana.\n                              </AlertDialogDescription>\n                            </AlertDialogHeader>\n                            <AlertDialogFooter>\n                              <AlertDialogCancel data-testid=\"button-cancel-delete\">Otka≈æi</AlertDialogCancel>\n                              <AlertDialogAction\n                                onClick={() => deleteMessageMutation.mutate(message.id)}\n                                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                                data-testid=\"button-confirm-delete\"\n                              >\n                                Obri≈°i\n                              </AlertDialogAction>\n                            </AlertDialogFooter>\n                          </AlertDialogContent>\n                        </AlertDialog>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })\n          ) : (\n            <div className=\"text-center text-muted-foreground py-8\">\n              <p>Nema poruka</p>\n              <p className=\"text-sm mt-1\">Po≈°aljite prvu poruku da zapoƒçnete konverzaciju</p>\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n      </ScrollArea>\n\n      <Card className=\"border-0 md:border-t rounded-none\">\n        <div className=\"p-4 flex gap-2\">\n          <Textarea\n            value={messageText}\n            onChange={(e) => {\n              setMessageText(e.target.value);\n              handleTyping();\n            }}\n            onKeyDown={handleKeyDown}\n            placeholder=\"Napi≈°ite poruku...\"\n            className=\"min-h-[60px] max-h-[120px] resize-none\"\n            disabled={sendMessageMutation.isPending}\n          />\n          <Button\n            onClick={handleSendMessage}\n            disabled={!messageText.trim() || sendMessageMutation.isPending}\n            size=\"icon\"\n            className=\"h-[60px] w-[60px] flex-shrink-0\"\n          >\n            {sendMessageMutation.isPending ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : (\n              <Send className=\"w-5 h-5\" />\n            )}\n          </Button>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":16507},"client/src/components/messaging/UserSearch.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card } from \"@/components/ui/card\";\nimport { Search, Loader2, User } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface User {\n  id: number;\n  username: string;\n  email: string;\n}\n\ninterface UserSearchProps {\n  onSelectUser: (userId: number) => void;\n}\n\nexport default function UserSearch({ onSelectUser }: UserSearchProps) {\n  const [query, setQuery] = useState(\"\");\n  const [debouncedQuery, setDebouncedQuery] = useState(\"\");\n  const [showResults, setShowResults] = useState(false);\n  const searchRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedQuery(query);\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [query]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (searchRef.current && !searchRef.current.contains(event.target as Node)) {\n        setShowResults(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  const { data: searchResults, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users/search\", debouncedQuery],\n    queryFn: async () => {\n      if (debouncedQuery.length < 2) return [];\n      const res = await fetch(`/api/users/search?q=${encodeURIComponent(debouncedQuery)}`, { cache: \"no-store\" });\n      if (!res.ok) throw new Error(\"Failed to search users\");\n      return res.json();\n    },\n    enabled: debouncedQuery.length >= 2,\n  });\n\n  const handleSelectUser = (userId: number) => {\n    onSelectUser(userId);\n    setQuery(\"\");\n    setShowResults(false);\n  };\n\n  return (\n    <div className=\"relative\" ref={searchRef} data-testid=\"user-search-container\">\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          type=\"text\"\n          placeholder=\"Pretra≈æi korisnike...\"\n          value={query}\n          onChange={(e) => {\n            setQuery(e.target.value);\n            setShowResults(true);\n          }}\n          onFocus={() => setShowResults(true)}\n          className=\"pl-10\"\n          data-testid=\"input-user-search\"\n        />\n        {isLoading && (\n          <Loader2 className=\"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground\" data-testid=\"loader-search\" />\n        )}\n      </div>\n\n      {showResults && searchResults && searchResults.length > 0 && (\n        <Card className=\"absolute top-full mt-1 w-full z-50 max-h-64 overflow-y-auto\" data-testid=\"search-results\">\n          {searchResults.map((user) => (\n            <button\n              key={user.id}\n              onClick={() => handleSelectUser(user.id)}\n              className={cn(\n                \"w-full flex items-center gap-3 p-3 hover:bg-muted/50 transition-colors text-left border-b last:border-b-0\"\n              )}\n              data-testid={`user-result-${user.id}`}\n            >\n              <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                <User className=\"w-4 h-4 text-primary\" />\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"font-medium text-sm truncate\">{user.username}</p>\n                <p className=\"text-xs text-muted-foreground truncate\">{user.email}</p>\n              </div>\n            </button>\n          ))}\n        </Card>\n      )}\n\n      {showResults && debouncedQuery.length >= 2 && searchResults?.length === 0 && !isLoading && (\n        <Card className=\"absolute top-full mt-1 w-full z-50 p-4 text-center text-sm text-muted-foreground\" data-testid=\"no-results\">\n          Nema rezultata\n        </Card>\n      )}\n\n      {showResults && debouncedQuery.length > 0 && debouncedQuery.length < 2 && (\n        <Card className=\"absolute top-full mt-1 w-full z-50 p-4 text-center text-sm text-muted-foreground\" data-testid=\"search-hint\">\n          Unesite najmanje 2 karaktera\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":4237},"client/src/components/messaging/ConversationList.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useWebSocketContext } from \"@/contexts/WebSocketContext\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { AvatarWithInitials } from \"@/components/ui/avatar-with-initials\";\nimport { Loader2 } from \"lucide-react\";\nimport { formatDistanceToNow, isToday, isYesterday, format } from \"date-fns\";\nimport { sr } from \"date-fns/locale\";\nimport { cn } from \"@/lib/utils\";\nimport { useEffect } from \"react\";\nimport UserSearch from \"./UserSearch\";\n\ninterface ConversationData {\n  id: number;\n  otherUser: {\n    id: number;\n    username: string;\n    avatarUrl: string | null;\n  };\n  lastMessage: {\n    id: number;\n    content: string;\n    senderId: number;\n    receiverId: number;\n    deleted: boolean;\n  } | null;\n  lastMessageAt: string;\n  unreadCount: number;\n  deleted: boolean;\n}\n\ninterface ConversationListProps {\n  selectedUserId: number | null;\n  onSelectConversation: (userId: number) => void;\n  searchQuery?: string;\n}\n\nfunction formatTimestamp(dateString: string): string {\n  const date = new Date(dateString);\n  \n  if (isToday(date)) {\n    return format(date, \"HH:mm\");\n  }\n  \n  if (isYesterday(date)) {\n    return \"Juƒçe\";\n  }\n  \n  const daysDiff = Math.floor((Date.now() - date.getTime()) / (1000 * 60 * 60 * 24));\n  if (daysDiff < 7) {\n    return formatDistanceToNow(date, { addSuffix: true, locale: sr });\n  }\n  \n  return format(date, \"d MMM\", { locale: sr });\n}\n\nexport default function ConversationList({ selectedUserId, onSelectConversation, searchQuery = \"\" }: ConversationListProps) {\n  const { user } = useAuth();\n  const { subscribe } = useWebSocketContext();\n\n  const { data: conversations, isLoading, refetch } = useQuery<ConversationData[]>({\n    queryKey: [\"/api/conversations\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/conversations\", { cache: \"no-store\" });\n      if (!res.ok) throw new Error(\"Failed to fetch conversations\");\n      return res.json();\n    },\n  });\n\n  // Filter conversations based on search query\n  const filteredConversations = conversations?.filter((conv) =>\n    conv.otherUser.username.toLowerCase().includes(searchQuery.toLowerCase())\n  ) || [];\n\n  useEffect(() => {\n    const unsubscribe = subscribe((message) => {\n      if (message.type === \"new_message\") {\n        refetch();\n      }\n      if (message.type === \"message_read\") {\n        refetch();\n      }\n      if (message.type === \"message_deleted\") {\n        refetch();\n      }\n    });\n\n    return unsubscribe;\n  }, [subscribe, refetch]);\n\n  const truncateMessage = (text: string | null, maxLength: number = 50): string => {\n    if (!text) return \"\";\n    if (text.length <= maxLength) return text;\n    return text.substring(0, maxLength) + \"...\";\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\" data-testid=\"conversation-list\">\n      <div className=\"p-4\">\n        <UserSearch onSelectUser={onSelectConversation} />\n      </div>\n      \n      <Separator />\n      \n      <ScrollArea className=\"flex-1\">\n        {filteredConversations && filteredConversations.length > 0 ? (\n          <div data-testid=\"conversations-list\">\n            {filteredConversations.map((conversation) => (\n              <button\n                key={conversation.id}\n                onClick={() => onSelectConversation(conversation.otherUser.id)}\n                className={cn(\n                  \"w-full flex items-start gap-3 p-4 hover:bg-muted/50 transition-colors text-left border-b\",\n                  selectedUserId === conversation.otherUser.id && \"bg-muted\"\n                )}\n                data-testid={`conversation-item-${conversation.otherUser.id}`}\n              >\n                <AvatarWithInitials\n                  src={conversation.otherUser.avatarUrl}\n                  alt={conversation.otherUser.username}\n                  name={conversation.otherUser.username}\n                  userId={conversation.otherUser.id}\n                  className=\"w-10 h-10 flex-shrink-0\"\n                />\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <p className=\"font-semibold text-sm truncate\">\n                      {conversation.otherUser.username}\n                    </p>\n                    <span className=\"text-xs text-muted-foreground ml-2 flex-shrink-0\">\n                      {formatTimestamp(conversation.lastMessageAt)}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <p className={cn(\n                      \"text-sm truncate\",\n                      conversation.unreadCount > 0 ? \"font-medium text-foreground\" : \"text-muted-foreground\"\n                    )}>\n                      {conversation.lastMessage?.deleted ? (\n                        <span className=\"italic text-muted-foreground\">Poruka obrisana</span>\n                      ) : conversation.lastMessage?.content ? (\n                        truncateMessage(conversation.lastMessage.content)\n                      ) : (\n                        <span className=\"italic\">Zapoƒçni konverzaciju</span>\n                      )}\n                    </p>\n                    {conversation.unreadCount > 0 && (\n                      <Badge variant=\"destructive\" className=\"ml-2 h-5 min-w-5 flex items-center justify-center text-xs px-1.5\">\n                        {conversation.unreadCount > 99 ? \"99+\" : conversation.unreadCount}\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              </button>\n            ))}\n          </div>\n        ) : conversations && conversations.length > 0 ? (\n          <div className=\"p-8 text-center text-muted-foreground\">\n            <p className=\"text-sm\">Nema rezultata pretrage</p>\n            <p className=\"text-xs mt-1\">Poku≈°ajte sa drugim imenom korisnika</p>\n          </div>\n        ) : (\n          <div className=\"p-8 text-center text-muted-foreground\">\n            <p className=\"text-sm\">Nema aktivnih konverzacija</p>\n            <p className=\"text-xs mt-1\">Pretra≈æite korisnike da zapoƒçnete chat</p>\n          </div>\n        )}\n      </ScrollArea>\n    </div>\n  );\n}\n","size_bytes":6557},"client/src/pages/inbox.tsx":{"content":"import { useState } from \"react\";\nimport { Helmet } from \"react-helmet-async\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Card } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { MessageCircle, Search } from \"lucide-react\";\nimport ConversationList from \"@/components/messaging/ConversationList\";\nimport ChatInterface from \"@/components/messaging/ChatInterface\";\n\nexport default function Inbox() {\n  const { user } = useAuth();\n  const [selectedUserId, setSelectedUserId] = useState<number | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  if (!user || !user.emailVerified) {\n    return (\n      <div className=\"container mx-auto px-4 py-16 text-center\">\n        <Helmet>\n          <title>Poruke - Studio LeFlow</title>\n        </Helmet>\n        <MessageCircle className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground\" />\n        <h2 className=\"text-2xl font-bold mb-2\">Pristup Odbijen</h2>\n        <p className=\"text-muted-foreground\">\n          Morate prvo verifikovati email adresu da biste pristupili porukama.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-[calc(100vh-80px)]\">\n      <Helmet>\n        <title>Poruke - Studio LeFlow</title>\n        <meta name=\"description\" content=\"Privatne poruke - Studio LeFlow\" />\n      </Helmet>\n\n      <div className=\"h-full flex flex-col md:flex-row\">\n        {/* Inbox sidebar - visible on mobile when no conversation selected */}\n        <Card \n          className={`w-full md:w-96 md:rounded-none md:rounded-l-lg border-0 md:border-r ${selectedUserId ? 'hidden md:flex' : 'flex'} flex-col`}\n          data-testid=\"inbox-sidebar\"\n        >\n          <div className=\"p-4 border-b space-y-3\">\n            <h2 className=\"text-xl font-bold\" data-testid=\"text-inbox-title\">Poruke</h2>\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Pretra≈æi konverzacije...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-conversations\"\n              />\n            </div>\n          </div>\n          <div className=\"flex-1 overflow-hidden\">\n            <ConversationList\n              selectedUserId={selectedUserId}\n              onSelectConversation={setSelectedUserId}\n              searchQuery={searchQuery}\n            />\n          </div>\n        </Card>\n\n        <Separator orientation=\"vertical\" className=\"hidden md:block\" />\n\n        {/* Chat area - visible on mobile when conversation is selected */}\n        <div \n          className={`flex-1 flex flex-col bg-muted/20 ${selectedUserId ? 'flex' : 'hidden md:flex'}`}\n          data-testid=\"chat-area\"\n        >\n          {selectedUserId ? (\n            <ChatInterface\n              selectedUserId={selectedUserId}\n              onBack={() => setSelectedUserId(null)}\n            />\n          ) : (\n            <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n              <div className=\"text-center\">\n                <MessageCircle className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                <p className=\"text-lg\">Izaberite konverzaciju da zapoƒçnete chat</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3534},"test-messaging.ts":{"content":"/**\n * End-to-End Messaging System Test\n * Tests: Authentication, User Search, Message Send/Receive, Read Receipts, WebSocket Events\n */\n\nimport WebSocket from 'ws';\n\nconst BASE_URL = 'http://localhost:5000';\nlet sessionCookie = '';\n\ninterface ApiResponse {\n  ok: boolean;\n  status: number;\n  data: any;\n}\n\n// Helper: Make authenticated HTTP request\nasync function request(method: string, path: string, body?: any): Promise<ApiResponse> {\n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n  };\n  \n  if (sessionCookie) {\n    headers['Cookie'] = sessionCookie;\n  }\n\n  const response = await fetch(`${BASE_URL}${path}`, {\n    method,\n    headers,\n    body: body ? JSON.stringify(body) : undefined,\n  });\n\n  const setCookie = response.headers.get('set-cookie');\n  if (setCookie && !sessionCookie) {\n    sessionCookie = setCookie.split(';')[0];\n  }\n\n  let data;\n  const contentType = response.headers.get('content-type');\n  if (contentType?.includes('application/json')) {\n    data = await response.json();\n  } else {\n    data = await response.text();\n  }\n\n  return {\n    ok: response.ok,\n    status: response.status,\n    data,\n  };\n}\n\n// Test 1: User Authentication\nasync function testAuthentication() {\n  console.log('\\nüîê Test 1: User Authentication');\n  \n  // Login as admin (LocalStrategy expects 'username' field, not 'email')\n  const loginRes = await request('POST', '/api/login', {\n    username: 'admin@leflow.rs', // Can be username or email\n    password: 'admin123',\n  });\n\n  if (loginRes.ok && loginRes.data.user) {\n    console.log(`‚úÖ Login successful: ${loginRes.data.user.username} (ID: ${loginRes.data.user.id})`);\n    console.log(`   Email verified: ${loginRes.data.user.emailVerified}`);\n    return loginRes.data.user;\n  } else {\n    console.log(`‚ùå Login failed: ${loginRes.status} ${JSON.stringify(loginRes.data)}`);\n    throw new Error('Authentication failed');\n  }\n}\n\n// Test 2: User Search\nasync function testUserSearch(query: string) {\n  console.log(`\\nüîç Test 2: User Search (query: \"${query}\")`);\n  \n  const searchRes = await request('GET', `/api/users/search?q=${query}`);\n  \n  if (searchRes.ok && Array.isArray(searchRes.data)) {\n    console.log(`‚úÖ Search found ${searchRes.data.length} users:`);\n    searchRes.data.forEach((user: any) => {\n      console.log(`   - ${user.username} (ID: ${user.id}, verified: ${user.emailVerified})`);\n    });\n    return searchRes.data;\n  } else {\n    console.log(`‚ùå Search failed: ${searchRes.status}`);\n    return [];\n  }\n}\n\n// Test 3: Get Conversations\nasync function testGetConversations() {\n  console.log('\\nüí¨ Test 3: Get Conversations');\n  \n  const convRes = await request('GET', '/api/conversations');\n  \n  if (convRes.ok && Array.isArray(convRes.data)) {\n    console.log(`‚úÖ Found ${convRes.data.length} conversations`);\n    convRes.data.forEach((conv: any) => {\n      console.log(`   - Conversation with user ${conv.otherUser?.username} (${conv.messageCount} messages)`);\n    });\n    return convRes.data;\n  } else {\n    console.log(`‚ùå Failed to get conversations: ${convRes.status}`);\n    return [];\n  }\n}\n\n// Test 4: Send Message\nasync function testSendMessage(receiverId: number, content: string) {\n  console.log(`\\nüì§ Test 4: Send Message to user ${receiverId}`);\n  \n  const sendRes = await request('POST', '/api/messages/send', {\n    receiverId,\n    content,\n  });\n\n  if (sendRes.ok && sendRes.data.message) {\n    console.log(`‚úÖ Message sent successfully (ID: ${sendRes.data.message.id})`);\n    console.log(`   Content: \"${sendRes.data.message.content}\"`);\n    console.log(`   Timestamp: ${sendRes.data.message.createdAt}`);\n    return sendRes.data.message;\n  } else {\n    console.log(`‚ùå Send message failed: ${sendRes.status} ${JSON.stringify(sendRes.data)}`);\n    return null;\n  }\n}\n\n// Test 5: Get Messages in Conversation\nasync function testGetMessages(otherUserId: number) {\n  console.log(`\\nüì• Test 5: Get Messages with user ${otherUserId}`);\n  \n  const msgRes = await request('GET', `/api/messages/conversation/${otherUserId}`);\n  \n  if (msgRes.ok && Array.isArray(msgRes.data)) {\n    console.log(`‚úÖ Retrieved ${msgRes.data.length} messages`);\n    msgRes.data.slice(-3).forEach((msg: any) => {\n      console.log(`   - [${msg.createdAt}] ${msg.sender.username}: \"${msg.content}\"`);\n    });\n    return msgRes.data;\n  } else {\n    console.log(`‚ùå Get messages failed: ${msgRes.status}`);\n    return [];\n  }\n}\n\n// Test 6: Mark Messages as Read\nasync function testMarkAsRead(conversationUserId: number) {\n  console.log(`\\n‚úÖ Test 6: Mark Messages as Read (conversation with ${conversationUserId})`);\n  \n  const readRes = await request('PUT', '/api/messages/mark-read', {\n    conversationUserId,\n  });\n\n  if (readRes.ok) {\n    console.log(`‚úÖ Messages marked as read successfully`);\n    return true;\n  } else {\n    console.log(`‚ùå Mark as read failed: ${readRes.status}`);\n    return false;\n  }\n}\n\n// Test 7: Get Unread Count\nasync function testUnreadCount() {\n  console.log('\\nüîî Test 7: Get Unread Message Count');\n  \n  const countRes = await request('GET', '/api/messages/unread-count');\n  \n  if (countRes.ok && typeof countRes.data.count === 'number') {\n    console.log(`‚úÖ Unread messages: ${countRes.data.count}`);\n    return countRes.data.count;\n  } else {\n    console.log(`‚ùå Get unread count failed: ${countRes.status}`);\n    return null;\n  }\n}\n\n// Test 8: WebSocket Connection\nasync function testWebSocket(userId: number): Promise<void> {\n  console.log('\\nüîå Test 8: WebSocket Real-Time Connection');\n  \n  return new Promise((resolve, reject) => {\n    const ws = new WebSocket(`ws://localhost:5000/api/ws`);\n    let authenticated = false;\n    \n    const timeout = setTimeout(() => {\n      console.log('‚ö†Ô∏è  WebSocket test timeout (10s)');\n      ws.close();\n      resolve(); // Don't reject, just resolve with warning\n    }, 10000);\n\n    ws.on('open', () => {\n      console.log('‚úÖ WebSocket connected');\n      // Send auth message\n      ws.send(JSON.stringify({ type: 'auth', userId }));\n    });\n\n    ws.on('message', (data) => {\n      const message = JSON.parse(data.toString());\n      \n      if (message.type === 'authenticated') {\n        authenticated = true;\n        console.log(`‚úÖ WebSocket authenticated for user ${userId}`);\n        \n        // Test typing indicator\n        ws.send(JSON.stringify({ \n          type: 'typing_start', \n          conversationUserId: 25 // Example user\n        }));\n        console.log('‚úÖ Typing indicator sent');\n        \n        // Clean up after 2 seconds\n        setTimeout(() => {\n          clearTimeout(timeout);\n          ws.close();\n          console.log('‚úÖ WebSocket test completed');\n          resolve();\n        }, 2000);\n      } else {\n        console.log(`   WebSocket event: ${message.type}`);\n      }\n    });\n\n    ws.on('error', (error) => {\n      console.log(`‚ö†Ô∏è  WebSocket error: ${error.message}`);\n      clearTimeout(timeout);\n      resolve(); // Don't fail the test\n    });\n\n    ws.on('close', () => {\n      if (!authenticated) {\n        console.log('‚ö†Ô∏è  WebSocket closed before authentication');\n      }\n      clearTimeout(timeout);\n      resolve();\n    });\n  });\n}\n\n// Run all tests\nasync function runAllTests() {\n  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n  console.log('  STUDIO LEFLOW - MESSAGING SYSTEM E2E TESTS');\n  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n\n  try {\n    // Test 1: Authentication\n    const currentUser = await testAuthentication();\n    \n    if (!currentUser.emailVerified) {\n      console.log('\\n‚ö†Ô∏è  WARNING: Current user email not verified!');\n      console.log('   Messaging features require email verification.');\n      console.log('   Some tests may fail due to requireVerifiedEmail middleware.');\n    }\n\n    // Test 2: User Search\n    const users = await testUserSearch('v');\n    \n    // Test 3: Get Conversations\n    await testGetConversations();\n    \n    // Test 4-7: Message Flow (if we have users to message)\n    if (users.length > 0 && currentUser.emailVerified) {\n      const targetUser = users.find((u: any) => u.id !== currentUser.id);\n      \n      if (targetUser) {\n        // Send message\n        const message = await testSendMessage(\n          targetUser.id, \n          `Test message from automated E2E test - ${new Date().toISOString()}`\n        );\n        \n        if (message) {\n          // Get messages\n          await testGetMessages(targetUser.id);\n          \n          // Mark as read\n          await testMarkAsRead(targetUser.id);\n          \n          // Check unread count\n          await testUnreadCount();\n        }\n      }\n    } else if (!currentUser.emailVerified) {\n      console.log('\\n‚ö†Ô∏è  Skipping message flow tests (email not verified)');\n    }\n    \n    // Test 8: WebSocket\n    if (currentUser.emailVerified) {\n      await testWebSocket(currentUser.id);\n    } else {\n      console.log('\\n‚ö†Ô∏è  Skipping WebSocket test (email not verified)');\n    }\n    \n    console.log('\\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n    console.log('  ‚úÖ ALL TESTS COMPLETED');\n    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n');\n    \n  } catch (error: any) {\n    console.error('\\n‚ùå TEST SUITE FAILED:', error.message);\n    console.error('Stack trace:', error.stack);\n    process.exit(1);\n  }\n}\n\n// Execute tests\nrunAllTests();\n","size_bytes":9853},"client/src/contexts/WebSocketContext.tsx":{"content":"import { createContext, useContext, useEffect, useRef, useState, useCallback, ReactNode } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport notificationSound from \"@assets/bottle-opening-wine-cork-pop-352701_1762664855578.mp3\";\n\nexport type WebSocketMessage = \n  | { type: 'online_status'; userId: number; online: boolean }\n  | { type: 'typing_start'; userId: number }\n  | { type: 'typing_stop'; userId: number }\n  | { type: 'new_message'; message: any }\n  | { type: 'message_read'; conversationId: number; readBy: number }\n  | { type: 'message_deleted'; messageId: number }\n  | { type: 'notification'; title: string; description?: string; variant?: 'default' | 'destructive' }\n  | { type: 'community-chat:new'; message: any }\n  | { type: 'community-chat:delete'; messageId: number };\n\ninterface WebSocketContextType {\n  isConnected: boolean;\n  send: (message: any) => void;\n  subscribe: (listener: (message: WebSocketMessage) => void) => () => void;\n}\n\nconst WebSocketContext = createContext<WebSocketContextType | null>(null);\n\nexport function WebSocketProvider({ children }: { children: ReactNode }) {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const ws = useRef<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const reconnectTimeout = useRef<NodeJS.Timeout>();\n  const messageListeners = useRef<Set<(message: WebSocketMessage) => void>>(new Set());\n  const userRef = useRef(user); // Track current user to prevent stale reconnects\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n\n  const connect = useCallback(() => {\n    // CRITICAL: Read from ref, not closure, to prevent stale reconnects\n    const currentUser = userRef.current;\n    if (!currentUser) return;\n    \n    // Only prevent connection if socket is currently open or connecting\n    if (ws.current?.readyState === WebSocket.OPEN || ws.current?.readyState === WebSocket.CONNECTING) {\n      return;\n    }\n\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/api/ws`;\n\n    ws.current = new WebSocket(wsUrl);\n\n    ws.current.onopen = () => {\n      console.log('[WebSocket] Connected');\n      setIsConnected(true);\n      \n      const authUser = userRef.current;\n      if (authUser) {\n        ws.current?.send(JSON.stringify({ type: 'auth', userId: authUser.id }));\n      }\n    };\n\n    ws.current.onmessage = (event) => {\n      try {\n        const message = JSON.parse(event.data) as WebSocketMessage;\n        \n        // Handle notification messages globally\n        if (message.type === 'notification') {\n          toast({\n            title: message.title,\n            description: message.description,\n            variant: message.variant || 'default',\n          });\n          \n          // Play notification sound\n          if (!audioRef.current) {\n            audioRef.current = new Audio(notificationSound);\n            audioRef.current.volume = 0.5;\n          }\n          audioRef.current.play().catch((error) => {\n            console.log('[WebSocket] Could not play notification sound:', error);\n          });\n        }\n        \n        // Play notification sound for new messages from other users\n        if (message.type === 'new_message') {\n          const currentUserId = userRef.current?.id;\n          const messageSenderId = message.message?.senderId;\n          \n          // Only play sound if message is from another user\n          if (currentUserId && messageSenderId && messageSenderId !== currentUserId) {\n            if (!audioRef.current) {\n              audioRef.current = new Audio(notificationSound);\n              audioRef.current.volume = 0.5; // 50% volume\n            }\n            \n            // Play notification sound\n            audioRef.current.play().catch((error) => {\n              console.log('[WebSocket] Could not play notification sound:', error);\n            });\n          }\n        }\n        \n        messageListeners.current.forEach(listener => listener(message));\n      } catch (error) {\n        console.error('[WebSocket] Failed to parse message:', error);\n      }\n    };\n\n    ws.current.onclose = () => {\n      console.log('[WebSocket] Disconnected');\n      setIsConnected(false);\n      ws.current = null; // Clear the reference so reconnect can create new socket\n      \n      reconnectTimeout.current = setTimeout(() => {\n        // CRITICAL: Check current user from ref, not closure\n        // This prevents reconnecting with stale auth after logout\n        if (userRef.current) {\n          console.log('[WebSocket] Reconnecting...');\n          connect();\n        }\n      }, 3000);\n    };\n\n    ws.current.onerror = (error) => {\n      console.error('[WebSocket] Error:', error);\n    };\n  }, []); // No user dependency - reads from ref instead\n\n  const disconnect = useCallback(() => {\n    if (reconnectTimeout.current) {\n      clearTimeout(reconnectTimeout.current);\n    }\n    \n    if (ws.current) {\n      ws.current.close();\n      ws.current = null;\n    }\n    \n    setIsConnected(false);\n  }, []);\n\n  const send = useCallback((message: any) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify(message));\n    }\n  }, []);\n\n  const subscribe = useCallback((listener: (message: WebSocketMessage) => void) => {\n    messageListeners.current.add(listener);\n    \n    return () => {\n      messageListeners.current.delete(listener);\n    };\n  }, []);\n\n  useEffect(() => {\n    userRef.current = user; // Always update userRef when user changes\n  }, [user]);\n\n  useEffect(() => {\n    if (user) {\n      connect();\n    } else {\n      disconnect();\n    }\n    \n    return () => {\n      disconnect();\n    };\n  }, [user, connect, disconnect]);\n\n  return (\n    <WebSocketContext.Provider value={{ isConnected, send, subscribe }}>\n      {children}\n    </WebSocketContext.Provider>\n  );\n}\n\nexport function useWebSocketContext() {\n  const context = useContext(WebSocketContext);\n  if (!context) {\n    throw new Error('useWebSocketContext must be used within WebSocketProvider');\n  }\n  return context;\n}\n","size_bytes":6140},"client/src/components/ui/avatar-with-initials.tsx":{"content":"import { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { cn } from \"@/lib/utils\";\n\ninterface AvatarWithInitialsProps {\n  src?: string | null;\n  alt?: string;\n  name: string;\n  userId?: number;\n  className?: string;\n  fallbackClassName?: string;\n}\n\nfunction generateColorFromId(id?: number): { bg: string; text: string } {\n  if (!id) {\n    return {\n      bg: \"hsl(var(--primary) / 0.1)\",\n      text: \"hsl(var(--primary))\",\n    };\n  }\n  \n  const colors = [\n    { bg: \"hsl(220, 85%, 92%)\", bgDark: \"hsl(220, 70%, 20%)\", text: \"hsl(220, 90%, 35%)\", textDark: \"hsl(220, 85%, 85%)\" },  // Blue\n    { bg: \"hsl(280, 85%, 92%)\", bgDark: \"hsl(280, 70%, 20%)\", text: \"hsl(280, 90%, 35%)\", textDark: \"hsl(280, 85%, 85%)\" },  // Purple\n    { bg: \"hsl(340, 85%, 92%)\", bgDark: \"hsl(340, 70%, 20%)\", text: \"hsl(340, 90%, 35%)\", textDark: \"hsl(340, 85%, 85%)\" },  // Pink\n    { bg: \"hsl(30, 85%, 92%)\", bgDark: \"hsl(30, 70%, 20%)\", text: \"hsl(30, 90%, 35%)\", textDark: \"hsl(30, 85%, 85%)\" },   // Orange\n    { bg: \"hsl(160, 85%, 92%)\", bgDark: \"hsl(160, 70%, 20%)\", text: \"hsl(160, 90%, 30%)\", textDark: \"hsl(160, 85%, 85%)\" },  // Teal\n    { bg: \"hsl(120, 85%, 92%)\", bgDark: \"hsl(120, 70%, 20%)\", text: \"hsl(120, 90%, 30%)\", textDark: \"hsl(120, 85%, 85%)\" },  // Green\n    { bg: \"hsl(50, 85%, 92%)\", bgDark: \"hsl(50, 70%, 25%)\", text: \"hsl(50, 90%, 30%)\", textDark: \"hsl(50, 85%, 85%)\" },   // Yellow\n    { bg: \"hsl(10, 85%, 92%)\", bgDark: \"hsl(10, 70%, 20%)\", text: \"hsl(10, 90%, 35%)\", textDark: \"hsl(10, 85%, 85%)\" },   // Red\n  ];\n  \n  const index = id % colors.length;\n  const color = colors[index]!;\n  \n  return {\n    bg: color.bg,\n    text: color.text,\n  };\n}\n\nfunction getInitials(name: string): string {\n  if (!name) return \"?\";\n  \n  const parts = name.trim().split(/\\s+/).filter(Boolean);\n  \n  if (parts.length === 0) return \"?\";\n  if (parts.length === 1) {\n    return parts[0]!.substring(0, 2).toUpperCase();\n  }\n  \n  return (parts[0]![0] + (parts[1]?.[0] || parts[0]![1] || \"\")).toUpperCase();\n}\n\nexport function AvatarWithInitials({\n  src,\n  alt,\n  name,\n  userId,\n  className,\n  fallbackClassName,\n}: AvatarWithInitialsProps) {\n  const initials = getInitials(name);\n  const colors = generateColorFromId(userId);\n\n  return (\n    <Avatar className={className}>\n      {src ? (\n        <AvatarImage src={src} alt={alt || name} />\n      ) : null}\n      <AvatarFallback\n        className={cn(\"font-semibold\", fallbackClassName)}\n        style={{\n          backgroundColor: colors.bg,\n          color: colors.text,\n        }}\n      >\n        {initials}\n      </AvatarFallback>\n    </Avatar>\n  );\n}\n","size_bytes":2621},"server/websocket-helpers.ts":{"content":"type BroadcastFunction = (userId: number, message: any) => void;\ntype NotificationFunction = (userId: number, title: string, description?: string, variant?: 'default' | 'destructive') => void;\ntype OnlineUsersAccessor = () => number[];\n\ninterface WebSocketHelpers {\n  broadcastToUser: BroadcastFunction | null;\n  sendNotification: NotificationFunction | null;\n  getOnlineUserIds: OnlineUsersAccessor | null;\n}\n\nexport const wsHelpers: WebSocketHelpers = {\n  broadcastToUser: null,\n  sendNotification: null,\n  getOnlineUserIds: null,\n};\n\nexport function setBroadcastFunction(fn: BroadcastFunction) {\n  wsHelpers.broadcastToUser = fn;\n}\n\nexport function setNotificationFunction(fn: NotificationFunction) {\n  wsHelpers.sendNotification = fn;\n}\n\nexport function setOnlineUsersAccessor(fn: OnlineUsersAccessor) {\n  wsHelpers.getOnlineUserIds = fn;\n}\n\nexport function notifyUser(userId: number, title: string, description?: string, variant: 'default' | 'destructive' = 'default') {\n  if (wsHelpers.sendNotification) {\n    wsHelpers.sendNotification(userId, title, description, variant);\n  } else {\n    console.warn('[WS] sendNotification not initialized yet, skipping notification');\n  }\n}\n\nexport function getOnlineUsersSnapshot(): number[] {\n  if (wsHelpers.getOnlineUserIds) {\n    return wsHelpers.getOnlineUserIds();\n  }\n  return [];\n}\n","size_bytes":1334},"client/src/components/admin/ContractsTab.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { FileText, Download, Mail, Trash2, Music, Scale, DollarSign, UserPlus } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Contract {\n  id: number;\n  contractNumber: string;\n  contractType: \"mix_master\" | \"copyright_transfer\" | \"instrumental_sale\";\n  contractData: any;\n  pdfPath: string | null;\n  clientEmail: string | null;\n  createdAt: string;\n  createdBy: number;\n  userId: number | null;\n  username: string | null;\n}\n\nexport function ContractsTab() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState<\"new\" | \"history\">(\"new\");\n  const [selectedContractType, setSelectedContractType] = useState<\"mix_master\" | \"copyright_transfer\" | \"instrumental_sale\">(\"mix_master\");\n\n  // Users query for assignment\n  const { data: users = [] } = useQuery<Array<{ id: number; username: string; email: string }>>({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  // Contract history query\n  const { data: contracts = [], isLoading: contractsLoading } = useQuery<Contract[]>({\n    queryKey: [\"/api/admin/contracts\"],\n    enabled: activeTab === \"history\",\n  });\n\n  // Generate contract mutation\n  const generateMutation = useMutation({\n    mutationFn: async (data: { contractType: string; contractData: any }) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/contracts/generate\", data);\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/contracts\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Ugovor je uspe≈°no generisan!\",\n      });\n      setActiveTab(\"history\");\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: error.message || \"Gre≈°ka pri generisanju ugovora\",\n      });\n    },\n  });\n\n  // Delete contract mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/admin/contracts/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/contracts\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Ugovor je uspe≈°no obrisan!\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri brisanju ugovora\",\n      });\n    },\n  });\n\n  // Assign user mutation\n  const assignUserMutation = useMutation({\n    mutationFn: async ({ contractId, userId }: { contractId: number; userId: number | null }) => {\n      await apiRequest(\"PATCH\", `/api/admin/contracts/${contractId}/assign-user`, { userId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/contracts\"] });\n      toast({\n        title: \"Uspeh\",\n        description: \"Korisnik uspe≈°no dodeljen ugovoru!\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri dodeli korisnika\",\n      });\n    },\n  });\n\n  const getContractTypeLabel = (type: string) => {\n    switch (type) {\n      case \"mix_master\": return \"Mix & Master\";\n      case \"copyright_transfer\": return \"Prenos autorskih prava\";\n      case \"instrumental_sale\": return \"Prodaja instrumentala\";\n      default: return type;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)}>\n        <TabsList>\n          <TabsTrigger value=\"new\">Kreiraj Novi Ugovor</TabsTrigger>\n          <TabsTrigger value=\"history\">Istorija Ugovora</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"new\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Izaberite Tip Ugovora</CardTitle>\n              <CardDescription>\n                Popunite formu i automatski generi≈° PDF ugovor\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Tabs value={selectedContractType} onValueChange={(v) => setSelectedContractType(v as any)}>\n                <TabsList className=\"flex flex-col lg:grid lg:grid-cols-3 w-full gap-2 bg-transparent p-0 h-auto mb-8\">\n                  <TabsTrigger value=\"mix_master\" className=\"flex items-center justify-center gap-2\" data-testid=\"tab-contract-mix-master\">\n                    <Music className=\"w-4 h-4\" />\n                    Mix & Master\n                  </TabsTrigger>\n                  <TabsTrigger value=\"copyright_transfer\" className=\"flex items-center justify-center gap-2\" data-testid=\"tab-contract-copyright\">\n                    <Scale className=\"w-4 h-4\" />\n                    Autorska prava\n                  </TabsTrigger>\n                  <TabsTrigger value=\"instrumental_sale\" className=\"flex items-center justify-center gap-2\" data-testid=\"tab-contract-instrumental\">\n                    <DollarSign className=\"w-4 h-4\" />\n                    Prodaja beat-a\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"mix_master\">\n                  <MixMasterForm onSubmit={(data) => generateMutation.mutate({ contractType: \"mix_master\", contractData: data })} isSubmitting={generateMutation.isPending} />\n                </TabsContent>\n\n                <TabsContent value=\"copyright_transfer\">\n                  <CopyrightTransferForm onSubmit={(data) => generateMutation.mutate({ contractType: \"copyright_transfer\", contractData: data })} isSubmitting={generateMutation.isPending} />\n                </TabsContent>\n\n                <TabsContent value=\"instrumental_sale\">\n                  <InstrumentalSaleForm onSubmit={(data) => generateMutation.mutate({ contractType: \"instrumental_sale\", contractData: data })} isSubmitting={generateMutation.isPending} />\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"history\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <FileText className=\"w-5 h-5\" />\n                Istorija Ugovora\n              </CardTitle>\n              <CardDescription>\n                Svi generisani ugovori sa opcijama za download i slanje emailom\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {contractsLoading ? (\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-12 w-full\" />\n                  <Skeleton className=\"h-12 w-full\" />\n                  <Skeleton className=\"h-12 w-full\" />\n                </div>\n              ) : contracts.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <FileText className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p>Jo≈° uvek nema kreiranih ugovora</p>\n                </div>\n              ) : (\n                <>\n                  {/* Mobile Card Layout */}\n                  <div className=\"space-y-4 md:hidden\">\n                    {contracts.map((contract) => (\n                      <div key={contract.id} className=\"rounded-md border bg-card p-4 space-y-3\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <div className=\"space-y-1 flex-1 min-w-0\">\n                              <div className=\"font-semibold text-sm\">{contract.contractNumber}</div>\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {getContractTypeLabel(contract.contractType)}\n                              </Badge>\n                            </div>\n                            <div className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                              {format(new Date(contract.createdAt), \"dd.MM.yyyy\")}\n                            </div>\n                          </div>\n\n                          <div className=\"flex items-center gap-2 text-sm\">\n                            <span className=\"text-muted-foreground\">Korisnik:</span>\n                            {contract.username ? (\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                {contract.username}\n                              </Badge>\n                            ) : (\n                              <span className=\"text-xs text-muted-foreground\">Nije dodeljen</span>\n                            )}\n                          </div>\n\n                          <div className=\"flex flex-wrap gap-2 pt-2 border-t\">\n                            <AssignUserDialog\n                              contractId={contract.id}\n                              contractNumber={contract.contractNumber}\n                              currentUserId={contract.userId}\n                              currentUsername={contract.username}\n                              users={users}\n                              onAssign={(userId) => assignUserMutation.mutate({ contractId: contract.id, userId })}\n                              isAssigning={assignUserMutation.isPending}\n                            />\n\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => window.open(`/api/admin/contracts/${contract.id}/download`, '_blank')}\n                              data-testid={`button-download-contract-${contract.id}`}\n                              className=\"flex-1\"\n                            >\n                              <Download className=\"w-4 h-4 mr-2\" />\n                              Download\n                            </Button>\n\n                            <SendEmailDialog contractId={contract.id} contractNumber={contract.contractNumber} />\n\n                            <AlertDialog>\n                              <AlertDialogTrigger asChild>\n                                <Button variant=\"ghost\" size=\"sm\" data-testid={`button-delete-contract-${contract.id}`}>\n                                  <Trash2 className=\"w-4 h-4 text-destructive\" />\n                                </Button>\n                              </AlertDialogTrigger>\n                              <AlertDialogContent>\n                                <AlertDialogHeader>\n                                  <AlertDialogTitle>Obri≈°i Ugovor?</AlertDialogTitle>\n                                  <AlertDialogDescription>\n                                    Da li ste sigurni da ≈æelite da obri≈°ete ugovor {contract.contractNumber}?\n                                    Ova akcija se ne mo≈æe poni≈°titi.\n                                  </AlertDialogDescription>\n                                </AlertDialogHeader>\n                                <AlertDialogFooter>\n                                  <AlertDialogCancel>Otka≈æi</AlertDialogCancel>\n                                  <AlertDialogAction onClick={() => deleteMutation.mutate(contract.id)}>\n                                    Obri≈°i\n                                  </AlertDialogAction>\n                                </AlertDialogFooter>\n                              </AlertDialogContent>\n                            </AlertDialog>\n                          </div>\n                        </div>\n                    ))}\n                  </div>\n\n                  {/* Desktop Table Layout */}\n                  <div className=\"hidden md:block rounded-md border overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Broj</TableHead>\n                          <TableHead>Tip</TableHead>\n                          <TableHead>Dodeljen Korisniku</TableHead>\n                          <TableHead>Datum</TableHead>\n                          <TableHead className=\"text-right\">Akcije</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {contracts.map((contract) => (\n                          <TableRow key={contract.id}>\n                            <TableCell className=\"font-medium\">\n                              {contract.contractNumber}\n                            </TableCell>\n                            <TableCell>\n                              <Badge variant=\"secondary\">\n                                {getContractTypeLabel(contract.contractType)}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>\n                              {contract.username ? (\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  {contract.username}\n                                </Badge>\n                              ) : (\n                                <span className=\"text-xs text-muted-foreground\">Nije dodeljen</span>\n                              )}\n                            </TableCell>\n                            <TableCell className=\"text-muted-foreground\">\n                              {format(new Date(contract.createdAt), \"dd.MM.yyyy\")}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex flex-wrap items-center justify-end gap-2\">\n                                <AssignUserDialog\n                                  contractId={contract.id}\n                                  contractNumber={contract.contractNumber}\n                                  currentUserId={contract.userId}\n                                  currentUsername={contract.username}\n                                  users={users}\n                                  onAssign={(userId) => assignUserMutation.mutate({ contractId: contract.id, userId })}\n                                  isAssigning={assignUserMutation.isPending}\n                                />\n\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => window.open(`/api/admin/contracts/${contract.id}/download`, '_blank')}\n                                  data-testid={`button-download-contract-${contract.id}`}\n                                >\n                                  <Download className=\"w-4 h-4\" />\n                                </Button>\n\n                                <SendEmailDialog contractId={contract.id} contractNumber={contract.contractNumber} />\n\n                                <AlertDialog>\n                                  <AlertDialogTrigger asChild>\n                                    <Button variant=\"ghost\" size=\"sm\" data-testid={`button-delete-contract-${contract.id}`}>\n                                      <Trash2 className=\"w-4 h-4 text-destructive\" />\n                                    </Button>\n                                  </AlertDialogTrigger>\n                                  <AlertDialogContent>\n                                    <AlertDialogHeader>\n                                      <AlertDialogTitle>Obri≈°i Ugovor?</AlertDialogTitle>\n                                      <AlertDialogDescription>\n                                        Da li ste sigurni da ≈æelite da obri≈°ete ugovor {contract.contractNumber}?\n                                        Ova akcija se ne mo≈æe poni≈°titi.\n                                      </AlertDialogDescription>\n                                    </AlertDialogHeader>\n                                    <AlertDialogFooter>\n                                      <AlertDialogCancel>Otka≈æi</AlertDialogCancel>\n                                      <AlertDialogAction onClick={() => deleteMutation.mutate(contract.id)}>\n                                        Obri≈°i\n                                      </AlertDialogAction>\n                                    </AlertDialogFooter>\n                                  </AlertDialogContent>\n                                </AlertDialog>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\n// Assign User Dialog Component\nfunction AssignUserDialog({\n  contractId,\n  contractNumber,\n  currentUserId,\n  currentUsername,\n  users,\n  onAssign,\n  isAssigning\n}: {\n  contractId: number;\n  contractNumber: string;\n  currentUserId: number | null;\n  currentUsername: string | null;\n  users: Array<{ id: number; username: string; email: string }>;\n  onAssign: (userId: number | null) => void;\n  isAssigning: boolean;\n}) {\n  const [open, setOpen] = useState(false);\n  const [selectedUserId, setSelectedUserId] = useState<string>(currentUserId?.toString() || \"null\");\n\n  const handleAssign = () => {\n    const userId = selectedUserId === \"null\" ? null : parseInt(selectedUserId);\n    onAssign(userId);\n    setOpen(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          data-testid={`button-assign-user-${contractId}`}\n          title={currentUsername ? `Trenutno dodeljen: ${currentUsername}` : \"Dodeli korisniku\"}\n        >\n          <UserPlus className=\"w-4 h-4\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Dodeli Ugovor Korisniku</DialogTitle>\n          <DialogDescription>\n            Ugovor {contractNumber} - Izaberite korisnika koji ƒáe videti ovaj ugovor u svom dashboard-u\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4 py-4\">\n          {currentUsername && (\n            <div className=\"p-3 bg-muted rounded-md text-sm\">\n              <span className=\"text-muted-foreground\">Trenutno dodeljen: </span>\n              <span className=\"font-medium\">{currentUsername}</span>\n            </div>\n          )}\n          <div className=\"space-y-2\">\n            <Label>Korisnik</Label>\n            <Select value={selectedUserId} onValueChange={setSelectedUserId}>\n              <SelectTrigger data-testid=\"select-contract-user\">\n                <SelectValue placeholder=\"Izaberite korisnika\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"null\">Nijedan (ukloni dodelu)</SelectItem>\n                {users.map((user) => (\n                  <SelectItem key={user.id} value={user.id.toString()}>\n                    {user.username} ({user.email})\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\n            Otka≈æi\n          </Button>\n          <Button\n            onClick={handleAssign}\n            disabled={isAssigning}\n            data-testid=\"button-confirm-assign-user\"\n          >\n            {isAssigning ? \"Dodeljuje se...\" : \"Dodeli\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Send Email Dialog Component\nfunction SendEmailDialog({ contractId, contractNumber }: { contractId: number; contractNumber: string }) {\n  const [open, setOpen] = useState(false);\n  const [email, setEmail] = useState(\"\");\n  const { toast } = useToast();\n\n  const sendEmailMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", `/api/admin/contracts/${contractId}/send-email`, { email });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Uspeh\",\n        description: `Email uspe≈°no poslat na ${email}!`,\n      });\n      setOpen(false);\n      setEmail(\"\");\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri slanju email-a\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"ghost\" size=\"sm\" data-testid={`button-email-contract-${contractId}`}>\n          <Mail className=\"w-4 h-4\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Po≈°alji Ugovor Email-om</DialogTitle>\n          <DialogDescription>\n            Unesite email adresu klijenta za ugovor {contractNumber}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email Adresa</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder=\"klijent@example.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              data-testid=\"input-contract-email\"\n            />\n          </div>\n        </div>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\n            Otka≈æi\n          </Button>\n          <Button\n            onClick={() => sendEmailMutation.mutate()}\n            disabled={!email || sendEmailMutation.isPending}\n            data-testid=\"button-send-contract-email\"\n          >\n            {sendEmailMutation.isPending ? \"≈†alje se...\" : \"Po≈°alji\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Mix & Master Form Component\nfunction MixMasterForm({ onSubmit, isSubmitting }: { onSubmit: (data: any) => void; isSubmitting: boolean }) {\n  const [formData, setFormData] = useState({\n    contractDate: format(new Date(), \"dd/MM/yyyy\"),\n    contractPlace: \"Beograd\",\n    studioName: \"LeFlow Studio\",\n    studioAddress: \"\",\n    studioMaticniBroj: \"\",\n    clientName: \"\",\n    clientAddress: \"\",\n    clientMaticniBroj: \"\",\n    projectName: \"\",\n    channelCount: \"\",\n    deliveryFormat: \"WAV 24bit / 44.1 kHz, MP3 320 kbps\",\n    deliveryDate: \"\",\n    totalAmount: \"\",\n    advancePayment: \"\",\n    remainingPayment: \"\",\n    paymentMethod: \"Uplata na raƒçun\",\n    vocalRecording: \"no\" as \"yes\" | \"no\",\n    vocalRights: \"client\" as \"client\" | \"studio\" | \"other\",\n    vocalRightsOther: \"\",\n    jurisdiction: \"Beograd\",\n    copies: \"2\",\n    finalDate: format(new Date(), \"dd/MM/yyyy\"),\n  });\n\n  const handleChange = (field: string, value: any) => {\n    setFormData(prev => {\n      const updated = { ...prev, [field]: value };\n      \n      // Auto-calculate remaining payment\n      if (field === \"totalAmount\" || field === \"advancePayment\") {\n        const total = parseFloat(updated.totalAmount || \"0\");\n        const advance = parseFloat(updated.advancePayment || \"0\");\n        updated.remainingPayment = (total - advance).toString();\n      }\n      \n      return updated;\n    });\n  };\n\n  return (\n    <form onSubmit={(e) => { e.preventDefault(); onSubmit(formData); }} className=\"space-y-6 mt-4\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Datum Ugovora</Label>\n          <Input value={formData.contractDate} onChange={(e) => handleChange(\"contractDate\", e.target.value)} data-testid=\"input-contract-date\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Mesto</Label>\n          <Input value={formData.contractPlace} onChange={(e) => handleChange(\"contractPlace\", e.target.value)} data-testid=\"input-contract-place\" />\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Studio Podaci</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Naziv Studija</Label>\n            <Input value={formData.studioName} onChange={(e) => handleChange(\"studioName\", e.target.value)} data-testid=\"input-studio-name\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Adresa Studija</Label>\n            <Input value={formData.studioAddress} onChange={(e) => handleChange(\"studioAddress\", e.target.value)} data-testid=\"input-studio-address\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Matiƒçni Broj Studija</Label>\n            <Input value={formData.studioMaticniBroj} onChange={(e) => handleChange(\"studioMaticniBroj\", e.target.value)} data-testid=\"input-studio-mb\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Podaci Klijenta</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ime i Prezime / Poslovno Ime</Label>\n            <Input value={formData.clientName} onChange={(e) => handleChange(\"clientName\", e.target.value)} data-testid=\"input-client-name\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Adresa Klijenta</Label>\n            <Input value={formData.clientAddress} onChange={(e) => handleChange(\"clientAddress\", e.target.value)} data-testid=\"input-client-address\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Matiƒçni Broj Klijenta</Label>\n            <Input value={formData.clientMaticniBroj} onChange={(e) => handleChange(\"clientMaticniBroj\", e.target.value)} data-testid=\"input-client-mb\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Detalji Projekta</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Naziv Pesme / Projekta</Label>\n            <Input value={formData.projectName} onChange={(e) => handleChange(\"projectName\", e.target.value)} data-testid=\"input-project-name\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Broj Kanala / Stemova</Label>\n            <Input value={formData.channelCount} onChange={(e) => handleChange(\"channelCount\", e.target.value)} data-testid=\"input-channel-count\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Format Isporuke</Label>\n            <Input value={formData.deliveryFormat} onChange={(e) => handleChange(\"deliveryFormat\", e.target.value)} data-testid=\"input-delivery-format\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Rok Isporuke</Label>\n            <Input value={formData.deliveryDate} onChange={(e) => handleChange(\"deliveryDate\", e.target.value)} placeholder=\"DD/MM/YYYY\" data-testid=\"input-delivery-date\" required />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Finansije</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ukupna Naknada (RSD)</Label>\n            <Input type=\"number\" value={formData.totalAmount} onChange={(e) => handleChange(\"totalAmount\", e.target.value)} data-testid=\"input-total-amount\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Avans (RSD)</Label>\n            <Input type=\"number\" value={formData.advancePayment} onChange={(e) => handleChange(\"advancePayment\", e.target.value)} data-testid=\"input-advance-payment\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Ostatak (auto)</Label>\n            <Input type=\"number\" value={formData.remainingPayment} readOnly className=\"bg-muted\" data-testid=\"input-remaining-payment\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Naƒçin Plaƒáanja</Label>\n            <Input value={formData.paymentMethod} onChange={(e) => handleChange(\"paymentMethod\", e.target.value)} data-testid=\"input-payment-method\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Snimanje Vokala</h3>\n        <RadioGroup value={formData.vocalRecording} onValueChange={(v) => handleChange(\"vocalRecording\", v)}>\n          <div className=\"flex items-center space-x-2\">\n            <RadioGroupItem value=\"yes\" id=\"vocal-yes\" data-testid=\"radio-vocal-yes\" />\n            <Label htmlFor=\"vocal-yes\">Da, vokali su snimljeni u studiju</Label>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <RadioGroupItem value=\"no\" id=\"vocal-no\" data-testid=\"radio-vocal-no\" />\n            <Label htmlFor=\"vocal-no\">Ne</Label>\n          </div>\n        </RadioGroup>\n\n        {formData.vocalRecording === \"yes\" && (\n          <RadioGroup value={formData.vocalRights} onValueChange={(v) => handleChange(\"vocalRights\", v)}>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"client\" id=\"rights-client\" data-testid=\"radio-rights-client\" />\n              <Label htmlFor=\"rights-client\">Sva prava prenose se na Naruƒçioca</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"studio\" id=\"rights-studio\" data-testid=\"radio-rights-studio\" />\n              <Label htmlFor=\"rights-studio\">Studio zadr≈æava pravo za portfolio</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"other\" id=\"rights-other\" data-testid=\"radio-rights-other\" />\n              <Label htmlFor=\"rights-other\">Drugo</Label>\n            </div>\n            {formData.vocalRights === \"other\" && (\n              <Input value={formData.vocalRightsOther} onChange={(e) => handleChange(\"vocalRightsOther\", e.target.value)} placeholder=\"Unesite...\"  data-testid=\"input-rights-other\" />\n            )}\n          </RadioGroup>\n        )}\n      </div>\n\n      <Button type=\"submit\" disabled={isSubmitting} className=\"w-full\" data-testid=\"button-generate-contract\">\n        {isSubmitting ? \"Generi≈°e se...\" : \"Generi≈°i Ugovor\"}\n      </Button>\n    </form>\n  );\n}\n\n// Copyright Transfer Form Component (simplified version)\nfunction CopyrightTransferForm({ onSubmit, isSubmitting }: { onSubmit: (data: any) => void; isSubmitting: boolean }) {\n  const [formData, setFormData] = useState({\n    contractDate: format(new Date(), \"dd/MM/yyyy\"),\n    contractPlace: \"Beograd\",\n    authorName: \"LeFlow Studio\",\n    authorAddress: \"\",\n    authorMaticniBroj: \"\",\n    buyerName: \"\",\n    buyerAddress: \"\",\n    buyerMaticniBroj: \"\",\n    songTitle: \"\",\n    components: {\n      text: false,\n      music: false,\n      vocals: false,\n      mixMaster: false,\n      other: false,\n      otherText: \"\",\n    },\n    rightsType: \"exclusive\" as \"exclusive\" | \"nonexclusive\",\n    rightsScope: {\n      reproduction: false,\n      distribution: false,\n      performance: false,\n      adaptation: false,\n      other: false,\n      otherText: \"\",\n    },\n    territory: \"Cela teritorija Srbije\",\n    duration: \"Trajanje za≈°tite autorskog prava\",\n    totalAmount: \"\",\n    firstPayment: \"\",\n    firstPaymentDate: \"\",\n    secondPayment: \"\",\n    secondPaymentDate: \"\",\n    paymentMethod: \"Uplata na raƒçun\",\n    authorPercentage: \"\",\n    buyerPercentage: \"\",\n    jurisdiction: \"Beograd\",\n    copies: \"2\",\n    finalDate: format(new Date(), \"dd/MM/yyyy\"),\n  });\n\n  const handleChange = (field: string, value: any) => {\n    setFormData(prev => {\n      const updated = { ...prev, [field]: value };\n      \n      // Auto-calculate percentage\n      if (field === \"authorPercentage\") {\n        const author = parseFloat(value || \"0\");\n        updated.buyerPercentage = (100 - author).toString();\n      }\n      if (field === \"buyerPercentage\") {\n        const buyer = parseFloat(value || \"0\");\n        updated.authorPercentage = (100 - buyer).toString();\n      }\n      \n      return updated;\n    });\n  };\n\n  return (\n    <form onSubmit={(e) => { e.preventDefault(); onSubmit(formData); }} className=\"space-y-6 mt-4\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Datum Ugovora</Label>\n          <Input value={formData.contractDate} onChange={(e) => handleChange(\"contractDate\", e.target.value)} data-testid=\"input-contract-date-copyright\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Mesto</Label>\n          <Input value={formData.contractPlace} onChange={(e) => handleChange(\"contractPlace\", e.target.value)} data-testid=\"input-contract-place-copyright\" />\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Autor/Prodavac</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ime i Prezime</Label>\n            <Input value={formData.authorName} onChange={(e) => handleChange(\"authorName\", e.target.value)} data-testid=\"input-author-name\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Adresa</Label>\n            <Input value={formData.authorAddress} onChange={(e) => handleChange(\"authorAddress\", e.target.value)} data-testid=\"input-author-address\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Matiƒçni Broj</Label>\n            <Input value={formData.authorMaticniBroj} onChange={(e) => handleChange(\"authorMaticniBroj\", e.target.value)} data-testid=\"input-author-mb\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Kupac</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ime i Prezime</Label>\n            <Input value={formData.buyerName} onChange={(e) => handleChange(\"buyerName\", e.target.value)} data-testid=\"input-buyer-name\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Adresa</Label>\n            <Input value={formData.buyerAddress} onChange={(e) => handleChange(\"buyerAddress\", e.target.value)} data-testid=\"input-buyer-address\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Matiƒçni Broj</Label>\n            <Input value={formData.buyerMaticniBroj} onChange={(e) => handleChange(\"buyerMaticniBroj\", e.target.value)} data-testid=\"input-buyer-mb\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Delo</h3>\n        <div className=\"space-y-2\">\n          <Label>Naziv Pesme</Label>\n          <Input value={formData.songTitle} onChange={(e) => handleChange(\"songTitle\", e.target.value)} data-testid=\"input-song-title\" required />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Komponente Dela</Label>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.components.text} onCheckedChange={(v) => handleChange(\"components\", { ...formData.components, text: !!v })} data-testid=\"checkbox-component-text\" />\n              <Label>Tekst</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.components.music} onCheckedChange={(v) => handleChange(\"components\", { ...formData.components, music: !!v })} data-testid=\"checkbox-component-music\" />\n              <Label>Muzika (instrumental)</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.components.vocals} onCheckedChange={(v) => handleChange(\"components\", { ...formData.components, vocals: !!v })} data-testid=\"checkbox-component-vocals\" />\n              <Label>Snimanje vokala</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.components.mixMaster} onCheckedChange={(v) => handleChange(\"components\", { ...formData.components, mixMaster: !!v })} data-testid=\"checkbox-component-mixmaster\" />\n              <Label>Miks i mastering</Label>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Prava</h3>\n        <RadioGroup value={formData.rightsType} onValueChange={(v) => handleChange(\"rightsType\", v)}>\n          <div className=\"flex items-center space-x-2\">\n            <RadioGroupItem value=\"exclusive\" id=\"rights-exclusive\" data-testid=\"radio-rights-exclusive\" />\n            <Label htmlFor=\"rights-exclusive\">Iskljuƒçiva prava</Label>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <RadioGroupItem value=\"nonexclusive\" id=\"rights-nonexclusive\" data-testid=\"radio-rights-nonexclusive\" />\n            <Label htmlFor=\"rights-nonexclusive\">Neiskljuƒçiva prava</Label>\n          </div>\n        </RadioGroup>\n\n        <div className=\"space-y-2\">\n          <Label>Obuhvat Prenosa Prava</Label>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.reproduction} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, reproduction: !!v })} data-testid=\"checkbox-scope-reproduction\" />\n              <Label>Reprodukovanje i umno≈æavanje dela</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.distribution} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, distribution: !!v })} data-testid=\"checkbox-scope-distribution\" />\n              <Label>Distribucija i digitalna prodaja</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.performance} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, performance: !!v })} data-testid=\"checkbox-scope-performance\" />\n              <Label>Javno izvoƒëenje i emitovanje</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.adaptation} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, adaptation: !!v })} data-testid=\"checkbox-scope-adaptation\" />\n              <Label>Prerada i adaptacija</Label>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Teritorija Kori≈°ƒáenja</Label>\n            <Input value={formData.territory} onChange={(e) => handleChange(\"territory\", e.target.value)} data-testid=\"input-territory\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Trajanje Prenosa Prava</Label>\n            <Input value={formData.duration} onChange={(e) => handleChange(\"duration\", e.target.value)} data-testid=\"input-duration\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Finansije</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ukupna Naknada (RSD)</Label>\n            <Input type=\"number\" value={formData.totalAmount} onChange={(e) => handleChange(\"totalAmount\", e.target.value)} data-testid=\"input-total-amount-copyright\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Naƒçin Plaƒáanja</Label>\n            <Input value={formData.paymentMethod} onChange={(e) => handleChange(\"paymentMethod\", e.target.value)} data-testid=\"input-payment-method-copyright\" />\n          </div>\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Podela Streaming Prihoda</Label>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Autor (%)</Label>\n              <Input type=\"number\" value={formData.authorPercentage} onChange={(e) => handleChange(\"authorPercentage\", e.target.value)} data-testid=\"input-author-percentage\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Kupac (auto %)</Label>\n              <Input type=\"number\" value={formData.buyerPercentage} readOnly className=\"bg-muted\" data-testid=\"input-buyer-percentage\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <Button type=\"submit\" disabled={isSubmitting} className=\"w-full\" data-testid=\"button-generate-contract-copyright\">\n        {isSubmitting ? \"Generi≈°e se...\" : \"Generi≈°i Ugovor\"}\n      </Button>\n    </form>\n  );\n}\n\n// Instrumental Sale Form Component (simplified version)\nfunction InstrumentalSaleForm({ onSubmit, isSubmitting }: { onSubmit: (data: any) => void; isSubmitting: boolean }) {\n  const [formData, setFormData] = useState({\n    contractDate: format(new Date(), \"dd/MM/yyyy\"),\n    contractPlace: \"Beograd\",\n    authorName: \"LeFlow Studio\",\n    authorAddress: \"\",\n    authorMaticniBroj: \"\",\n    buyerName: \"\",\n    buyerAddress: \"\",\n    buyerMaticniBroj: \"\",\n    instrumentalName: \"\",\n    duration: \"\",\n    rightsType: \"nonexclusive\" as \"exclusive\" | \"nonexclusive\",\n    rightsScope: {\n      reproduction: false,\n      distribution: false,\n      performance: false,\n      adaptation: false,\n      other: false,\n      otherText: \"\",\n    },\n    territory: \"Cela teritorija Srbije\",\n    durationPeriod: \"Trajanje za≈°tite autorskog prava\",\n    totalAmount: \"\",\n    advancePayment: \"\",\n    remainingPayment: \"\",\n    paymentMethod: \"Uplata na raƒçun\",\n    authorPercentage: \"\",\n    buyerPercentage: \"\",\n    jurisdiction: \"Beograd\",\n    copies: \"2\",\n    finalDate: format(new Date(), \"dd/MM/yyyy\"),\n  });\n\n  const handleChange = (field: string, value: any) => {\n    setFormData(prev => {\n      const updated = { ...prev, [field]: value };\n      \n      // Auto-calculate remaining payment\n      if (field === \"totalAmount\" || field === \"advancePayment\") {\n        const total = parseFloat(updated.totalAmount || \"0\");\n        const advance = parseFloat(updated.advancePayment || \"0\");\n        updated.remainingPayment = (total - advance).toString();\n      }\n      \n      // Auto-calculate percentage\n      if (field === \"authorPercentage\") {\n        const author = parseFloat(value || \"0\");\n        updated.buyerPercentage = (100 - author).toString();\n      }\n      if (field === \"buyerPercentage\") {\n        const buyer = parseFloat(value || \"0\");\n        updated.authorPercentage = (100 - buyer).toString();\n      }\n      \n      return updated;\n    });\n  };\n\n  return (\n    <form onSubmit={(e) => { e.preventDefault(); onSubmit(formData); }} className=\"space-y-6 mt-4\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n        <div className=\"space-y-2\">\n          <Label>Datum Ugovora</Label>\n          <Input value={formData.contractDate} onChange={(e) => handleChange(\"contractDate\", e.target.value)} data-testid=\"input-contract-date-instrumental\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Mesto</Label>\n          <Input value={formData.contractPlace} onChange={(e) => handleChange(\"contractPlace\", e.target.value)} data-testid=\"input-contract-place-instrumental\" />\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Autor/Prodavac (Studio)</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ime i Prezime</Label>\n            <Input value={formData.authorName} onChange={(e) => handleChange(\"authorName\", e.target.value)} data-testid=\"input-author-name-instrumental\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Adresa</Label>\n            <Input value={formData.authorAddress} onChange={(e) => handleChange(\"authorAddress\", e.target.value)} data-testid=\"input-author-address-instrumental\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Matiƒçni Broj</Label>\n            <Input value={formData.authorMaticniBroj} onChange={(e) => handleChange(\"authorMaticniBroj\", e.target.value)} data-testid=\"input-author-mb-instrumental\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Kupac</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ime i Prezime</Label>\n            <Input value={formData.buyerName} onChange={(e) => handleChange(\"buyerName\", e.target.value)} data-testid=\"input-buyer-name-instrumental\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Adresa</Label>\n            <Input value={formData.buyerAddress} onChange={(e) => handleChange(\"buyerAddress\", e.target.value)} data-testid=\"input-buyer-address-instrumental\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Matiƒçni Broj</Label>\n            <Input value={formData.buyerMaticniBroj} onChange={(e) => handleChange(\"buyerMaticniBroj\", e.target.value)} data-testid=\"input-buyer-mb-instrumental\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Instrumental</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Naziv Instrumentala</Label>\n            <Input value={formData.instrumentalName} onChange={(e) => handleChange(\"instrumentalName\", e.target.value)} data-testid=\"input-instrumental-name\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Trajanje</Label>\n            <Input value={formData.duration} onChange={(e) => handleChange(\"duration\", e.target.value)} placeholder=\"npr. 3:45\" data-testid=\"input-instrumental-duration\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Prava</h3>\n        <RadioGroup value={formData.rightsType} onValueChange={(v) => handleChange(\"rightsType\", v)}>\n          <div className=\"flex items-center space-x-2\">\n            <RadioGroupItem value=\"exclusive\" id=\"rights-exclusive-inst\" data-testid=\"radio-rights-exclusive-instrumental\" />\n            <Label htmlFor=\"rights-exclusive-inst\">Iskljuƒçiva prava</Label>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <RadioGroupItem value=\"nonexclusive\" id=\"rights-nonexclusive-inst\" data-testid=\"radio-rights-nonexclusive-instrumental\" />\n            <Label htmlFor=\"rights-nonexclusive-inst\">Neiskljuƒçiva prava</Label>\n          </div>\n        </RadioGroup>\n\n        <div className=\"space-y-2\">\n          <Label>Obuhvat Prenosa Prava</Label>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.reproduction} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, reproduction: !!v })} data-testid=\"checkbox-scope-reproduction-instrumental\" />\n              <Label>Reprodukovanje i umno≈æavanje</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.distribution} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, distribution: !!v })} data-testid=\"checkbox-scope-distribution-instrumental\" />\n              <Label>Distribucija i digitalna prodaja</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.performance} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, performance: !!v })} data-testid=\"checkbox-scope-performance-instrumental\" />\n              <Label>Javno izvoƒëenje i emitovanje</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Checkbox checked={formData.rightsScope.adaptation} onCheckedChange={(v) => handleChange(\"rightsScope\", { ...formData.rightsScope, adaptation: !!v })} data-testid=\"checkbox-scope-adaptation-instrumental\" />\n              <Label>Prerada i adaptacija</Label>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Teritorija Kori≈°ƒáenja</Label>\n            <Input value={formData.territory} onChange={(e) => handleChange(\"territory\", e.target.value)} data-testid=\"input-territory-instrumental\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Trajanje Prenosa Prava</Label>\n            <Input value={formData.durationPeriod} onChange={(e) => handleChange(\"durationPeriod\", e.target.value)} data-testid=\"input-duration-period-instrumental\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Finansije</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>Ukupna Naknada (RSD)</Label>\n            <Input type=\"number\" value={formData.totalAmount} onChange={(e) => handleChange(\"totalAmount\", e.target.value)} data-testid=\"input-total-amount-instrumental\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Avans (RSD)</Label>\n            <Input type=\"number\" value={formData.advancePayment} onChange={(e) => handleChange(\"advancePayment\", e.target.value)} data-testid=\"input-advance-payment-instrumental\" required />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Ostatak (auto)</Label>\n            <Input type=\"number\" value={formData.remainingPayment} readOnly className=\"bg-muted\" data-testid=\"input-remaining-payment-instrumental\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Naƒçin Plaƒáanja</Label>\n            <Input value={formData.paymentMethod} onChange={(e) => handleChange(\"paymentMethod\", e.target.value)} data-testid=\"input-payment-method-instrumental\" />\n          </div>\n        </div>\n        <div className=\"space-y-2\">\n          <Label>Podela Streaming Prihoda</Label>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Autor (%)</Label>\n              <Input type=\"number\" value={formData.authorPercentage} onChange={(e) => handleChange(\"authorPercentage\", e.target.value)} data-testid=\"input-author-percentage-instrumental\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Kupac (auto %)</Label>\n              <Input type=\"number\" value={formData.buyerPercentage} readOnly className=\"bg-muted\" data-testid=\"input-buyer-percentage-instrumental\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <Button type=\"submit\" disabled={isSubmitting} className=\"w-full\" data-testid=\"button-generate-contract-instrumental\">\n        {isSubmitting ? \"Generi≈°e se...\" : \"Generi≈°i Ugovor\"}\n      </Button>\n    </form>\n  );\n}\n","size_bytes":52500},"server/pdf-generators.ts":{"content":"import PDFDocument from \"pdfkit\";\nimport type { Readable } from \"stream\";\nimport path from \"path\";\n\nexport interface MixMasterContract {\n  // Osnovno\n  contractDate: string; // \"DD/MM/YYYY\"\n  contractPlace: string;\n  studioName: string;\n  studioAddress: string;\n  studioMaticniBroj: string;\n  clientName: string;\n  clientAddress: string;\n  clientMaticniBroj: string;\n  \n  // Projekat\n  projectName: string;\n  channelCount: string;\n  deliveryFormat: string;\n  deliveryDate: string;\n  \n  // Finansije\n  totalAmount: string;\n  advancePayment: string;\n  remainingPayment: string;\n  paymentMethod: string;\n  \n  // Opciono\n  vocalRecording: \"yes\" | \"no\";\n  vocalRights: \"client\" | \"studio\" | \"other\";\n  vocalRightsOther?: string;\n  \n  // Pravno\n  jurisdiction: string;\n  copies: string;\n  finalDate: string;\n}\n\nexport interface CopyrightTransferContract {\n  // Osnovno\n  contractDate: string;\n  contractPlace: string;\n  authorName: string;\n  authorAddress: string;\n  authorMaticniBroj: string;\n  buyerName: string;\n  buyerAddress: string;\n  buyerMaticniBroj: string;\n  \n  // Delo\n  songTitle: string;\n  components: {\n    text: boolean;\n    music: boolean;\n    vocals: boolean;\n    mixMaster: boolean;\n    other: boolean;\n    otherText?: string;\n  };\n  \n  // Prava\n  rightsType: \"exclusive\" | \"nonexclusive\";\n  rightsScope: {\n    reproduction: boolean;\n    distribution: boolean;\n    performance: boolean;\n    adaptation: boolean;\n    other: boolean;\n    otherText?: string;\n  };\n  territory: string;\n  duration: string;\n  \n  // Finansije\n  totalAmount: string;\n  firstPayment: string;\n  firstPaymentDate: string;\n  secondPayment: string;\n  secondPaymentDate: string;\n  paymentMethod: string;\n  \n  // Streaming podela\n  authorPercentage: string;\n  buyerPercentage: string;\n  \n  // Pravno\n  jurisdiction: string;\n  copies: string;\n  finalDate: string;\n}\n\nexport interface InstrumentalSaleContract {\n  // Osnovno\n  contractDate: string;\n  contractPlace: string;\n  authorName: string;\n  authorAddress: string;\n  authorMaticniBroj: string;\n  buyerName: string;\n  buyerAddress: string;\n  buyerMaticniBroj: string;\n  \n  // Instrumental\n  instrumentalName: string;\n  duration: string;\n  \n  // Prava\n  rightsType: \"exclusive\" | \"nonexclusive\";\n  rightsScope: {\n    reproduction: boolean;\n    distribution: boolean;\n    performance: boolean;\n    adaptation: boolean;\n    other: boolean;\n    otherText?: string;\n  };\n  territory: string;\n  durationPeriod: string;\n  \n  // Finansije\n  totalAmount: string;\n  advancePayment: string;\n  remainingPayment: string;\n  paymentMethod: string;\n  \n  // Streaming podela\n  authorPercentage: string;\n  buyerPercentage: string;\n  \n  // Pravno\n  jurisdiction: string;\n  copies: string;\n  finalDate: string;\n}\n\n/**\n * Helper function to draw Studio LeFlow logo at top-right of contract\n */\n/**\n * Draw professional contract header with Studio LeFlow logo\n * Returns the Y position where body content should start\n */\nfunction drawContractLogo(doc: PDFKit.PDFDocument): number {\n  try {\n    const logoPath = path.resolve(process.cwd(), 'attached_assets', 'logo', 'studioleflow-transparent.png');\n    const logoWidth = 85; // Professional size for A4 header\n    const headerHeight = 100; // Total header band height\n    \n    // Start from absolute page top (accounting for top margin)\n    const headerTop = doc.page.margins.top;\n    const pageWidth = doc.page.width;\n    const leftMargin = doc.page.margins.left;\n    const rightMargin = doc.page.margins.right;\n    \n    // Center logo horizontally\n    const logoX = (pageWidth - logoWidth) / 2;\n    \n    // Draw logo centered in header\n    doc.image(logoPath, logoX, headerTop + 10, {\n      width: logoWidth,\n      align: 'center'\n    });\n    \n    // Studio info text below logo (centered)\n    doc.fontSize(9)\n      .font('DejaVuSans')\n      .fillColor('#666666');\n    \n    const infoY = headerTop + 95; // Position below logo to avoid overlap\n    doc.text('Studio LeFlow | Beograd, Srbija', leftMargin, infoY, {\n      width: pageWidth - leftMargin - rightMargin,\n      align: 'center'\n    });\n    \n    // Draw horizontal separator line\n    const lineY = headerTop + headerHeight - 10;\n    doc.strokeColor('#cccccc')\n      .lineWidth(1)\n      .moveTo(leftMargin, lineY)\n      .lineTo(pageWidth - rightMargin, lineY)\n      .stroke();\n    \n    // Reset text color to black for body content\n    doc.fillColor('#000000');\n    \n    // Return Y position where body content should start\n    return headerTop + headerHeight + 10;\n    \n  } catch (error) {\n    // Graceful fallback if logo is missing - return default starting position\n    console.error('[PDF] Failed to load logo:', error);\n    return doc.page.margins.top + 20;\n  }\n}\n\n/**\n * Generate PDF buffer for Mix/Master contract\n */\nexport function generateMixMasterPDF(data: MixMasterContract): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    const doc = new PDFDocument({ \n      size: 'A4', \n      margins: { top: 50, bottom: 50, left: 72, right: 72 }\n    });\n    \n    // Register DejaVu Sans font for Serbian characters support\n    doc.registerFont('DejaVuSans', '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf');\n    doc.registerFont('DejaVuSans-Bold', '/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf');\n    \n    const buffers: Buffer[] = [];\n    doc.on('data', buffers.push.bind(buffers));\n    doc.on('end', () => resolve(Buffer.concat(buffers)));\n    doc.on('error', reject);\n\n    // Draw professional contract header with logo\n    const bodyStartY = drawContractLogo(doc);\n    doc.y = bodyStartY;\n\n    // Contract title\n    doc.fontSize(14).font('DejaVuSans-Bold').text('UGOVOR O PRU≈ΩANJU USLUGA MIXINGA I MASTERINGA', { align: 'center' });\n    doc.moveDown(2);\n\n    // Contract metadata\n    doc.fontSize(10).font('DejaVuSans')\n      .text(`Zakljuƒçen dana ${data.contractDate} godine u ${data.contractPlace}, izmeƒëu sledeƒáih ugovornih strana:`, { align: 'left' });\n    doc.moveDown();\n\n    // Pru≈æalac usluge\n    doc.fontSize(11).font('DejaVuSans-Bold').text('1. Pru≈æalac usluge (Studio)');\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ime i prezime / poslovno ime: ${data.studioName}`);\n    doc.text(`Adresa: ${data.studioAddress}`);\n    doc.text(`Matiƒçni broj: ${data.studioMaticniBroj}`);\n    doc.moveDown();\n\n    // Naruƒçilac\n    doc.fontSize(11).font('DejaVuSans-Bold').text('2. Naruƒçilac usluge');\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ime i prezime / poslovno ime: ${data.clientName}`);\n    doc.text(`Adresa: ${data.clientAddress}`);\n    doc.text(`Matiƒçni broj: ${data.clientMaticniBroj}`);\n    doc.moveDown();\n\n    doc.fontSize(10).text('(u daljem tekstu zajedniƒçki: \"Ugovorne strane\").');\n    doc.moveDown(2);\n\n    // ƒålan 1\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 1. Predmet ugovora', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Predmet ovog ugovora je pru≈æanje usluge profesionalnog miksanja i masteringa sledeƒáeg muziƒçkog dela:');\n    doc.moveDown(0.5);\n    doc.text(`Naziv pesme / projekta: ${data.projectName}`);\n    doc.text(`Broj kanala / stemova: ${data.channelCount}`);\n    doc.moveDown(2);\n\n    // ƒålan 2\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 2. Obaveze Pru≈æaoca usluge', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Pru≈æalac usluge se obavezuje da:');\n    doc.text('‚Äì izvr≈°i tehniƒçku obradu materijala (mix i mastering) prema profesionalnim standardima;');\n    doc.text(`‚Äì isporuƒçi finalne fajlove u formatu: ${data.deliveryFormat}`);\n    doc.text(`‚Äì isporuku izvr≈°i najkasnije do ${data.deliveryDate}.`);\n    doc.moveDown(2);\n\n    // ƒålan 3\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 3. Obaveze Naruƒçioca', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Naruƒçilac se obavezuje da:');\n    doc.text('‚Äì dostavi sve potrebne fajlove i informacije potrebne za rad na projektu;');\n    doc.text('‚Äì blagovremeno odobri radne verzije ili dostavi primedbe;');\n    doc.text('‚Äì isplati ugovorenu naknadu u predviƒëenom roku.');\n    doc.moveDown(2);\n\n    // ƒålan 4\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 4. Naknada i uslovi plaƒáanja', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ukupna naknada za izvr≈°enje usluge iznosi: ${data.totalAmount} RSD / EUR.`);\n    doc.moveDown(0.5);\n    doc.text('Raspored plaƒáanja:');\n    doc.text(`‚Äì Avans (pre poƒçetka rada): ${data.advancePayment} RSD / EUR`);\n    doc.text(`‚Äì Ostatak (po zavr≈°etku usluge, pre isporuke finalnih fajlova): ${data.remainingPayment} RSD / EUR`);\n    doc.text(`Naƒçin plaƒáanja: ${data.paymentMethod}`);\n    doc.moveDown();\n    doc.text('U sluƒçaju neplaƒáanja u predviƒëenom roku, Pru≈æalac usluge zadr≈æava pravo da raskine ovaj ugovor i da snimke ponudi treƒáim licima ili koristi u druge svrhe, bez prava Naruƒçioca na naknadu ≈°tete.');\n    doc.moveDown(2);\n\n    // ƒålan 5\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 5. Odgovornost i reklamacije', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Pru≈æalac usluge garantuje kvalitet obrade prema profesionalnim standardima.');\n    doc.text('Naruƒçilac ima pravo na do dve runde revizija finalne verzije.');\n    doc.text('Naknadne izmene i dodatne revizije se naplaƒáuju po dogovoru.');\n    doc.text('Reklamacije se prihvataju iskljuƒçivo u roku od 7 dana od dana isporuke finalnih fajlova.');\n    doc.moveDown(2);\n\n    // ƒålan 6\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 6. Autorska prava', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Ovim ugovorom Pru≈æalac usluge ne stiƒçe nikakva autorska prava na muziƒçko delo koje je predmet obrade.');\n    doc.text('Sva autorska prava na pesmu i originalne snimke ostaju u vlasni≈°tvu Naruƒçioca.');\n    doc.moveDown(2);\n\n    // ƒålan 7 - Snimanje vokala\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 7. Snimanje vokala i prava na snimke', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Snimanje vokala je izvr≈°eno u studiju LeFlow Studio: ${data.vocalRecording === 'yes' ? 'DA' : 'NE'}`);\n    doc.moveDown(0.5);\n    \n    if (data.vocalRecording === 'yes') {\n      doc.text('Ugovorne strane se sla≈æu da:');\n      if (data.vocalRights === 'client') {\n        doc.text('‚òë Sva prava na vokalne snimke i izvedbu prenose se iskljuƒçivo na Naruƒçioca.');\n      } else if (data.vocalRights === 'studio') {\n        doc.text('‚òë Pru≈æalac usluge zadr≈æava pravo da koristi snimke iskljuƒçivo u promotivne svrhe studija (portfolio, sajt, dru≈°tvene mre≈æe), uz obavezu navoƒëenja imena izvoƒëaƒça.');\n      } else {\n        doc.text(`‚òë Drugo: ${data.vocalRightsOther || ''}`);\n      }\n    }\n    doc.moveDown(2);\n\n    // ƒålan 8\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 8. Nadle≈ænost', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Za re≈°avanje eventualnih sporova nadle≈æan je sud u: ${data.jurisdiction}`);\n    doc.moveDown(2);\n\n    // ƒålan 9\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 9. Zavr≈°ne odredbe', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ovaj ugovor je saƒçinjen u ${data.copies} istovetnih primeraka, od kojih svaka ugovorna strana zadr≈æava po jedan.`);\n    doc.moveDown();\n    doc.text('Potpisivanjem ugovora, strane potvrƒëuju da su saglasne sa svim odredbama i da ga zakljuƒçuju slobodnom voljom.');\n    doc.moveDown(3);\n\n    // Signatures\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('____________________________', 100, doc.y, { continued: true, width: 200 });\n    doc.text('____________________________', 320, doc.y - doc.currentLineHeight(), { width: 200 });\n    doc.moveDown(2);\n    doc.text(`Datum: ${data.finalDate}`, { align: 'center' });\n\n    doc.end();\n  });\n}\n\n/**\n * Generate PDF buffer for Copyright Transfer contract\n */\nexport function generateCopyrightTransferPDF(data: CopyrightTransferContract): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    const doc = new PDFDocument({ \n      size: 'A4', \n      margins: { top: 50, bottom: 50, left: 72, right: 72 }\n    });\n    \n    // Register DejaVu Sans font for Serbian characters support\n    doc.registerFont('DejaVuSans', '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf');\n    doc.registerFont('DejaVuSans-Bold', '/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf');\n    \n    const buffers: Buffer[] = [];\n    doc.on('data', buffers.push.bind(buffers));\n    doc.on('end', () => resolve(Buffer.concat(buffers)));\n    doc.on('error', reject);\n\n    // Draw professional contract header with logo\n    const bodyStartY = drawContractLogo(doc);\n    doc.y = bodyStartY;\n\n    // Contract title\n    doc.fontSize(14).font('DejaVuSans-Bold').text('UGOVOR O PRENOSU IMOVINSKIH AUTORSKIH PRAVA', { align: 'center' });\n    doc.moveDown(2);\n\n    // Contract metadata\n    doc.fontSize(10).font('DejaVuSans')\n      .text(`Zakljuƒçen dana ${data.contractDate} godine u ${data.contractPlace}, izmeƒëu sledeƒáih ugovornih strana:`, { align: 'left' });\n    doc.moveDown(2);\n\n    // Autor/Prodavac\n    doc.fontSize(12).font('DejaVuSans-Bold').text('1. Autor/Prodavac', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ime i prezime / poslovno ime: ${data.authorName}`);\n    doc.text(`Adresa: ${data.authorAddress}`);\n    doc.text(`Matiƒçni broj: ${data.authorMaticniBroj}`);\n    doc.moveDown(2);\n\n    // Kupac\n    doc.fontSize(12).font('DejaVuSans-Bold').text('2. Kupac', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ime i prezime / poslovno ime: ${data.buyerName}`);\n    doc.text(`Adresa: ${data.buyerAddress}`);\n    doc.text(`Matiƒçni broj: ${data.buyerMaticniBroj}`);\n    doc.moveDown();\n\n    doc.fontSize(10).text('(u daljem tekstu zajedniƒçki: \"Ugovorne strane\").');\n    doc.moveDown(3);\n\n    // ƒålan 1\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 1. Predmet ugovora', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Predmet ovog ugovora je prenos imovinskih autorskih prava na sledeƒáem autorskom delu:');\n    doc.moveDown(0.5);\n    doc.text(`Naziv pesme: ${data.songTitle}`);\n    doc.moveDown();\n    doc.text('Delo obuhvata sledeƒáe komponente:');\n    if (data.components.text) doc.text('‚òë Tekst');\n    if (data.components.music) doc.text('‚òë Muziku (instrumental)');\n    if (data.components.vocals) doc.text('‚òë Snimanje vokala');\n    if (data.components.mixMaster) doc.text('‚òë Miks i mastering');\n    if (data.components.other) doc.text(`‚òë Ostalo: ${data.components.otherText || ''}`);\n    doc.moveDown(2);\n\n    // ƒålan 2\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 2. Vrsta prenosa prava', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Autor prenosi sledeƒáa imovinska autorska prava:');\n    doc.text(data.rightsType === 'exclusive' ? '‚òë Iskljuƒçiva prava' : '‚òë Neiskljuƒçiva prava');\n    doc.moveDown();\n    doc.text('Obuhvat prenosa prava:');\n    if (data.rightsScope.reproduction) doc.text('‚òë Reprodukovanje i umno≈æavanje dela');\n    if (data.rightsScope.distribution) doc.text('‚òë Distribucija i digitalna prodaja');\n    if (data.rightsScope.performance) doc.text('‚òë Javno izvoƒëenje i emitovanje');\n    if (data.rightsScope.adaptation) doc.text('‚òë Prerada i adaptacija');\n    if (data.rightsScope.other) doc.text(`‚òë Ostalo: ${data.rightsScope.otherText || ''}`);\n    doc.moveDown(2);\n\n    // ƒålan 3\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 3. Teritorija kori≈°ƒáenja', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Prenos prava se odnosi na teritoriju: ${data.territory}`);\n    doc.moveDown(2);\n\n    // ƒålan 4\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 4. Trajanje prenosa prava', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Prenos prava se zakljuƒçuje na period: ${data.duration}`);\n    doc.moveDown(2);\n\n    // ƒålan 5\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 5. Naknada i uslovi plaƒáanja', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Kupac se obavezuje da Autor/Prodavcu isplati ukupan iznos naknade u visini od: ${data.totalAmount} RSD / EUR`);\n    doc.moveDown();\n    doc.text('Raspored plaƒáanja:');\n    doc.text(`‚Äì I rata u iznosu od ${data.firstPayment} RSD/EUR, do ${data.firstPaymentDate}`);\n    doc.text(`‚Äì II rata u iznosu od ${data.secondPayment} RSD/EUR, do ${data.secondPaymentDate}`);\n    doc.text('(U sluƒçaju neplaƒáanja u predviƒëenom roku, Autor zadr≈æava pravo da delo ponudi i proda treƒáim licima.)');\n    doc.moveDown();\n    doc.text(`Naƒçin plaƒáanja: ${data.paymentMethod}`);\n    doc.moveDown(2);\n\n    // ƒålan 6\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 6. Podela prihoda od kori≈°ƒáenja dela (Streaming servis)', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Ugovorne strane su saglasne da se prihod ostvaren od eksploatacije dela deli na sledeƒái naƒçin:');\n    doc.text(`‚Äì Procenat prihoda koji pripada Autor/Prodavcu: ${data.authorPercentage}%`);\n    doc.text(`‚Äì Procenat prihoda koji pripada Kupcu: ${data.buyerPercentage}%`);\n    doc.moveDown(2);\n\n    // ƒålan 7\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 7. Moralna prava', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Autor zadr≈æava moralna prava na delu, ukljuƒçujuƒái:');\n    doc.text('‚Äì Pravo da bude priznat i oznaƒçen kao autor dela;');\n    doc.text('‚Äì Pravo da delo ne bude menjano, obraƒëivano ili prilagoƒëavano bez njegove prethodne pisane saglasnosti.');\n    doc.moveDown(2);\n\n    // ƒålan 8\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 8. Nadle≈ænost', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Za tumaƒçenje i sprovoƒëenje ovog ugovora nadle≈æan je sud u: ${data.jurisdiction}`);\n    doc.moveDown(2);\n\n    // ƒålan 9\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 9. Zavr≈°ne odredbe', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ovaj ugovor je saƒçinjen u ${data.copies} istovetnih primeraka, od kojih svaka ugovorna strana zadr≈æava po jedan.`);\n    doc.text('Potpisivanjem ugovora strane potvrƒëuju da su saglasne sa svim odredbama i da ga zakljuƒçuju slobodnom voljom.');\n    doc.moveDown(3);\n\n    // Signatures\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('____________________________', { align: 'left' });\n    doc.text('Autor/Prodavac', { align: 'left' });\n    doc.moveDown(2);\n    doc.text('____________________________', { align: 'left' });\n    doc.text('Kupac', { align: 'left' });\n    doc.moveDown(2);\n    doc.text(`Datum: ${data.finalDate}`, { align: 'center' });\n\n    doc.end();\n  });\n}\n\n/**\n * Generate PDF buffer for Instrumental Sale contract\n */\nexport function generateInstrumentalSalePDF(data: InstrumentalSaleContract): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    const doc = new PDFDocument({ \n      size: 'A4', \n      margins: { top: 50, bottom: 50, left: 72, right: 72 }\n    });\n    \n    // Register DejaVu Sans font for Serbian characters support\n    doc.registerFont('DejaVuSans', '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf');\n    doc.registerFont('DejaVuSans-Bold', '/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf');\n    \n    const buffers: Buffer[] = [];\n    doc.on('data', buffers.push.bind(buffers));\n    doc.on('end', () => resolve(Buffer.concat(buffers)));\n    doc.on('error', reject);\n\n    // Draw professional contract header with logo\n    const bodyStartY = drawContractLogo(doc);\n    doc.y = bodyStartY;\n\n    // License title\n    doc.fontSize(14).font('DejaVuSans-Bold').text('LICENCA ZA KORI≈†ƒÜENJE INSTRUMENTALA', { align: 'center' });\n    doc.moveDown(2);\n\n    // License metadata\n    doc.fontSize(10).font('DejaVuSans')\n      .text(`Izdata dana ${data.contractDate} godine u ${data.contractPlace}`, { align: 'left' });\n    doc.moveDown(2);\n\n    // Autor/Prodavac (Studio)\n    doc.fontSize(11).font('DejaVuSans-Bold').text('Izdavaƒç licence (Studio)');\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ime i prezime / poslovno ime: ${data.authorName}`);\n    doc.text(`Adresa: ${data.authorAddress}`);\n    doc.moveDown(2);\n\n    // Korisnik licence (Kupac)\n    doc.fontSize(11).font('DejaVuSans-Bold').text('Korisnik licence');\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ime i prezime / poslovno ime: ${data.buyerName}`);\n    doc.text(`Adresa: ${data.buyerAddress}`);\n    doc.text(`Matiƒçni broj: ${data.buyerMaticniBroj}`);\n    doc.moveDown(2);\n\n    // ƒålan 1\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 1. Predmet licence', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Predmet ove licence je kori≈°ƒáenje sledeƒáeg muziƒçkog instrumentala:');\n    doc.moveDown(0.5);\n    doc.text(`Naziv instrumentala: ${data.instrumentalName}`);\n    doc.text(`Trajanje: ${data.duration}`);\n    doc.moveDown(2);\n\n    // ƒålan 2\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 2. Vrsta licence', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Korisniku se izdaje sledeƒáa vrsta licence:');\n    doc.moveDown();\n    doc.text(data.rightsType === 'exclusive' ? '‚òë Iskljuƒçiva licenca' : '‚òë Neiskljuƒçiva licenca');\n    doc.moveDown();\n    doc.text('Opseg dozvoljenog kori≈°ƒáenja:');\n    if (data.rightsScope.reproduction) doc.text('‚òë Reprodukovanje i umno≈æavanje');\n    if (data.rightsScope.distribution) doc.text('‚òë Distribucija i digitalna prodaja');\n    if (data.rightsScope.performance) doc.text('‚òë Javno izvoƒëenje i emitovanje');\n    if (data.rightsScope.adaptation) doc.text('‚òë Prerada i adaptacija');\n    if (data.rightsScope.other) doc.text(`‚òë Ostalo: ${data.rightsScope.otherText || ''}`);\n    doc.moveDown(2);\n\n    // ƒålan 3\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 3. Teritorija kori≈°ƒáenja', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Licenca se odnosi na teritoriju: ${data.territory}`);\n    doc.moveDown(2);\n\n    // ƒålan 4\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 4. Trajanje licence', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Licenca se izdaje na period: ${data.durationPeriod}`);\n    doc.moveDown(2);\n\n    // ƒålan 5\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 5. Naknada za licencu', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ukupna naknada za licencu iznosi: ${data.totalAmount} RSD / EUR.`);\n    doc.moveDown();\n    doc.text('Raspored plaƒáanja:');\n    doc.text(`‚Äì Avans: ${data.advancePayment} RSD / EUR`);\n    doc.text(`‚Äì Ostatak: ${data.remainingPayment} RSD / EUR`);\n    doc.moveDown();\n    doc.text(`Naƒçin plaƒáanja: ${data.paymentMethod}`);\n    doc.moveDown();\n    doc.text('U sluƒçaju neplaƒáanja u predviƒëenom roku, licenca postaje neva≈æeƒáa.');\n    doc.moveDown(2);\n\n    // ƒålan 6\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 6. Podela prihoda od kori≈°ƒáenja', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Prihod od kori≈°ƒáenja instrumentala deli se na sledeƒái naƒçin:');\n    doc.text(`‚Äì Procenat prihoda koji pripada Izdavaƒçu: ${data.authorPercentage}%`);\n    doc.text(`‚Äì Procenat prihoda koji pripada Korisniku: ${data.buyerPercentage}%`);\n    doc.moveDown(2);\n\n    // ƒålan 7\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 7. Autorska prava', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('Izdavaƒç zadr≈æava sva autorska i moralna prava na instrumentalu, ukljuƒçujuƒái:');\n    doc.text('‚Äì Pravo da bude priznat i oznaƒçen kao autor instrumentala.');\n    doc.text('‚Äì Pravo da instrumental ne bude menjan bez prethodne pisane saglasnosti.');\n    doc.moveDown(2);\n\n    // ƒålan 8\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 8. Nadle≈ænost', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Za re≈°avanje eventualnih sporova nadle≈æan je sud u: ${data.jurisdiction}`);\n    doc.moveDown(2);\n\n    // ƒålan 9\n    doc.fontSize(12).font('DejaVuSans-Bold').text('ƒålan 9. Va≈ænost licence', { align: 'center' });\n    doc.moveDown();\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text(`Ova licenca je izdata u ${data.copies} primerka i stupa na snagu danom plaƒáanja naknade.`);\n    doc.moveDown();\n    doc.text('Kori≈°ƒáenjem instrumentala, Korisnik potvrƒëuje da prihvata sve uslove navedene u ovoj licenci.');\n    doc.moveDown(3);\n\n    // Signatures\n    doc.fontSize(10).font('DejaVuSans');\n    doc.text('____________________________', 100, doc.y, { continued: true, width: 200 });\n    doc.text('____________________________', 320, doc.y - doc.currentLineHeight(), { width: 200 });\n    doc.moveDown(2);\n    doc.text(`Datum izdavanja: ${data.finalDate}`, { align: 'center' });\n\n    doc.end();\n  });\n}\n","size_bytes":25685},"client/src/pages/moje-pesme.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { Link } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { Music, Trash2, CheckCircle2, Clock, AlertCircle, Youtube } from \"lucide-react\";\nimport { SEO } from \"@/components/SEO\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\n\nconst songFormSchema = z.object({\n  songTitle: z.string().min(3, \"Naslov pesme mora imati najmanje 3 karaktera\").max(100, \"Naslov pesme mo≈æe imati najvi≈°e 100 karaktera\"),\n  artistName: z.string().min(2, \"Ime izvoƒëaƒça mora imati najmanje 2 karaktera\").max(100, \"Ime izvoƒëaƒça mo≈æe imati najvi≈°e 100 karaktera\"),\n  youtubeUrl: z.string().url(\"Unesite validan YouTube URL\").regex(/^https?:\\/\\/(www\\.)?(youtube\\.com|youtu\\.be)\\//, \"URL mora biti sa YouTube-a\"),\n});\n\ntype SongFormData = z.infer<typeof songFormSchema>;\n\ntype UserSong = {\n  id: number;\n  userId: number;\n  songTitle: string;\n  artistName: string;\n  youtubeUrl: string;\n  submittedAt: string;\n  approved: boolean;\n};\n\nexport default function MojePesme() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [songToDelete, setSongToDelete] = useState<number | null>(null);\n  const [submitDialogOpen, setSubmitDialogOpen] = useState(false);\n\n  const form = useForm<SongFormData>({\n    resolver: zodResolver(songFormSchema),\n    defaultValues: {\n      songTitle: \"\",\n      artistName: \"\",\n      youtubeUrl: \"\",\n    },\n  });\n\n  // Fetch user's songs\n  const { data: songs = [], isLoading: songsLoading } = useQuery<UserSong[]>({\n    queryKey: [\"/api/user-songs\"],\n    enabled: !!user,\n  });\n\n  // Submit new song mutation\n  const submitSongMutation = useMutation({\n    mutationFn: async (data: SongFormData) => {\n      return apiRequest(\"POST\", \"/api/user-songs\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-songs\"] });\n      setSubmitDialogOpen(false);\n      form.reset();\n      toast({\n        title: \"Pesma dodata\",\n        description: \"Va≈°a pesma je uspe≈°no poslata na odobrenje.\",\n      });\n    },\n    onError: (error: any) => {\n      const errorMessage = error.message || \"Gre≈°ka pri dodavanju pesme\";\n      \n      // Handle rate limiting error\n      if (error.hoursRemaining) {\n        toast({\n          title: \"Saƒçekajte\",\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      } else if (errorMessage.includes(\"veƒá postavljena\")) {\n        toast({\n          title: \"Duplikat\",\n          description: \"Ova pesma je veƒá postavljena.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Gre≈°ka\",\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  // Delete song mutation\n  const deleteSongMutation = useMutation({\n    mutationFn: async (songId: number) => {\n      return apiRequest(\"DELETE\", `/api/user-songs/${songId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-songs\"] });\n      setDeleteDialogOpen(false);\n      setSongToDelete(null);\n      toast({\n        title: \"Pesma obrisana\",\n        description: \"Pesma je uspe≈°no uklonjena.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Gre≈°ka pri brisanju pesme\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: SongFormData) => {\n    submitSongMutation.mutate(data);\n  };\n\n  const handleDelete = (songId: number) => {\n    setSongToDelete(songId);\n    setDeleteDialogOpen(true);\n  };\n\n  const confirmDelete = () => {\n    if (songToDelete) {\n      deleteSongMutation.mutate(songToDelete);\n    }\n  };\n\n  // Extract YouTube video ID from URL\n  const getYoutubeVideoId = (url: string): string | null => {\n    const regExp = /^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/;\n    const match = url.match(regExp);\n    return match && match[7] && match[7].length === 11 ? match[7] : null;\n  };\n\n  if (!user) {\n    return (\n      <div className=\"container mx-auto px-4 py-16\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Prijavite se</CardTitle>\n            <CardDescription>\n              Morate biti prijavljeni da biste postavili pesme.\n            </CardDescription>\n          </CardHeader>\n          <CardFooter>\n            <Link href=\"/auth\">\n              <Button data-testid=\"button-login\">Prijavi se</Button>\n            </Link>\n          </CardFooter>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <SEO\n        title=\"Moje Pesme\"\n        description=\"Podelite va≈°e omiljene YouTube pesme sa Studio LeFlow zajednicom\"\n        keywords={[\"pesme\", \"muzika\", \"youtube\", \"studija\", \"studio leflow\"]}\n      />\n\n      <div className=\"container mx-auto px-4 py-8 max-w-6xl\">\n        <FadeInWhenVisible>\n          <motion.div\n            initial={{ opacity: 0, y: -20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5 }}\n            className=\"mb-8\"\n          >\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n              <div>\n                <h1 className=\"text-3xl font-bold tracking-tight mb-2 flex items-center gap-2\">\n                  <Music className=\"h-8 w-8\" />\n                  Moje Pesme\n                </h1>\n                <p className=\"text-muted-foreground\">\n                  Podelite va≈°e omiljene YouTube pesme (1 pesma na 36 sati)\n                </p>\n              </div>\n              <Button\n                onClick={() => setSubmitDialogOpen(true)}\n                size=\"lg\"\n                data-testid=\"button-submit-song\"\n              >\n                <Youtube className=\"mr-2 h-5 w-5\" />\n                Dodaj Pesmu\n              </Button>\n            </div>\n          </motion.div>\n        </FadeInWhenVisible>\n\n        <Separator className=\"mb-8\" />\n\n        {/* User's Songs List */}\n        <div className=\"space-y-4\">\n          {songsLoading ? (\n            <>\n              <Skeleton className=\"h-64 w-full\" />\n              <Skeleton className=\"h-64 w-full\" />\n            </>\n          ) : songs.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-16\">\n                <div className=\"text-center text-muted-foreground\">\n                  <Music className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-lg mb-2\">Niste jo≈° dodali nijednu pesmu</p>\n                  <p className=\"text-sm\">Kliknite na \"Dodaj Pesmu\" da poƒçnete</p>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            songs.map((song) => {\n              const videoId = getYoutubeVideoId(song.youtubeUrl);\n              \n              return (\n                <motion.div\n                  key={song.id}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.3 }}\n                >\n                  <Card>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between gap-4\">\n                        <div className=\"flex-1 space-y-1\">\n                          <CardTitle className=\"flex items-center gap-2 flex-wrap\">\n                            {song.songTitle}\n                            {song.approved ? (\n                              <Badge variant=\"default\" className=\"gap-1\" data-testid={`badge-approved-${song.id}`}>\n                                <CheckCircle2 className=\"h-3 w-3\" />\n                                Odobreno\n                              </Badge>\n                            ) : (\n                              <Badge variant=\"secondary\" className=\"gap-1\" data-testid={`badge-pending-${song.id}`}>\n                                <Clock className=\"h-3 w-3\" />\n                                Na ƒçekanju\n                              </Badge>\n                            )}\n                          </CardTitle>\n                          <CardDescription>\n                            {song.artistName} ‚Ä¢ Poslato {format(new Date(song.submittedAt), \"dd.MM.yyyy HH:mm\")}\n                          </CardDescription>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => handleDelete(song.id)}\n                          data-testid={`button-delete-${song.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      {videoId ? (\n                        <div className=\"aspect-video rounded-md overflow-hidden bg-muted\">\n                          <iframe\n                            width=\"100%\"\n                            height=\"100%\"\n                            src={`https://www.youtube.com/embed/${videoId}`}\n                            title={song.songTitle}\n                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                            allowFullScreen\n                            data-testid={`iframe-youtube-${song.id}`}\n                          ></iframe>\n                        </div>\n                      ) : (\n                        <div className=\"p-4 bg-muted rounded-md flex items-center gap-2\">\n                          <AlertCircle className=\"h-5 w-5 text-muted-foreground\" />\n                          <p className=\"text-sm text-muted-foreground\">Neva≈æeƒái YouTube URL</p>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {/* Submit Song Dialog */}\n      <Dialog open={submitDialogOpen} onOpenChange={setSubmitDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Dodaj Novu Pesmu</DialogTitle>\n            <DialogDescription>\n              Unesite YouTube link pesme koja ≈æelite da podelite. Mo≈æete dodati novu pesmu svakih 36 sati.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"songTitle\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Naslov pesme</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"npr. One More Time\"\n                        {...field}\n                        data-testid=\"input-song-title\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"artistName\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Izvoƒëaƒç</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"npr. Daft Punk\"\n                        {...field}\n                        data-testid=\"input-artist-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"youtubeUrl\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>YouTube URL</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"url\"\n                        placeholder=\"https://www.youtube.com/watch?v=...\"\n                        {...field}\n                        data-testid=\"input-youtube-url\"\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      Kopirajte link YouTube videa\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setSubmitDialogOpen(false)}\n                  data-testid=\"button-cancel\"\n                >\n                  Otka≈æi\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={submitSongMutation.isPending}\n                  data-testid=\"button-submit-form\"\n                >\n                  {submitSongMutation.isPending ? \"Dodavanje...\" : \"Dodaj Pesmu\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Obri≈°i pesmu?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Ova akcija ne mo≈æe biti poni≈°tena. Pesma ƒáe biti trajno uklonjena.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-delete-cancel\">Otka≈æi</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDelete}\n              data-testid=\"button-delete-confirm\"\n              disabled={deleteSongMutation.isPending}\n            >\n              {deleteSongMutation.isPending ? \"Brisanje...\" : \"Obri≈°i\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","size_bytes":15361},"client/src/pages/zajednica.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { Link } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\nimport { Music, Heart, User, TrendingUp, Youtube } from \"lucide-react\";\nimport { SEO } from \"@/components/SEO\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport { CommunityChat } from \"@/components/community/CommunityChat\";\n\ntype PublicSong = {\n  id: number;\n  userId: number;\n  username: string;\n  songTitle: string;\n  artistName: string;\n  youtubeUrl: string;\n  submittedAt: string;\n  approved: boolean;\n  votesCount: number;\n  hasVoted: boolean;\n};\n\nexport default function Zajednica() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  // Fetch all approved songs\n  const { data: songs = [], isLoading: songsLoading } = useQuery<PublicSong[]>({\n    queryKey: [\"/api/user-songs/public\"],\n  });\n\n  // Vote mutation\n  const voteMutation = useMutation({\n    mutationFn: async (songId: number) => {\n      return apiRequest(\"POST\", `/api/user-songs/${songId}/vote`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-songs/public\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: \"Morate biti prijavljeni da glasate\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleVote = (songId: number) => {\n    if (!user) {\n      toast({\n        title: \"Prijavite se\",\n        description: \"Morate biti prijavljeni da glasate za pesme\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    voteMutation.mutate(songId);\n  };\n\n  // Extract YouTube video ID from URL\n  const getYoutubeVideoId = (url: string): string | null => {\n    const regExp = /^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/;\n    const match = url.match(regExp);\n    return match && match[7] && match[7].length === 11 ? match[7] : null;\n  };\n\n  return (\n    <>\n      <SEO\n        title=\"Zajednica - Top Pesme Korisnika\"\n        description=\"Muziƒçka zajednica Studio LeFlow - pogledajte i glasajte za najbolje pesme koje korisnici dele. Podr≈æite talente i poka≈æite svoju omiljenu muziku!\"\n        keywords={[\"zajednica\", \"top pesme\", \"muzika\", \"glasanje\", \"korisnici\", \"studio leflow\", \"community\"]}\n      />\n\n      <div className=\"container mx-auto px-4 py-8 max-w-6xl\">\n        <FadeInWhenVisible>\n          <motion.div\n            initial={{ opacity: 0, y: -20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5 }}\n            className=\"mb-8\"\n          >\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n              <div>\n                <h1 className=\"text-3xl font-bold tracking-tight mb-2 flex items-center gap-2\">\n                  <TrendingUp className=\"h-8 w-8\" />\n                  Muziƒçka Zajednica\n                </h1>\n                <p className=\"text-muted-foreground\">\n                  Podeli svoju pesmu i glasaj za omiljene pesme iz zajednice\n                </p>\n              </div>\n              <Link href=\"/moje-pesme\">\n                <Button variant=\"outline\" data-testid=\"button-my-songs\">\n                  <Music className=\"mr-2 h-4 w-4\" />\n                  Moje Pesme\n                </Button>\n              </Link>\n            </div>\n          </motion.div>\n        </FadeInWhenVisible>\n\n        <Separator className=\"mb-8\" />\n\n        {/* Songs List */}\n        <div className=\"space-y-6\">\n          {songsLoading ? (\n            <>\n              <Skeleton className=\"h-96 w-full\" />\n              <Skeleton className=\"h-96 w-full\" />\n            </>\n          ) : songs.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-16\">\n                <div className=\"text-center text-muted-foreground\">\n                  <Music className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p className=\"text-lg mb-2\">Jo≈° nema odobrenih pesama</p>\n                  <p className=\"text-sm\">Budite prvi koji ƒáe podeliti pesmu!</p>\n                  <Link href=\"/moje-pesme\">\n                    <Button className=\"mt-4\" data-testid=\"button-submit-first-song\">\n                      <Youtube className=\"mr-2 h-4 w-4\" />\n                      Dodaj Pesmu\n                    </Button>\n                  </Link>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            songs.map((song, index) => {\n              const videoId = getYoutubeVideoId(song.youtubeUrl);\n              const isTopSong = index === 0;\n              \n              return (\n                <motion.div\n                  key={song.id}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.3, delay: index * 0.05 }}\n                >\n                  <Card className={cn(\"hover-elevate active-elevate-2\", isTopSong && \"border-primary\")}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                        <div className=\"flex-1 space-y-1\">\n                          <CardTitle className=\"flex items-center gap-2 flex-wrap\">\n                            {song.songTitle}\n                            {isTopSong && (\n                              <Badge variant=\"default\" className=\"gap-1\" data-testid=\"badge-top-song\">\n                                <TrendingUp className=\"h-3 w-3\" />\n                                #1 Najpopularnija\n                              </Badge>\n                            )}\n                          </CardTitle>\n                          <CardDescription>\n                            {song.artistName} ‚Ä¢ Poslao <span className=\"inline-flex items-center gap-1\">\n                              <User className=\"h-3 w-3\" />\n                              {song.username}\n                            </span> ‚Ä¢ {format(new Date(song.submittedAt), \"dd.MM.yyyy\")}\n                          </CardDescription>\n                        </div>\n                        <Button\n                          variant={song.hasVoted ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          onClick={() => handleVote(song.id)}\n                          disabled={voteMutation.isPending || !user}\n                          className=\"gap-2\"\n                          data-testid={`button-vote-${song.id}`}\n                        >\n                          <Heart className={cn(\"h-4 w-4\", song.hasVoted && \"fill-current\")} />\n                          <span className=\"font-semibold\">{song.votesCount}</span>\n                        </Button>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      {videoId ? (\n                        <div className=\"aspect-video rounded-md overflow-hidden bg-muted\">\n                          <iframe\n                            width=\"100%\"\n                            height=\"100%\"\n                            src={`https://www.youtube.com/embed/${videoId}`}\n                            title={song.songTitle}\n                            allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                            allowFullScreen\n                            data-testid={`iframe-youtube-${song.id}`}\n                          ></iframe>\n                        </div>\n                      ) : (\n                        <div className=\"p-4 bg-muted rounded-md\">\n                          <p className=\"text-sm text-muted-foreground\">Neva≈æeƒái YouTube URL</p>\n                        </div>\n                      )}\n                    </CardContent>\n                    {!user && (\n                      <CardFooter>\n                        <p className=\"text-sm text-muted-foreground\">\n                          <Link href=\"/auth\" className=\"underline\">Prijavite se</Link> da glasate za ovu pesmu\n                        </p>\n                      </CardFooter>\n                    )}\n                  </Card>\n                </motion.div>\n              );\n            })\n          )}\n        </div>\n\n        <Separator className=\"my-12\" />\n\n        {/* Community Chat */}\n        <FadeInWhenVisible>\n          <CommunityChat />\n        </FadeInWhenVisible>\n      </div>\n    </>\n  );\n}\n","size_bytes":8936},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { SEO } from \"@/components/SEO\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Link } from \"wouter\";\nimport { format } from \"date-fns\";\nimport { \n  FolderOpen, \n  FileText, \n  Receipt, \n  MessageCircle, \n  Clock, \n  CheckCircle2, \n  XCircle,\n  LayoutDashboard,\n  Download,\n  AlertCircle,\n  Loader2\n} from \"lucide-react\";\nimport { FadeInWhenVisible } from \"@/components/motion/FadeIn\";\n\ntype Project = {\n  id: number;\n  title: string;\n  description: string;\n  genre: string;\n  status: \"waiting\" | \"in_progress\" | \"completed\" | \"cancelled\";\n  uploadDate: string;\n  approved: boolean;\n  username: string;\n};\n\ntype Contract = {\n  id: number;\n  contractNumber: string;\n  contractType: string;\n  pdfPath: string | null;\n  createdAt: string;\n  username: string;\n};\n\ntype Invoice = {\n  id: number;\n  invoiceNumber: string;\n  amount: string;\n  currency: string;\n  status: \"pending\" | \"paid\" | \"overdue\" | \"cancelled\";\n  description: string;\n  issuedDate: string;\n  dueDate: string;\n  paidDate: string | null;\n  contractNumber: string | null;\n  contractType: string | null;\n};\n\ntype DashboardOverview = {\n  totalProjects: number;\n  projectsByStatus: Record<string, number>;\n  totalContracts: number;\n  totalInvoices: number;\n  pendingInvoices: number;\n  overdueInvoices: number;\n  totalAmountPending: string;\n  unreadMessages: number;\n};\n\nconst statusConfig = {\n  waiting: { label: \"ƒåekanje\", icon: Clock, color: \"bg-yellow-500/10 text-yellow-600 dark:text-yellow-500\" },\n  in_progress: { label: \"U toku\", icon: Loader2, color: \"bg-blue-500/10 text-blue-600 dark:text-blue-500\" },\n  completed: { label: \"Zavr≈°eno\", icon: CheckCircle2, color: \"bg-green-500/10 text-green-600 dark:text-green-500\" },\n  cancelled: { label: \"Otkazano\", icon: XCircle, color: \"bg-red-500/10 text-red-600 dark:text-red-500\" },\n};\n\nconst invoiceStatusConfig = {\n  pending: { label: \"Na ƒçekanju\", color: \"bg-yellow-500/10 text-yellow-600 dark:text-yellow-500\" },\n  paid: { label: \"Plaƒáeno\", color: \"bg-green-500/10 text-green-600 dark:text-green-500\" },\n  overdue: { label: \"Prekoraƒçeno\", color: \"bg-red-500/10 text-red-600 dark:text-red-500\" },\n  cancelled: { label: \"Otkazano\", color: \"bg-gray-500/10 text-gray-600 dark:text-gray-500\" },\n};\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n\n  const { data: overview, isLoading: overviewLoading } = useQuery<DashboardOverview>({\n    queryKey: [\"/api/dashboard/overview\"],\n  });\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<Project[]>({\n    queryKey: [\"/api/user/projects\"],\n  });\n\n  const { data: contracts, isLoading: contractsLoading } = useQuery<Contract[]>({\n    queryKey: [\"/api/user/contracts\"],\n  });\n\n  const { data: invoices, isLoading: invoicesLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/user/invoices\"],\n  });\n\n  if (!user) {\n    return (\n      <div className=\"container mx-auto px-4 py-16 text-center\">\n        <SEO title=\"Dashboard - Studio LeFlow\" description=\"Klijent dashboard\" />\n        <LayoutDashboard className=\"w-16 h-16 mx-auto mb-4 text-muted-foreground\" />\n        <h2 className=\"text-2xl font-bold mb-2\">Pristup Odbijen</h2>\n        <p className=\"text-muted-foreground\">Morate biti ulogovani da pristupite dashboard-u.</p>\n        <Link href=\"/auth\">\n          <Button className=\"mt-4\" data-testid=\"button-go-to-login\">Prijavi se</Button>\n        </Link>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-7xl\">\n      <SEO title=\"Dashboard - Studio LeFlow\" description=\"Klijent dashboard sa preglednom projekata, ugovora i faktura\" />\n      \n      {/* Hero Section */}\n      <FadeInWhenVisible>\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"text-dashboard-title\">\n            Dobrodo≈°li, {user.username}!\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"text-dashboard-subtitle\">\n            Ovde mo≈æete pratiti sve svoje projekte, ugovore i fakture sa Studio LeFlow\n          </p>\n        </div>\n      </FadeInWhenVisible>\n\n      {/* Quick Stats */}\n      {overviewLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n          {[1, 2, 3, 4].map((i) => (\n            <Card key={i}>\n              <CardHeader className=\"pb-2\">\n                <Skeleton className=\"h-4 w-24\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-12 mb-2\" />\n                <Skeleton className=\"h-3 w-32\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : overview && (\n        <FadeInWhenVisible>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n            <Card data-testid=\"card-stat-projects\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Projekti</CardTitle>\n                <FolderOpen className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-projects\">{overview.totalProjects}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {overview.projectsByStatus.in_progress || 0} u toku\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-stat-contracts\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Ugovori</CardTitle>\n                <FileText className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-contracts\">{overview.totalContracts}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Ukupno ugovora\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-stat-invoices\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Fakture</CardTitle>\n                <Receipt className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-invoices\">{overview.totalInvoices}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {overview.pendingInvoices} na ƒçekanju\n                  {overview.overdueInvoices > 0 && (\n                    <span className=\"text-red-500\"> ‚Ä¢ {overview.overdueInvoices} prekoraƒçeno</span>\n                  )}\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card data-testid=\"card-stat-messages\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Poruke</CardTitle>\n                <MessageCircle className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-unread-messages\">{overview.unreadMessages}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Neproƒçitane poruke\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </FadeInWhenVisible>\n      )}\n\n      {/* Projects Section */}\n      <FadeInWhenVisible>\n        <Card className=\"mb-8\" data-testid=\"card-projects\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FolderOpen className=\"w-5 h-5\" />\n              Moji Projekti\n            </CardTitle>\n            <CardDescription>\n              Pregled svih va≈°ih projekata i njihovih statusa\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {projectsLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i} className=\"flex items-center justify-between p-4 border rounded-md\">\n                    <div className=\"flex-1\">\n                      <Skeleton className=\"h-5 w-48 mb-2\" />\n                      <Skeleton className=\"h-4 w-32\" />\n                    </div>\n                    <Skeleton className=\"h-6 w-24\" />\n                  </div>\n                ))}\n              </div>\n            ) : projects && projects.length > 0 ? (\n              <div className=\"space-y-3\">\n                {projects.map((project) => {\n                  const status = statusConfig[project.status];\n                  const StatusIcon = status.icon;\n                  \n                  return (\n                    <div\n                      key={project.id}\n                      className=\"flex items-center justify-between p-4 border rounded-md hover-elevate\"\n                      data-testid={`project-item-${project.id}`}\n                    >\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-medium\" data-testid={`text-project-title-${project.id}`}>\n                          {project.title}\n                        </h4>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {project.genre} ‚Ä¢ Uploadovano {format(new Date(project.uploadDate), \"dd.MM.yyyy.\")}\n                        </p>\n                      </div>\n                      <Badge className={`${status.color} flex items-center gap-1`} variant=\"outline\" data-testid={`badge-status-${project.id}`}>\n                        <StatusIcon className=\"w-3 h-3\" />\n                        {status.label}\n                      </Badge>\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <FolderOpen className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                <p>Nemate jo≈° uvek nijedan projekat.</p>\n                <Link href=\"/giveaway\">\n                  <Button variant=\"outline\" className=\"mt-4\" data-testid=\"button-upload-project\">\n                    Upload projekat\n                  </Button>\n                </Link>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </FadeInWhenVisible>\n\n      {/* Contracts Section */}\n      <FadeInWhenVisible>\n        <Card className=\"mb-8\" data-testid=\"card-contracts\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"w-5 h-5\" />\n              Ugovori\n            </CardTitle>\n            <CardDescription>\n              Va≈°i ugovori sa Studio LeFlow\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {contractsLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2].map((i) => (\n                  <div key={i} className=\"flex items-center justify-between p-4 border rounded-md\">\n                    <div className=\"flex-1\">\n                      <Skeleton className=\"h-5 w-32 mb-2\" />\n                      <Skeleton className=\"h-4 w-48\" />\n                    </div>\n                    <Skeleton className=\"h-9 w-28\" />\n                  </div>\n                ))}\n              </div>\n            ) : contracts && contracts.length > 0 ? (\n              <div className=\"space-y-3\">\n                {contracts.map((contract) => (\n                  <div\n                    key={contract.id}\n                    className=\"flex items-center justify-between p-4 border rounded-md hover-elevate\"\n                    data-testid={`contract-item-${contract.id}`}\n                  >\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-medium\" data-testid={`text-contract-number-${contract.id}`}>\n                        Ugovor #{contract.contractNumber}\n                      </h4>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {contract.contractType === \"mix_master\" && \"Mix & Master\"}\n                        {contract.contractType === \"copyright_transfer\" && \"Prenos autorskih prava\"}\n                        {contract.contractType === \"instrumental_sale\" && \"Prodaja instrumentala\"}\n                        {\" ‚Ä¢ \"}\n                        {format(new Date(contract.createdAt), \"dd.MM.yyyy.\")}\n                      </p>\n                    </div>\n                    {contract.pdfPath && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        asChild\n                        data-testid={`button-download-contract-${contract.id}`}\n                      >\n                        <a href={contract.pdfPath} download>\n                          <Download className=\"w-4 h-4 mr-2\" />\n                          Preuzmi PDF\n                        </a>\n                      </Button>\n                    )}\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <FileText className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                <p>Nemate nijedan ugovor.</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </FadeInWhenVisible>\n\n      {/* Invoices Section */}\n      <FadeInWhenVisible>\n        <Card className=\"mb-8\" data-testid=\"card-invoices\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Receipt className=\"w-5 h-5\" />\n              Fakture\n            </CardTitle>\n            <CardDescription>\n              Pregled svih faktura i njihovih statusa\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {invoicesLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2].map((i) => (\n                  <div key={i} className=\"flex items-center justify-between p-4 border rounded-md\">\n                    <div className=\"flex-1\">\n                      <Skeleton className=\"h-5 w-32 mb-2\" />\n                      <Skeleton className=\"h-4 w-48\" />\n                    </div>\n                    <div className=\"text-right\">\n                      <Skeleton className=\"h-6 w-24 mb-1\" />\n                      <Skeleton className=\"h-4 w-20\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : invoices && invoices.length > 0 ? (\n              <div className=\"space-y-3\">\n                {invoices.map((invoice) => {\n                  const status = invoiceStatusConfig[invoice.status];\n                  const dueDate = new Date(invoice.dueDate);\n                  const isOverdue = invoice.status === \"pending\" && dueDate < new Date();\n                  const displayStatus = isOverdue ? \"overdue\" : invoice.status;\n                  const displayStatusConfig = invoiceStatusConfig[displayStatus];\n\n                  return (\n                    <div\n                      key={invoice.id}\n                      className=\"flex items-center justify-between p-4 border rounded-md hover-elevate\"\n                      data-testid={`invoice-item-${invoice.id}`}\n                    >\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <h4 className=\"font-medium\" data-testid={`text-invoice-number-${invoice.id}`}>\n                            Faktura #{invoice.invoiceNumber}\n                          </h4>\n                          {isOverdue && (\n                            <AlertCircle className=\"w-4 h-4 text-red-500\" />\n                          )}\n                        </div>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {invoice.description}\n                        </p>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Rok: {format(dueDate, \"dd.MM.yyyy.\")}\n                          {invoice.paidDate && (\n                            <span className=\"ml-2\">\n                              ‚Ä¢ Plaƒáeno: {format(new Date(invoice.paidDate), \"dd.MM.yyyy.\")}\n                            </span>\n                          )}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"font-bold text-lg mb-1\" data-testid={`text-invoice-amount-${invoice.id}`}>\n                          {parseFloat(invoice.amount).toLocaleString('sr-RS', { minimumFractionDigits: 2 })} {invoice.currency}\n                        </div>\n                        <Badge className={displayStatusConfig.color} variant=\"outline\" data-testid={`badge-invoice-status-${invoice.id}`}>\n                          {displayStatusConfig.label}\n                        </Badge>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Receipt className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                <p>Nemate nijednu fakturu.</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </FadeInWhenVisible>\n\n      {/* Messages Quick Access */}\n      <FadeInWhenVisible>\n        <Card data-testid=\"card-messages\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <MessageCircle className=\"w-5 h-5\" />\n              Poruke\n            </CardTitle>\n            <CardDescription>\n              Brz pristup va≈°im porukama\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">\n                  {overview ? (\n                    overview.unreadMessages > 0 ? (\n                      <>Imate <span className=\"font-semibold text-foreground\">{overview.unreadMessages}</span> {overview.unreadMessages === 1 ? \"neproƒçitanu poruku\" : overview.unreadMessages < 5 ? \"neproƒçitane poruke\" : \"neproƒçitanih poruka\"}</>\n                    ) : (\n                      \"Nemate neproƒçitanih poruka\"\n                    )\n                  ) : (\n                    \"Uƒçitavanje...\"\n                  )}\n                </p>\n              </div>\n              <Link href=\"/inbox\">\n                <Button variant=\"outline\" data-testid=\"button-go-to-inbox\">\n                  Otvori Inbox\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      </FadeInWhenVisible>\n    </div>\n  );\n}\n","size_bytes":19307},"client/public/sw.js":{"content":"// Studio LeFlow Service Worker - PWA Offline Support\nconst CACHE_NAME = 'studio-leflow-v1';\nconst RUNTIME_CACHE = 'studio-leflow-runtime';\n\n// Assets to cache immediately on install\nconst PRECACHE_URLS = [\n  '/',\n  '/index.html',\n  '/favicon-192x192.png',\n  '/favicon-512x512.png',\n  '/apple-touch-icon.png'\n];\n\n// Install event - cache essential assets\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then((cache) => cache.addAll(PRECACHE_URLS))\n      .then(() => self.skipWaiting())\n  );\n});\n\n// Activate event - clean up old caches\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames\n          .filter((name) => name !== CACHE_NAME && name !== RUNTIME_CACHE)\n          .map((name) => caches.delete(name))\n      );\n    }).then(() => self.clients.claim())\n  );\n});\n\n// Fetch event - Network first, fall back to cache\nself.addEventListener('fetch', (event) => {\n  // Skip cross-origin requests\n  if (!event.request.url.startsWith(self.location.origin)) {\n    return;\n  }\n\n  // Network first strategy for API calls\n  if (event.request.url.includes('/api/')) {\n    event.respondWith(\n      fetch(event.request)\n        .then((response) => {\n          // Don't cache API responses\n          return response;\n        })\n        .catch(() => {\n          // Return offline fallback for API failures\n          return new Response(\n            JSON.stringify({ error: 'Offline - proveri internet konekciju' }),\n            {\n              status: 503,\n              headers: { 'Content-Type': 'application/json' }\n            }\n          );\n        })\n    );\n    return;\n  }\n\n  // Cache first strategy for static assets\n  event.respondWith(\n    caches.match(event.request)\n      .then((cachedResponse) => {\n        if (cachedResponse) {\n          return cachedResponse;\n        }\n\n        return fetch(event.request).then((response) => {\n          // Don't cache if not successful\n          if (!response || response.status !== 200 || response.type !== 'basic') {\n            return response;\n          }\n\n          // Clone the response\n          const responseToCache = response.clone();\n\n          caches.open(RUNTIME_CACHE)\n            .then((cache) => {\n              cache.put(event.request, responseToCache);\n            });\n\n          return response;\n        });\n      })\n      .catch(() => {\n        // Return offline page for navigation requests\n        if (event.request.mode === 'navigate') {\n          return caches.match('/');\n        }\n      })\n  );\n});\n","size_bytes":2615},"client/src/components/pwa/InstallPrompt.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { X, Share, Plus } from \"lucide-react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { isIOS, shouldShowInstallPrompt } from \"@/lib/registerServiceWorker\";\n\nexport function InstallPrompt() {\n  const [showPrompt, setShowPrompt] = useState(false);\n\n  useEffect(() => {\n    // Show prompt after 3 seconds if on iOS and not installed\n    const timer = setTimeout(() => {\n      if (shouldShowInstallPrompt()) {\n        // Check if user hasn't dismissed the prompt in the last 7 days\n        const dismissedAt = localStorage.getItem('pwa-install-prompt-dismissed');\n        const weekInMs = 7 * 24 * 60 * 60 * 1000;\n        \n        if (!dismissedAt || Date.now() - parseInt(dismissedAt) > weekInMs) {\n          setShowPrompt(true);\n        }\n      }\n    }, 3000);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    localStorage.setItem('pwa-install-prompt-dismissed', Date.now().toString());\n  };\n\n  if (!showPrompt || !isIOS()) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 left-4 right-4 z-50 animate-in slide-in-from-bottom-5\" data-testid=\"pwa-install-prompt\">\n      <Card className=\"border-primary/20 bg-card/95 backdrop-blur-sm\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-sm mb-2\">\n                Instaliraj Studio LeFlow aplikaciju\n              </h3>\n              <p className=\"text-sm text-muted-foreground mb-3\">\n                Dodaj aplikaciju na poƒçetni ekran za brz pristup i pun ekran re≈æim.\n              </p>\n              \n              <div className=\"space-y-2 text-xs text-muted-foreground\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primary\">\n                    1\n                  </span>\n                  <span>Pritisni <Share className=\"w-3 h-3 inline mx-1\" /> <strong>Share</strong> dugme ispod</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-primary/10 text-primary\">\n                    2\n                  </span>\n                  <span>Scroll dole i izaberi <strong>\"Add to Home Screen\"</strong> <Plus className=\"w-3 h-3 inline ml-1\" /></span>\n                </div>\n              </div>\n            </div>\n            \n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={handleDismiss}\n              className=\"flex-shrink-0\"\n              data-testid=\"button-dismiss-install-prompt\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3005},"client/src/lib/registerServiceWorker.ts":{"content":"// Service Worker Registration for PWA Support\nexport function registerServiceWorker() {\n  // Only register in production and if service workers are supported\n  if (\n    import.meta.env.PROD &&\n    'serviceWorker' in navigator &&\n    window.location.protocol === 'https:' || window.location.hostname === 'localhost'\n  ) {\n    window.addEventListener('load', async () => {\n      try {\n        const registration = await navigator.serviceWorker.register('/sw.js', {\n          scope: '/',\n        });\n\n        // Check for updates every hour\n        setInterval(() => {\n          registration.update();\n        }, 60 * 60 * 1000);\n\n        registration.addEventListener('updatefound', () => {\n          const newWorker = registration.installing;\n          if (newWorker) {\n            newWorker.addEventListener('statechange', () => {\n              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n                // New service worker available, show update notification\n                console.log('Nova verzija aplikacije je dostupna! Refresh-uj stranicu.');\n              }\n            });\n          }\n        });\n\n        console.log('‚úÖ PWA Service Worker registrovan uspe≈°no');\n      } catch (error) {\n        console.error('‚ùå Service Worker registracija neuspe≈°na:', error);\n      }\n    });\n  }\n}\n\n// Detect if app is running in standalone mode (installed as PWA)\nexport function isStandalone(): boolean {\n  return (\n    window.matchMedia('(display-mode: standalone)').matches ||\n    (window.navigator as any).standalone === true ||\n    document.referrer.includes('android-app://')\n  );\n}\n\n// Detect iOS device\nexport function isIOS(): boolean {\n  return /iPad|iPhone|iPod/.test(navigator.userAgent) && !(window as any).MSStream;\n}\n\n// Check if PWA installation prompt should be shown\nexport function shouldShowInstallPrompt(): boolean {\n  return isIOS() && !isStandalone();\n}\n","size_bytes":1915},"client/src/hooks/use-pwa-redirect.tsx":{"content":"import { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\n/**\n * Hook that automatically redirects users when PWA is opened in standalone mode:\n * - Logged in users ‚Üí / (home page)\n * - Not logged in users ‚Üí /auth (authentication page)\n * \n * Redirect happens only once per session to prevent infinite loops.\n */\nexport function usePWARedirect() {\n  const [location, setLocation] = useLocation();\n  const { user, isLoading } = useAuth();\n\n  useEffect(() => {\n    // Check if we're in PWA standalone mode\n    const isPWA = window.matchMedia('(display-mode: standalone)').matches || \n                  (window.navigator as any).standalone === true; // iOS Safari\n\n    if (!isPWA) {\n      return; // Not a PWA, skip redirect\n    }\n\n    // Check if we've already done the initial redirect this session\n    const hasRedirected = sessionStorage.getItem('pwa_initial_redirect');\n    \n    if (hasRedirected) {\n      return; // Already redirected, don't redirect again\n    }\n\n    // Wait for auth to load\n    if (isLoading) {\n      return;\n    }\n\n    // Mark that we've done the initial redirect\n    sessionStorage.setItem('pwa_initial_redirect', 'true');\n\n    // Perform redirect based on auth status\n    if (user) {\n      // User is logged in ‚Üí redirect to home page\n      if (location !== '/') {\n        console.log('[PWA] Redirecting logged in user to home page');\n        setLocation('/');\n      }\n    } else {\n      // User is not logged in ‚Üí redirect to auth page\n      if (location !== '/auth') {\n        console.log('[PWA] Redirecting guest user to auth page');\n        setLocation('/auth');\n      }\n    }\n  }, [user, isLoading, location, setLocation]);\n}\n","size_bytes":1724},"client/src/components/community/CommunityChat.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useWebSocketContext } from \"@/contexts/WebSocketContext\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertCommunityMessageSchema, type InsertCommunityMessage } from \"@shared/schema\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { sr } from \"date-fns/locale\";\nimport { Crown, Trophy, Shield, User as UserIcon, Trash2, Send, MessageSquare } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem } from \"@/components/ui/form\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { cn } from \"@/lib/utils\";\n\ntype CommunityMessageWithUser = {\n  id: number;\n  userId: number;\n  username: string;\n  rank: \"user\" | \"vip\" | \"legend\" | \"admin\";\n  message: string;\n  createdAt: string;\n};\n\nfunction getRankColor(rank: string): string {\n  switch (rank) {\n    case \"vip\":\n      return \"text-blue-500 dark:text-blue-400\";\n    case \"legend\":\n      return \"text-yellow-500 dark:text-yellow-400\";\n    case \"admin\":\n      return \"text-destructive\";\n    default:\n      return \"text-muted-foreground\";\n  }\n}\n\nfunction getRankIcon(rank: string) {\n  switch (rank) {\n    case \"vip\":\n      return <Crown className=\"h-3 w-3 text-blue-500 dark:text-blue-400\" />;\n    case \"legend\":\n      return <Trophy className=\"h-3 w-3 text-yellow-500 dark:text-yellow-400\" />;\n    case \"admin\":\n      return <Shield className=\"h-3 w-3 text-destructive\" />;\n    default:\n      return null;\n  }\n}\n\ninterface MessageItemProps {\n  message: CommunityMessageWithUser;\n  isOwnMessage: boolean;\n  isAdmin: boolean;\n  onDelete: (messageId: number) => void;\n}\n\nfunction MessageItem({ message, isOwnMessage, isAdmin, onDelete }: MessageItemProps) {\n  const canDelete = isOwnMessage || isAdmin;\n  const rankIcon = getRankIcon(message.rank);\n\n  return (\n    <div\n      className={cn(\"flex flex-col gap-1.5\", isOwnMessage ? \"items-end\" : \"items-start\")}\n      data-testid={`message-${message.id}`}\n    >\n      <div className=\"flex items-center gap-2\">\n        {!isOwnMessage && (\n          <Avatar className=\"h-7 w-7\">\n            <AvatarFallback className=\"text-xs\">\n              {message.username.substring(0, 2).toUpperCase()}\n            </AvatarFallback>\n          </Avatar>\n        )}\n        <div className=\"flex items-center gap-1.5\">\n          {rankIcon}\n          <span className={cn(\"text-sm font-semibold\", getRankColor(message.rank))}>\n            {message.username}\n          </span>\n        </div>\n        {isOwnMessage && (\n          <Avatar className=\"h-7 w-7\">\n            <AvatarFallback className=\"text-xs\">\n              {message.username.substring(0, 2).toUpperCase()}\n            </AvatarFallback>\n          </Avatar>\n        )}\n      </div>\n\n      <div className={cn(\"flex items-start gap-2 max-w-[80%]\", isOwnMessage ? \"flex-row-reverse\" : \"flex-row\")}>\n        <div\n          className={cn(\n            \"rounded-lg px-4 py-3 shadow-sm\",\n            isOwnMessage \n              ? \"bg-primary text-primary-foreground\" \n              : \"bg-muted border border-border\"\n          )}\n        >\n          <p className=\"text-sm leading-relaxed whitespace-pre-wrap break-words\">{message.message}</p>\n        </div>\n\n        {canDelete && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-7 w-7 opacity-0 group-hover:opacity-100 focus-visible:opacity-100 transition-opacity\"\n            onClick={() => onDelete(message.id)}\n            data-testid={`button-delete-message-${message.id}`}\n          >\n            <Trash2 className=\"h-3.5 w-3.5 text-destructive\" />\n          </Button>\n        )}\n      </div>\n\n      <span className={cn(\"text-xs text-muted-foreground px-1\", isOwnMessage ? \"mr-1\" : \"\")} data-testid={`timestamp-${message.id}`}>\n        {formatDistanceToNow(new Date(message.createdAt), { addSuffix: true, locale: sr })}\n      </span>\n    </div>\n  );\n}\n\ninterface MessageListProps {\n  messages: CommunityMessageWithUser[];\n  isLoading: boolean;\n  currentUserId: number | undefined;\n  isAdmin: boolean;\n  onDelete: (messageId: number) => void;\n  containerRef: React.RefObject<HTMLDivElement>;\n  endRef: React.RefObject<HTMLDivElement>;\n}\n\nfunction MessageList({ messages, isLoading, currentUserId, isAdmin, onDelete, containerRef, endRef }: MessageListProps) {\n  if (isLoading) {\n    return (\n      <ScrollArea className=\"h-[450px] px-6 bg-muted/30 rounded-lg\">\n        <div className=\"space-y-5 py-6\">\n          {[1, 2, 3].map((i) => (\n            <div key={i} className=\"flex flex-col gap-2\">\n              <Skeleton className=\"h-4 w-28\" />\n              <Skeleton className=\"h-20 w-3/4\" />\n            </div>\n          ))}\n        </div>\n      </ScrollArea>\n    );\n  }\n\n  if (messages.length === 0) {\n    return (\n      <ScrollArea className=\"h-[450px] px-6 bg-muted/30 rounded-lg\">\n        <div className=\"flex flex-col items-center justify-center h-full text-center text-muted-foreground\">\n          <MessageSquare className=\"h-16 w-16 mb-4 opacity-40\" />\n          <p className=\"text-lg font-medium mb-2\">Nema poruka u chatu</p>\n          <p className=\"text-sm\">Budite prvi koji ƒáe poslati poruku!</p>\n        </div>\n      </ScrollArea>\n    );\n  }\n\n  return (\n    <ScrollArea className=\"h-[450px] px-6 bg-muted/30 rounded-lg\" ref={containerRef}>\n      <div className=\"space-y-5 py-6\">\n        {messages.map((message) => (\n          <div key={message.id} className=\"group\">\n            <MessageItem\n              message={message}\n              isOwnMessage={message.userId === currentUserId}\n              isAdmin={isAdmin}\n              onDelete={onDelete}\n            />\n          </div>\n        ))}\n        <div ref={endRef} />\n      </div>\n    </ScrollArea>\n  );\n}\n\ninterface MessageInputProps {\n  onSubmit: (message: string) => void;\n  isPending: boolean;\n  cooldownSeconds: number;\n  resetTrigger?: number;\n}\n\nfunction MessageInput({ onSubmit, isPending, cooldownSeconds, resetTrigger }: MessageInputProps) {\n  const form = useForm<InsertCommunityMessage>({\n    resolver: zodResolver(insertCommunityMessageSchema),\n    defaultValues: {\n      message: \"\",\n    },\n  });\n\n  const handleSubmit = (data: InsertCommunityMessage) => {\n    onSubmit(data.message);\n  };\n\n  useEffect(() => {\n    if (resetTrigger) {\n      form.reset({ message: \"\" });\n    }\n  }, [resetTrigger, form]);\n\n  return (\n    <div className=\"bg-card rounded-lg border p-4\">\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-3\">\n          <FormField\n            control={form.control}\n            name=\"message\"\n            render={({ field }) => (\n              <FormItem>\n                <FormControl>\n                  <Textarea\n                    {...field}\n                    placeholder=\"Napi≈°i poruku...\"\n                    maxLength={85}\n                    rows={2}\n                    disabled={isPending || cooldownSeconds > 0}\n                    data-testid=\"textarea-message\"\n                    className=\"resize-none focus-visible:ring-1\"\n                  />\n                </FormControl>\n              </FormItem>\n            )}\n          />\n\n          <div className=\"flex items-center justify-between gap-3\">\n            {cooldownSeconds > 0 ? (\n              <p className=\"text-sm font-medium text-destructive\" data-testid=\"text-cooldown\">\n                Sledeƒáa poruka za {cooldownSeconds}s\n              </p>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">\n                {form.watch(\"message\")?.length || 0}/85 karaktera\n              </p>\n            )}\n\n            <Button\n              type=\"submit\"\n              disabled={isPending || cooldownSeconds > 0 || !form.watch(\"message\")?.trim()}\n              data-testid=\"button-send-message\"\n              className=\"gap-2\"\n              size=\"default\"\n            >\n              <Send className=\"h-4 w-4\" />\n              Po≈°alji\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}\n\nexport function CommunityChat() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { subscribe } = useWebSocketContext();\n  const [messages, setMessages] = useState<CommunityMessageWithUser[]>([]);\n  const [cooldownSeconds, setCooldownSeconds] = useState(0);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const endRef = useRef<HTMLDivElement>(null);\n  const cooldownIntervalRef = useRef<NodeJS.Timeout>();\n\n  const { data: fetchedMessages = [], isLoading } = useQuery<CommunityMessageWithUser[]>({\n    queryKey: [\"/api/community-chat\"],\n    enabled: !!user,\n  });\n\n  useEffect(() => {\n    setMessages(fetchedMessages);\n  }, [fetchedMessages]);\n\n  const isNearBottom = () => {\n    const container = containerRef.current;\n    if (!container) return true;\n\n    const scrollArea = container.querySelector('[data-radix-scroll-area-viewport]');\n    if (!scrollArea) return true;\n\n    const { scrollHeight, scrollTop, clientHeight } = scrollArea;\n    return scrollHeight - (scrollTop + clientHeight) < 64;\n  };\n\n  const scrollToBottom = (smooth = true) => {\n    if (isNearBottom()) {\n      endRef.current?.scrollIntoView({ behavior: smooth ? \"smooth\" : \"auto\" });\n    }\n  };\n\n  useEffect(() => {\n    scrollToBottom(false);\n  }, [messages]);\n\n  const [formResetTrigger, setFormResetTrigger] = useState(0);\n\n  const postMutation = useMutation({\n    mutationFn: async (message: string) => {\n      return apiRequest(\"POST\", \"/api/community-chat\", { message });\n    },\n    onSuccess: (res) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-chat\"] });\n      setFormResetTrigger(prev => prev + 1);\n    },\n    onError: (error: Error) => {\n      if (error.message.includes(\"Rate limit\") || error.message.includes(\"10 sekund\")) {\n        setCooldownSeconds(10);\n        \n        if (cooldownIntervalRef.current) {\n          clearInterval(cooldownIntervalRef.current);\n        }\n\n        cooldownIntervalRef.current = setInterval(() => {\n          setCooldownSeconds((prev) => {\n            if (prev <= 1) {\n              if (cooldownIntervalRef.current) {\n                clearInterval(cooldownIntervalRef.current);\n              }\n              return 0;\n            }\n            return prev - 1;\n          });\n        }, 1000);\n\n        toast({\n          title: \"Saƒçekajte malo\",\n          description: \"Mo≈æete slati poruke svakih 10 sekundi\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Gre≈°ka\",\n          description: error.message || \"Nije moguƒáe poslati poruku\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (messageId: number) => {\n      return apiRequest(\"DELETE\", `/api/community-chat/${messageId}`, {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-chat\"] });\n      toast({\n        title: \"Uspe≈°no\",\n        description: \"Poruka je obrisana\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Nije moguƒáe obrisati poruku\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const clearAllMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"DELETE\", \"/api/community-chat/clear\", {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-chat\"] });\n      toast({\n        title: \"Uspe≈°no\",\n        description: \"Sve poruke su obrisane\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gre≈°ka\",\n        description: error.message || \"Nije moguƒáe obrisati sve poruke\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    const unsubscribe = subscribe((message) => {\n      if (message.type === \"community-chat:new\") {\n        const newMessage = message.message as CommunityMessageWithUser;\n        setMessages((prev) => {\n          if (prev.some(m => m.id === newMessage.id)) {\n            return prev;\n          }\n          const updated = [...prev, newMessage];\n          return updated;\n        });\n        setTimeout(() => scrollToBottom(true), 100);\n      } else if (message.type === \"community-chat:delete\") {\n        setMessages((prev) => prev.filter((m) => m.id !== message.messageId));\n      } else if (message.type === \"community-chat:clear\") {\n        setMessages([]);\n      }\n    });\n\n    return unsubscribe;\n  }, [subscribe]);\n\n  useEffect(() => {\n    return () => {\n      if (cooldownIntervalRef.current) {\n        clearInterval(cooldownIntervalRef.current);\n      }\n    };\n  }, []);\n\n  const handleSubmit = (message: string) => {\n    postMutation.mutate(message);\n  };\n\n  const handleDelete = (messageId: number) => {\n    deleteMutation.mutate(messageId);\n  };\n\n  if (!user) {\n    return (\n      <Card className=\"w-full max-w-5xl mx-auto shadow-sm\">\n        <CardContent className=\"py-20\">\n          <div className=\"text-center text-muted-foreground\">\n            <MessageSquare className=\"h-16 w-16 mx-auto mb-6 opacity-40\" />\n            <p className=\"text-xl font-semibold mb-3\">Prijavite se da pristupite chatu</p>\n            <p className=\"text-sm\">Chat zajednice je dostupan samo registrovanim korisnicima</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const isAdmin = user.role === \"admin\" || user.rank === \"admin\";\n\n  return (\n    <Card className=\"w-full max-w-5xl mx-auto shadow-lg\">\n      <CardHeader className=\"border-b bg-muted/50\">\n        <div className=\"flex items-center justify-between flex-wrap gap-4\">\n          <div>\n            <CardTitle className=\"flex items-center gap-3 text-2xl\">\n              <MessageSquare className=\"h-7 w-7 text-primary\" />\n              Chat Zajednice\n            </CardTitle>\n            <CardDescription className=\"mt-2\">\n              Razgovarajte u real-time sa drugim ƒçlanovima zajednice Studio LeFlow\n            </CardDescription>\n          </div>\n          <Badge variant=\"secondary\" className=\"gap-1.5\">\n            <UserIcon className=\"h-3 w-3\" />\n            {messages.length} {\n              messages.length === 1 ? 'poruka' : \n              messages.length >= 2 && messages.length <= 4 ? 'poruke' : \n              'poruka'\n            }\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-6 space-y-6\">\n        <MessageList\n          messages={messages}\n          isLoading={isLoading}\n          currentUserId={user.id}\n          isAdmin={isAdmin}\n          onDelete={handleDelete}\n          containerRef={containerRef}\n          endRef={endRef}\n        />\n\n        <MessageInput\n          onSubmit={handleSubmit}\n          isPending={postMutation.isPending}\n          cooldownSeconds={cooldownSeconds}\n          resetTrigger={formResetTrigger}\n        />\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":15746}},"version":2}